!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@zxing/library"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ajf/core/barcode",["exports","@angular/core","@zxing/library","rxjs","rxjs/operators"],e):e(((t=t||self).ajf=t.ajf||{},t.ajf.core=t.ajf.core||{},t.ajf.core.barcode={}),t.ng.core,t.zxing,t.rxjs,t.rxjs.operators)}(this,(function(t,e,r,o,n){"use strict";
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var i=function(){function t(t,i){var a=this;this._cdr=t,this._renderer=i,this.codeReader=new r.BrowserBarcodeReader,this.startDetection=new e.EventEmitter,this.startCalculation=new e.EventEmitter,this._startDetectionSub=o.Subscription.EMPTY,this._startCalculationSub=o.Subscription.EMPTY,this._barcodeValue="",this._toggle="drop",this._onChangeCallback=function(t){},this._onTouchedCallback=function(){},this._init(),this._startDetectionSub=this.startDetection.pipe(n.debounceTime(300),n.switchMap((function(){var t=a._getDataFromVideo(a.videoSource);return a._readBarcodeFromData(t)})),n.catchError((function(){return o.of({})}))).subscribe((function(t){t.text?(a.toggle="drop",a.value=t.text):a.startDetection.emit()})),this._startCalculationSub=this.startCalculation.pipe(n.switchMap((function(t){return a._readBarcodeFromData(t)}))).subscribe((function(t){t.text&&(a.toggle="drop",a.value=t.text)}))}return Object.defineProperty(t.prototype,"canvasCtx",{get:function(){return this._canvas.getContext("2d")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoSource",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._barcodeValue},set:function(t){this._barcodeValue!==t&&(this._barcodeValue=t,this._cdr.detectChanges(),this._onChangeCallback(t))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toggle",{get:function(){return this._toggle},set:function(t){this._toggle=t,this._cdr.markForCheck()},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.value="",this._onTouchedCallback()},t.prototype.takeSnapshot=function(){this.startDetection.emit()},t.prototype.onSelectFile=function(t){null!=t&&null!=t.target&&this._onSelect(t.target.files)},t.prototype.onSelectDrop=function(t){null!=t&&this._onSelect(t)},t.prototype.writeValue=function(t){this._barcodeValue=t},t.prototype.registerOnChange=function(t){this._onChangeCallback=t},t.prototype.registerOnTouched=function(t){this._onTouchedCallback=t},t.prototype.ngOnDestroy=function(){this._startCalculationSub.unsubscribe(),this._startDetectionSub.unsubscribe()},t.prototype._init=function(){this._initCanvas(),this._initVideo()},t.prototype._initCanvas=function(){this._canvas=this._renderer.createElement("canvas"),this._canvas.height=480,this._canvas.width=640},t.prototype._initVideo=function(){this._video=this._renderer.createElement("video"),this._video.height=480,this._video.width=640},t.prototype._onSelect=function(t){var e=this;if(null!=t&&t.length>0&&t[0]){var r=new FileReader;r.readAsDataURL(t[0]),r.onload=function(t){e.startCalculation.emit(t.target.result),e._cdr.detectChanges()}}},t.prototype._getDataFromVideo=function(t){return this.canvasCtx.drawImage(t,0,0,640,480),this._canvas.toDataURL("image/png")},t.prototype._readBarcodeFromImage=function(t){return o.from(this.codeReader.decodeFromImage(t)).pipe(n.catchError((function(t){return o.of(t)})))},t.prototype._readBarcodeFromData=function(t){var e=this._createImage(t);return this._readBarcodeFromImage(e)},t.prototype._createImage=function(t){var e=this._renderer.createElement("img");return null!==t&&"string"==typeof t&&(e.src=t),e},t}();i.decorators=[{type:e.Directive}],i.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:e.Renderer2}]},
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
t.AjfBarcode=i,Object.defineProperty(t,"__esModule",{value:!0})}));