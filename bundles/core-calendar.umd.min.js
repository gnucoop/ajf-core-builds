!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("date-fns"),require("tslib"),require("rxjs")):"function"==typeof define&&define.amd?define("@ajf/core/calendar",["exports","@angular/core","date-fns","tslib","rxjs"],t):t(((e=e||self).ajf=e.ajf||{},e.ajf.core=e.ajf.core||{},e.ajf.core.calendar={}),e.ng.core,e.dateFns,e.tslib)}(this,(function(e,t,r,n,a){"use strict";
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function i(e,t,n){return(r.isAfter(e,t)||r.isSameDay(e,t))&&(r.isBefore(e,n)||r.isSameDay(e,n))}function o(e){return["day","week","month","year"].indexOf(e)}var s=function(){function e(){}return e.prototype.buildView=function(e){var t=e.viewDate;switch(e.viewMode){case"decade":var n=t.getFullYear(),a=n-n%10+1;return{header:a+" - "+(a+11),headerRow:[],rows:this._decadeCalendarRows(e)};case"year":return{header:""+t.getFullYear(),headerRow:[],rows:this._yearCalendarRows(e)};case"month":return{header:r.format(t,"MMM yyyy"),headerRow:this._monthHeaderRow(e),rows:this._monthCalendarRows(e)}}return{header:"",headerRow:[],rows:[]}},e.prototype.monthBounds=function(e,t){if(!t)return{start:r.startOfMonth(e),end:r.endOfMonth(e)};e=r.getISODay(e)<4?r.endOfISOWeek(e):r.startOfISOWeek(e);var n=r.startOfMonth(e),a=r.endOfMonth(n),i=n.getDay(),o=a.getDay();return(0==i||i>4)&&(n=r.addWeeks(n,1)),o>0&&o<4&&(a=r.subWeeks(a,1)),{start:n=r.startOfISOWeek(n),end:a=r.endOfISOWeek(a)}},e.prototype.getEntryRange=function(e){if("day"===e.type)return{start:new Date(e.date),end:new Date(e.date)};var t=new Date(e.date);return{start:"month"===e.type?r.startOfMonth(t):r.startOfYear(t),end:"month"===e.type?r.endOfMonth(t):r.endOfYear(t)}},e.prototype.isEntrySelected=function(e,t){if(null!=t&&null!=t.startDate&&null!=t.endDate){var n=r.startOfDay(t.startDate),a=r.endOfDay(t.endDate),s=o(t.type),d=o(e.type),c=this.getEntryRange(e);if(d<=s&&i(c.start,n,a)&&i(c.end,n,a))return"full";if(d>s&&i(n,c.start,c.end)&&i(a,c.start,c.end))return"partial"}return"none"},e.prototype.entryLabel=function(e){return"day"===e.type?""+e.date.getDate():"month"===e.type?r.format(e.date,"MMM"):""+e.date.getFullYear()},e.prototype.nextView=function(e,t){return"month"==t?r.addMonths(e,1):"year"==t?r.addYears(e,1):"decade"==t?r.addYears(e,10):e},e.prototype.previousView=function(e,t){return"month"==t?r.subMonths(e,1):"year"==t?r.subYears(e,1):"decade"==t?r.subYears(e,10):e},e.prototype._monthHeaderRow=function(e){var t,n=e.viewDate;t=e.isoMode?r.setISODay(r.startOfWeek(n),1):r.startOfWeek(n);for(var a=[],i=0;i<7;i++)a.push(r.format(t,"EEE")),t=r.addDays(t,1);return a},e.prototype._decadeCalendarRows=function(e){var t=e.viewDate,n=e.selection,a=t.getFullYear(),i=a-a%10+1,o=r.startOfYear(t);o.setFullYear(i);for(var s=[],d=0;d<4;d++){for(var c=[],l=0;l<3;l++){var u={type:"year",date:new Date(o),selected:"none"};u.selected=this.isEntrySelected(u,n),c.push(u),o=r.addYears(o,1)}s.push(c)}return s},e.prototype._yearCalendarRows=function(e){for(var t=e.selection,n=r.startOfYear(e.viewDate),a=[],i=0;i<4;i++){for(var o=[],s=0;s<3;s++){var d={type:"month",date:new Date(n),selected:"none"};d.selected=this.isEntrySelected(d,t),o.push(d),n=r.addMonths(n,1)}a.push(o)}return a},e.prototype._monthCalendarRows=function(e){var t=e.selection,n=e.isoMode,a=e.minDate,i=e.maxDate,o=this.monthBounds(e.viewDate,n),s=new Date(o.start),d=new Date(o.end);n||(s=r.startOfWeek(s),d=r.endOfWeek(d));for(var c=[],l=new Date,u=new Date(s);u<d;){for(var h=[],f=0;f<7;f++){var y=null!=a&&r.isBefore(u,a)||null!=i&&r.isAfter(u,i),p={type:"day",date:new Date(u),selected:"none",highlight:r.format(l,"yyyy-MM-dd")===r.format(u,"yyyy-MM-dd"),disabled:y};p.selected=this.isEntrySelected(p,t),h.push(p),u=r.addDays(u,1)}c.push(h)}return c},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ɵprov=t["ɵɵdefineInjectable"]({factory:function t(){return new e},token:e,providedIn:"root"}),e}(),d=function(){function e(e){this._service=e}return e.prototype.transform=function(e){return this._service.entryLabel(e)},e.decorators=[{type:t.Injectable},{type:t.Pipe,args:[{name:"ajfCalendarEntryLabel"}]}],e.ctorParameters=function(){return[{type:s}]},e}(),c=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[d],exports:[d]}]}],e}(),l=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{providers:[s]}]}],e}(),u=function u(){},h=["","monday","tuesday","wednesday","thursday","friday","saturday","sunday"],f=function f(){},y=function(){function e(e,r){this._cdr=e,this._service=r,this._disabled=!1,this._dateOnlyForDay=!1,this._viewMode="month",this._selectionMode="day",this._startOfWeekDay=1,this._isoMode=!1,this._change=new t.EventEmitter,this.change=this._change.asObservable(),this._viewDate=new Date,this._viewHeader="",this._calendarRows=[],this._calendarHeaders=[],this._onChangeCallback=function(e){},this._onTouchedCallback=function(){}}return Object.defineProperty(e.prototype,"viewDate",{get:function(){return this._viewDate},set:function(e){this._setViewDate(e),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=null!=e&&""+e!="false";t!==this._disabled&&(this._disabled=t,this._cdr.markForCheck())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateOnlyForDay",{get:function(){return this._disabled},set:function(e){this._dateOnlyForDay=null!=e&&""+e!="false",this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMode",{get:function(){return this._viewMode},set:function(e){this._viewMode=e,this._buildCalendar(),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this._selectionMode},set:function(e){this._selectionMode=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startOfWeekDay",{get:function(){return h[this._startOfWeekDay]},set:function(e){this._startOfWeekDay=h.indexOf(e),"month"===this._viewMode&&this._buildCalendar(),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isoMode",{get:function(){return this._isoMode},set:function(e){this._isoMode=e,this._buildCalendar()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minDate",{get:function(){return this._minDate},set:function(e){this._minDate=null!=e?new Date(e.valueOf()):null,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxDate",{get:function(){return this._maxDate},set:function(e){this._maxDate=null!=e?new Date(e.valueOf()):null,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedPeriod",{set:function(e){this._selectedPeriod=e,this._change.emit({source:this,period:e}),this._refreshSelection(),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._dateOnlyForDay&&"day"===this.selectionMode?null!=this._selectedPeriod?this._selectedPeriod.startDate:null:this._selectedPeriod},set:function(e){this._dateOnlyForDay&&"day"===this.selectionMode&&e instanceof Date&&(null==this._selectedPeriod||e!==this._selectedPeriod.startDate)?this.selectedPeriod={type:"day",startDate:e,endDate:e}:e instanceof Object&&e!==this._selectedPeriod&&(this.selectedPeriod=e,this._onChangeCallback(e)),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"calendarHeaders",{get:function(){return this._calendarHeaders},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"calendarRows",{get:function(){return this._calendarRows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewHeader",{get:function(){return this._viewHeader},enumerable:!0,configurable:!0}),e.prototype.prevPage=function(){this.viewDate=this._service.previousView(this._viewDate,this._viewMode),this._buildCalendar()},e.prototype.nextPage=function(){this.viewDate=this._service.nextView(this._viewDate,this._viewMode),this._buildCalendar()},e.prototype.previousViewMode=function(){"decade"!=this._viewMode&&("year"==this._viewMode?this._viewMode="decade":"month"==this._viewMode&&(this._viewMode="year"),this._buildCalendar())},e.prototype.selectEntry=function(e){if(!this._canSelectEntry(e))return this._nextViewMode(e);var t=null;if("full"==this._service.isEntrySelected(e,this._selectedPeriod))t=null;else if("day"==this._selectionMode)t={type:"day",startDate:e.date,endDate:e.date};else if("week"==this._selectionMode)t={type:"week",startDate:this._isoMode?r.startOfISOWeek(e.date):r.startOfWeek(e.date,{weekStartsOn:this._startOfWeekDay}),endDate:this._isoMode?r.endOfISOWeek(e.date):r.endOfWeek(e.date,{weekStartsOn:this._startOfWeekDay})};else if("month"==this._selectionMode){var n=this._service.monthBounds(e.date,this._isoMode);t={type:"month",startDate:new Date(n.start),endDate:new Date(n.end)}}else"year"==this._selectionMode&&(t={type:"year",startDate:r.startOfYear(e.date),endDate:r.endOfYear(e.date)});this.value=t,this._onTouchedCallback(),this._cdr.markForCheck()},e.prototype.registerOnChange=function(e){this._onChangeCallback=e},e.prototype.registerOnTouched=function(e){this._onTouchedCallback=e},e.prototype.writeValue=function(e){"string"==typeof e&&(e=r.parseISO(e)),this.value=e},e.prototype.ngOnInit=function(){this._buildCalendar()},e.prototype.ngAfterContentInit=function(){this._refreshSelection()},e.prototype._setViewDate=function(e){this._viewDate=e},e.prototype._buildCalendar=function(){var e=this._service.buildView({viewMode:this._viewMode,viewDate:this._viewDate,selection:this._selectedPeriod,isoMode:this._isoMode,minDate:null==this._minDate?null:new Date(this._minDate),maxDate:null==this._maxDate?null:new Date(this._maxDate)});this._viewHeader=e.header,this._calendarHeaders=e.headerRow,this._calendarRows=e.rows,this._cdr.markForCheck()},e.prototype._refreshSelection=function(){var e,t,r,a;try{for(var i=n.__values(this._calendarRows),o=i.next();!o.done;o=i.next()){var s=o.value;try{for(var d=(r=void 0,n.__values(s)),c=d.next();!c.done;c=d.next()){var l=c.value;l.selected=this._service.isEntrySelected(l,this._selectedPeriod)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(a=d.return)&&a.call(d)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype._canSelectEntry=function(e){return!(["day","week"].indexOf(this._selectionMode)>=0&&"day"!=e.type||"month"==this._selectionMode&&"year"==e.type)},e.prototype._nextViewMode=function(e){if("decade"==this._viewMode)this._viewMode="year";else if("year"==this._viewMode)this._viewMode="month";else if("month"==this._viewMode)return;this._viewDate=e.date,this._buildCalendar()},e.decorators=[{type:t.Directive}],e.ctorParameters=function(){return[{type:t.ChangeDetectorRef},{type:s}]},e.propDecorators={viewDate:[{type:t.Input}],disabled:[{type:t.Input}],dateOnlyForDay:[{type:t.Input}],viewMode:[{type:t.Input}],selectionMode:[{type:t.Input}],startOfWeekDay:[{type:t.Input}],isoMode:[{type:t.Input}],minDate:[{type:t.Input}],maxDate:[{type:t.Input}],change:[{type:t.Output}],selectedPeriod:[{type:t.Input}],value:[{type:t.Input}]},e}();
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
e.AjfCalendar=y,e.AjfCalendarChange=f,e.AjfCalendarEntryLabelPipe=d,e.AjfCalendarModule=c,e.AjfCalendarPeriod=u,e.AjfCalendarService=s,e.AjfGregorianCalendarModule=l,Object.defineProperty(e,"__esModule",{value:!0})}));