!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("chart.js"),require("tslib"),require("@angular/core"),require("chart.piecelabel.js"),require("@ajf/core/utils")):"function"==typeof define&&define.amd?define("@ajf/core/chart",["exports","chart.js","tslib","@angular/core","chart.piecelabel.js","@ajf/core/utils"],e):e(((t=t||self).ajf=t.ajf||{},t.ajf.core=t.ajf.core||{},t.ajf.core.chart={}),t.Chart,t.tslib,t.ng.core,0,t.ng.core.utils)}(this,(function(t,e,a,r,n,i){"use strict";var s="default"in e?e.default:e,h=s||e,o=s||e,l=function(){function t(t,e){this._el=t,this._renderer=e,this._chartTypesNeedPoints=["scatter","bubble"]}return t.prototype.ngAfterViewInit=function(){this._rebuildChart()},t.prototype.ngOnChanges=function(t){"chartType"in t?this._rebuildChart():("options"in t||"data"in t)&&this._updateChart()},t.prototype._fixData=function(t,e){var a=this,r=i.deepCopy(e),n=0;(r.datasets||[]).forEach((function(e){null==e.label&&(e.label=""),n=Math.max(n,(e.data||[]).length),a._chartTypesNeedPoints.indexOf(null!=e.type?e.type:t)>-1&&(e.data=(e.data||[]).map((function(t,e){return"number"==typeof t?{x:e,y:t,r:t}:t})))}));var s=r.labels||[];if(n>0&&s.length<n){for(var h=s.length;h<n;h++)s.push("");r.labels=s}return r},t.prototype._updateChart=function(){null==this._chart?this._rebuildChart():(this._chart.options=a.__assign(a.__assign({},i.deepCopy(this._chart.options)),i.deepCopy(this.options||{})),this._chart.data=a.__assign(a.__assign({},i.deepCopy(this._chart.data)),i.deepCopy(this.data)),this._chart.update())},t.prototype._rebuildChart=function(){if(null!=this._chart&&(this._chart.destroy(),this._chart=null),null!=this._chartCanvasElement&&(this._renderer.removeChild(this._el.nativeElement,this._chartCanvasElement),this._chartCanvasElement=null),null!=this.data){this._chartCanvasElement=this._renderer.createElement("canvas"),this._renderer.setStyle(this._chartCanvasElement,"width","inherit"),this._renderer.setStyle(this._chartCanvasElement,"height","inherit"),this._renderer.appendChild(this._el.nativeElement,this._chartCanvasElement);var t=this._chartCanvasElement.getContext("2d");this._chart=new o(t,{type:this.chartType,data:this._fixData(this.chartType,this.data),options:this._fixChartOptions(this.options)})}},t.prototype._fixChartOptions=function(t){if(null==(t=t||{}).scales&&(t.scales={xAxes:[],yAxes:[]}),null==t.scales.xAxes&&(t.scales.xAxes=[]),null==t.scales.yAxes&&(t.scales.yAxes=[]),"pie"==this.chartType){var e=t;return e.pieceLabel={render:function(t){return t.label?t.label+":"+t.value:t.value},position:"outside"},e}return t},t.decorators=[{type:r.Component,args:[{selector:"ajf-chart",template:"",changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,styles:["ajf-chart{display:block;width:inherit;height:inherit;position:relative}\n"]}]}],t.ctorParameters=function(){return[{type:r.ElementRef},{type:r.Renderer2}]},t.propDecorators={data:[{type:r.Input}],options:[{type:r.Input}],chartType:[{type:r.Input}]},t}(),c=function(){function t(){}return t.decorators=[{type:r.NgModule,args:[{declarations:[l],exports:[l]}]}],t}();
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
t.AjfChartComponent=l,t.AjfChartModule=c,t.registerChartPlugins=function p(t){null!=t&&t.length>0&&t.forEach((function(t){return h.plugins.register(t)}))}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */,Object.defineProperty(t,"__esModule",{value:!0})}));