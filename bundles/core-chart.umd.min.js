!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("chart.js"),require("@ajf/core/utils"),require("@angular/core")):"function"==typeof define&&define.amd?define("@ajf/core/chart",["exports","chart.js","@ajf/core/utils","@angular/core"],t):t(((e=e||self).ajf=e.ajf||{},e.ajf.core=e.ajf.core||{},e.ajf.core.chart={}),e.Chart,e.ajf.core.utils,e.ng.core)}(this,(function(e,t,n,a){"use strict";
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var i,r=function(){function e(e,t){this._el=e,this._renderer=t,this._chartTypesNeedPoints=["scatter","bubble"]}return e.prototype.ngAfterViewInit=function(){this._rebuildChart()},e.prototype.ngOnChanges=function(e){var t=this;"chartType"in e?this._rebuildChart():("options"in e||"data"in e)&&this._updateChart(),"instance"in e&&(this.instance.canvasDataUrl=function(){return null==t._chartCanvasElement?"":t._chartCanvasElement.toDataURL()})},e.prototype._fixData=function(e,t){var a=this,i=n.deepCopy(t),r=0;(i.datasets||[]).forEach((function(t){null==t.label&&(t.label=""),r=Math.max(r,(t.data||[]).length),a._chartTypesNeedPoints.indexOf(null!=t.type?t.type:e)>-1&&(t.data=(t.data||[]).map((function(e,t){return"number"==typeof e?{x:t,y:e,r:e}:e})))}));var o=i.labels||[];if(r>0&&o.length<r){for(var s=o.length;s<r;s++)o.push("");i.labels=o}return i},e.prototype._updateChart=function(){null==this._chart?this._rebuildChart():(this._chart.options=Object.assign(Object.assign({},n.deepCopy(this._chart.options)),n.deepCopy(this.options||{})),this._chart.data=Object.assign(Object.assign({},n.deepCopy(this._chart.data)),n.deepCopy(this.data)),this._chart.update())},e.prototype._rebuildChart=function(){if(null!=this._chart&&(this._chart.destroy(),this._chart=null),null!=this._chartCanvasElement&&(this._renderer.removeChild(this._el.nativeElement,this._chartCanvasElement),this._chartCanvasElement=null),null!=this.data){this._chartCanvasElement=this._renderer.createElement("canvas");var e=this._el.nativeElement.parentElement.parentElement,n=e.clientHeight,a=e.clientWidth;null!=e?(n>0&&(this._renderer.setStyle(this._el.nativeElement,"height",n+"px"),this._renderer.setStyle(this._chartCanvasElement,"height",n+"px")),a>0&&this._renderer.setStyle(this._chartCanvasElement,"width",a)):(this._renderer.setStyle(this._chartCanvasElement,"width","inherit"),this._renderer.setStyle(this._chartCanvasElement,"height","inherit")),this._renderer.appendChild(this._el.nativeElement,this._chartCanvasElement);var i=this._chartCanvasElement.getContext("2d");this._chart=new t.Chart(i,{type:this.chartType,data:this._fixData(this.chartType,this.data),options:this._fixChartOptions(this.options)})}},e.prototype._fixChartOptions=function(e){if((e=e||{}).legendCallback){var t="string"==typeof e.legendCallback?new Function(e.legendCallback):e.legendCallback;e.legendCallback=t}if(e.onHover){var n="string"==typeof e.onHover?new Function(e.onHover):e.onHover;e.onHover=n}if(e.onClick){var a="string"==typeof e.onClick?new Function(e.onClick):e.onClick;e.onClick=a}if(e.onResize){var i="string"==typeof e.onResize?new Function(e.onResize):e.onResize;e.onResize=i}if(e.legend){var r=e.legend;if(r.onClick&&(a="string"==typeof r.onClick?new Function(r.onClick):r.onClick,r.onClick=a),r.onHover&&(n="string"==typeof r.onHover?new Function(r.onHover):r.onHover,r.onHover=n),r.onLeave){var o="string"==typeof r.onLeave?new Function(r.onLeave):r.onLeave;r.onLeave=o}if(r.labels){var s=r.labels;if(s.generateLabels){var l="string"==typeof s.generateLabels?new Function(s.generateLabels):s.generateLabels;s.generateLabels=l}if(s.filter){var c="string"==typeof s.filter?new Function(s.filter):s.filter;s.filter=c}}}if(e.tooltips){var h=e.tooltips;if(h.custom){var p="string"==typeof h.custom?new Function(h.custom):h.custom;h.custom=p}if(h.callbacks){var f=h.callbacks;for(var u in f){var v=f[u];f[u]="string"==typeof v?new Function(v):v}}if(h.filter&&(c="string"==typeof h.filter?new Function(h.filter):h.filter,h.filter=c),h.itemSort){var d="string"==typeof h.itemSort?new Function(h.itemSort):h.itemSort;h.itemSort=d}}if(e.hover){var g=e.hover;g.onHover&&(n="string"==typeof g.onHover?new Function(g.onHover):g.onHover,g.onHover=n)}if(e.animation){var y=e.animation;if(y.onProgress){var C="string"==typeof y.onProgress?new Function(y.onProgress):y.onProgress;y.onProgress=C}if(y.onComplete){var b="string"==typeof y.onComplete?new Function(y.onComplete):y.onComplete;y.onComplete=b}}if(null==e.scales&&(e.scales={xAxes:[],yAxes:[]}),null==e.scales.xAxes&&(e.scales.xAxes=[]),null==e.scales.yAxes&&(e.scales.yAxes=[]),e.scales.yAxes.forEach((function(e){if(e.ticks&&e.ticks.callback){var t="string"==typeof e.ticks.callback?new Function(e.ticks.callback):e.ticks.callback;e.ticks.callback=t}})),e.scales.xAxes.forEach((function(e){if(e.ticks&&e.ticks.callback){var t="string"==typeof e.ticks.callback?new Function(e.ticks.callback):e.ticks.callback;e.ticks.callback=t}})),"pie"==this.chartType){var _=e;return _.pieceLabel=Object.assign(Object.assign({},Object.assign({render:function(e){return e.label?e.label+":"+e.value:e.value}},_.pieceLabel)),{position:"outside"}),_}return e},e}();r.decorators=[{type:a.Component,args:[{selector:"ajf-chart",template:"",changeDetection:a.ChangeDetectionStrategy.OnPush,encapsulation:a.ViewEncapsulation.None,styles:["ajf-chart{display:block;width:inherit;height:inherit;position:relative}\n"]}]}],r.ctorParameters=function(){return[{type:a.ElementRef},{type:a.Renderer2}]},r.propDecorators={data:[{type:a.Input}],options:[{type:a.Input}],chartType:[{type:a.Input}],instance:[{type:a.Input}]},(i=function i(){}).decorators=[{type:a.NgModule,args:[{declarations:[r],exports:[r]}]}],
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
e.AjfChartComponent=r,e.AjfChartModule=i,e.registerChartPlugins=function o(e){null!=e&&e.length>0&&e.forEach((function(e){return t.Chart.plugins.register(e)}))},Object.defineProperty(e,"__esModule",{value:!0})}));