{"version":3,"sources":["src/core/core-chart.umd.js"],"names":["global","factory","exports","module","require","define","amd","self","ajf","core","chart","Chart","tslib","ng","utils","this","chart_piecelabel_js","Chart__default","chartClass","chartClass$1","AjfChartComponent","_el","_renderer","_chartTypesNeedPoints","prototype","ngAfterViewInit","_rebuildChart","ngOnChanges","changes","_updateChart","_fixData","chartType","data","_this","newData","deepCopy","maxPointsNum","datasets","forEach","dataset","label","Math","max","length","indexOf","type","map","d","idx","x","y","r","labels","i","push","_chart","options","__assign","update","destroy","_chartCanvasElement","removeChild","nativeElement","createElement","setStyle","appendChild","ctx","getContext","_fixChartOptions","scales","xAxes","yAxes","newOptions","pieceLabel","render","args","value","position","decorators","Component","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","styles","ctorParameters","ElementRef","Renderer2","propDecorators","Input","AjfChartModule","NgModule","declarations","registerChartPlugins","plugins","plugin","register","Object","defineProperty"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('chart.js'), require('tslib'), require('@angular/core'), require('chart.piecelabel.js'), require('@ajf/core/utils')) :\n    typeof define === 'function' && define.amd ? define('@ajf/core/chart', ['exports', 'chart.js', 'tslib', '@angular/core', 'chart.piecelabel.js', '@ajf/core/utils'], factory) :\n    (global = global || self, factory((global.ajf = global.ajf || {}, global.ajf.core = global.ajf.core || {}, global.ajf.core.chart = {}), global.Chart, global.tslib, global.ng.core, global.Chart.piecelabel, global.ng.core.utils));\n}(this, (function (exports, Chart, tslib, core, chart_piecelabel_js, utils) { 'use strict';\n\n    var Chart__default = 'default' in Chart ? Chart['default'] : Chart;\n\n    /**\n     * @license\n     * Copyright (C) 2018 Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var chartClass = Chart__default || Chart;\n    function registerChartPlugins(plugins) {\n        if (plugins != null && plugins.length > 0) {\n            plugins.forEach(function (plugin) { return chartClass.plugins.register(plugin); });\n        }\n    }\n\n    /**\n     * @license\n     * Copyright (C) 2018 Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var chartClass$1 = Chart__default || Chart;\n    var AjfChartComponent = /** @class */ (function () {\n        function AjfChartComponent(_el, _renderer) {\n            this._el = _el;\n            this._renderer = _renderer;\n            this._chartTypesNeedPoints = ['scatter', 'bubble'];\n        }\n        AjfChartComponent.prototype.ngAfterViewInit = function () {\n            this._rebuildChart();\n        };\n        AjfChartComponent.prototype.ngOnChanges = function (changes) {\n            if ('chartType' in changes) {\n                this._rebuildChart();\n            }\n            else if ('options' in changes || 'data' in changes) {\n                this._updateChart();\n            }\n        };\n        AjfChartComponent.prototype._fixData = function (chartType, data) {\n            var _this = this;\n            var newData = utils.deepCopy(data);\n            var maxPointsNum = 0;\n            (newData.datasets || []).forEach(function (dataset) {\n                if (dataset.label == null) {\n                    dataset.label = '';\n                }\n                maxPointsNum = Math.max(maxPointsNum, (dataset.data || []).length);\n                var datasetType = dataset.type != null ? dataset.type : chartType;\n                if (_this._chartTypesNeedPoints.indexOf(datasetType) > -1) {\n                    dataset.data = (dataset.data || []).map(function (d, idx) {\n                        if (typeof d === 'number') {\n                            return { x: idx, y: d, r: d };\n                        }\n                        return d;\n                    });\n                }\n            });\n            var labels = newData.labels || [];\n            if (maxPointsNum > 0 && labels.length < maxPointsNum) {\n                for (var i = labels.length; i < maxPointsNum; i++) {\n                    labels.push('');\n                }\n                newData.labels = labels;\n            }\n            return newData;\n        };\n        AjfChartComponent.prototype._updateChart = function () {\n            if (this._chart == null) {\n                this._rebuildChart();\n            }\n            else {\n                this._chart.options = tslib.__assign(tslib.__assign({}, utils.deepCopy(this._chart.options)), utils.deepCopy(this.options || {}));\n                this._chart.data = tslib.__assign(tslib.__assign({}, utils.deepCopy(this._chart.data)), utils.deepCopy(this.data));\n                this._chart.update();\n            }\n        };\n        AjfChartComponent.prototype._rebuildChart = function () {\n            if (this._chart != null) {\n                this._chart.destroy();\n                this._chart = null;\n            }\n            if (this._chartCanvasElement != null) {\n                this._renderer.removeChild(this._el.nativeElement, this._chartCanvasElement);\n                this._chartCanvasElement = null;\n            }\n            if (this.data != null) {\n                this._chartCanvasElement = this._renderer.createElement('canvas');\n                this._renderer.setStyle(this._chartCanvasElement, 'width', 'inherit');\n                this._renderer.setStyle(this._chartCanvasElement, 'height', 'inherit');\n                this._renderer.appendChild(this._el.nativeElement, this._chartCanvasElement);\n                var ctx = this._chartCanvasElement.getContext('2d');\n                this._chart = new chartClass$1(ctx, {\n                    type: this.chartType,\n                    data: this._fixData(this.chartType, this.data),\n                    options: this._fixChartOptions(this.options)\n                });\n            }\n        };\n        AjfChartComponent.prototype._fixChartOptions = function (options) {\n            options = options || {};\n            if (options.scales == null) {\n                options.scales = { xAxes: [], yAxes: [] };\n            }\n            if (options.scales.xAxes == null) {\n                options.scales.xAxes = [];\n            }\n            if (options.scales.yAxes == null) {\n                options.scales.yAxes = [];\n            }\n            if (this.chartType == 'pie') {\n                var newOptions = options;\n                newOptions.pieceLabel = {\n                    render: function (args) {\n                        if (args.label) {\n                            return args.label + ':' + args.value;\n                        }\n                        else {\n                            return args.value;\n                        }\n                    },\n                    position: 'outside'\n                };\n                return newOptions;\n            }\n            return options;\n        };\n        AjfChartComponent.decorators = [\n            { type: core.Component, args: [{\n                        selector: 'ajf-chart',\n                        template: \"\",\n                        changeDetection: core.ChangeDetectionStrategy.OnPush,\n                        encapsulation: core.ViewEncapsulation.None,\n                        styles: [\"ajf-chart{display:block;width:inherit;height:inherit;position:relative}\\n\"]\n                    }] }\n        ];\n        /** @nocollapse */\n        AjfChartComponent.ctorParameters = function () { return [\n            { type: core.ElementRef },\n            { type: core.Renderer2 }\n        ]; };\n        AjfChartComponent.propDecorators = {\n            data: [{ type: core.Input }],\n            options: [{ type: core.Input }],\n            chartType: [{ type: core.Input }]\n        };\n        return AjfChartComponent;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) 2018 Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfChartModule = /** @class */ (function () {\n        function AjfChartModule() {\n        }\n        AjfChartModule.decorators = [\n            { type: core.NgModule, args: [{\n                        declarations: [\n                            AjfChartComponent\n                        ],\n                        exports: [\n                            AjfChartComponent\n                        ]\n                    },] }\n        ];\n        return AjfChartModule;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) 2018 Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n\n    /**\n     * Generated bundle index. Do not edit.\n     */\n\n    exports.AjfChartComponent = AjfChartComponent;\n    exports.AjfChartModule = AjfChartModule;\n    exports.registerChartPlugins = registerChartPlugins;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=core-chart.umd.js.map\n"]}