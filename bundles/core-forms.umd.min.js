/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ajf/core/utils"),require("rxjs"),require("@ajf/core/models"),require("@angular/core"),require("rxjs/operators"),require("esprima"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@ajf/core/forms",["exports","@ajf/core/utils","rxjs","@ajf/core/models","@angular/core","rxjs/operators","esprima","@angular/forms"],t):t(((e=e||self).ajf=e.ajf||{},e.ajf.core=e.ajf.core||{},e.ajf.core.forms={}),e.ajf.core.utils,e.rxjs,e.ajf.core.models,e.ng.core,e.rxjs.operators,e.esprima,e.ng.forms)}(this,function(e,p,b,d,n,a,t,s){"use strict";var i="default"in t?t.default:t,o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var u=function(){return(u=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l={Link:0,Pdf:1,LENGTH:2};l[l.Link]="Link",l[l.Pdf]="Pdf",l[l.LENGTH]="LENGTH";var c=(Object.defineProperty(f.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),f);function f(e){this._label=e&&e.label||null,this._value=e&&e.value||null,this._type=e&&e.type||null}var h=(m.create=function(e){var t=[];if(e.attachments instanceof Array)for(var n=0;n<e.attachments.length;n++){var i=e.attachments[n];switch(i.type){case l.Link:case l.Pdf:t.push(new c(i));break;default:throw new Error("Invalid attachment type")}}return e.attachments=t,new g(e)},m.fromJson=function(e){if(e=p.deepCopy(e),-1===Object.keys(e).indexOf("type"))throw new Error("Attachments origin type missing type");var t=e.type;switch(delete e.type,t){case"fixed":return g.create(e);default:throw new Error("Invalid attachment origin type")}},m.prototype.getName=function(){return this._name},m);function m(e){this._name=e&&e.name||null}var v,g=(r(y,v=h),y.prototype.getAttachments=function(){return this._attachments},y);function y(e){var t=v.call(this,e)||this;return t._attachments=e&&e.attachments||[],t}function _(e){var t=typeof e;return"object"==t?e.constructor.toString().match(/\w+/g)[1]:t}var x={String:0,Number:1,LENGTH:2};x[x.String]="String",x[x.Number]="Number",x[x.LENGTH]="LENGTH";var j,N=(r(C,j=d.AjfJsonSerializable),C);function C(e){var t=j.call(this,e)||this;return t.label=e&&e.label||"",t.value=e&&e.value||null,t}var M,w=(r(O,M=d.AjfJsonSerializable),O.create=function(e,t){switch(e){case"string":case"number":return new E(t);default:return null}},O.fromJson=function(e){if(e=p.deepCopy(e),-1===Object.keys(e).indexOf("type"))throw new Error("Choices origin type missing type");var t=e.type;switch(delete e.type,t){case"fixed":return new E(e);case"function":return new V(e);case"observable":return new I(e);case"observableArray":return new D(e);case"promise":return new I(e);default:throw new Error("Invalid choices origin type")}},O.prototype.getName=function(){return this._name},O.prototype.getLabel=function(){return this._label},O.prototype.setName=function(e){this._name=e},O.prototype.setLabel=function(e){this._label=e},O.prototype.getChoicesType=function(){return this._choicesType||this._guessChoicesType()},O.prototype._guessChoicesType=function(){var e=this.getChoices();return e&&0<e.length&&(this._choicesType=_(e[0].value)),this._choicesType},O);function O(e){var t=M.call(this)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["type","name","label","choicesType"]),t._name=e&&e.name||null,t._label=e&&e.label||null,t._choicesType=e&&e.choicesType||null,t}var S,E=(r(F,S=w),F.prototype.getType=function(){return"fixed"},F.prototype.getChoices=function(){return this._choices},F.prototype.setChoices=function(e){this._choices=e.slice(0)},F);function F(e){var t=S.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat("choices"),t._choices=e&&e.choices||[],t}var A,V=(r(T,A=w),Object.defineProperty(T.prototype,"generator",{get:function(){return this._generator},enumerable:!0,configurable:!0}),T.prototype.getType=function(){return"function"},T.prototype.getChoices=function(){return this._generator()},T);function T(e,t){var n=A.call(this,t)||this;return n.jsonExportedMembers=n.jsonExportedMembers.concat("generator"),n._generator=e,n}var R,I=(r(P,R=w),Object.defineProperty(P.prototype,"observable",{get:function(){return this._observable},enumerable:!0,configurable:!0}),P.prototype.getType=function(){return"observable"},P.prototype.getChoices=function(){return this._currentChoices.splice(0)},P.prototype.destroy=function(){this._subscription.unsubscribe()},P);function P(e,t){var n=R.call(this,t)||this;n._observable=e,n._currentChoices=[],n._subscription=b.Subscription.EMPTY,n.jsonExportedMembers=n.jsonExportedMembers.concat("observable");var i=n;return n._subscription=e.subscribe(function(e){return i._currentChoices.push(e)}),n}var B,D=(r(k,B=w),Object.defineProperty(k.prototype,"observable",{get:function(){return this._observable},enumerable:!0,configurable:!0}),k.prototype.getType=function(){return"observableArray"},k.prototype.getChoices=function(){return this._currentChoices.splice(0)},k.prototype.destroy=function(){this._subscription.unsubscribe()},k);function k(e,t){var n=B.call(this,t)||this;n._observable=e,n._currentChoices=[],n._subscription=b.Subscription.EMPTY,n.jsonExportedMembers=n.jsonExportedMembers.concat("observable");var i=n;return n._subscription=e.subscribe(function(e){return i._currentChoices=e.splice(0)}),n}var U,G=(r(L,U=w),L.prototype.getType=function(){return"promise"},L.prototype.getChoices=function(){return this._choices.splice(0)},L);function L(e,t){var n=U.call(this,t)||this;return n._choices=[],n.jsonExportedMembers=n.jsonExportedMembers.concat("promise"),e.then(function(e){n._choices=e.splice(0)}),n}var J,W=(r($,J=d.AjfError),Object.defineProperty($.prototype,"name",{get:function(){return"AjfInvalidFieldDefinitionError"},enumerable:!0,configurable:!0}),$);function $(e){return J.call(this,e)||this}function z(e){for(var t=1,n=e;1<n;n--)t*=n;return t}var H,Y=function(e,t,n){this.result=e,this.error=t,this.clientValidation=n},q=(r(Z,H=d.AjfCondition),Z.fromJson=function(e){return new Z(e=p.deepCopy(e))},Z.getMaxCondition=function(e){return new Z({condition:"$value <= "+e.toString(),errorMessage:"Value must be <= "+e.toString()})},Z.getMinCondition=function(e){return new Z({condition:"$value >= "+e.toString(),errorMessage:"Value must be >= "+e.toString()})},Z.getNotEmptyCondition=function(){return new Z({condition:"notEmpty($value)",errorMessage:"Value must not be empty"})},Z.getMaxDigitsCondition=function(e){return new Z({condition:"$value ? $value.toString().length <= "+e.toString()+" : false",errorMessage:"Digits count must be <= "+e.toString()})},Z.getMinDigitsCondition=function(e){return new Z({condition:"$value ? $value.toString().length >= "+e.toString()+" : false",errorMessage:"Digits count must be >= "+e.toString()})},Z.prototype.evaluate=function(e,t){return new Y(H.prototype.evaluate.call(this,e,t),this.errorMessage,this.clientValidation)},Z);function Z(e){var t=H.call(this,e)||this;return t.clientValidation=e&&e.clientValidation||!1,t.errorMessage=e&&e.errorMessage||"Undefined Error",t.jsonExportedMembers=t.jsonExportedMembers.concat(["clientValidation","errorMessage"]),t}var K,Q=(r(X,K=d.AjfJsonSerializable),X.fromJson=function(e){var t=Object.keys(e);if(-1<t.indexOf("maxValue")&&"number"==typeof e.maxValue&&(e.maxValue=q.getMaxCondition(e.maxValue)),-1<t.indexOf("minValue")&&"number"==typeof e.minValue&&(e.minValue=q.getMinCondition(e.minValue)),-1<t.indexOf("notEmpty")&&(e.notEmpty=q.getNotEmptyCondition()),-1<t.indexOf("forceValue")&&(e.forceValue=d.AjfCondition.fromJson(e.forceValue)),-1<t.indexOf("maxDigits")&&"number"==typeof e.maxDigits&&(e.maxDigits=q.getMaxDigitsCondition(e.maxDigits)),-1<t.indexOf("minDigits")&&"number"==typeof e.minDigits&&(e.minDigits=q.getMinDigitsCondition(e.minDigits)),-1<t.indexOf("conditions")&&e.conditions instanceof Array){for(var n=[],i=0,o=e.conditions;i<o.length;i++){var r=o[i];n.push(q.fromJson(r))}e.conditions=n}return new X(e)},X.prototype.toJson=function(){var e={};return null!=this.forceValue&&(e.forceValue=!0),null!=this.maxValue&&(e.maxValue=this.maxValue.condition.replace("$value <= ","")),null!=this.minValue&&(e.minValue=this.minValue.condition.replace("$value >= ","")),null!=this.notEmpty&&(e.notEmpty=!0),null!=this.maxDigits&&(e.maxDigits=this.maxDigits.condition.replace("$value ? $value.toString().length <=  : false","")),null!=this.minDigits&&(e.minDigits=this.minDigits.condition.replace("$value ? $value.toString().length >=  : false","")),null!=this.conditions&&(e.conditions=this.conditions.map(function(e){return e.toJson()})),e},X.prototype._evaluateMaxValue=function(e){return null==this.maxValue?null:this.maxValue.evaluate({$value:e})},X.prototype._evaluateMinvalue=function(e){return null==this.minValue?null:this.minValue.evaluate({$value:e})},X.prototype._evaluateNotEmpty=function(e){return null==this.notEmpty?null:this.notEmpty.evaluate({$value:e})},X.prototype._evaluateConditions=function(t){var n=[];return this.conditions.forEach(function(e){n.push(e.evaluate(t))}),n},X.prototype.evaluate=function(e,t){var n=[],i=p.deepCopy(t);if(i.$value=e,n=this._evaluateConditions(i),!this.maxValue||null!=this._evaluateMaxValue(e)&&n.push(),this.minValue){var o=this._evaluateMinvalue(e);null!=o&&n.push(o)}if(this.notEmpty){var r=this._evaluateNotEmpty(e);null!=r&&n.push(r)}return this.maxDigits&&n.push(this.maxDigits.evaluate({$value:e})),this.minDigits&&n.push(this.minDigits.evaluate({$value:e})),n},X.prototype.evaluateForceValue=function(e){return this.forceValue.evaluate(e)},X);function X(e){var t=K.call(this,e)||this;return t.forceValue=e&&e.forceValue||null,t.maxValue=e&&e.maxValue||null,t.minValue=e&&e.minValue||null,t.notEmpty=e&&e.notEmpty||null,t.maxDigits=e&&e.maxDigits||null,t.minDigits=e&&e.minDigits||null,t.conditions=e&&e.conditions||[],t.jsonExportedMembers=t.jsonExportedMembers.concat(["forceValue","maxValue","minValue","notEmpty","maxDigits","minDigits","conditions"]),t}var ee,te=function(e,t){this.result=e,this.warning=t},ne=(r(ie,ee=d.AjfCondition),ie.fromJson=function(e){return new ie(e)},ie.getNotEmptyWarning=function(){return new ie({condition:"notEmpty($value)",warningMessage:"Value must not be empty"})},ie.prototype.evaluate=function(e,t){return new te(ee.prototype.evaluate.call(this,e,t),this.warningMessage)},ie);function ie(e){var t=ee.call(this,e)||this;return t.warningMessage=e&&e.warningMessage||"Undefined Error",t.jsonExportedMembers=t.jsonExportedMembers.concat(["warningMessage"]),t}var oe,re=(r(ae,oe=d.AjfJsonSerializable),ae.fromJson=function(e){var t=Object.keys(e);if(-1<t.indexOf("notEmpty")&&(e.notEmpty=ne.getNotEmptyWarning()),-1<t.indexOf("conditions")&&e.conditions instanceof Array){for(var n=[],i=0,o=e.conditions;i<o.length;i++){var r=o[i];n.push(ne.fromJson(r))}e.conditions=n}return new ae(e)},ae.prototype._evaluateConditions=function(t){var n=[];return this.conditions.forEach(function(e){n.push(e.evaluate(t))}),n},ae.prototype.evaluate=function(e){return this._evaluateConditions(e)},ae);function ae(e){var t=oe.call(this,e)||this;return t.notEmpty=e&&e.notEmpty||null,t.conditions=e&&e.conditions||null,t.jsonExportedMembers=t.jsonExportedMembers.concat(["notEmpty","conditions"]),t}var se={AjfField:0,AjfFieldNodeLink:1,AjfNodeGroup:2,AjfSlide:3,AjfRepeatingSlide:4,LENGTH:5};se[se.AjfField]="AjfField",se[se.AjfFieldNodeLink]="AjfFieldNodeLink",se[se.AjfNodeGroup]="AjfNodeGroup",se[se.AjfSlide]="AjfSlide",se[se.AjfRepeatingSlide]="AjfRepeatingSlide",se[se.LENGTH]="LENGTH";var ue,le=(r(ce,ue=d.AjfJsonSerializable),Object.defineProperty(ce.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"parentNode",{get:function(){return this._parentNode},set:function(e){this._parentNode=e},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"conditionalBranches",{get:function(){return this._conditionalBranches},set:function(e){this._conditionalBranches=e},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"label",{get:function(){return this._label},set:function(e){this._label=e},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"visibility",{get:function(){return this._visibility},set:function(e){this._visibility=e},enumerable:!0,configurable:!0}),ce.fromJson=function(e,t,n,i){e=p.deepCopy(e),i=i&&p.deepCopy(i);var o=Object.keys(e);if(-1===o.indexOf("nodeType"))throw new Error("Node type missing type");var r=e.nodeType;if(delete e.nodeType,null==se[r])throw new Error("Invalid node type");if(-1<o.indexOf("visibility")&&(e.visibility=d.AjfCondition.fromJson(e.visibility)),-1<o.indexOf("conditionalBranches")&&e.conditionalBranches instanceof Array){for(var a=[],s=0;s<e.conditionalBranches.length;s++)a.push(d.AjfCondition.fromJson(e.conditionalBranches[s]));0==a.length&&a.push(d.AjfCondition.alwaysCondition()),e.conditionalBranches=a}return ce.createNode(r,e,t,n,i)},ce.createNode=function(e,t,n,i,o){switch(n=n||[],i=i||[],e){case se.AjfNodeGroup:return ve.fromJson(t,n,i,o);case se.AjfField:return Me.fromJson(t,n,i,o);case se.AjfRepeatingSlide:return je.fromJson(t,n,i,o);case se.AjfSlide:return be.fromJson(t,n,i,o);default:throw new Error("Invalid node type")}},Object.defineProperty(ce.prototype,"nodeType",{get:function(){var e=this;if(e instanceof Me)return se.AjfField;if(e instanceof fe)return se.AjfFieldNodeLink;if(e instanceof ve)return se.AjfNodeGroup;if(e instanceof je)return se.AjfRepeatingSlide;if(e instanceof be)return se.AjfSlide;throw new Error("Invalid node type")},enumerable:!0,configurable:!0}),ce.prototype.setConditionalBranchesNum=function(e){if(0<=this.getMaxConditionalBranches()&&(e=Math.min(e,this.getMaxConditionalBranches())),e<this.conditionalBranches.length)this.conditionalBranches=this.conditionalBranches.slice(0,e);else if(e>this.conditionalBranches.length)for(var t=this.conditionalBranches.length;t<e;t++)this.conditionalBranches.push(d.AjfCondition.alwaysCondition())},ce.prototype.getMaxConditionalBranches=function(){return-1},ce);function ce(e){var t=ue.call(this)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["id","nodeType","parent","parentNode","visibility","name","label","conditionalBranches"]),t._id=e&&e.id||null,t._parent=e&&e.parent||null,t._parentNode=e&&e.parentNode||0,t._visibility=e&&e.visibility||d.AjfCondition.alwaysCondition(),t._name=e&&e.name||null,t._label=e&&e.label||null,t._conditionalBranches=e&&e.conditionalBranches||[d.AjfCondition.alwaysCondition()],t}var pe,fe=(r(de,pe=le),de);function de(){return null!==pe&&pe.apply(this,arguments)||this}var he={String:0,Text:1,Number:2,Boolean:3,SingleChoice:4,MultipleChoice:5,Formula:6,Empty:7,Date:8,DateInput:9,Time:10,Table:11,LENGTH:12};he[he.String]="String",he[he.Text]="Text",he[he.Number]="Number",he[he.Boolean]="Boolean",he[he.SingleChoice]="SingleChoice",he[he.MultipleChoice]="MultipleChoice",he[he.Formula]="Formula",he[he.Empty]="Empty",he[he.Date]="Date",he[he.DateInput]="DateInput",he[he.Time]="Time",he[he.Table]="Table",he[he.LENGTH]="LENGTH";var me,ve=(r(ge,me=le),Object.defineProperty(ge.prototype,"nodes",{get:function(){return this._nodes},set:function(e){this._nodes=e},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"formulaReps",{get:function(){return this._formulaReps},set:function(e){this._formulaReps=e},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"maxReps",{get:function(){return this._maxReps},set:function(e){this._maxReps=e},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"minReps",{get:function(){return this._minReps},set:function(e){this._minReps=e},enumerable:!0,configurable:!0}),ge.fromJson=function(e,t,n,i){e=p.deepCopy(e),i=i&&p.deepCopy(i);var o=Object.keys(e);if(-1<o.indexOf("nodes")&&e.nodes instanceof Array){for(var r=[],a=0;a<e.nodes.length;a++)r.push(le.fromJson(e.nodes[a],t,n));e.nodes=r}if(-1<o.indexOf("formulaReps")&&null!=e.formulaReps&&(e.formulaReps=d.AjfFormula.fromJson(e.formulaReps)),-1<o.indexOf("visibility")&&null!=e.visibility&&(e.visibility=d.AjfCondition.fromJson(e.visibility)),-1<o.indexOf("conditionalBranches")&&e.conditionalBranches instanceof Array){var s=[];for(a=0;a<e.conditionalBranches.length;a++)s.push(d.AjfCondition.fromJson(e.conditionalBranches[a]));e.conditionalBranches=s}return new ge(e)},ge);function ge(e){var t=me.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["formulaReps","minReps","maxReps","nodes"]),t.nodes=e&&e.nodes||[],t.formulaReps=e&&e.formulaReps||null,t.maxReps=e&&e.maxReps||null,t.minReps=e&&e.minReps||null,t}var ye,be=(r(_e,ye=le),Object.defineProperty(_e.prototype,"nodes",{get:function(){return this._nodes.slice(0)},set:function(e){this._nodes=e.slice(0)},enumerable:!0,configurable:!0}),_e.fromJson=function(e,t,n,i){e=p.deepCopy(e),i=i&&p.deepCopy(i);var o=Object.keys(e);if(-1<o.indexOf("visibility")&&null!=e.visibility&&(e.visibility=d.AjfCondition.fromJson(e.visibility)),-1<o.indexOf("nodes")&&e.nodes instanceof Array){for(var r=[],a=0;a<e.nodes.length;a++)r.push(le.fromJson(e.nodes[a],t,n));e.nodes=r}if(-1<o.indexOf("conditionalBranches")&&e.conditionalBranches instanceof Array){var s=[];for(a=0;a<e.conditionalBranches.length;a++)s.push(d.AjfCondition.fromJson(e.conditionalBranches[a]));e.conditionalBranches=s}return new _e(e)},_e);function _e(e){var t=ye.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["nodes"]),t._nodes=e&&e.nodes||[],t}var xe,je=(r(Ne,xe=be),Object.defineProperty(Ne.prototype,"formulaReps",{get:function(){return this._formulaReps},set:function(e){this._formulaReps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"maxReps",{get:function(){return this._maxReps},set:function(e){this._maxReps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.prototype,"minReps",{get:function(){return this._minReps},set:function(e){this._minReps=e},enumerable:!0,configurable:!0}),Ne.fromJson=function(e,t,n,i){e=p.deepCopy(e),i=i&&p.deepCopy(i);var o=Object.keys(e);if(-1<o.indexOf("visibility")&&null!=e.visibility&&(e.visibility=d.AjfCondition.fromJson(e.visibility)),-1<o.indexOf("nodes")&&e.nodes instanceof Array){for(var r=[],a=0;a<e.nodes.length;a++)r.push(le.fromJson(e.nodes[a],t,n));e.nodes=r}if(-1<o.indexOf("formulaReps")&&null!=e.formulaReps&&(e.formulaReps=d.AjfFormula.fromJson(e.formulaReps)),-1<o.indexOf("conditionalBranches")&&e.conditionalBranches instanceof Array){var s=[];for(a=0;a<e.conditionalBranches.length;a++)s.push(d.AjfCondition.fromJson(e.conditionalBranches[a]));e.conditionalBranches=s}return new Ne(e)},Ne);function Ne(e){var t=xe.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["nodes","formulaReps","minReps","maxReps"]),t.formulaReps=e&&e.formulaReps||null,t.nodes=e&&e.nodes||[],t.minReps=e&&e.minReps||1,t.maxReps=e&&e.maxReps||0,t}var Ce,Me=(r(we,Ce=le),Object.defineProperty(we.prototype,"description",{get:function(){return this._description},set:function(e){this._description=e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"editable",{get:function(){return this._editable},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"formula",{get:function(){return this._formula},set:function(e){this._formula=e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"hasChoices",{get:function(){return this._hasChoices},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"defaultValue",{get:function(){return this._defaultValue},set:function(e){if(null!=e&&!this.validateValue(e))throw new W("The default value is not valid for this field type");this._defaultValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"validation",{get:function(){return this._validation},set:function(e){this._validation=e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"warning",{get:function(){return this._warning},set:function(e){this._warning=e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"hasAttachments",{get:function(){return this._hasAttachments},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"attachmentsOrigin",{get:function(){return this.hasAttachments&&this._attachmentsOrigin||null},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"attachments",{get:function(){return this.hasAttachments&&this._attachmentsOrigin.getAttachments()||[]},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"nextSlideCondition",{get:function(){return this._nextSlideCondition},set:function(e){this._nextSlideCondition=e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"nextSlide",{get:function(){return this._nextSlide},set:function(e){this._nextSlide=e},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"fieldType",{get:function(){var e=this;return e instanceof Qe?he.Formula:e instanceof qe?he.MultipleChoice:e instanceof ze?he.SingleChoice:e instanceof Ue?he.Boolean:e instanceof Be?he.Number:e instanceof Re?he.Text:e instanceof Ae?he.String:e instanceof tt?he.Date:e instanceof ot?he.DateInput:e instanceof ct?he.Table:e instanceof st?he.Time:he.Empty},enumerable:!0,configurable:!0}),Object.defineProperty(we.prototype,"nodeType",{get:function(){return se.AjfField},enumerable:!0,configurable:!0}),we.create=function(e,t){var n;switch(e){case he.String:n=new Ae(t);break;case he.Text:n=new Re(t);break;case he.Number:n=new Be(t);break;case he.Boolean:n=new Ue(t);break;case he.SingleChoice:n=new ze(t);break;case he.MultipleChoice:n=new qe(t);break;case he.Formula:n=new Qe(t);break;case he.Empty:n=new Se(t);break;case he.Date:n=new tt(t);break;case he.DateInput:n=new ot(t);break;case he.Time:n=new st(t);break;case he.Table:n=new ct(t);break;default:throw new Error("Invalid field type")}return n},we.fromJson=function(t,e,n,i){t=p.deepCopy(t),i=i&&p.deepCopy(i);var o=Object.keys(t);if(-1===o.indexOf("fieldType"))throw new Error("Field type missing type");var r=t.fieldType;if(delete t.fieldType,null==he[r])throw new Error("Invalid field type");if(-1<o.indexOf("visibility")&&null!=t.visibility&&(t.visibility=d.AjfCondition.fromJson(t.visibility)),-1<o.indexOf("formula")&&null!=t.formula&&(t.formula=d.AjfFormula.fromJson(t.formula)),-1<o.indexOf("choicesFilter")&&null!=t.choicesFilter&&(t.choicesFilter=d.AjfFormula.fromJson(t.choicesFilter)),-1<o.indexOf("validation")&&null!=t.validation&&(t.validation=Q.fromJson(t.validation)),-1<o.indexOf("warning")&&null!=t.warning&&(t.warning=re.fromJson(t.warning)),-1<o.indexOf("choicesOriginRef")){var a=e.filter(function(e){return e.getName()===t.choicesOriginRef});t.choicesOrigin=0<a.length?a[0]:null}if(-1<o.indexOf("attachmentsOriginRef")&&(a=n.filter(function(e){return e.getName()===t.attachmentsOriginRef}),t.attachmentsOrigin=0<a.length?a[0]:null),-1<o.indexOf("triggerConditions")&&null!=t.triggerConditions&&0<t.triggerConditions.length&&(t.triggerConditions=t.triggerConditions.map(function(e){return d.AjfCondition.fromJson(e)})),-1<o.indexOf("nodes")&&t.nodes instanceof Array){for(var s=[],u=0;u<t.nodes.length;u++){var l=t.nodes[u];l.parentField=t.id,s.push(le.fromJson(l,e,n,i))}t.nodes=s}if(-1<o.indexOf("nextSlideCondition")&&null!=t.nextSlideCondition&&(t.nextSlideCondition=d.AjfCondition.fromJson(t.nextSlideCondition)),-1<o.indexOf("conditionalBranches")&&t.conditionalBranches instanceof Array){var c=[];for(u=0;u<t.conditionalBranches.length;u++)c.push(d.AjfCondition.fromJson(t.conditionalBranches[u]));t.conditionalBranches=c}return we.create(r,t)},we.prototype.setEditable=function(e){void 0===e&&(e=!0),this._editable=e},we.prototype.setHasChoices=function(e){this._hasChoices=e},we.prototype.setHasAttachments=function(e){this._hasAttachments=e},we);function we(e){var t=Ce.call(this,e)||this;return t._hasChoices=!1,t._hasAttachments=!1,t.jsonExportedMembers=t.jsonExportedMembers.concat(["fieldType","description","editable","formula","validation","warning","hasChoices","defaultValue","size","nextSlideCondition"]),t._description=e&&e.description||null,t._formula=e&&e.formula||null,t._validation=e&&e.validation||null,t._warning=e&&e.warning||null,t._attachmentsOrigin=e&&e.attachmentsOrigin||null,t.defaultValue=e&&null!=e.defaultValue?e.defaultValue:null,t._size=e&&e.size||"normal",t._nextSlideCondition=e&&e.nextSlideCondition||null,t.setHasAttachments(!!t._attachmentsOrigin),t._hasChoices=!1,t.setEditable(),t}var Oe,Se=(r(Ee,Oe=Me),Ee.prototype.validateValue=function(e){return!0},Ee);function Ee(e){var t=Oe.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["HTML"]),t.HTML=e&&e.HTML||null,t}var Fe,Ae=(r(Ve,Fe=Me),Ve.prototype.validateValue=function(e){return e===e.toString()},Ve);function Ve(){return null!==Fe&&Fe.apply(this,arguments)||this}var Te,Re=(r(Ie,Te=Ae),Ie);function Ie(){return null!==Te&&Te.apply(this,arguments)||this}var Pe,Be=(r(De,Pe=Me),De.prototype.validateValue=function(e){return e===parseInt(e,10)||e===parseFloat(e)},De);function De(){return null!==Pe&&Pe.apply(this,arguments)||this}var ke,Ue=(r(Ge,ke=Me),Ge.prototype.validateValue=function(e){return e===!!e},Ge.prototype.getMaxConditionalBranches=function(){return 2},Ge);function Ge(){return null!==ke&&ke.apply(this,arguments)||this}var Le,Je=(r(We,Le=Me),Object.defineProperty(We.prototype,"choices",{get:function(){return this.choicesOrigin&&this.choicesOrigin.getChoices()||[]},enumerable:!0,configurable:!0}),Object.defineProperty(We.prototype,"choicesOriginRef",{get:function(){return this.choicesOrigin.getName()},enumerable:!0,configurable:!0}),We.prototype.validateValue=function(e){return!0},We);function We(e){var t=Le.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["choicesOriginRef","choicesFilter","forceExpanded","forceNarrow","triggerConditions"]),t.choicesOrigin=e&&e.choicesOrigin||null,t.choicesFilter=e&&e.choicesFilter||null,t.forceExpanded=e&&e.forceExpanded||!1,t.forceNarrow=e&&e.forceNarrow||!1,t.triggerConditions=e&&e.triggerConditions||null,t.setHasChoices(!0),t}var $e,ze=(r(He,$e=Je),He.prototype.validateValue=function(t){return null==t||0<this.choices.filter(function(e){return e===t}).length},He.prototype.getMaxConditionalBranches=function(){return Math.max(1,this.choices.length+1)},He);function He(e){return $e.call(this,e)||this}var Ye,qe=(r(Ze,Ye=ze),Ze.prototype.validateValue=function(e){if(e instanceof Array){for(var t=0,n=e.length,i=!0;i&&t<n;)i=Ye.prototype.validateValue.call(this,e[t++]);return i}return Ye.prototype.validateValue.call(this,e)},Ze.prototype.getMaxConditionalBranches=function(){for(var e=0,t=this.choices.length,n=[1],i=1;i<=t;i++)n.push(z(i));for(i=1;i<=t;i++)e+=n[t]/(n[i]*n[t-i]);return e},Ze);function Ze(e){var t=e&&e.defaultValue||[];return e=u({},e||{},{defaultValue:t}),Ye.call(this,e)||this}var Ke,Qe=(r(Xe,Ke=Be),Xe);function Xe(e){var t=Ke.call(this,e)||this;return t.setEditable(!1),t}var et,tt=(r(nt,et=Me),nt.prototype.validateValue=function(e){return e===e.toString()},nt);function nt(e){var t=et.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["maxDate","minDate"]),t.minDate=e&&e.minDate||null,t.maxDate=e&&e.maxDate||null,t.minDateValue="today"===t.minDate?new Date:t.minDate,t.maxDateValue="today"===t.maxDate?new Date:t.maxDate,t}var it,ot=(r(rt,it=Me),rt.prototype.validateValue=function(e){return e===e.toString()},rt);function rt(e){return it.call(this,e)||this}var at,st=(r(ut,at=Me),ut.prototype.validateValue=function(e){return e===e.toString()},ut);function ut(e){var t=at.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat([]),t}var lt,ct=(r(pt,lt=Me),pt.prototype.validateValue=function(e){return e===e.toString()},pt);function pt(e){var t=lt.call(this,e)||this;return t.columnLabels=[],t.rowLabels=[],t.hideEmptyRows=!1,t.setEditable(e&&e.editable||!1),t.jsonExportedMembers=t.jsonExportedMembers.concat(["rows","columnLabels","rowLabels"]),t.rows=e&&e.rows||[],t.columnLabels=e&&e.columnLabels||[],t.rowLabels=e&&e.rowLabels||[],t.hideEmptyRows=e&&e.hideEmptyRows||!1,t}function ft(e){return"ajf-icon-field-"+he[e].toLowerCase()}var dt=(ht.prototype.transform=function(e){return ft(e instanceof Me?e.fieldType:e)},ht.decorators=[{type:n.Pipe,args:[{name:"fieldIcon"}]}],ht);function ht(){}var mt=(Object.defineProperty(vt.prototype,"updated",{get:function(){return this._updated},enumerable:!0,configurable:!0}),Object.defineProperty(vt.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(vt.prototype,"prefix",{get:function(){return this._prefix.slice(0)},enumerable:!0,configurable:!0}),Object.defineProperty(vt.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(vt.prototype,"suffix",{get:function(){return null==this.prefix||0==this.prefix.length?"":"__"+this.prefix.join("__")},enumerable:!0,configurable:!0}),Object.defineProperty(vt.prototype,"completeName",{get:function(){return""+this.node.name+this.suffix},enumerable:!0,configurable:!0}),vt.prototype.setNode=function(e){this._node=e},vt.prototype.triggerUpdate=function(){this._updatedEvt.emit()},vt.prototype.updateVisibility=function(e,t){if(void 0===t&&(t=!0),null==this.visibility)return!1;var n=this.visibility,i=this.visible,o=t&&n.evaluate(e);return o!==this.visible&&(this._visible=o),i!==o},vt.prototype.updateConditionalBranches=function(e){var t=this.conditionalBranches;if(null!=t){for(var n=this.verifiedBranch,i=0,o=!1;i<t.length&&!o;)t[i].evaluate(e)&&(o=!0,i!==this.verifiedBranch&&(this.verifiedBranch=i)),i++;if(n!==this.verifiedBranch)return!0}return!1},vt);function vt(e,t){this._updatedEvt=new n.EventEmitter,this._updated=this._updatedEvt.asObservable(),this._node=e.node,this._prefix=null!=e.prefix?e.prefix.slice(0):[],this._visible=null==e.visible||e.visible}var gt,yt=(r(bt,gt=mt),Object.defineProperty(bt.prototype,"field",{get:function(){return this.node},set:function(e){this.setNode(e)},enumerable:!0,configurable:!0}),Object.defineProperty(bt.prototype,"value",{get:function(){return null!=this._value&&this._value||this._defaultValue},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(bt.prototype,"triggerWarning",{get:function(){return this._triggerWarning.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(bt.prototype,"validationResults",{get:function(){return this._validationResults},enumerable:!0,configurable:!0}),Object.defineProperty(bt.prototype,"warningResults",{get:function(){return this._warningResults},enumerable:!0,configurable:!0}),bt.prototype.updateFormula=function(e){var t=this.formula,n=this.field.editable;if(null!=t&&this.visible&&(!n||n&&null==this.value)){var i=t.evaluate(e),o=this.value;return i!==this.value&&(this.value=i,e[this.completeName]=this.value,e.$value=this.value),{changed:i!==o,value:i}}return{changed:!1,value:this.value}},bt.prototype._makeSupplementaryContext=function(t,n){return Object.keys(n).forEach(function(e){t["__supplementary__"+e+"__"]=n[e]}),t},bt.prototype.updateValidation=function(e,t){var n=this.validation;null!=n&&(t&&this._makeSupplementaryContext(e,t),null!=e[this.completeName]&&n&&n.forceValue&&(this.value=n.evaluateForceValue(e),e[this.completeName]=this.value,e.$value=this.value),null!=n?(this._validationResults=n.evaluate(e[this.completeName],e),this.valid=this.validationResults.reduce(function(e,t){return e&&t.result},!0)):this.valid=!0)},bt.prototype.updateWarning=function(e){var t=this.warning;null!=e[this.completeName]&&t&&(this._warningResults=t.evaluate(e))},bt.prototype.updateNextSlideCondition=function(e){return null!=this.nextSlideCondition&&this.nextSlideCondition.evaluate(e)},bt.prototype.updateFieldState=function(e,t){void 0===t&&(t=!0),this.updateVisibility(e,t),this.updateConditionalBranches(e),this.updateFormula(e),this.updateValidation(e),this.updateWarning(e),this.updateNextSlideCondition(e)},bt.prototype.emitTriggerWarning=function(){this._triggerWarning.next()},bt);function bt(e,t){var n=gt.call(this,e,t)||this;n.reps=0,n._validationResults=[],n._warningResults=[],n._defaultValue=null,n._triggerWarning=new b.ReplaySubject(1),null!=n.node&&null!=t&&(null!=t[n.node.name]?n.value=t[n.node.name]:null!=t[n.completeName]?n.value=t[n.completeName]:n.value=null);var i=n.node.defaultValue;return n._defaultValue=n.node&&null!=i?i:null,n}var _t,xt=(r(jt,_t=yt),Object.defineProperty(jt.prototype,"field",{get:function(){return this.node},set:function(e){this.setNode(e)},enumerable:!0,configurable:!0}),Object.defineProperty(jt.prototype,"triggerSelection",{get:function(){return this._triggerSelection.asObservable()},enumerable:!0,configurable:!0}),jt.prototype.updateFilteredChoices=function(t){var n=this;null!=this.choicesFilter?this.filteredChoices=this.field.choicesOrigin.getChoices().filter(function(e){return t.$choiceValue=e.value,n.choicesFilter.evaluate(t)}):this.filteredChoices=this.field.choicesOrigin.getChoices()},jt.prototype.updateTriggerConditions=function(e){if(this._firstTriggerConditionDone[this.completeName])return!1;for(var t=!1,n=this.triggerConditions.length,i=0;i<n;i++)if(this.triggerConditions[i].evaluate(e)){t=!0;break}return this._firstTriggerConditionDone[this.completeName]=t},jt.prototype.emitTriggerSelection=function(){this._triggerSelection.next(null)},jt);function jt(e,t){var n=_t.call(this,e,t)||this;return n._triggerSelection=new b.ReplaySubject(1),n._firstTriggerConditionDone={},n.filteredChoices=n.field.choices.slice(0),n}var Nt,Ct=(r(Mt,Nt=mt),Object.defineProperty(Mt.prototype,"reps",{get:function(){return this._reps},set:function(e){this._reps=e,this._repsArr=new Array(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Mt.prototype,"repsArr",{get:function(){return this._repsArr},enumerable:!0,configurable:!0}),Object.defineProperty(Mt.prototype,"valid",{get:function(){return this.nodes.map(function(e){return!(-1<Object.keys(e).indexOf("valid"))||e.valid}).reduce(function(e,t){return e&&t})},enumerable:!0,configurable:!0}),Object.defineProperty(Mt.prototype,"nodeGroup",{get:function(){return this.node},enumerable:!0,configurable:!0}),Mt.prototype.setNodeGroup=function(e){this.setNode(e)},Mt.prototype.updateRepsNum=function(e){var t=this.reps||0;if(null==this.nodeGroup.formulaReps){var n=e[this.completeName];null!=n?this.reps=n:0==t&&(this.reps=1)}else{var i=this.nodeGroup.formulaReps.evaluate(e);i!==t&&(this.reps=i)}return t},Mt);function Mt(e,t){return Nt.call(this,e,t)||this}var wt,Ot=(r(St,wt=mt),Object.defineProperty(St.prototype,"valid",{get:function(){return this.flatNodes.map(function(e){return!(e.visible&&-1<Object.keys(e).indexOf("valid"))||e.valid}).reduce(function(e,t){return e&&t},!0)},enumerable:!0,configurable:!0}),Object.defineProperty(St.prototype,"slide",{get:function(){return this.node},enumerable:!0,configurable:!0}),St.prototype.setSlide=function(e){this.setNode(e)},St);function St(){var e=null!==wt&&wt.apply(this,arguments)||this;return e.nodes=[],e.flatNodes=[],e}var Et,Ft=(r(At,Et=Ot),Object.defineProperty(At.prototype,"reps",{get:function(){return this._reps},set:function(e){this._reps=e,this.canRemoveGroup=0===this.slide.minReps||e>this.slide.minReps,this.canAddGroup=0===this.slide.maxReps||e<this.slide.maxReps,this._repsArr=new Array(e)},enumerable:!0,configurable:!0}),Object.defineProperty(At.prototype,"repsArr",{get:function(){return this._repsArr},enumerable:!0,configurable:!0}),Object.defineProperty(At.prototype,"slide",{get:function(){return this.node},enumerable:!0,configurable:!0}),Object.defineProperty(At.prototype,"nodesPerSlide",{get:function(){return null!=this.nodes?this.nodes.length/this.reps:0},enumerable:!0,configurable:!0}),At.prototype.setSlide=function(e){this.setNode(e)},At.prototype.validSlide=function(e){return e>=this.slideNodes.length||this.slideNodes[e].map(function(e){return!(e.visible&&-1<Object.keys(e).indexOf("valid"))||e.valid}).reduce(function(e,t){return e&&t},!0)},At.prototype.slidePosition=function(e){return this.position+e},At.prototype.updateRepsNum=function(e){var t=this.reps||0;if(null==this.slide.formulaReps){var n=e[this.completeName];null!=n?this.reps=n:0==t&&(this.reps=1)}else{var i=this.slide.formulaReps.evaluate(e);i!==t&&(this.reps=i)}return t},At);function At(e,t){return Et.call(this,e,t)||this}var Vt,Tt=(r(Rt,Vt=yt),Object.defineProperty(Rt.prototype,"hideEmptyRows",{get:function(){return this._hideEmptyRows},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"controls",{get:function(){return this._matrixFormControl},set:function(e){this._matrixFormControl=e,this._matrixFormControlWithLabels=this._controlsWithLabels()},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"controlsWithLabels",{get:function(){return this._matrixFormControlWithLabels},enumerable:!0,configurable:!0}),Rt.prototype._controlsWithLabels=function(){for(var e=this.node,t=[],n=0,i=0,o=e.rowLabels;i<o.length;i++){var r=o[i];t.push([r].concat(this._matrixFormControl[n])),n+=1}return t.unshift([e.label].concat(e.columnLabels)),t},Object.defineProperty(Rt.prototype,"value",{get:function(){return this.node.editable?this._matrixFormControl:this._matrixValue},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Rt.prototype.setValue=function(t){var n=this,i=this.node;if(i.editable)this._context=t;else{var o=[],r=0;i.rows.forEach(function(e){e.forEach(function(e){n._context[e]=t[e]}),o[r]=[i.rowLabels[r]].concat(e.map(function(e){return t[e]})),r+=1}),o.unshift([i.label].concat(i.columnLabels)),this._matrixValue=o}},Object.defineProperty(Rt.prototype,"visibleColumns",{get:function(){return this.hideEmptyRows?this.value.filter(function(e){return e.slice(1).reduce(function(e,t){return e||null!=t&&""!==t&&0!==t&&"0"!==t},!1)}):this.value},enumerable:!0,configurable:!0}),Rt);function Rt(e,t){var n=Vt.call(this,e,t)||this;return n._context={},n.setValue(t),n._hideEmptyRows=n.node.hideEmptyRows,n}var It,Pt=(r(Bt,It=yt),Object.defineProperty(Bt.prototype,"field",{get:function(){return this.field},set:function(e){this.setNode(e)},enumerable:!0,configurable:!0}),Bt);function Bt(){return null!==It&&It.apply(this,arguments)||this}var Dt,kt=(r(Ut,Dt=yt),Object.defineProperty(Ut.prototype,"field",{get:function(){return this.field},set:function(e){this.setNode(e)},enumerable:!0,configurable:!0}),Ut);function Ut(){return null!==Dt&&Dt.apply(this,arguments)||this}function Gt(){}var Lt=(Object.defineProperty(Jt.prototype,"fieldInstance",{get:function(){return this._fieldInstance},set:function(e){var t=this;this._fieldInstance=e,this._fieldUpdateSubscription.unsubscribe(),this._fieldUpdateSubscription=e.updated.subscribe(function(){if(t._changeDetectionRef)try{t._changeDetectionRef.detectChanges()}catch(e){}})},enumerable:!0,configurable:!0}),Object.defineProperty(Jt.prototype,"fwcInst",{get:function(){return this._fieldInstance},enumerable:!0,configurable:!0}),Object.defineProperty(Jt.prototype,"fwc",{get:function(){return this._fieldInstance.field},enumerable:!0,configurable:!0}),Object.defineProperty(Jt.prototype,"datefInst",{get:function(){return this._fieldInstance},enumerable:!0,configurable:!0}),Object.defineProperty(Jt.prototype,"tablefInst",{get:function(){return this._fieldInstance},enumerable:!0,configurable:!0}),Object.defineProperty(Jt.prototype,"emptyfInst",{get:function(){return this._fieldInstance},enumerable:!0,configurable:!0}),Object.defineProperty(Jt.prototype,"valueChanged",{get:function(){return this._valueChanged.asObservable()},enumerable:!0,configurable:!0}),Jt.prototype.ngOnInit=function(){var i=this;this.control=this._rendererService.getControl(this.fieldInstance),this._triggerWarningSubscription=this.fieldInstance.triggerWarning.pipe(a.withLatestFrom(this.control),a.filter(function(e){return null!=e[1]})).subscribe(function(e){var t=e[1],n=i.showWarningAlertPrompt(i.fieldInstance.warningResults.filter(function(e){return e.result}).map(function(e){return e.warning})).subscribe(function(e){e.result&&t.setValue(null)},function(e){n&&n.unsubscribe()},function(){n&&n.unsubscribe()})})},Jt.prototype.ngAfterViewInit=function(){var e=this;this.fieldInstance instanceof xt&&(this._triggerSelectionSubscription=this.fieldInstance.triggerSelection.subscribe(function(){e._triggerSelection()}))},Jt.prototype.ngOnDestroy=function(){this._triggerSelectionSubscription.unsubscribe(),this._triggerWarningSubscription.unsubscribe(),this._fieldUpdateSubscription.unsubscribe()},Jt.prototype._triggerSelection=function(){null==this.singleChoiceSelect||this.singleChoiceSelect._isOpen?null==this.multipleChoiceSelect||this.multipleChoiceSelect._isOpen||this.multipleChoiceSelect.open():this.singleChoiceSelect.open()},Jt);function Jt(e,t){this._rendererService=e,this._changeDetectionRef=t,this.ajfFieldTypes=he,this._valueChanged=new n.EventEmitter,this._triggerSelectionSubscription=b.Subscription.EMPTY,this._triggerWarningSubscription=b.Subscription.EMPTY,this._fieldUpdateSubscription=b.Subscription.EMPTY}var Wt=(i||t).tokenize;function $t(t,n){var i=[];return t.filter(function(e){return e.parent==n}).sort(function(e,t){return e.parentNode-t.parentNode}).forEach(function(e){i.push(e),i=i.concat($t(t,e.id))}),i}function zt(e){return null!=e&&(e instanceof je||e instanceof ve)}function Ht(e){return null!=e&&(e instanceof be||e instanceof je||e instanceof ve)}function Yt(e){var t=[];return e.forEach(function(e){t.push(e),(e instanceof ve||e instanceof be||e instanceof je)&&(t=t.concat(Yt(e.nodes)))}),t}function qt(e,t){void 0===t&&(t=!1);var n=[];return e.forEach(function(e){e instanceof yt&&n.push(e),(e instanceof Ct||e instanceof Ot||e instanceof Ft)&&(t&&n.push(e),n=n.concat(qt(e.nodes,t)))}),n}function Zt(e,t){for(var n=[],i=t.parent;null!=i;)(t=e.find(function(e){return e instanceof le?e.id==i:e.node.id==i}))instanceof mt&&(t=t.node),zt(t)&&n.push(t),i=null!=t?t.parent:null;return n}function Kt(e,t){var n={};return Zt(e,t).forEach(function(e,t){(e.nodes||[]).forEach(function(e){e instanceof Me&&(n[e.name]=t)})}),n}function Qt(e){var t=[];return e.forEach(function(e){(e instanceof Ot||e instanceof Ft)&&(t.push(e),e.flatNodes=qt(e.nodes))}),t}function Xt(t,n,i){var o=Object.keys(n);return Wt(t).filter(function(e){return"Identifier"==e.type&&"$value"!=e.value}).map(function(e){return e.value}).forEach(function(e){-1<o.indexOf(e)&&(t=t.replace(new RegExp("\\b"+e+"\\b","g"),e+"__"+i.slice(n[e]).join("__")))}),t}function en(e,t,n){var i=e.condition,o=Xt(i,t,n);return o===i?e:new d.AjfCondition({condition:o})}function tn(e,t,n){var i=e.formula,o=Xt(i,t,n);return o===i?e:new d.AjfFormula({formula:o})}function nn(e,n,i){var o=!1,t=e.map(function(e){var t=en(e,n,i);return t!==e&&(o=!0),t});return o?t:e}function on(e,n,i){var o=!1,t=e.map(function(e){var t=function(e,t,n){var i=e.condition,o=Xt(i,t,n);return o===i?e:new q({condition:o})}(e,n,i);return t!==e&&(o=!0),t});return o?t:e}function rn(e,n,i){var o=!1,t=e.map(function(e){var t=function(e,t,n){var i=e.condition,o=Xt(i,t,n);return o===i?e:new ne({condition:o})}(e,n,i);return t!==e&&(o=!0),t});return o?t:e}function an(e,t,n,i){var o=null;if(t instanceof Je?o=new xt({node:t,prefix:n},i):t instanceof ct?o=new Tt({node:t,prefix:n},i):t instanceof Me?o=new yt({node:t,prefix:n},i):t instanceof ve?o=new Ct({node:t,prefix:n},i):t instanceof je?o=new Ft({node:t,prefix:n},i):t instanceof be&&(o=new Ot({node:t,prefix:n},i)),null!=o)if(null!=n&&0<n.length){var r=Kt(e,t);if(null!=t.visibility){var a=t.visibility.condition,s=Xt(a,r,n);o.visibility=s!==a?new d.AjfCondition({condition:s}):t.visibility}if(o.conditionalBranches=nn(o.node.conditionalBranches,r,n),o instanceof Ct||o instanceof Ft){var u=o instanceof Ct?o.nodeGroup.formulaReps:o.slide.formulaReps;if(null!=u){var l=u.formula,c=Xt(l,r,n);o.formulaReps=c!==l?new d.AjfFormula({formula:c}):u}}else if(o instanceof yt){if(null!=o.field.formula&&(o.formula=tn(o.field.formula,r,n)),null!=o.field.validation){var p=on(o.field.validation.conditions,r,n);p!==o.field.validation.conditions?(o.validation=new Q(o.field.validation),o.validation.conditions=p):o.validation=o.field.validation}if(null!=o.field.warning){var f=rn(o.field.warning.conditions,r,n);f!==o.field.warning.conditions?(o.warning=new re(o.field.warning),o.warning.conditions=f):o.warning=o.field.warning}null!=o.field.nextSlideCondition&&(o.nextSlideCondition=en(o.field.nextSlideCondition,r,n)),o instanceof xt&&(null!=o.field.choicesFilter&&(o.choicesFilter=tn(o.field.choicesFilter,r,n)),null!=o.field.triggerConditions&&(o.triggerConditions=nn(o.field.triggerConditions,r,n)))}}else o.visibility=o.node.visibility,o.conditionalBranches=o.node.conditionalBranches,o instanceof Ct||o instanceof Ft?o.formulaReps=(o instanceof Ct?o.nodeGroup:o.slide).formulaReps:o instanceof yt&&(o.formula=o.field.formula,o.validation=o.field.validation,o.warning=o.field.warning,o.nextSlideCondition=o.field.nextSlideCondition,o instanceof xt&&(o.choicesFilter=o.field.choicesFilter,o.triggerConditions=o.field.triggerConditions));return o}function sn(e){return null!=e&&(e instanceof Ot||e instanceof Ft||e instanceof Ct)}var un=(ln.prototype.addFunction=function(e){this._functions.push(e),this._initFunctions()},ln.prototype.addFunctionHandler=function(e,t){void 0===d.AjfValidatedProperty.utils[e]&&(d.AjfValidatedProperty.utils[e]={fn:t})},ln.prototype._initFunctions=function(){var e=this._functions.map(function(e){return"string"==typeof e?e:e.toString()}).join("; ");this._functionsStr=this._baseUtilFunctions.join("; ")+"; "+e,d.AjfValidatedProperty.UTIL_FUNCTIONS=this._functionsStr},ln.decorators=[{type:n.Injectable}],ln.ctorParameters=function(){return[]},ln);function ln(){this._baseUtilFunctions=["/**\n        * count the number of digit contained on x.\n        * @param  x the value used for digit count\n        * @return the count of the digit\n      */\n    var digitCount = function(x) { return x.toString().length; }","/**\n        * count the number of decimal contained on x.\n        * @param  x the value used for decimal count\n        * @return the count of the decimal\n      */\n    var decimalCount = function(x) {\n      return (parseFloat(x).toString().split('.')[1] || []).length;\n    }","/**\n        * check if x is integer\n        * @param  x the value used for check\n        * @return true if x is a number\n      */\n    var isInt = function(x) { return !/[,.]/.test(x); }","/**\n        * check if x is not empity\n        * @param  x the value used for check\n        * @return true if x defined and not null and the number of digit is > 0\n      */\n    var notEmpty = function (x) {\n      return (typeof x !== 'undefined' && x !== null ? x.toString().length > 0 : false);\n    }","/**\n        * check if x is contained on array\n        * @param  x the value used for check\n        * @return the position of x on array or if array === x\n      */\n    var valueInChoice = function(array, x) { return array.indexOf(x) > -1 || array === x; }","var scanGroupField = function(reps, acc, callback) {\n        for (var i = 0; i < reps; i++) {\n            acc = callback(acc, i);\n        }\n        return acc;\n    }","/**\n        * sum the value contained on array\n        * @param  x the array\n        * @return the sum\n      */\n    var sum = function(array) {return array.reduce(function(a, b){ return a + b; }, 0); }","var dateOperations = function(dString, period, operation, v) {\n        fmt = 'MM/DD/YYYY';\n        var d = (typeof dString !== 'undefined') ? dateUtils.parse(dString) : new Date();\n        if (operation == 'remove') {\n          v = -v;\n        }\n        var dateOp;\n        switch (period) {\n          case 'day':\n            dateOp = dateUtils.addDays;\n            break;\n          case 'month':\n            dateOp = dateUtils.addMonths;\n            break;\n          case 'year':\n            dateOp = dateUtils.addYears;\n            break;\n          default:\n            return -1;\n        }\n        return dateUtils.format(dateOp(d, v), fmt);\n      }","/**\n        * round the num\n        * @param  num the value to round\n        * @param  digits how many digit\n        * @return num rounded\n      */\n      var round = function(num, digits) {\n        digits = digits || 0;\n        var f = 0;\n        try { f = parseFloat(num); } catch (e) { }\n        var m = Math.pow(10, digits);\n        return Math.round(f * m) / m;\n      }","/**\n        * extract the property of the source object with property != null\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want filter\n        * @return array of dates\n      */\n      var extractArray = function(source, property, property2) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null && source[i][property2] != null) {\n            res.push(source[i][property] + source[i][property2]);\n          }\n          else if (source[i][property] != null) {\n            res.push(source[i][property]);\n          }\n        }\n        return res;\n      }","/**\n        * extract the property of the source object with property != null\n        * @param  source array of object wich contains property\n        * @param  propertues string array the properties to sum\n        * @return the sum\n      */\n      var extractSum = function(source, properties) {\n        var sum = 0;\n        properties = (properties || []).slice(0);\n        var l = properties.length;\n\n        for (var i = 0; i < l ; i++) {\n          var array = extractArray(source, properties[i]);\n          var leng = array.length;\n          for(var j = 0; j < leng; i++) {\n            sum += array[j];\n          }\n        }\n        return sum;\n      }","/**\n        * extract the array of sum for each week != null\n        * @param  source array of object wich contains property\n        * @param  propertues string array the properties to sum\n        * @return the sum\n      */\n      var extractArraySum = function(source, properties) {\n        var arrays = [];\n        properties = (properties || []).slice(0);\n\n        for (var propI = 0; propI < properties.length ; propI++) {\n          var array = extractArray(source, properties[propI]);\n          arrays.push(array);\n        }\n\n        var res = [];\n        for (var weekI = 0; weekI < array.length; weekI ++ ) {\n          var sum = 0;\n          for (var propI = 0; propI < properties.length ; propI++) {\n            sum = sum + arrays[propI][weekI]\n          }\n          res.push(sum);\n        }\n        return res;\n      }","/**\n        * draw a threshold line on chart related to the property\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want filter\n        * @return array of dates\n      */\n      var drawThreshold = function(source, property, treshold) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null) {\n            res.push(treshold);\n          }\n        }\n        return res;\n      }",'/**\n        * extract the dates of the source object with property != null\n        * @param  source array of object wich contains property and date_start\n        * @param  property the property on wich we want to calculate dates\n        * @param  format the format of the date\n        * @return array of dates\n      */\n      var extractDates = function(source, property, format) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        var prefix = \'\';\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null) {\n            switch(format) {\n              case "WW":\n                prefix = "W";\n                break;\n              case "MM":\n                prefix = "M";\n                break;\n              default:\n                prefix = "";\n            }\n            res.push(prefix + formatDate(source[i]["date_start"], format));\n          }\n        }\n        return res;\n      }',"/**\n        * extract the last property contains in source != null\n        * @param  source array of object wich contains property and date_start\n        * @param  property the property to find\n        * @return the last property != null\n      */\n      var lastProperty = function(source, property) {\n        source = (source || []).slice(0);\n        var l = source.length -1;\n\n        while (l >= 0 && source[l][property] == null) {\n          l--;\n          if (l < 0) return 0;\n        }\n        return l >= 0 ? source[l][property] : 0;\n      }","var sumLastProperties = function(source, properties) {\n        source = (source || []).slice(0);\n        var sum = 0;\n        for (var i = 0; i < properties.length; i++) {\n          sum += lastProperty(source, properties[i]);\n        }\n\n        return sum;\n      }",'/**\n        * compute the trend of the property contained on the source.\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want to calculate the trend\n        * @return an html icon that identifies the trend\n      */\n      var calculateTrendProperty = function(source, property) {\n        source = (source || []).slice(0);\n        var last = source.length - 1;\n        while (source[last][property] == null) {\n          if (last == 0) {\n            break;\n          }\n          last--;\n        }\n        var lastLast = last - 1;\n        if (last == 0) {\n          lastLast = last;\n        } else {\n          while (source[lastLast][property] == null) {\n            if (lastLast == 0) {\n              lastLast = last;\n              break;\n            }\n            lastLast--;\n          }\n        }\n\n        var lastProperty = source[last]?(source[last][property] || 0): 0;\n        var lastLastProperty = source[lastLast]?(source[lastLast][property] || 0): 0;\n\n        if (lastProperty == lastLastProperty) {\n          return \'<p><i class="material-icons" style="color:blue">trending_flat</i></p>\';\n        } else if (lastProperty > lastLastProperty) {\n          return \'<p><i class="material-icons" style="color:green">trending_up</i></p>\';\n        } else {\n          return \'<p><i class="material-icons" style="color:red">trending_down</i></p>\';\n        }\n      }',"/**\n        * compute the average value of the property contained on the source.\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want to calculate the average\n        * @param  range the range on wich we want to calculate the average\n        * @param  coefficent the coefficent used for calculate the treshold\n                  if coefficent is 0 mean return the count of property > 0\n        * @return the average value || the count of property > 0\n      */\n      var calculateAvgProperty = function(source, property, range, coefficient) {\n        source = (source || []).slice(0);\n\n        source.pop();\n\n        coefficient = coefficient || 1;\n        range = range || 12;\n\n        var l = source.length;\n        var res = 0;\n        var counter = 0;\n        var noZero = 0;\n\n        if(l < range) {\n          range = l;\n        }\n\n        while (range != 0) {\n          counter++;\n          if (source[l - 1][property] != null) {\n            res += source[l - 1][property];\n\n            if (source[l - 1][property] > 0) {\n              noZero++;\n            }\n          }\n          l--;\n          range--;\n        }\n\n        if (coefficient == 0) {\n          return noZero;\n        } else {\n          var treshold = (res/counter)*coefficient || 0;\n          return treshold;\n        }\n      }","var alert = function(source, property, treshold, fmt) {\n        source = (source || []).slice(0);\n        var l = source.length;\n\n        if ( lastProperty(source, property)  > treshold ) {\n          return '<p><i class=\"material-icons\" style=\"color:red\">warning</i></p>';\n          } else {\n            return '<p></p>';\n          }\n      }","var formatNumber = function(num, fmt) {\n        fmt = fmt || '0,0[.]0';\n        return numeral(num).format(fmt);\n      }","var formatDate = function(date, fmt) {\n        fmt = fmt || 'MM-DD-YYYY';\n        return dateUtils.format(date, fmt);\n      }","var isoMonth = function(date, fmt) {\n        fmt = fmt || 'MM';\n        var du = dateUtils;\n        return du.format(du.addDays(du.startOfMonth(date), 4),fmt)\n      }","var nextCounterValue = function(counterName, firstValue) {\n        firstValue = firstValue != null ? firstValue : 0;\n        if (execContext['$$'+counterName] == null) {\n          execContext['$$'+counterName] = firstValue;\n        } else {\n          execContext['$$'+counterName]++;\n        }\n        return execContext['$$'+counterName];\n      }","var getCoordinate = function(source, zoom) {\n        zoom = zoom || 6;\n        if(source == null) {\n          return [51.505,-0.09, zoom];\n        } else {\n          return [source[0], source[1], zoom];\n        }\n      }"],this._functions=[],this._functionsStr="",this._initFunctions()}var cn=(i||t).tokenize,pn={Initializing:0,Complete:1};pn[pn.Initializing]="Initializing",pn[pn.Complete]="Complete";var fn=(Object.defineProperty(dn.prototype,"nodesTree",{get:function(){return this._flatNodesTree},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"errorPositions",{get:function(){return this._errorPositions},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"errors",{get:function(){return this._errors},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"currentSupplementaryInformations",{get:function(){var e=this._form.getValue();return null!=e&&null!=e.form?e.form.supplementaryInformations:null},enumerable:!0,configurable:!0}),dn.prototype.setForm=function(e,t){void 0===t&&(t={}),this._initUpdateMapStreams(),null!=e&&0===Object.keys(t).length&&0<Object.keys(e.initContext).length&&(t=e.initContext);var n=this._form.getValue();(null==n&&null!=e||null!=n&&e!==n.form)&&this._form.next({form:e,context:t})},dn.prototype.getFormValue=function(){var e=this._formGroup.getValue();return null==e?{}:p.deepCopy(e.value)},dn.prototype.addGroup=function(o){var r=this;return new b.Observable(function(n){if(null!=o.formulaReps)return n.next(!1),void n.complete();var e=o instanceof Ct?o.nodeGroup.maxReps:o.slide.maxReps;if(0<e&&o.reps+1>e)return n.next(!1),void n.complete();var i=o.reps;o.reps=o.reps+1,r._nodesUpdates.next(function(e){var t=qt(e,!0);return r._adjustReps(t,o,i,r.getFormValue()),n.next(!0),n.complete(),e})})},dn.prototype.removeGroup=function(i){var o=this;return new b.Observable(function(t){if(null!=i.formulaReps)return t.next(!1),void t.complete();var e=i instanceof Ct?i.nodeGroup.minReps:i.slide.minReps;if(i.reps-1<e)return t.next(!1),void t.complete();var n=i.reps;i.reps=i.reps-1,o._nodesUpdates.next(function(e){return o._adjustReps(e,i,n,o.getFormValue()),t.next(!0),t.complete(),e})})},dn.prototype.getControl=function(n){return this.formGroup.pipe(a.map(function(e){var t=n.completeName;return null!=e&&e.contains(t)?e.controls[t]:null}))},dn.prototype._initErrorsStreams=function(){var r=this;this._errorPositions=this._valueChanged.pipe(a.withLatestFrom(this._nodes,this._form),a.filter(function(e){return null!=e[2]&&null!=e[2].form}),a.map(function(e){var t=e[1],n=e[2].form,i=0,o=[];return t.forEach(function(e){if(e instanceof Ft)for(var t=0;t<e.reps;t++)e.visible&&(i++,0==t&&(e.position=i),e.validSlide(t)||o.push(i));else e instanceof Ot&&e.visible&&(i++,e.position=i,e.valid||o.push(i))}),n.valid=0==o.length,r._slidesNum.next(i),o}),a.publishReplay(),a.refCount()),this._errors=this._errorPositions.pipe(a.map(function(e){return null!=e?e.length:0}),a.startWith(0),a.publishReplay(),a.refCount())},dn.prototype._initUpdateMapStreams=function(){this._visibilityNodesMap=this._visibilityNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._repetitionNodesMap=this._repetitionNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._conditionalBranchNodesMap=this._conditionalBranchNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._formulaNodesMap=this._formulaNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._validationNodesMap=this._validationNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._warningNodesMap=this._warningNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._filteredChoicesNodesMap=this._filteredChoicesNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._triggerConditionsNodesMap=this._triggerConditionsNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._nextSlideConditionsNodesMap=this._nextSlideConditionsNodesMapUpdates.pipe(a.scan(function(e,t){return t(e)},{}),a.startWith({}),a.share()),this._nodesMaps=[this._visibilityNodesMap,this._repetitionNodesMap,this._conditionalBranchNodesMap,this._formulaNodesMap,this._validationNodesMap,this._warningNodesMap,this._nextSlideConditionsNodesMap,this._filteredChoicesNodesMap,this._triggerConditionsNodesMap]},dn.prototype._initFormStreams=function(){var o=this,e=this._form;e.pipe(a.map(function(e){return o._initFormGroupStreams(new s.FormGroup({}))})).subscribe(this._formGroup),e.pipe(a.map(function(i){return function(e){var t=null!=i&&null!=i.form?o._orderedNodesInstancesTree(Yt(i.form.nodes),i.form.nodes,void 0,[],i.context):[],n=0;return t.forEach(function(e){if(e instanceof Ft)for(var t=0;t<e.reps;t++)e.visible&&(n++,0==t&&(e.position=n));else e instanceof Ot&&e.visible&&(n++,e.position=n)}),t}})).subscribe(this._nodesUpdates)},dn.prototype._initNodeInstance=function(e,t,n,i,o){void 0===o&&(o=!0);var r=an(e,t,n,i);return null!=r&&(r instanceof Ct||r instanceof Ft?this._explodeRepeatingNode(e,r,i):r instanceof Ot&&(r.nodes=this._orderedNodesInstancesTree(e,r.slide.nodes,r.slide.id,n,i)),r.updateVisibility(i,o),r.updateConditionalBranches(i),r instanceof xt?r.updateFilteredChoices(i):r instanceof yt&&(r.value=i[r.completeName],r.updateFieldState(i)),this._addNodeInstance(r)),r},dn.prototype._adjustReps=function(i,o,e,r){var a=this,t=o.reps,n={added:null,removed:null};if(e<t){var s=[];if(null==o.nodes&&(o.nodes=[]),o instanceof Ct){var u=new Se({label:o.node.label}),l=this._initNodeInstance(i,u,o.prefix.slice(0),r);null!=l&&o.nodes.push(l)}for(var c=function(e){var n=o.prefix.slice(0),t=o instanceof Ct?o.nodeGroup:o.slide;n.push(e),$t(t.nodes,o.node.id).forEach(function(e){var t=a._initNodeInstance(i,e,n,r);null!=t&&(s.push(t),o.nodes.push(t))}),p._addNodeInstance(o)},p=this,f=e;f<t;f++)c(f);n.added=s}else if(t<e){var d=o.nodes.length/e;o instanceof Ct&&d++,n.removed=o.nodes.splice(t*d,d),n.removed.forEach(function(e){a._removeNodeInstance(e)})}if(e!=t&&null==o.formulaReps){var h=this._formGroup.getValue();null!=h&&h.contains(o.completeName)&&h.controls[o.completeName].setValue(o.reps)}if(o.flatNodes=qt(o.nodes),o instanceof Ft){var m=[],v=o.nodesPerSlide;for(f=0;f<o.reps;f++){var g=f*v;m.push(o.nodes.slice(g,g+v))}o.slideNodes=m}return n},dn.prototype._updateFormValueAndValidity=function(){this._nodesUpdates.asObservable().pipe(a.withLatestFrom(this._formGroup),a.filter(function(e){return null!==e[1]})).subscribe(function(e){e[1].updateValueAndValidity()})},dn.prototype._explodeRepeatingNode=function(e,t,n){var i=t.updateRepsNum(n);i!==t.reps&&this._adjustReps(e,t,i,n)},dn.prototype._orderedNodesInstancesTree=function(o,e,t,r,a){var s=this;void 0===t&&(t=null),void 0===r&&(r=[]);var u=[],l=0<r.length?"__"+r.join("__"):"";return $t(e,t).forEach(function(t){var e=u.find(function(e){return e.node.id==t.parent&&e.suffix==l}),n=null==e||null!=e.verifiedBranch&&e.verifiedBranch==t.parentNode,i=s._initNodeInstance(o,t,r,a,n);null!=i&&u.push(i)}),u},dn.prototype._formValueDelta=function(t,n){return Object.keys(n).filter(function(e){return t[e]!==n[e]})},dn.prototype._initFormGroupStreams=function(e){var v=this;this._formGroupSubscription.unsubscribe();var g=!0,y=!0;return this._formInitEvent.emit(pn.Initializing),this._formGroupSubscription=e.valueChanges.pipe(a.startWith({}),a.pairwise(),a.debounceTime(200),a.withLatestFrom.apply(void 0,this._nodesMaps.concat([this._flatNodes]))).subscribe(function(e){var t=g&&{}||e[0][0];g=!1;var a=e[0][1],n=e[1],i=e[2],o=e[3],r=e[4],s=e[5],u=e[6],l=e[7],c=e[8],p=e[9],f=e[10],d=v._formValueDelta(t,a),h=d.length,m=[];d.forEach(function(t){if(m=m.concat(f.filter(function(e){return e.completeName===t})),null!=n[t]&&n[t].forEach(function(e){var t=e.updateVisibility(a);if(t&&!e.visible){var n=v._formGroup.getValue();if(null!=n)var i=b.timer(200).subscribe(function(){i&&!i.closed&&i.unsubscribe(),n.controls[e.completeName].setValue(null)});e instanceof yt&&(e.value=null)}else if(t&&e.visible&&e instanceof yt){var o=v._formGroup.getValue(),r=e.updateFormula(a);null!=o&&r.changed&&o.controls[e.completeName].setValue(r.value)}-1===m.indexOf(e)&&m.push(e)}),null!=i[t]&&i[t].forEach(function(e){if(e instanceof Ct||e instanceof Ft){var t=e.updateRepsNum(a);t!==e.reps&&v._adjustReps(f,e,t,a)}-1===m.indexOf(e)&&m.push(e)}),null!=o[t]&&o[t].forEach(function(n){n.updateConditionalBranches(a);var i=n.verifiedBranch;n.conditionalBranches.forEach(function(e,t){t==i?v._showSubtree(a,f,n,t):v._hideSubtree(a,f,n,t)}),-1===m.indexOf(n)&&m.push(n)}),null!=r[t]&&r[t].forEach(function(e){if(e instanceof yt){var t=e.updateFormula(a),n=v._formGroup.getValue();null!=n&&t.changed&&(e.updateValidation(a),n.controls[e.completeName].setValue(t.value))}-1===m.indexOf(e)&&m.push(e)}),null!=s[t]&&s[t].forEach(function(e){e instanceof yt&&(a.$value=a[e.completeName],e.updateValidation(a,v.currentSupplementaryInformations)),-1===m.indexOf(e)&&m.push(e)}),null!=u[t]&&u[t].forEach(function(e){e instanceof yt&&(e.updateWarning(a),0<e.warningResults.filter(function(e){return e.result}).length&&e.emitTriggerWarning()),-1===m.indexOf(e)&&m.push(e)}),1==h&&null!=l[t]&&1==l[t].filter(function(e){return e instanceof yt&&e.updateNextSlideCondition(a)}).length&&v._nextSlideTrigger.emit(),null!=c[t]&&c[t].forEach(function(e){e instanceof xt&&e.updateFilteredChoices(a),-1===m.indexOf(e)&&m.push(e)}),1==h&&null!=p[t]){var e=p[t].filter(function(e){return e instanceof xt&&e.updateTriggerConditions(a)});1==e.length&&e[0].emitTriggerSelection()}}),m.forEach(function(e){return e.triggerUpdate()}),y&&(y=!1,v._formInitEvent.emit(pn.Complete)),v._valueChanged.next()}),e},dn.prototype._showSubtree=function(e,t,n,i){this._updateSubtreeVisibility(e,t,n,!0,i)},dn.prototype._hideSubtree=function(e,t,n,i){this._updateSubtreeVisibility(e,t,n,!1,i)},dn.prototype._updateSubtreeVisibility=function(e,n,i,o,t){var r,a=this;r=null!=t?n.filter(function(e){return e.suffix==i.suffix&&e.node.parent==i.node.id&&e.node.parentNode==t}):n.filter(function(e){return e.suffix==i.suffix&&e.node.parent==i.node.id});var s=Ht(i.node);r.forEach(function(t){(!s||s&&null==i.node.nodes.find(function(e){return e.id==t.node.id}))&&(t.updateVisibility(e,o),t instanceof yt&&t.updateFormula(e),a._updateSubtreeVisibility(e,n,t,o))})},dn.prototype._initNodesStreams=function(){this._nodes=this._nodesUpdates.pipe(a.scan(function(e,t){return t(e)},[]),a.share()),this._flatNodesTree=this._nodes.pipe(a.map(function(e){return Qt(e)}),a.share()),this._flatNodes=this._flatNodesTree.pipe(a.map(function(e){var t=[];return e.forEach(function(e){t.push(e),t=t.concat(e.flatNodes)}),t}),a.share())},dn.prototype._removeNodeInstance=function(e){var t=e.completeName;return this._removeNodesVisibilityMapIndex(t),this._removeNodesRepetitionMapIndex(t),this._removeNodesConditionalBranchMapIndex(t),this._removeNodesFormulaMapIndex(t),this._removeNodesValidationMapIndex(t),this._removeNodesWarningMapIndex(t),this._removeNodesNextSlideConditionsMapIndex(t),this._removeNodesFilteredChoicesMapIndex(t),this._removeNodesTriggerConditionsMapIndex(t),e instanceof Ot?this._removeSlideInstance(e):(zt(e.node)?this._removeNodeGroupInstance(e):e instanceof yt&&this._removeFieldInstance(e),e)},dn.prototype._removeSlideInstance=function(t){var n=this,e=t.slide;return null!=e.visibility&&this._removeFromNodesVisibilityMap(t,e.visibility.condition),t.conditionalBranches.forEach(function(e){n._removeFromNodesConditionalBranchMap(t,e.condition)}),t},dn.prototype._removeNodeGroupInstance=function(e){var t=e instanceof Ct?e.nodeGroup:e.slide;return null!=t.visibility&&this._removeFromNodesVisibilityMap(e,t.visibility.condition),null!=e.formulaReps&&null!=t.formulaReps&&this._removeFromNodesRepetitionMap(e,t.formulaReps.formula),e},dn.prototype._removeFieldInstance=function(t){var n=this,e=this._formGroup.getValue(),i=t.completeName;return null!=e&&e.contains(i)&&e.removeControl(i),null!=t.validation&&this._validationNodesMapUpdates.next(function(e){return null==e[i]&&delete e[i],e}),null!=t.visibility&&this._removeFromNodesVisibilityMap(t,t.visibility.condition),t.conditionalBranches.forEach(function(e){n._removeFromNodesConditionalBranchMap(t,e.condition)}),null!=t.formula&&this._removeFromNodesFormulaMap(t,t.formula.formula),t instanceof Ct&&null!=t.formulaReps&&this._removeFromNodesRepetitionMap(t,t.formulaReps.formula),null!=t.validation&&null!=t.validation.conditions&&t.validation.conditions.forEach(function(e){n._removeFromNodesValidationMap(t,e.condition)}),null!=t.warning&&t.warning.conditions.forEach(function(e){n._removeFromNodesWarningMap(t,e.condition)}),null!=t.nextSlideCondition&&this._removeFromNodesNextSlideConditionsMap(t,t.nextSlideCondition.condition),t instanceof xt&&null!=t.choicesFilter&&(this._removeFromNodesFilteredChoicesMap(t,t.choicesFilter.formula),null!=t.triggerConditions&&t.triggerConditions.forEach(function(e){n._removeFromNodesTriggerConditionsMap(t,e.condition)})),t},dn.prototype._addNodeInstance=function(e){return e instanceof Ft||e instanceof Ct?this._addNodeGroupInstance(e):e instanceof Ot?this._addSlideInstance(e):e instanceof yt?this._addFieldInstance(e):e},dn.prototype._addFieldInstance=function(i){var t=this,o=this._formGroup.getValue(),n=i.completeName;if(null!=o&&!o.contains(n)){var e=new s.FormControl;e.setValue(i.value),o.registerControl(n,e)}if(null!=o&&i instanceof Tt&&i.node.editable){var r=i.node,a=[];r.rows.forEach(function(e){var n=[];e.forEach(function(e){var t=new s.FormControl;t.setValue(i.context[e]),o.registerControl(e,t),n.push(t)}),a.push(n)}),i.controls=a}return null!=i.validation&&this._validationNodesMapUpdates.next(function(e){return null==e[n]&&(e[n]=[]),-1==e[n].indexOf(i)&&e[n].push(i),e}),null!=i.visibility&&this._addToNodesVisibilityMap(i,i.visibility.condition),i.conditionalBranches.forEach(function(e){t._addToNodesConditionalBranchMap(i,e.condition)}),null!=i.formula&&this._addToNodesFormulaMap(i,i.formula.formula),i instanceof Ct&&null!=i.formulaReps&&this._addToNodesRepetitionMap(i,i.formulaReps.formula),null!=i.validation&&null!=i.validation.conditions&&i.validation.conditions.forEach(function(e){t._addToNodesValidationMap(i,e.condition)}),null!=i.warning&&i.warning.conditions.forEach(function(e){t._addToNodesWarningMap(i,e.condition)}),null!=i.nextSlideCondition&&this._addToNodesNextSlideConditionsMap(i,i.nextSlideCondition.condition),i instanceof xt&&(null!=i.choicesFilter&&this._addToNodesFilteredChoicesMap(i,i.choicesFilter.formula),null!=i.triggerConditions&&i.triggerConditions.forEach(function(e){t._addToNodesTriggerConditionsMap(i,e.condition)})),i},dn.prototype._addSlideInstance=function(t){var n=this,e=t.slide;return null!=e.visibility&&this._addToNodesVisibilityMap(t,e.visibility.condition),t.conditionalBranches.forEach(function(e){n._addToNodesConditionalBranchMap(t,e.condition)}),t},dn.prototype._addNodeGroupInstance=function(t){var n=this,e=t instanceof Ct?t.nodeGroup:t.slide;if(null!=e.visibility&&this._addToNodesVisibilityMap(t,e.visibility.condition),t.conditionalBranches.forEach(function(e){n._addToNodesConditionalBranchMap(t,e.condition)}),null!=t.formulaReps)null!=e.formulaReps&&this._addToNodesRepetitionMap(t,e.formulaReps.formula);else{var i=this._formGroup.getValue(),o=t.completeName;if(null!=i&&!i.contains(o)){var r=new s.FormControl;r.setValue(t.reps),i.registerControl(o,r)}}return t},dn.prototype._removeNodesVisibilityMapIndex=function(e){this._removeNodesMapIndex(this._visibilityNodesMapUpdates,e)},dn.prototype._removeNodesRepetitionMapIndex=function(e){this._removeNodesMapIndex(this._repetitionNodesMapUpdates,e)},dn.prototype._removeNodesConditionalBranchMapIndex=function(e){this._removeNodesMapIndex(this._conditionalBranchNodesMapUpdates,e)},dn.prototype._removeNodesFormulaMapIndex=function(e){this._removeNodesMapIndex(this._formulaNodesMapUpdates,e)},dn.prototype._removeNodesValidationMapIndex=function(e){this._removeNodesMapIndex(this._validationNodesMapUpdates,e)},dn.prototype._removeNodesWarningMapIndex=function(e){this._removeNodesMapIndex(this._warningNodesMapUpdates,e)},dn.prototype._removeNodesFilteredChoicesMapIndex=function(e){this._removeNodesMapIndex(this._filteredChoicesNodesMapUpdates,e)},dn.prototype._removeNodesTriggerConditionsMapIndex=function(e){this._removeNodesMapIndex(this._triggerConditionsNodesMapUpdates,e)},dn.prototype._removeNodesNextSlideConditionsMapIndex=function(e){this._removeNodesMapIndex(this._nextSlideConditionsNodesMapUpdates,e)},dn.prototype._removeNodesMapIndex=function(e,t){e.next(function(e){return-1<Object.keys(e).indexOf(t)&&delete e[t],e})},dn.prototype._removeFromNodesVisibilityMap=function(e,t){this._removeFromNodesMap(this._visibilityNodesMapUpdates,e,t)},dn.prototype._removeFromNodesRepetitionMap=function(e,t){this._removeFromNodesMap(this._repetitionNodesMapUpdates,e,t)},dn.prototype._removeFromNodesConditionalBranchMap=function(e,t){this._removeFromNodesMap(this._conditionalBranchNodesMapUpdates,e,t)},dn.prototype._removeFromNodesFormulaMap=function(e,t){this._removeFromNodesMap(this._formulaNodesMapUpdates,e,t)},dn.prototype._removeFromNodesValidationMap=function(e,t){this._removeFromNodesMap(this._validationNodesMapUpdates,e,t)},dn.prototype._removeFromNodesWarningMap=function(e,t){this._removeFromNodesMap(this._warningNodesMapUpdates,e,t)},dn.prototype._removeFromNodesFilteredChoicesMap=function(e,t){this._removeFromNodesMap(this._filteredChoicesNodesMapUpdates,e,t)},dn.prototype._removeFromNodesTriggerConditionsMap=function(e,t){this._removeFromNodesMap(this._filteredChoicesNodesMapUpdates,e,t)},dn.prototype._removeFromNodesNextSlideConditionsMap=function(e,t){this._removeFromNodesMap(this._nextSlideConditionsNodesMapUpdates,e,t)},dn.prototype._removeFromNodesMap=function(e,o,t){var n=cn(t).filter(function(e){return"Identifier"==e.type&&"$value"!=e.value});0<n.length&&e.next(function(i){return n.forEach(function(e){var t=e.value;if(null!=i[t]){var n=i[t].indexOf(o);-1<n&&(i[t].splice(n,1),0==i[t].length&&delete i[t])}}),i})},dn.prototype._addToNodesVisibilityMap=function(e,t){this._addToNodesMap(this._visibilityNodesMapUpdates,e,t)},dn.prototype._addToNodesRepetitionMap=function(e,t){this._addToNodesMap(this._repetitionNodesMapUpdates,e,t)},dn.prototype._addToNodesConditionalBranchMap=function(e,t){this._addToNodesMap(this._conditionalBranchNodesMapUpdates,e,t)},dn.prototype._addToNodesFormulaMap=function(e,t){this._addToNodesMap(this._formulaNodesMapUpdates,e,t)},dn.prototype._addToNodesValidationMap=function(e,t){this._addToNodesMap(this._validationNodesMapUpdates,e,t)},dn.prototype._addToNodesWarningMap=function(e,t){this._addToNodesMap(this._warningNodesMapUpdates,e,t)},dn.prototype._addToNodesFilteredChoicesMap=function(e,t){this._addToNodesMap(this._filteredChoicesNodesMapUpdates,e,t)},dn.prototype._addToNodesTriggerConditionsMap=function(e,t){this._addToNodesMap(this._triggerConditionsNodesMapUpdates,e,t)},dn.prototype._addToNodesNextSlideConditionsMap=function(e,t){this._addToNodesMap(this._nextSlideConditionsNodesMapUpdates,e,t)},dn.prototype._addToNodesMap=function(e,i,t){var o=cn(t).filter(function(e){return"Identifier"==e.type&&"$value"!=e.value});0<o.length&&e.next(function(n){return o.forEach(function(e){var t=e.value;null==n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)}),n})},dn.decorators=[{type:n.Injectable}],dn.ctorParameters=function(){return[{type:un}]},dn);function dn(e){this._visibilityNodesMapUpdates=new b.Subject,this._repetitionNodesMapUpdates=new b.Subject,this._conditionalBranchNodesMapUpdates=new b.Subject,this._formulaNodesMapUpdates=new b.Subject,this._validationNodesMapUpdates=new b.Subject,this._warningNodesMapUpdates=new b.Subject,this._filteredChoicesNodesMapUpdates=new b.Subject,this._triggerConditionsNodesMapUpdates=new b.Subject,this._nextSlideConditionsNodesMapUpdates=new b.Subject,this._formInitEvent=new n.EventEmitter,this.formInitEvent=this._formInitEvent.asObservable(),this._formGroup=new b.BehaviorSubject(null),this.formGroup=this._formGroup.asObservable(),this._form=new b.BehaviorSubject(null),this._nodesUpdates=new b.Subject,this._formGroupSubscription=b.Subscription.EMPTY,this._valueChanged=new b.Subject,this._nextSlideTrigger=new n.EventEmitter,this.nextSlideTrigger=this._nextSlideTrigger.asObservable(),this._slidesNum=new b.BehaviorSubject(0),this.slidesNum=this._slidesNum.asObservable(),this._initUpdateMapStreams(),this._initNodesStreams(),this._initErrorsStreams(),this._initFormStreams(),this._updateFormValueAndValidity()}function hn(){}var mn=(Object.defineProperty(vn.prototype,"saveDisabled",{get:function(){return this._saveDisabled},set:function(e){this._saveDisabled=p.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"hasStartMessage",{get:function(){return this._hasStartMessage},set:function(e){this._hasStartMessage=p.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"hasEndMessage",{get:function(){return this._hasEndMessage},set:function(e){this._hasEndMessage=p.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"hideTopToolbar",{get:function(){return this._hideTopToolbar},set:function(e){this._hideTopToolbar=p.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"hideBottompToolbar",{get:function(){return this._hideBottomToolbar},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"hideBottomToolbar",{set:function(e){this._hideBottomToolbar=p.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"hideNavigationButtons",{get:function(){return this._hideNavigationButtons},set:function(e){this._hideNavigationButtons=p.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"fixedOrientation",{get:function(){return this._fixedOrientation},set:function(e){this._fixedOrientation=p.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"orientation",{get:function(){return this._orientation},set:function(e){"horizontal"!==e&&"vertical"!==e||e!==this._orientation&&(this._orientation=e,this._changeDetectorRef.markForCheck(),this._orientationChange.emit(this._orientation))},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"form",{set:function(e){this._form=e,this._init&&this._rendererService.setForm(this._form)},enumerable:!0,configurable:!0}),vn.prototype.isRepeatingSlide=function(e){return e instanceof Ft},vn.prototype.goToNextError=function(){this._errorMoveEvent.emit(!0)},vn.prototype.goToPrevError=function(){this._errorMoveEvent.emit(!1)},vn.prototype.addGroup=function(e){var t=this,n=this._rendererService.addGroup(e).pipe(a.delayWhen(function(){return t.formSlider.pageScrollFinish})).subscribe(function(e){e&&null!=t.formSlider&&t.formSlider.slide({dir:"down"})},function(e){n&&n.unsubscribe()},function(){n&&n.unsubscribe()})},vn.prototype.removeGroup=function(e){var t=this,n=this._rendererService.removeGroup(e).pipe(a.delayWhen(function(){return t.formSlider.pageScrollFinish})).subscribe(function(e){e&&null!=t.formSlider&&t.formSlider.slide({dir:"up"})},function(e){n&&n.unsubscribe()},function(){n&&n.unsubscribe()})},vn.prototype.onSave=function(e){this._formAction.emit({source:this,action:"save",value:this._rendererService.getFormValue()})},vn.prototype.onFormAction=function(e,t){this._formAction.emit({source:this,value:this._rendererService.getFormValue(),action:t})},vn.prototype.ngAfterViewInit=function(){null!=this._form&&(this._rendererService.setForm(this._form),this._changeDetectorRef.detectChanges())},vn.prototype.ngAfterViewChecked=function(){var l=this;this._init||null==this.formSlider||(this._init=!0,this._errorMoveSubscription=this._errorMoveEvent.pipe(a.withLatestFrom(this._errorPositions)).subscribe(function(e){var t=e[0],n=l.formSlider.currentPage-+l.hasStartMessage+1,i=e[1];if(null!=i){for(var o=!1,r=-1,a=-1,s=0,u=i.length;!o&&s<u;)i[s]==n?(o=!0,r=0<s?s-1:u-1,a=s<u-1?s+1:0):i[s]>n&&(o=!0,r=0<s?s-1:u-1,a=s),s++;o||(r=u-1,a=0),l.formSlider.slide({to:t?i[a]-1:i[r]-1}),l._changeDetectorRef.detectChanges()}}))},vn.prototype.ngOnDestroy=function(){this._nextSlideSubscription.unsubscribe(),this._errorMoveSubscription.unsubscribe(),this._orientationChange.complete(),this._errorMoveEvent.complete(),this._formAction.complete()},vn.prototype.orientationChangeHandler=function(e){this.orientation=e},vn.prototype.trackNodeById=function(e,t){return t.completeName},vn);function vn(e,t){this._rendererService=e,this._changeDetectorRef=t,this.ajfFieldTypes=he,this._orientationChange=new n.EventEmitter,this.orientationChange=this._orientationChange.asObservable(),this._saveDisabled=!1,this._hasStartMessage=!1,this._hasEndMessage=!1,this._hideTopToolbar=!1,this._hideBottomToolbar=!1,this._hideNavigationButtons=!1,this._fixedOrientation=!1,this._orientation="horizontal",this._errorMoveEvent=new n.EventEmitter,this._init=!1,this._nextSlideSubscription=b.Subscription.EMPTY,this._errorMoveSubscription=b.Subscription.EMPTY,this._formAction=new n.EventEmitter,this.formAction=this._formAction.asObservable(),this.formGroup=e.formGroup,this.slides=e.nodesTree,this._errorPositions=e.errorPositions,this.errors=e.errors,this.slidesNum=e.slidesNum,this.formIsInit=e.formInitEvent.pipe(a.map(function(e){return e===pn.Complete}))}var gn=(yn.prototype.transform=function(e){return e?1:0},yn.decorators=[{type:n.Pipe,args:[{name:"boolToInt"}]}],yn);function yn(){}var bn=(_n.prototype.transform=function(e){return!(!e||!e.validationResults||0!==e.validationResults.length)},_n.decorators=[{type:n.Pipe,args:[{name:"ajfFieldIsValid"}]}],_n);function _n(){}var xn=(jn.prototype.transform=function(e){return e%2==0?"ajf-row-even":"ajf-row-odd"},jn.decorators=[{type:n.Pipe,args:[{name:"tableRowClass"}]}],jn);function jn(){}var Nn=(Cn.decorators=[{type:n.NgModule,args:[{declarations:[bn,gn,dt,xn],exports:[bn,gn,dt,xn],providers:[fn,un]}]}],Cn);function Cn(){}var Mn,wn=(r(On,Mn=d.AjfJsonSerializable),On.fromJson=function(e,t){e=p.deepCopy(e),t&&(t=p.deepCopy(t),e.initContext=t);var n=Object.keys(e);if(-1<n.indexOf("choicesOrigins")&&e.choicesOrigins instanceof Array){for(var i=[],o=0;o<e.choicesOrigins.length;o++)i.push(w.fromJson(e.choicesOrigins[o]));e.choicesOrigins=i}if(-1<n.indexOf("attachmentsOrigins")&&e.attachmentsOrigins instanceof Array){for(i=[],o=0;o<e.attachmentsOrigins.length;o++)i.push(h.fromJson(e.attachmentsOrigins[o]));e.attachmentsOrigins=i}if(-1<n.indexOf("nodes")&&e.nodes instanceof Array){var r=[];for(o=0;o<e.nodes.length;o++){var a,s=e.nodes[o];a=le.fromJson(s,e.choicesOrigins,e.attachmentsOrigins,t),r.push(a)}e.nodes=r}return new On(e)},On.toString=function(e,r,t){return void 0===t&&(t=""),null!=e.stringIdentifier&&0<e.stringIdentifier.length?e.stringIdentifier.map(function(e){var o=[];return null!=e.value&&0<e.value.length&&e.value.forEach(function(e){var t,n=e.split("."),i=r;n.forEach(function(e){-1<Object.keys(i).indexOf(e)&&(t=i[e],i=i[e])}),t instanceof Array&&0<t.length&&(t=t.join(", ")),null!=t&&o.push(""+t)}),e.label+": "+(0<o.length?o.join(", "):t)}).join(" - "):null},On.prototype.getChildNodes=function(t){return this.nodes.filter(function(e){return e.parent===t.id}).sort(function(e){return e.parentNode})},On.prototype.getRootNode=function(){if(null==this.nodes||0===this.nodes.length)return null;var e=this.nodes.filter(function(e){return null==e.parent});return 1===e.length?e[0]:null},On);function On(e){var t=Mn.call(this)||this;return t.valid=!0,t.lastSelectedLocation=!0,t.jsonExportedMembers=t.jsonExportedMembers.concat(["nodes","choicesOrigins","stringIdentifier","topBar"]),t.nodes=e&&e.nodes||[],t.choicesOrigins=e&&e.choicesOrigins||[],t.attachmentsOrigins=e&&e.attachmentsOrigins||[],t.initContext=e&&e.initContext||{},t.stringIdentifier=e&&e.stringIdentifier||[],t.lastSelectedLocation=!e||0!=e.lastSelectedLocation,t.supplementaryInformations=e&&e.supplementaryInformations||null,t}e.AjfAttachment=c,e.AjfAttachmentsFixedOrigin=g,e.AjfAttachmentsOrigin=h,e.AjfAttachmentsType=l,e.AjfBooleanField=Ue,e.AjfChoice=N,e.AjfChoicesFixedOrigin=E,e.AjfChoicesFunctionOrigin=V,e.AjfChoicesObservableArrayOrigin=D,e.AjfChoicesObservableOrigin=I,e.AjfChoicesOrigin=w,e.AjfChoicesPromiseOrigin=G,e.AjfChoicesType=x,e.AjfDateField=tt,e.AjfDateFieldInstance=Pt,e.AjfDateInputField=ot,e.AjfEmptyField=Se,e.AjfEmptyFieldInstance=kt,e.AjfField=Me,e.AjfFieldInstance=yt,e.AjfFieldNodeLink=fe,e.AjfFieldType=he,e.AjfFieldWithChoices=Je,e.AjfFieldWithChoicesInstance=xt,e.AjfForm=wn,e.AjfFormActionEvent=hn,e.AjfFormField=Lt,e.AjfFormFieldValueChanged=Gt,e.AjfFormInitStatus=pn,e.AjfFormRenderer=mn,e.AjfFormRendererService=fn,e.AjfFormsModule=Nn,e.AjfFormulaField=Qe,e.AjfInvalidFieldDefinitionError=W,e.AjfMultipleChoiceField=qe,e.AjfNode=le,e.AjfNodeGroup=ve,e.AjfNodeGroupInstance=Ct,e.AjfNodeInstance=mt,e.AjfNodeType=se,e.AjfNumberField=Be,e.AjfRepeatingSlide=je,e.AjfRepeatingSlideInstance=Ft,e.AjfSingleChoiceField=ze,e.AjfSlide=be,e.AjfSlideInstance=Ot,e.AjfStringField=Ae,e.AjfTableField=ct,e.AjfTableFieldInstance=Tt,e.AjfTextField=Re,e.AjfTimeField=st,e.AjfValidation=q,e.AjfValidationGroup=Q,e.AjfValidationResult=Y,e.AjfValidationService=un,e.AjfWarning=ne,e.AjfWarningGroup=re,e.AjfWarningResult=te,e.FieldIconPipe=dt,e.fieldIconName=ft,e.findNodeInstanceInTree=function e(t,n){var i=t.indexOf(n);if(-1<i)return{container:t,index:i};for(var o=t.filter(function(e){return sn(e)}),r=0,a=o.length;r<a;){var s=e(o[r].node.nodes,n);if(-1<s.index)return s;r++}return{container:[],index:-1}},e.flattenNodeInstances=function t(e){void 0===e&&(e=[]);var n=[];return e.forEach(function(e){n.push(e),(e instanceof Ct||e instanceof Ot||e instanceof Ft)&&(n=n.concat(t(e.nodes)))}),n},e.flattenNodes=Yt,e.flattenNodesInstances=qt,e.flattenNodesTree=Qt,e.getAncestorRepeatingNodes=Zt,e.getAncestorRepeatingNodesNames=Kt,e.getTypeName=_,e.isContainerNode=Ht,e.isContainerNodeInstance=sn,e.isRepeatingNode=zt,e.nodeToNodeInstance=an,e.normalizeFormula=Xt,e.orderedNodes=$t,e.ɵa=bn,e.ɵb=gn,e.ɵc=xn,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core-forms.umd.min.js.map
