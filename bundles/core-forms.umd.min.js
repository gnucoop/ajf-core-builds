/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/forms"),require("rxjs"),require("rxjs/operators"),require("@angular/core"),require("date-fns"),require("@ajf/core/models"),require("@ajf/core/utils"),require("esprima")):"function"==typeof define&&define.amd?define("@ajf/core/forms",["exports","@angular/forms","rxjs","rxjs/operators","@angular/core","date-fns","@ajf/core/models","@ajf/core/utils","esprima"],n):n(((e=e||self).ajf=e.ajf||{},e.ajf.core=e.ajf.core||{},e.ajf.core.forms={}),e.ng.forms,e.rxjs,e.rxjs.operators,e.ng.core,e.dateFns,e.ajf.core.models,e.ajf.core.utils,e.esprima)}(this,function(e,h,_,o,i,t,x,c,n){"use strict";var r="default"in n?n.default:n,a=function(e,n){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};function s(e,n){function t(){this.constructor=e}a(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}var M=function(){return(M=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},u=(Object.defineProperty(l.prototype,"instance",{get:function(){return this._instance},set:function(e){e!==this._instance&&(this._instance=e,this._setUpInstanceUpdate(),this._onInstanceChange())},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"control",{get:function(){return this._control},enumerable:!0,configurable:!0}),l.prototype.ngOnInit=function(){var r=this;this._warningTriggerSub=this.instance.warningTrigger.pipe(o.withLatestFrom(this.control),o.filter(function(e){return null!=e[1]})).subscribe(function(e){if(null!=r.instance.warningResults)var n=e[1],t=r._warningAlertService.showWarningAlertPrompt(r.instance.warningResults.filter(function(e){return e.result}).map(function(e){return e.warning})).subscribe(function(e){e.result&&n.setValue(null)},function(e){t&&t.unsubscribe()},function(){t&&t.unsubscribe()})})},l.prototype.ngOnDestroy=function(){this._warningTriggerSub.unsubscribe(),this._instanceUpdateSub.unsubscribe()},l.prototype._onInstanceChange=function(){},l.prototype._setUpInstanceUpdate=function(){var e=this;this._instanceUpdateSub.unsubscribe(),null!=this._instance?this._instanceUpdateSub=this._instance.updated.subscribe(function(){if(e._changeDetectorRef)try{e._changeDetectorRef.detectChanges()}catch(e){}}):this._instanceUpdateSub=_.Subscription.EMPTY,this._changeDetectorRef.detectChanges()},l);function l(e,n,t){var r=this;this._changeDetectorRef=e,this._service=n,this._warningAlertService=t,this._warningTriggerSub=_.Subscription.EMPTY,this._instanceUpdateSub=_.Subscription.EMPTY,this._control=_.defer(function(){return r._service.getControl(r.instance).pipe(o.map(function(e){return e||new h.FormControl}))})}var d=(p.prototype.transform=function(e){if(null!=e)return"today"===e?new Date:e},p.decorators=[{type:i.Pipe,args:[{name:"ajfDateValue"}]}],p);function p(){}var f=(m.prototype.transform=function(e){if(null!=e){var n="today"===e?new Date:e;return t.format(n,"YYYY-MM-DD")}},m.decorators=[{type:i.Injectable},{type:i.Pipe,args:[{name:"ajfDateValueString"}]}],m);function m(){}var v,g=(s(y,v=x.AjfError),Object.defineProperty(y.prototype,"name",{get:function(){return"AjfInvalidFieldDefinitionError"},enumerable:!0,configurable:!0}),y);function y(e){return v.call(this,e)||this}var S={String:0,Text:1,Number:2,Boolean:3,SingleChoice:4,MultipleChoice:5,Formula:6,Empty:7,Date:8,DateInput:9,Time:10,Table:11,Geolocation:12,Barcode:13,LENGTH:14};function b(e){return"ajf-icon-field-"+("string"==typeof S[e]?S[e].toLowerCase():e)}S[S.String]="String",S[S.Text]="Text",S[S.Number]="Number",S[S.Boolean]="Boolean",S[S.SingleChoice]="SingleChoice",S[S.MultipleChoice]="MultipleChoice",S[S.Formula]="Formula",S[S.Empty]="Empty",S[S.Date]="Date",S[S.DateInput]="DateInput",S[S.Time]="Time",S[S.Table]="Table",S[S.Geolocation]="Geolocation",S[S.Barcode]="Barcode",S[S.LENGTH]="LENGTH";var N=(j.prototype.transform=function(e){return b(e.fieldType?e.fieldType:e)},j.decorators=[{type:i.Pipe,args:[{name:"ajfFieldIcon"}]}],j);function j(){}var C=(F.prototype.transform=function(e){return!(!e||!e.validationResults||0!==e.validationResults.length)},F.decorators=[{type:i.Pipe,args:[{name:"ajfFieldIsValid"}]}],F);function F(){}var w=(Object.defineProperty(T.prototype,"instance",{get:function(){return this._instance},set:function(e){this._instance!==e&&(this._instance=e,this._loadComponent())},enumerable:!0,configurable:!0}),T.prototype.ngOnInit=function(){this._loadComponent()},T.prototype._loadComponent=function(){if(null!=this._instance&&null!=this.fieldHost){var e=this.fieldHost.viewContainerRef;e.clear();var n=this.componentsMap[this._instance.node.fieldType];if(null!=n){var t=n.component;try{var r=this._cfr.resolveComponentFactory(t),o=e.createComponent(r).instance;o.instance=this._instance,n.inputs&&Object.keys(n.inputs).forEach(function(e){e in o&&(o[e]=n.inputs[e])})}catch(e){}}}},T);function T(e){this._cfr=e}var E=(A.decorators=[{type:i.Directive,args:[{selector:"[ajf-field-host]"}]}],A.ctorParameters=function(){return[{type:i.ViewContainerRef}]},A);function A(e){this.viewContainerRef=e}var R={},I=(V.prototype.registerCustomField=function(e){var n=e.fieldType,t=e.component;if(n<100)throw new Error("Invalid custom field type, it must be greater than 100");if(null==t)throw new Error("Invalid custom field component");this.componentsMap[n]=e},V);function V(){this.componentsMap=R}var O,P=(s(U,O=u),Object.defineProperty(U.prototype,"searchThreshold",{get:function(){return this._searchThreshold},enumerable:!0,configurable:!0}),U);function U(e,n,t,r){var o=O.call(this,e,n,t)||this;return o._searchThreshold=6,null!=r&&(o._searchThreshold=r),o}var B={AjfField:0,AjfFieldNodeLink:1,AjfNodeGroup:2,AjfSlide:3,AjfRepeatingSlide:4,LENGTH:5};function D(e){return e.fieldType===S.SingleChoice||e.fieldType===S.MultipleChoice}function G(e){return null!=e&&e.nodeType===B.AjfField}function k(e){return null!=e&&null!=e.node&&G(e.node)}function L(e){return null!=e&&k(e)&&D(e.node)}function J(e){return null!=e&&k(e)&&function(e){return e.fieldType===S.Table}(e.node)}function W(e,n){var t=e.conditionalBranches;if(null!=t){for(var r=e.verifiedBranch,o=0,i=!1;o<t.length&&!i;){x.evaluateExpression(t[o].condition,n)&&(i=!0,o!==e.verifiedBranch&&(e.verifiedBranch=o)),o++}if(r!==e.verifiedBranch)return!0}return!1}function $(e,n,t){if(void 0===t&&(t=!0),null==e.visibility)return e.visible=!1;var r=e.visibility,o=e.visible,i=t&&x.evaluateExpression(r.condition,n);return i!==e.visible&&(e.visible=i),o!==i}function z(e){return null==e.prefix||0==e.prefix.length?"":"__"+e.prefix.join("__")}function H(e){return""+e.node.name+z(e)}function Y(e,n){var t=e.formula,r=e.node.editable;if(null!=t&&e.visible&&(!r||r&&null==e.value)){var o=x.evaluateExpression(t.formula,n),i=e.value;return o!==e.value&&(e.value=o,n[H(e)]=e.value,n.$value=e.value),{changed:o!==i,value:o}}return{changed:!1,value:e.value}}function q(e,n){return null!=e.nextSlideCondition&&x.evaluateExpression(e.nextSlideCondition.condition,n)}function Z(e,n,t){return{result:x.evaluateExpression(e.condition,n,t),error:e.errorMessage,clientValidation:e.clientValidation}}function K(e,n,t){var r=[],o=c.deepCopy(t);if(o.$value=n,r=function(e,n){var t=[];return e.conditions.forEach(function(e){t.push(Z(e,n))}),t}(e,o),e.maxValue){var i=function(e,n){if(null==e.maxValue)return null;var t={$value:n};return"number"==typeof e.maxValue?{result:x.evaluateExpression("$value.length <= "+e.maxValue,t),error:"Value must be <= "+e.minValue,clientValidation:!1}:Z(e.maxValue,{$value:n})}(e,n);null!=i&&r.push(i)}if(e.minValue){var a=function(e,n){if(null==e.minValue)return null;var t={$value:n};return"number"==typeof e.minValue?{result:x.evaluateExpression("$value.length <= "+e.minValue,t),error:"Value must be >= "+e.minValue,clientValidation:!1}:Z(e.minValue,{$value:n})}(e,n);null!=a&&r.push(a)}if(e.notEmpty){var s=function(e,n){if(null==e.notEmpty)return null;var t={$value:n};return"boolean"==typeof e.notEmpty?{result:x.evaluateExpression("($value != null) === "+e.notEmpty,t),error:"Value must not be empty",clientValidation:!1}:Z(e.notEmpty)}(e,n);null!=s&&r.push(s)}if(e.maxDigits){var u=function(e,n){if(null==e.maxDigits)return null;var t={$value:n};return"number"==typeof e.maxDigits?{result:x.evaluateExpression("$value.toString().length <= "+e.maxDigits,t),error:"Digits count must be <= "+e.minValue,clientValidation:!1}:Z(e.maxDigits,t)}(e,n);null!=u&&r.push(u)}if(e.minDigits){var l=function(e,n){if(null==e.minDigits)return null;var t={$value:n};return"number"==typeof e.minDigits?{result:x.evaluateExpression("$value.toString().length >= "+e.minDigits,t),error:"Digits count must be >= "+e.minValue,clientValidation:!1}:Z(e.minDigits,t)}(e,n);null!=l&&r.push(l)}return r}function Q(e,n,t){var r=e.validation;if(null!=r){t&&Object.keys(t).forEach(function(e){n["__supplementary__"+e+"__"]=t[e]});var o=H(e);null!=n[o]&&r&&r.forceValue&&(e.value=x.evaluateExpression(r.forceValue.condition,n),n[o]=e.value,n.$value=e.value),null!=r?(e.validationResults=K(r,n[o],n),e.valid=e.validationResults.reduce(function(e,n){return e&&n.result},!0)):e.valid=!0}}function X(e,n){return e.conditions.map(function(e){return function(e,n,t){return{result:x.evaluateExpression(e.condition,n,t),warning:e.warningMessage}}(e,n)})}function ee(e,n){var t=e.warning;null!=t&&null!=n[H(e)]&&t&&(e.warningResults=function(e,n){return X(e,n)}(t,n))}function ne(n,t){null!=n.choicesFilter?n.filteredChoices=n.node.choicesOrigin.choices.filter(function(e){return t.$choiceValue=e.value,x.evaluateExpression(n.choicesFilter.formula,t)}):n.filteredChoices=n.node.choicesOrigin.choices}function te(e){var n=null!=e.conditionalBranches&&0<e.conditionalBranches.length?e.conditionalBranches:[x.alwaysCondition()];return M({},e,{parentNode:null!=e.parentNode?e.parentNode:0,label:e.label||"",visibility:e.visibility||x.alwaysCondition(),conditionalBranches:n})}function re(e){var n=te(M({},e,{nodeType:B.AjfField})),t=null!=e.editable?e.editable:e.fieldType!==S.Formula&&e.fieldType!==S.Table;return M({},n,e,{nodeType:B.AjfField,editable:t,defaultValue:null!=e.defaultValue?e.defaultValue:null,size:e.size||"normal"})}function oe(e){return null!=e&&(e.nodeType===B.AjfRepeatingSlide||e.nodeType===B.AjfSlide)}function ie(e){return null!=e&&(e.nodeType===B.AjfNodeGroup||oe(e))}function ae(e,n){void 0===n&&(n=!1);var t=[];return e.forEach(function(e){k(e)&&t.push(e),function(e){return null!=e&&null!=e.node&&ie(e.node)}(e)&&(n&&t.push(e),t=t.concat(ae(e.nodes,n)))}),t}function se(e){return null!=e&&null!=e.node&&oe(e.node)}function ue(e){return null!=e&&null!=e.node&&function(e){return null!=e&&e.nodeType===B.AjfNodeGroup}(e.node)}function le(e){return null!=e&&null!=e.node&&function(e){return null!=e&&e.nodeType===B.AjfSlide}(e.node)}function ce(e){return{node:e.node,prefix:e.prefix?e.prefix.slice():[],visible:null==e.visible||e.visible,conditionalBranches:[],updatedEvt:new i.EventEmitter}}function de(e,n){var t=ce(e),r=null;if(null!=t.node&&null!=n){var o=H(t);null!=n[t.node.name]?r=n[t.node.name]:null!=n[o]&&(r=n[o])}return M({},t,{node:e.node,value:r,valid:!1,defaultValue:null!=e.defaultValue?e.defaultValue:null,validationResults:e.validationResults||[],warningResults:e.warningResults||[],warningTrigger:new i.EventEmitter,updated:new i.EventEmitter})}function pe(e,n){var t=de(e,n);return M({},t,{node:e.node,filteredChoices:e.node.choices.slice(),firstTriggerConditionDone:{},selectionTrigger:new i.EventEmitter})}function fe(e){var n=ce(e);return M({},n,{node:e.node,nodes:[],slideNodes:[],flatNodes:[],valid:!1,position:0})}function he(e){return M({},e,{conditions:e.conditions||[]})}function me(e){return M({},e,{conditions:e.conditions||[]})}function ve(e){return null!=e&&(e.nodeType===B.AjfNodeGroup||e.nodeType===B.AjfRepeatingSlide)}function ge(e,n){var t={};return function(e,n){for(var t=[],r=n.parent;null!=r;){var o=e.map(function(e){return e.node||e}).find(function(e){return e.id==r});o&&ve(o)&&t.push(o),r=null!=o?o.parent:null}return t}(e,n).forEach(function(e,n){return(e.nodes||[]).forEach(function(e){G(e)&&(t[e.name]=n)})}),t}function ye(e,n,t){var r=e.condition,o=x.normalizeExpression(r,n,t);return o===r?e:{condition:o}}function _e(e,t,r){var o=!1,n=e.map(function(e){var n=ye(e,t,r);return n!==e&&(o=!0),n});return o?n:e}function be(e,n,t){var r=e.formula,o=x.normalizeExpression(r,n,t);return o===r?e:{formula:o}}function Ne(e){return M({},e,{clientValidation:e.clientValidation||!1,errorMessage:e.errorMessage||"Undefined Error"})}function xe(e,t,r){var o=!1,n=e.map(function(e){var n=function(e,n,t){var r=e.condition,o=x.normalizeExpression(r,n,t);return o===r?e:Ne({condition:o})}(e,t,r);return n!==e&&(o=!0),n});return o?n:e}function Me(e){return M({},e,{warningMessage:e.warningMessage||"Undefined Warning"})}function Se(e,t,r){var o=!1,n=e.map(function(e){var n=function(e,n,t){var r=e.condition,o=x.normalizeExpression(r,n,t);return o===r?e:Me({condition:o})}(e,t,r);return n!==e&&(o=!0),n});return o?n:e}function je(e){return null!=e&&null!=e.node&&se(e)&&function(e){return null!=e&&e.nodeType===B.AjfRepeatingSlide}(e.node)}function Ce(e,n,t,r){var o=null,i=n.nodeType;switch(i){case B.AjfField:var a=n;if(100<a.fieldType)o=null!=R[a.fieldType]&&null!=R[a.fieldType].createInstance?R[a.fieldType].createInstance({node:n,prefix:t},r):de({node:n,prefix:t},r);else switch(a.fieldType){case S.SingleChoice:case S.MultipleChoice:o=pe({node:n,prefix:t},r);break;case S.Table:o=function(e,n){var t=de(e,n);return M({},t,{node:e.node,context:n,hideEmptyRows:e.hideEmptyRows||!1,controls:[]})}({node:n,prefix:t},r);break;default:o=de({node:n,prefix:t},r)}break;case B.AjfNodeGroup:o=function(e){var n=ce(e);return M({},n,{node:e.node,formulaReps:e.formulaReps,reps:0,nodes:[],flatNodes:[]})}({node:n,prefix:t});break;case B.AjfRepeatingSlide:o=function(e){var n=fe(e);return M({},n,{node:e.node,slideNodes:[],formulaReps:e.formulaReps,reps:0,nodes:[],flatNodes:[]})}({node:n,prefix:t});break;case B.AjfSlide:o=fe({node:n,prefix:t})}if(null!=o)if(null!=t&&0<t.length){var s=ge(e,n);if(null!=n.visibility){var u=n.visibility.condition,l=x.normalizeExpression(u,s,t);o.visibility=l!==u?x.createCondition({condition:l}):n.visibility}var c=null!=o.node.conditionalBranches&&0<o.node.conditionalBranches.length?o.node.conditionalBranches:[x.alwaysCondition()];if(o.conditionalBranches=_e(c,s,t),i===B.AjfNodeGroup||i===B.AjfRepeatingSlide){var d=o,p=d.node.formulaReps;if(null!=p){var f=p.formula,h=x.normalizeExpression(f,s,t);d.formulaReps=h!==f?x.createFormula({formula:h}):p}}else if(i===B.AjfField){var m=(b=o).node;if(m.formula&&(b.formula=be(m.formula,s,t)),null!=m.validation){var v=xe(m.validation.conditions,s,t);v!==m.validation.conditions?(b.validation=he(m.validation),b.validation.conditions=v):b.validation=m.validation}if(null!=m.warning){var g=Se(m.warning.conditions,s,t);g!==m.warning.conditions?(b.warning=me(m.warning),b.warning.conditions=g):b.warning=m.warning}if(null!=m.nextSlideCondition&&(b.nextSlideCondition=ye(m.nextSlideCondition,s,t)),D(m)){var y=(N=o).node;null!=y.choicesFilter&&(N.choicesFilter=be(y.choicesFilter,s,t)),null!=y.triggerConditions&&(N.triggerConditions=_e(y.triggerConditions,s,t))}}}else{o.visibility=o.node.visibility;c=null!=o.node.conditionalBranches&&0<o.node.conditionalBranches.length?o.node.conditionalBranches:[x.alwaysCondition()];if(o.conditionalBranches=c,ue(o)||je(o)){var _=o;_.formulaReps=_.node.formulaReps}else if(k(o)){var b,N;if((b=o).validation=b.node.validation,b.warning=b.node.warning,b.nextSlideCondition=b.node.nextSlideCondition,L(o))(N=o).choicesFilter=N.node.choicesFilter,N.triggerConditions=N.node.triggerConditions;b.formula=b.node.formula}}return o}function Fe(e){var n=[];return e.forEach(function(e){n.push(e),ie(e)&&(n=n.concat(Fe(e.nodes)))}),n}function we(n,t){var r=[];return n.filter(function(e){return null!=t?e.parent==t:null==e.parent||0===e.parent}).sort(function(e,n){return e.parentNode-n.parentNode}).forEach(function(e){r.push(e),r=r.concat(we(n,e.id))}),r}function Te(e,n){var t=e.reps||0;if(n=n||{},null==e.node.formulaReps){var r=n[H(e)];null!=r?e.reps=r:0==t&&(e.reps=1)}else{var o=x.evaluateExpression(e.node.formulaReps.formula,n);o!==t&&(e.reps=o)}return e.canAdd=0===e.node.maxReps||e.reps<e.node.maxReps,e.canRemove=0===e.node.minReps||e.reps>e.node.minReps,t}B[B.AjfField]="AjfField",B[B.AjfFieldNodeLink]="AjfFieldNodeLink",B[B.AjfNodeGroup]="AjfNodeGroup",B[B.AjfSlide]="AjfSlide",B[B.AjfRepeatingSlide]="AjfRepeatingSlide",B[B.LENGTH]="LENGTH";var Ee=(Ae.prototype.addFunction=function(e){this._functions.push(e),this._initFunctions()},Ae.prototype.addFunctionHandler=function(e,n){void 0===x.AjfExpressionUtils.utils[e]&&(x.AjfExpressionUtils.utils[e]={fn:n})},Ae.prototype._initFunctions=function(){var e=this._functions.map(function(e){return"string"==typeof e?e:e.toString()}).join("; ");this._functionsStr=this._baseUtilFunctions.join("; ")+"; "+e,x.AjfExpressionUtils.UTIL_FUNCTIONS=this._functionsStr},Ae.decorators=[{type:i.Injectable}],Ae.ctorParameters=function(){return[]},Ae);function Ae(){this._baseUtilFunctions=["/**\n        * count the number of digit contained on x.\n        * @param  x the value used for digit count\n        * @return the count of the digit\n      */\n    var digitCount = function(x) { return x.toString().length; }","/**\n        * count the number of decimal contained on x.\n        * @param  x the value used for decimal count\n        * @return the count of the decimal\n      */\n    var decimalCount = function(x) {\n      return (parseFloat(x).toString().split('.')[1] || []).length;\n    }","/**\n        * check if x is integer\n        * @param  x the value used for check\n        * @return true if x is a number\n      */\n    var isInt = function(x) { return !/[,.]/.test(x); }","/**\n        * check if x is not empity\n        * @param  x the value used for check\n        * @return true if x defined and not null and the number of digit is > 0\n      */\n    var notEmpty = function (x) {\n      return (typeof x !== 'undefined' && x !== null ? x.toString().length > 0 : false);\n    }","/**\n        * check if x is contained on array\n        * @param  x the value used for check\n        * @return the position of x on array or if array === x\n      */\n    var valueInChoice = function(array, x) { return array.indexOf(x) > -1 || array === x; }","var scanGroupField = function(reps, acc, callback) {\n        for (var i = 0; i < reps; i++) {\n            acc = callback(acc, i);\n        }\n        return acc;\n    }","/**\n        * sum the value contained on array\n        * @param  x the array\n        * @return the sum\n      */\n    var sum = function(array) {return array.reduce(function(a, b){ return a + b; }, 0); }","var dateOperations = function(dString, period, operation, v) {\n        fmt = 'MM/DD/YYYY';\n        var d = (typeof dString !== 'undefined') ? dateUtils.parse(dString) : new Date();\n        if (operation == 'remove') {\n          v = -v;\n        }\n        var dateOp;\n        switch (period) {\n          case 'day':\n            dateOp = dateUtils.addDays;\n            break;\n          case 'month':\n            dateOp = dateUtils.addMonths;\n            break;\n          case 'year':\n            dateOp = dateUtils.addYears;\n            break;\n          default:\n            return -1;\n        }\n        return dateUtils.format(dateOp(d, v), fmt);\n      }","/**\n        * round the num\n        * @param  num the value to round\n        * @param  digits how many digit\n        * @return num rounded\n      */\n      var round = function(num, digits) {\n        digits = digits || 0;\n        var f = 0;\n        try { f = parseFloat(num); } catch (e) { }\n        var m = Math.pow(10, digits);\n        return Math.round(f * m) / m;\n      }","/**\n        * extract the property of the source object with property != null\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want filter\n        * @return array of dates\n      */\n      var extractArray = function(source, property, property2) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null && source[i][property2] != null) {\n            res.push(source[i][property] + source[i][property2]);\n          }\n          else if (source[i][property] != null) {\n            res.push(source[i][property]);\n          }\n        }\n        return res;\n      }","/**\n        * extract the property of the source object with property != null\n        * @param  source array of object wich contains property\n        * @param  propertues string array the properties to sum\n        * @return the sum\n      */\n      var extractSum = function(source, properties) {\n        var sum = 0;\n        properties = (properties || []).slice(0);\n        var l = properties.length;\n\n        for (var i = 0; i < l ; i++) {\n          var array = extractArray(source, properties[i]);\n          var leng = array.length;\n          for(var j = 0; j < leng; i++) {\n            sum += array[j];\n          }\n        }\n        return sum;\n      }","/**\n        * extract the array of sum for each week != null\n        * @param  source array of object wich contains property\n        * @param  propertues string array the properties to sum\n        * @return the sum\n      */\n      var extractArraySum = function(source, properties) {\n        var arrays = [];\n        properties = (properties || []).slice(0);\n\n        for (var propI = 0; propI < properties.length ; propI++) {\n          var array = extractArray(source, properties[propI]);\n          arrays.push(array);\n        }\n\n        var res = [];\n        for (var weekI = 0; weekI < array.length; weekI ++ ) {\n          var sum = 0;\n          for (var propI = 0; propI < properties.length ; propI++) {\n            sum = sum + arrays[propI][weekI]\n          }\n          res.push(sum);\n        }\n        return res;\n      }","/**\n        * draw a threshold line on chart related to the property\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want filter\n        * @return array of dates\n      */\n      var drawThreshold = function(source, property, threshold) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null) {\n            res.push(threshold);\n          }\n        }\n        return res;\n      }",'/**\n        * extract the dates of the source object with property != null\n        * @param  source array of object wich contains property and date_start\n        * @param  property the property on wich we want to calculate dates\n        * @param  format the format of the date\n        * @return array of dates\n      */\n      var extractDates = function(source, property, format) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        var prefix = \'\';\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null) {\n            switch(format) {\n              case "WW":\n                prefix = "W";\n                break;\n              case "MM":\n                prefix = "M";\n                break;\n              default:\n                prefix = "";\n            }\n            res.push(prefix + formatDate(source[i]["date_start"], format));\n          }\n        }\n        return res;\n      }',"/**\n        * extract the last property contains in source != null\n        * @param  source array of object wich contains property and date_start\n        * @param  property the property to find\n        * @return the last property != null\n      */\n      var lastProperty = function(source, property) {\n        source = (source || []).slice(0);\n        var l = source.length -1;\n\n        while (l >= 0 && source[l][property] == null) {\n          l--;\n          if (l < 0) return 0;\n        }\n        return l >= 0 ? source[l][property] : 0;\n      }","var sumLastProperties = function(source, properties) {\n        source = (source || []).slice(0);\n        var sum = 0;\n        for (var i = 0; i < properties.length; i++) {\n          sum += lastProperty(source, properties[i]);\n        }\n\n        return sum;\n      }",'/**\n        * compute the trend of the property contained on the source.\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want to calculate the trend\n        * @return an html icon that identifies the trend\n      */\n      var calculateTrendProperty = function(source, property) {\n        source = (source || []).slice(0);\n        var last = source.length - 1;\n        while (source[last][property] == null) {\n          if (last == 0) {\n            break;\n          }\n          last--;\n        }\n        var lastLast = last - 1;\n        if (last == 0) {\n          lastLast = last;\n        } else {\n          while (source[lastLast][property] == null) {\n            if (lastLast == 0) {\n              lastLast = last;\n              break;\n            }\n            lastLast--;\n          }\n        }\n\n        var lastProperty = source[last]?(source[last][property] || 0): 0;\n        var lastLastProperty = source[lastLast]?(source[lastLast][property] || 0): 0;\n\n        if (lastProperty == lastLastProperty) {\n          return \'<p><i class="material-icons" style="color:blue">trending_flat</i></p>\';\n        } else if (lastProperty > lastLastProperty) {\n          return \'<p><i class="material-icons" style="color:green">trending_up</i></p>\';\n        } else {\n          return \'<p><i class="material-icons" style="color:red">trending_down</i></p>\';\n        }\n      }',"/**\n        * compute the average value of the property contained on the source.\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want to calculate the average\n        * @param  range the range on wich we want to calculate the average\n        * @param  coefficent the coefficent used for calculate the threshold\n                  if coefficent is 0 mean return the count of property > 0\n        * @return the average value || the count of property > 0\n      */\n      var calculateAvgProperty = function(source, property, range, coefficient) {\n        source = (source || []).slice(0);\n\n        source.pop();\n\n        coefficient = coefficient || 1;\n        range = range || 12;\n\n        var l = source.length;\n        var res = 0;\n        var counter = 0;\n        var noZero = 0;\n\n        if(l < range) {\n          range = l;\n        }\n\n        while (range != 0) {\n          counter++;\n          if (source[l - 1][property] != null) {\n            res += source[l - 1][property];\n\n            if (source[l - 1][property] > 0) {\n              noZero++;\n            }\n          }\n          l--;\n          range--;\n        }\n\n        if (coefficient == 0) {\n          return noZero;\n        } else {\n          var threshold = (res/counter)*coefficient || 0;\n          return threshold;\n        }\n      }","var alert = function(source, property, threshold, fmt) {\n        source = (source || []).slice(0);\n        var l = source.length;\n\n        if ( lastProperty(source, property)  > threshold ) {\n          return '<p><i class=\"material-icons\" style=\"color:red\">warning</i></p>';\n          } else {\n            return '<p></p>';\n          }\n      }","var formatNumber = function(num, fmt) {\n        fmt = fmt || '0,0[.]0';\n        return numeral(num).format(fmt);\n      }","var formatDate = function(date, fmt) {\n        fmt = fmt || 'MM-DD-YYYY';\n        return dateUtils.format(date, fmt);\n      }","var isoMonth = function(date, fmt) {\n        fmt = fmt || 'MM';\n        var du = dateUtils;\n        return du.format(du.addDays(du.startOfMonth(date), 4),fmt)\n      }","var nextCounterValue = function(counterName, firstValue) {\n        firstValue = firstValue != null ? firstValue : 0;\n        if (execContext['$$'+counterName] == null) {\n          execContext['$$'+counterName] = firstValue;\n        } else {\n          execContext['$$'+counterName]++;\n        }\n        return execContext['$$'+counterName];\n      }","var getCoordinate = function(source, zoom) {\n        zoom = zoom || 6;\n        if(source == null) {\n          return [51.505,-0.09, zoom];\n        } else {\n          return [source[0], source[1], zoom];\n        }\n      }"],this._functions=[],this._functionsStr="",this._initFunctions()}var Re=(r||n).tokenize,Ie={Initializing:0,Complete:1};Ie[Ie.Initializing]="Initializing",Ie[Ie.Complete]="Complete";var Ve=(Object.defineProperty(Oe.prototype,"nodesTree",{get:function(){return this._flatNodesTree},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"errorPositions",{get:function(){return this._errorPositions},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"errors",{get:function(){return this._errors},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"currentSupplementaryInformations",{get:function(){var e=this._form.getValue();return null!=e&&null!=e.form?e.form.supplementaryInformations:null},enumerable:!0,configurable:!0}),Oe.prototype.setForm=function(e,n){void 0===n&&(n={}),this._initUpdateMapStreams(),null!=e&&0===Object.keys(n).length&&0<Object.keys(e.initContext||{}).length&&(n=e.initContext||{});var t=this._form.getValue();(null==t&&null!=e||null!=t&&e!==t.form)&&this._form.next({form:e,context:n})},Oe.prototype.getFormValue=function(){var e=this._formGroup.getValue();return null==e?{}:c.deepCopy(e.value)},Oe.prototype.addGroup=function(o){var i=this;return new _.Observable(function(t){if(null!=o.formulaReps)return t.next(!1),void t.complete();var e=o.node.maxReps;if(0<e&&o.reps+1>e)return t.next(!1),void t.complete();var r=o.reps;o.reps=o.reps+1,o.canAdd=0===o.node.maxReps||o.reps<o.node.maxReps,o.canRemove=0===o.node.minReps||o.reps>o.node.minReps,i._nodesUpdates.next(function(e){var n=ae(e,!0);return i._adjustReps(n,o,r,i.getFormValue()),t.next(!0),t.complete(),e})})},Oe.prototype.removeGroup=function(r){var o=this;return new _.Observable(function(n){if(null!=r.formulaReps)return n.next(!1),void n.complete();var e=r.node.minReps;if(r.reps-1<e)return n.next(!1),void n.complete();var t=r.reps;r.reps=r.reps-1,r.canAdd=0===r.node.maxReps||r.reps<r.node.maxReps,r.canRemove=0===r.node.minReps||r.reps>r.node.minReps,o._nodesUpdates.next(function(e){return o._adjustReps(e,r,t,o.getFormValue()),n.next(!0),n.complete(),e})})},Oe.prototype.getControl=function(t){return this.formGroup.pipe(o.map(function(e){var n=H(t);return null!=e&&e.contains(n)?e.controls[n]:null}))},Oe.prototype._initErrorsStreams=function(){var r=this;this._errorPositions=this._valueChanged.pipe(o.withLatestFrom(this._nodes,this._form),o.filter(function(e){return null!=e[2]&&null!=e[2].form}),o.map(function(e){var n=e[1],t=e[2].form,a=0,s=[];return n.forEach(function(e){if(e.node.nodeType===B.AjfRepeatingSlide)for(var n=e,t=0;t<n.reps;t++)e.visible&&(a++,0==t&&(n.position=a),(i=t)>=(o=n).slideNodes.length||o.slideNodes[i].map(function(e){return!(e.visible&&-1<Object.keys(e).indexOf("valid"))||e.valid}).reduce(function(e,n){return e&&n},!0)||s.push(a));else if(e.node.nodeType===B.AjfSlide){var r=e;r.visible&&(a++,r.position=a,r.valid||s.push(a))}var o,i}),t.valid=0==s.length,r._slidesNum.next(a),s}),o.publishReplay(),o.refCount()),this._errors=this._errorPositions.pipe(o.map(function(e){return null!=e?e.length:0}),o.startWith(0),o.publishReplay(),o.refCount())},Oe.prototype._initUpdateMapStreams=function(){this._visibilityNodesMap=this._visibilityNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._repetitionNodesMap=this._repetitionNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._conditionalBranchNodesMap=this._conditionalBranchNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._formulaNodesMap=this._formulaNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._validationNodesMap=this._validationNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._warningNodesMap=this._warningNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._filteredChoicesNodesMap=this._filteredChoicesNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._triggerConditionsNodesMap=this._triggerConditionsNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._nextSlideConditionsNodesMap=this._nextSlideConditionsNodesMapUpdates.pipe(o.scan(function(e,n){return n(e)},{}),o.startWith({}),o.share()),this._nodesMaps=[this._visibilityNodesMap,this._repetitionNodesMap,this._conditionalBranchNodesMap,this._formulaNodesMap,this._validationNodesMap,this._warningNodesMap,this._nextSlideConditionsNodesMap,this._filteredChoicesNodesMap,this._triggerConditionsNodesMap]},Oe.prototype._initFormStreams=function(){var r=this,e=this._form;e.pipe(o.map(function(e){return r._initFormGroupStreams(new h.FormGroup({}))})).subscribe(this._formGroup),e.pipe(o.map(function(t){return function(e){var n=null!=t&&null!=t.form?r._orderedNodesInstancesTree(Fe(t.form.nodes),t.form.nodes,void 0,[],t.context||{}):[],o=0;return n.forEach(function(e){if(e.node.nodeType===B.AjfRepeatingSlide)for(var n=e,t=0;t<n.reps;t++)e.visible&&(o++,0==t&&(n.position=o));else if(e.node.nodeType===B.AjfSlide){var r=e;r.visible&&(o++,r.position=o)}}),n}})).subscribe(this._nodesUpdates)},Oe.prototype._initNodeInstance=function(e,n,t,r,o){void 0===o&&(o=!0);var i=Ce(e,n,t,r);if(null!=i){var a=i.node.nodeType;if(a===B.AjfNodeGroup||a===B.AjfRepeatingSlide)this._explodeRepeatingNode(e,i,r);else if(a===B.AjfSlide){var s=i;s.nodes=this._orderedNodesInstancesTree(e,s.node.nodes,s.node.id,t,r)}if($(i,r,o),W(i,r),a===B.AjfField){var u=i;if(D(u.node))ne(u,r);else{if(J(u)){var l=u,c=l.node;if(l.context=r[H(l)]||r,c.editable){var d=this._formGroup.getValue(),p=[];p.push([n.label,c.columnLabels]),c.rows.forEach(function(e,n){var t=[];e.forEach(function(e){var n=new h.FormControl;console.log(e),console.log(l.context[e]),n.setValue(l.context[e]),null!=d&&d.registerControl(e,n),t.push(n)}),p.push([c.rowLabels[n],t])}),l.controls=p}else{var f=[];f.push([c.label,c.columnLabels]),c.rows.forEach(function(e,n){f.push([c.rowLabels[n],e.map(function(e){return l.context[e]=r[e],r[e]})])}),l.value=f}}else u.value=r[H(i)];!function(e,n,t){void 0===t&&(t=!0),$(e,n,t),W(e,n),Y(e,n),Q(e,n),ee(e,n),q(e,n)}(u,r)}}this._addNodeInstance(i)}return i},Oe.prototype._adjustReps=function(r,o,e,i){var a=this,n=o.reps,t={added:null,removed:null};if(e<n){var s=[];if(null==o.nodes&&(o.nodes=[]),o.node.nodeType===B.AjfNodeGroup){var u=re({id:999,name:"",parent:-1,fieldType:S.Empty,label:o.node.label}),l=this._initNodeInstance(r,u,o.prefix.slice(0),i);null!=l&&o.nodes.push(l)}for(var c=function(e){var t=o.prefix.slice(0),n=o.node;t.push(e),we(n.nodes,o.node.id).forEach(function(e){var n=a._initNodeInstance(r,e,t,i);null!=n&&(s.push(n),o.nodes.push(n))}),d._addNodeInstance(o)},d=this,p=e;p<n;p++)c(p);t.added=s}else if(n<e){var f=o.nodes.length/e;o.node.nodeType===B.AjfNodeGroup&&f++,t.removed=o.nodes.splice(n*f,f),t.removed.forEach(function(e){a._removeNodeInstance(e)})}if(e!=n&&null==o.formulaReps){var h=this._formGroup.getValue(),m=H(o);null!=h&&h.contains(m)&&h.controls[m].setValue(o.reps)}if(o.flatNodes=ae(o.nodes),o.node.nodeType===B.AjfRepeatingSlide){var v=o,g=[],y=null!=v.nodes?v.nodes.length/v.reps:0;for(p=0;p<o.reps;p++){var _=p*y;g.push(o.nodes.slice(_,_+y))}v.slideNodes=g}return t},Oe.prototype._updateFormValueAndValidity=function(){this._nodesUpdates.asObservable().pipe(o.withLatestFrom(this._formGroup),o.filter(function(e){return null!==e[1]})).subscribe(function(e){e[1].updateValueAndValidity()})},Oe.prototype._explodeRepeatingNode=function(e,n,t){var r=Te(n,t);r!==n.reps&&this._adjustReps(e,n,r,t)},Oe.prototype._orderedNodesInstancesTree=function(o,e,n,i,a){var s=this;void 0===n&&(n=null),void 0===i&&(i=[]);var u=[],l=0<i.length?"__"+i.join("__"):"";return we(e,n).forEach(function(n){var e=u.find(function(e){return e.node.id==n.parent&&z(e)==l}),t=null==e||null!=e.verifiedBranch&&e.verifiedBranch==n.parentNode,r=s._initNodeInstance(o,n,i,a,t);null!=r&&u.push(r)}),u},Oe.prototype._formValueDelta=function(n,t){return Object.keys(t).filter(function(e){return n[e]!==t[e]})},Oe.prototype._initFormGroupStreams=function(e){var v=this;this._formGroupSubscription.unsubscribe();var g=!0,y=!0;return this._formInitEvent.emit(Ie.Initializing),this._formGroupSubscription=e.valueChanges.pipe(o.startWith({}),o.pairwise(),o.debounceTime(200),o.withLatestFrom.apply(void 0,this._nodesMaps.concat([this._flatNodes]))).subscribe(function(e){var n=g&&{}||e[0][0];g=!1;var u=e[0][1],t=e[1],r=e[2],o=e[3],i=e[4],a=e[5],s=e[6],l=e[7],c=e[8],d=e[9],p=e[10];window.nodes=p;var f=v._formValueDelta(n,u),h=f.length,m=[];f.forEach(function(n){if(m=m.concat(p.filter(function(e){return H(e)===n})),null!=t[n]&&t[n].forEach(function(e){var n=H(e),t=$(e,u),r=k(e);if(t&&!e.visible){var o=v._formGroup.getValue();if(null!=o)var i=_.timer(200).subscribe(function(){i&&!i.closed&&i.unsubscribe(),o.controls[n].setValue(null)});r&&(e.value=null)}else if(t&&e.visible&&r){var a=v._formGroup.getValue(),s=Y(e,u);null!=a&&s.changed&&a.controls[n].setValue(s.value)}-1===m.indexOf(e)&&m.push(e)}),null!=r[n]&&r[n].forEach(function(e){if(ve(e.node)){var n=e,t=Te(n,u);t!==n.reps&&v._adjustReps(p,n,t,u)}-1===m.indexOf(e)&&m.push(e)}),null!=o[n]&&o[n].forEach(function(t){W(t,u);var r=t.verifiedBranch;t.conditionalBranches.forEach(function(e,n){n==r?v._showSubtree(u,p,t,n):v._hideSubtree(u,p,t,n)}),-1===m.indexOf(t)&&m.push(t)}),null!=i[n]&&i[n].forEach(function(e){if(k(e)){var n=e,t=Y(n,u),r=v._formGroup.getValue();null!=r&&t.changed&&(Q(n,u),r.controls[H(e)].setValue(t.value))}-1===m.indexOf(e)&&m.push(e)}),null!=a[n]&&a[n].forEach(function(e){if(k(e)){var n=e;u.$value=u[H(e)],Q(n,u,v.currentSupplementaryInformations)}-1===m.indexOf(e)&&m.push(e)}),null!=s[n]&&s[n].forEach(function(e){if(k(e)){var n=e;ee(n,u),null!=n.warningResults&&0<n.warningResults.filter(function(e){return e.result}).length&&n.warningTrigger.emit()}-1===m.indexOf(e)&&m.push(e)}),1==h&&null!=l[n]&&1==l[n].filter(function(e){return!!k(e)&&q(e,u)}).length&&v._nextSlideTrigger.emit(),null!=c[n]&&c[n].forEach(function(e){if(k(e)){var n=e;D(n.node)&&ne(n,u)}-1===m.indexOf(e)&&m.push(e)}),1==h&&null!=d[n]){var e=d[n].filter(function(e){if(!k(e))return!1;var n=e;return!!D(n.node)&&function(e,n){if(null==e.triggerConditions)return!1;var t=H(e);if(e.firstTriggerConditionDone[t])return!1;for(var r=!1,o=e.triggerConditions.length,i=0;i<o;i++)if(x.evaluateExpression(e.triggerConditions[i].condition,n)){r=!0;break}return e.firstTriggerConditionDone[t]=r}(n,u)});1==e.length&&e[0].selectionTrigger.emit()}}),m.forEach(function(e){for(var n=p.indexOf(e)-1;0<=n;){var t=p[n];if(se(t)){for(var r=t,o=r.flatNodes.length,i=!0,a=0;a<o;a++){var s=r.flatNodes[a];if(s.visible&&k(s)&&!s.valid){i=!1;break}}r.valid!==i&&(r.valid=i),r.updatedEvt.emit()}n--}e.updatedEvt.emit()}),y&&(y=!1,v._formInitEvent.emit(Ie.Complete)),v._valueChanged.next()}),e},Oe.prototype._showSubtree=function(e,n,t,r){this._updateSubtreeVisibility(e,n,t,!0,r)},Oe.prototype._hideSubtree=function(e,n,t,r){this._updateSubtreeVisibility(e,n,t,!1,r)},Oe.prototype._updateSubtreeVisibility=function(e,t,r,o,n){var i,a=this,s=z(r);i=null!=n?t.filter(function(e){return z(e)==s&&e.node.parent==r.node.id&&e.node.parentNode==n}):t.filter(function(e){return z(e)==s&&e.node.parent==r.node.id});var u=ie(r.node);i.forEach(function(n){(!u||u&&null==r.node.nodes.find(function(e){return e.id==n.node.id}))&&($(n,e,o),Y(n,e),a._updateSubtreeVisibility(e,t,n,o))})},Oe.prototype._initNodesStreams=function(){this._nodes=this._nodesUpdates.pipe(o.scan(function(e,n){return n(e)},[]),o.share()),this._flatNodesTree=this._nodes.pipe(o.map(function(e){return function(e){var t=[];return e.forEach(function(e){if(se(e)){var n=e;t.push(n),n.flatNodes=ae(n.nodes)}}),t}(e)}),o.share()),this._flatNodes=this._flatNodesTree.pipe(o.map(function(e){var n=[];return e.forEach(function(e){n.push(e),n=n.concat(e.flatNodes)}),n}),o.share())},Oe.prototype._removeNodeInstance=function(e){var n=H(e);return this._removeNodesVisibilityMapIndex(n),this._removeNodesRepetitionMapIndex(n),this._removeNodesConditionalBranchMapIndex(n),this._removeNodesFormulaMapIndex(n),this._removeNodesValidationMapIndex(n),this._removeNodesWarningMapIndex(n),this._removeNodesNextSlideConditionsMapIndex(n),this._removeNodesFilteredChoicesMapIndex(n),this._removeNodesTriggerConditionsMapIndex(n),se(e)?this._removeSlideInstance(e):(ve(e.node)?this._removeNodeGroupInstance(e):k(e)&&this._removeFieldInstance(e),e)},Oe.prototype._removeSlideInstance=function(n){var t=this,e=n.node;return null!=e.visibility&&this._removeFromNodesVisibilityMap(n,e.visibility.condition),n.conditionalBranches.forEach(function(e){t._removeFromNodesConditionalBranchMap(n,e.condition)}),n},Oe.prototype._removeNodeGroupInstance=function(e){var n=e.node;return null!=n.visibility&&this._removeFromNodesVisibilityMap(e,n.visibility.condition),null!=e.formulaReps&&null!=n.formulaReps&&this._removeFromNodesRepetitionMap(e,n.formulaReps.formula),e},Oe.prototype._removeFieldInstance=function(n){var t=this,e=this._formGroup.getValue(),r=H(n);if(null!=e&&e.contains(r)&&e.removeControl(r),null!=n.validation&&this._validationNodesMapUpdates.next(function(e){return null==e[r]&&delete e[r],e}),null!=n.visibility&&this._removeFromNodesVisibilityMap(n,n.visibility.condition),n.conditionalBranches.forEach(function(e){t._removeFromNodesConditionalBranchMap(n,e.condition)}),n.formula&&this._removeFromNodesFormulaMap(n,n.formula.formula),ve(n.node)){var o=n;null!=o.formulaReps&&this._removeFromNodesRepetitionMap(n,o.formulaReps.formula)}if(null!=n.validation&&null!=n.validation.conditions&&n.validation.conditions.forEach(function(e){t._removeFromNodesValidationMap(n,e.condition)}),null!=n.warning&&n.warning.conditions.forEach(function(e){t._removeFromNodesWarningMap(n,e.condition)}),null!=n.nextSlideCondition&&this._removeFromNodesNextSlideConditionsMap(n,n.nextSlideCondition.condition),D(n.node)){var i=n;null!=i.choicesFilter&&(this._removeFromNodesFilteredChoicesMap(n,i.choicesFilter.formula),null!=i.triggerConditions&&i.triggerConditions.forEach(function(e){t._removeFromNodesTriggerConditionsMap(n,e.condition)}))}return n},Oe.prototype._addNodeInstance=function(e){return ve(e.node)?this._addNodeGroupInstance(e):le(e)?this._addSlideInstance(e):k(e)?this._addFieldInstance(e):e},Oe.prototype._addFieldInstance=function(n){var t=this,e=this._formGroup.getValue(),r=H(n);if(null!=e&&!e.contains(r)){var o=new h.FormControl;o.setValue(n.value),e.registerControl(r,o)}if(null!=n.validation&&this._validationNodesMapUpdates.next(function(e){return null==e[r]&&(e[r]=[]),-1==e[r].indexOf(n)&&e[r].push(n),e}),null!=n.visibility&&this._addToNodesVisibilityMap(n,n.visibility.condition),n.conditionalBranches.forEach(function(e){t._addToNodesConditionalBranchMap(n,e.condition)}),n.formula&&this._addToNodesFormulaMap(n,n.formula.formula),ue(n)){var i=n;null!=i.formulaReps&&this._addToNodesRepetitionMap(n,i.formulaReps.formula)}if(null!=n.validation&&null!=n.validation.conditions&&n.validation.conditions.forEach(function(e){t._addToNodesValidationMap(n,e.condition)}),null!=n.warning&&n.warning.conditions.forEach(function(e){t._addToNodesWarningMap(n,e.condition)}),null!=n.nextSlideCondition&&this._addToNodesNextSlideConditionsMap(n,n.nextSlideCondition.condition),100<n.node.fieldType&&null!=R[n.node.fieldType]&&!0===R[n.node.fieldType].isFieldWithChoice||L(n)){var a=n;null!=a.choicesFilter&&this._addToNodesFilteredChoicesMap(n,a.choicesFilter.formula),null!=a.triggerConditions&&a.triggerConditions.forEach(function(e){t._addToNodesTriggerConditionsMap(n,e.condition)})}return n},Oe.prototype._addSlideInstance=function(n){var t=this,e=n.node;return null!=e.visibility&&this._addToNodesVisibilityMap(n,e.visibility.condition),n.conditionalBranches.forEach(function(e){t._addToNodesConditionalBranchMap(n,e.condition)}),n},Oe.prototype._addNodeGroupInstance=function(n){var t=this,e=n.node;if(null!=e.visibility&&this._addToNodesVisibilityMap(n,e.visibility.condition),n.conditionalBranches.forEach(function(e){t._addToNodesConditionalBranchMap(n,e.condition)}),null!=n.formulaReps)null!=e.formulaReps&&this._addToNodesRepetitionMap(n,e.formulaReps.formula);else{var r=this._formGroup.getValue(),o=H(n);if(null!=r&&!r.contains(o)){var i=new h.FormControl;i.setValue(n.reps),r.registerControl(o,i)}}return n},Oe.prototype._removeNodesVisibilityMapIndex=function(e){this._removeNodesMapIndex(this._visibilityNodesMapUpdates,e)},Oe.prototype._removeNodesRepetitionMapIndex=function(e){this._removeNodesMapIndex(this._repetitionNodesMapUpdates,e)},Oe.prototype._removeNodesConditionalBranchMapIndex=function(e){this._removeNodesMapIndex(this._conditionalBranchNodesMapUpdates,e)},Oe.prototype._removeNodesFormulaMapIndex=function(e){this._removeNodesMapIndex(this._formulaNodesMapUpdates,e)},Oe.prototype._removeNodesValidationMapIndex=function(e){this._removeNodesMapIndex(this._validationNodesMapUpdates,e)},Oe.prototype._removeNodesWarningMapIndex=function(e){this._removeNodesMapIndex(this._warningNodesMapUpdates,e)},Oe.prototype._removeNodesFilteredChoicesMapIndex=function(e){this._removeNodesMapIndex(this._filteredChoicesNodesMapUpdates,e)},Oe.prototype._removeNodesTriggerConditionsMapIndex=function(e){this._removeNodesMapIndex(this._triggerConditionsNodesMapUpdates,e)},Oe.prototype._removeNodesNextSlideConditionsMapIndex=function(e){this._removeNodesMapIndex(this._nextSlideConditionsNodesMapUpdates,e)},Oe.prototype._removeNodesMapIndex=function(e,n){e.next(function(e){return-1<Object.keys(e).indexOf(n)&&delete e[n],e})},Oe.prototype._removeFromNodesVisibilityMap=function(e,n){this._removeFromNodesMap(this._visibilityNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesRepetitionMap=function(e,n){this._removeFromNodesMap(this._repetitionNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesConditionalBranchMap=function(e,n){this._removeFromNodesMap(this._conditionalBranchNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesFormulaMap=function(e,n){this._removeFromNodesMap(this._formulaNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesValidationMap=function(e,n){this._removeFromNodesMap(this._validationNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesWarningMap=function(e,n){this._removeFromNodesMap(this._warningNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesFilteredChoicesMap=function(e,n){this._removeFromNodesMap(this._filteredChoicesNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesTriggerConditionsMap=function(e,n){this._removeFromNodesMap(this._filteredChoicesNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesNextSlideConditionsMap=function(e,n){this._removeFromNodesMap(this._nextSlideConditionsNodesMapUpdates,e,n)},Oe.prototype._removeFromNodesMap=function(e,o,n){var t=Re(n).filter(function(e){return"Identifier"==e.type&&"$value"!=e.value});0<t.length&&e.next(function(r){return t.forEach(function(e){var n=e.value;if(null!=r[n]){var t=r[n].indexOf(o);-1<t&&(r[n].splice(t,1),0==r[n].length&&delete r[n])}}),r})},Oe.prototype._addToNodesVisibilityMap=function(e,n){this._addToNodesMap(this._visibilityNodesMapUpdates,e,n)},Oe.prototype._addToNodesRepetitionMap=function(e,n){this._addToNodesMap(this._repetitionNodesMapUpdates,e,n)},Oe.prototype._addToNodesConditionalBranchMap=function(e,n){this._addToNodesMap(this._conditionalBranchNodesMapUpdates,e,n)},Oe.prototype._addToNodesFormulaMap=function(e,n){this._addToNodesMap(this._formulaNodesMapUpdates,e,n)},Oe.prototype._addToNodesValidationMap=function(e,n){this._addToNodesMap(this._validationNodesMapUpdates,e,n)},Oe.prototype._addToNodesWarningMap=function(e,n){this._addToNodesMap(this._warningNodesMapUpdates,e,n)},Oe.prototype._addToNodesFilteredChoicesMap=function(e,n){this._addToNodesMap(this._filteredChoicesNodesMapUpdates,e,n)},Oe.prototype._addToNodesTriggerConditionsMap=function(e,n){this._addToNodesMap(this._triggerConditionsNodesMapUpdates,e,n)},Oe.prototype._addToNodesNextSlideConditionsMap=function(e,n){this._addToNodesMap(this._nextSlideConditionsNodesMapUpdates,e,n)},Oe.prototype._addToNodesMap=function(e,r,n){var o=Re(n).filter(function(e){return"Identifier"==e.type&&"$value"!=e.value});0<o.length&&e.next(function(t){return o.forEach(function(e){var n=e.value;null==t[n]&&(t[n]=[]),-1===t[n].indexOf(r)&&t[n].push(r)}),t})},Oe.decorators=[{type:i.Injectable}],Oe.ctorParameters=function(){return[{type:Ee}]},Oe);function Oe(e){this._visibilityNodesMapUpdates=new _.Subject,this._repetitionNodesMapUpdates=new _.Subject,this._conditionalBranchNodesMapUpdates=new _.Subject,this._formulaNodesMapUpdates=new _.Subject,this._validationNodesMapUpdates=new _.Subject,this._warningNodesMapUpdates=new _.Subject,this._filteredChoicesNodesMapUpdates=new _.Subject,this._triggerConditionsNodesMapUpdates=new _.Subject,this._nextSlideConditionsNodesMapUpdates=new _.Subject,this._formInitEvent=new i.EventEmitter,this.formInitEvent=this._formInitEvent.asObservable(),this._formGroup=new _.BehaviorSubject(null),this.formGroup=this._formGroup.asObservable(),this._form=new _.BehaviorSubject(null),this._nodesUpdates=new _.Subject,this._formGroupSubscription=_.Subscription.EMPTY,this._valueChanged=new _.Subject,this._nextSlideTrigger=new i.EventEmitter,this.nextSlideTrigger=this._nextSlideTrigger.asObservable(),this._slidesNum=new _.BehaviorSubject(0),this.slidesNum=this._slidesNum.asObservable(),this._initUpdateMapStreams(),this._initNodesStreams(),this._initErrorsStreams(),this._initFormStreams(),this._updateFormValueAndValidity()}function Pe(){}var Ue=(Object.defineProperty(Be.prototype,"saveDisabled",{get:function(){return this._saveDisabled},set:function(e){this._saveDisabled=c.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"hasStartMessage",{get:function(){return this._hasStartMessage},set:function(e){this._hasStartMessage=c.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"hasEndMessage",{get:function(){return this._hasEndMessage},set:function(e){this._hasEndMessage=c.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"hideTopToolbar",{get:function(){return this._hideTopToolbar},set:function(e){this._hideTopToolbar=c.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"hideBottompToolbar",{get:function(){return this._hideBottomToolbar},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"hideBottomToolbar",{set:function(e){this._hideBottomToolbar=c.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"hideNavigationButtons",{get:function(){return this._hideNavigationButtons},set:function(e){this._hideNavigationButtons=c.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"fixedOrientation",{get:function(){return this._fixedOrientation},set:function(e){this._fixedOrientation=c.coerceBooleanProperty(e),this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"orientation",{get:function(){return this._orientation},set:function(e){"horizontal"!==e&&"vertical"!==e||e!==this._orientation&&(this._orientation=e,this._changeDetectorRef.markForCheck(),this._orientationChange.emit(this._orientation))},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"form",{set:function(e){this._form=e,this._init&&this._rendererService.setForm(this._form)},enumerable:!0,configurable:!0}),Be.prototype.goToNextError=function(){this._errorMoveEvent.emit(!0)},Be.prototype.goToPrevError=function(){this._errorMoveEvent.emit(!1)},Be.prototype.addGroup=function(e){var n=this,t=this._rendererService.addGroup(e).pipe(o.delayWhen(function(){return n.formSlider.pageScrollFinish})).subscribe(function(e){e&&null!=n.formSlider&&n.formSlider.slide({dir:"down"})},function(e){t&&t.unsubscribe()},function(){t&&t.unsubscribe()})},Be.prototype.removeGroup=function(e){var n=this,t=this._rendererService.removeGroup(e).pipe(o.delayWhen(function(){return n.formSlider.pageScrollFinish})).subscribe(function(e){e&&null!=n.formSlider&&n.formSlider.slide({dir:"up"})},function(e){t&&t.unsubscribe()},function(){t&&t.unsubscribe()})},Be.prototype.onSave=function(e){this._formAction.emit({source:this,action:"save",value:this._rendererService.getFormValue()})},Be.prototype.onFormAction=function(e,n){this._formAction.emit({source:this,value:this._rendererService.getFormValue(),action:n})},Be.prototype.ngAfterViewInit=function(){null!=this._form&&(this._rendererService.setForm(this._form),this._changeDetectorRef.detectChanges())},Be.prototype.ngAfterViewChecked=function(){var l=this;this._init||null==this.formSlider||(this._init=!0,this._errorMoveSubscription=this._errorMoveEvent.pipe(o.withLatestFrom(this._errorPositions)).subscribe(function(e){var n=e[0],t=l.formSlider.currentPage-+l.hasStartMessage+1,r=e[1];if(null!=r){for(var o=!1,i=-1,a=-1,s=0,u=r.length;!o&&s<u;)r[s]==t?(o=!0,i=0<s?s-1:u-1,a=s<u-1?s+1:0):r[s]>t&&(o=!0,i=0<s?s-1:u-1,a=s),s++;o||(i=u-1,a=0),l.formSlider.slide({to:n?r[a]-1:r[i]-1}),l._changeDetectorRef.detectChanges()}}))},Be.prototype.ngOnDestroy=function(){this._nextSlideSubscription.unsubscribe(),this._errorMoveSubscription.unsubscribe(),this._orientationChange.complete(),this._errorMoveEvent.complete(),this._formAction.complete()},Be.prototype.orientationChangeHandler=function(e){this.orientation=e},Be.prototype.trackNodeById=function(e,n){return H(n)},Be);function Be(e,n){this._rendererService=e,this._changeDetectorRef=n,this.ajfFieldTypes=S,this._orientationChange=new i.EventEmitter,this.orientationChange=this._orientationChange.asObservable(),this._saveDisabled=!1,this._hasStartMessage=!1,this._hasEndMessage=!1,this._hideTopToolbar=!1,this._hideBottomToolbar=!1,this._hideNavigationButtons=!1,this._fixedOrientation=!1,this._orientation="horizontal",this._errorMoveEvent=new i.EventEmitter,this._init=!1,this._nextSlideSubscription=_.Subscription.EMPTY,this._errorMoveSubscription=_.Subscription.EMPTY,this._formAction=new i.EventEmitter,this.formAction=this._formAction.asObservable(),this.formGroup=e.formGroup,this.slides=e.nodesTree,this._errorPositions=e.errorPositions,this.errors=e.errors,this.slidesNum=e.slidesNum,this.formIsInit=e.formInitEvent.pipe(o.map(function(e){return e===Ie.Complete}))}var De=(Ge.prototype.transform=function(e){return e?1:0},Ge.decorators=[{type:i.Pipe,args:[{name:"ajfBoolToInt"}]}],Ge);function Ge(){}var ke=(Le.prototype.transform=function(e,n){return!e.node.forceNarrow&&(e.node.forceExpanded||e.filteredChoices&&e.filteredChoices.length<=n)},Le.decorators=[{type:i.Pipe,args:[{name:"ajfExpandFieldWithChoices"}]}],Le);function Le(){}var Je=(We.prototype.transform=function(e,n){return void 0===n&&(n=1),e+n},We.decorators=[{type:i.Pipe,args:[{name:"ajfIncrement"}]}],We);function We(){}var $e=(ze.prototype.transform=function(e){return je(e)},ze.decorators=[{type:i.Pipe,args:[{name:"ajfIsRepeatingSlideInstance"}]}],ze);function ze(){}var He=(Ye.prototype.transform=function(e){return e?H(e):""},Ye.decorators=[{type:i.Pipe,args:[{name:"ajfNodeCompleteName"}]}],Ye);function Ye(){}var qe=(Ze.prototype.transform=function(e,n,t){void 0===e&&(e=0),void 0===n&&(n=1),void 0===t&&(t=1);for(var r=[],o=0;o<e;++o)r.push(n),n+=t;return r},Ze.decorators=[{type:i.Pipe,args:[{name:"ajfRange"}]}],Ze);function Ze(){}var Ke=(Qe.prototype.transform=function(e){return e%2==0?"ajf-row-even":"ajf-row-odd"},Qe.decorators=[{type:i.Pipe,args:[{name:"ajfTableRowClass"}]}],Qe);function Qe(){}var Xe=(en.prototype.transform=function(e){return e.node.editable?(e.controls||[]).map(function(e){return[e[0]].concat(e[1])}):e.hideEmptyRows?(e.value||[]).filter(function(e){return e[1].reduce(function(e,n){return e||null!=n&&""!==n&&0!==n&&"0"!==n},!1)}).map(function(e){return[e[0]].concat(e[1])}):e.value.map(function(e){return[e[0]].concat(e[1])})},en.decorators=[{type:i.Pipe,args:[{name:"ajfTableVisibleColumns"}]}],en);function en(){}var nn=(tn.prototype.transform=function(e,n){return null!=n&&"number"==typeof n&&(n>=e.slideNodes.length||e.slideNodes[n].map(function(e){return!(e.visible&&-1<Object.keys(e).indexOf("valid"))||e.valid}).reduce(function(e,n){return e&&n},!0))},tn.decorators=[{type:i.Pipe,args:[{name:"ajfValidSlide",pure:!1}]}],tn);function tn(){}var rn=(on.decorators=[{type:i.NgModule,args:[{declarations:[De,d,f,ke,E,N,C,Je,$e,He,qe,Ke,Xe,nn],exports:[De,d,f,ke,E,N,C,Je,$e,He,qe,Ke,Xe,nn],providers:[f,Ve,Ee]}]}],on);function on(){}var an,sn=(s(un,an=u),Object.defineProperty(un.prototype,"readonly",{get:function(){return this._readonly},set:function(e){this._readonly=c.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),un);function un(){var e=null!==an&&an.apply(this,arguments)||this;return e.type="text",e._readonly=!1,e}var ln=new i.InjectionToken("AJF_SEARCH_ALERT_THRESHOLD");var cn=(dn.fromJson=function(e){if(null==e.name)throw new Error("Malformed attachments origin");return function(e){return M({},e,{attachments:e.attachments||[]})}(e)},dn);function dn(){}function pn(e){return M({},e,{type:e.type,label:e.label||"",choices:e.choices||[]})}var fn=(hn.fromJson=function(e){return pn(M({},e,{type:e.type||"fixed",name:e.name||""}))},hn);function hn(){}function mn(e){var n=te(e);return M({},n,{nodes:e.nodes||[]})}function vn(e){var n=te(e);return M({},e,n,{minReps:null!=e.minReps?e.minReps:1,maxReps:null!=e.maxReps?e.maxReps:0})}function gn(e){return M({},mn(e),vn(e),{nodeType:B.AjfNodeGroup})}function yn(e){return M({},mn(e),vn(e),{nodeType:B.AjfRepeatingSlide})}function _n(e){return M({},mn(e),{nodeType:B.AjfSlide})}var bn=(Nn.fromJson=function(e){return he(e)},Nn);function Nn(){}var xn=(Mn.fromJson=function(e){return me(e)},Mn);function Mn(){}var Sn=(jn.fromJson=function(e,n,t){var r="Malformed node";if(e.name=e.name||"",null==e.id||null==e.parent||null==e.nodeType)throw new Error(r);var o=e;switch(o.visibility&&(o.visibility=x.AjfConditionSerializer.fromJson(o.visibility)),o.conditionalBranches=(o.conditionalBranches||[]).map(function(e){return x.AjfConditionSerializer.fromJson(e)}),o.nodeType){case B.AjfField:return jn._fieldFromJson(o,n,t);case B.AjfFieldNodeLink:return jn._fieldNodeLinkFromJson(o);case B.AjfNodeGroup:return jn._nodeGroupFromJson(o,n,t);case B.AjfRepeatingSlide:return jn._repeatingSlideFromJson(o,n,t);case B.AjfSlide:return jn._slideFromJson(o,n,t)}throw new Error(r)},jn._containerNodeFromJson=function(e,n,t){return e.nodes=(e.nodes||[]).map(function(e){return jn.fromJson(e,n,t)}),mn(e)},jn._fieldFromJson=function(n,e,t){if(null==n.fieldType)throw new Error("Malformed field");var r=n;switch(r.validation&&(r.validation=bn.fromJson(r.validation)),r.warning&&(r.warning=xn.fromJson(r.warning)),n.attachmentsOriginRef&&(r.attachmentOrigin=(t||[]).find(function(e){return e.name===n.attachmentsOriginRef})),r.nextSlideCondition&&(r.nextSlideCondition=x.AjfConditionSerializer.fromJson(r.nextSlideCondition)),r.fieldType){case S.Formula:return jn._formulaFieldFromJson(n);case S.MultipleChoice:case S.SingleChoice:return jn._fieldWithChoicesFromJson(n,e)}return re(r)},jn._fieldNodeLinkFromJson=function(e){return M({},te(e),{nodeType:B.AjfFieldNodeLink})},jn._fieldWithChoicesFromJson=function(n,e){var t="Malformed field with choices";if(null==n.choicesOriginRef)throw new Error(t);var r=(e||[]).find(function(e){return e.name===n.choicesOriginRef});if(null==r)throw new Error(t);return n.choicesFilter&&(n.choicesFilter=x.AjfFormulaSerializer.fromJson(n.choicesFilter)),n.triggerConditions&&(n.triggerConditions=n.triggerConditions.map(function(e){return x.AjfConditionSerializer.fromJson(e)})),function(e){var n=re(M({},e));return M({},n,e,{choices:e.choices||[],forceExpanded:e.forceExpanded||!1,forceNarrow:e.forceNarrow||!1})}(M({},n,{choicesOrigin:r}))},jn._formulaFieldFromJson=function(e){return e.formula&&(e.formula=x.AjfFormulaSerializer.fromJson(e.formula)),M({},re(e),{fieldType:S.Formula})},jn._nodeGroupFromJson=function(e,n,t){return gn(M({},jn._containerNodeFromJson(e,n,t),jn._repeatingNodeFromJson(e)))},jn._repeatingNodeFromJson=function(e){return e.formulaReps&&(e.formulaReps=x.AjfFormulaSerializer.fromJson(e.formulaReps)),vn(e)},jn._repeatingSlideFromJson=function(e,n,t){return yn(M({},jn._containerNodeFromJson(e,n,t),jn._repeatingNodeFromJson(e)))},jn._slideFromJson=function(e,n,t){return _n(jn._containerNodeFromJson(e,n,t))},jn);function jn(){}var Cn=(Fn.fromJson=function(e,n){var t=(e.choicesOrigins||[]).map(function(e){return fn.fromJson(e)}),r=(e.attachmentsOrigins||[]).map(function(e){return cn.fromJson(e)}),o=(e.nodes||[]).map(function(e){return Sn.fromJson(e,t,r)});return M({},e,{choicesOrigins:t,attachmentsOrigins:r,nodes:o,stringIdentifier:e.stringIdentifier||[],initContext:c.deepCopy(n||{})})},Fn);function Fn(){}var wn={Link:0,Pdf:1,LENGTH:2};wn[wn.Link]="Link",wn[wn.Pdf]="Pdf",wn[wn.LENGTH]="LENGTH";var Tn={String:0,Number:1,LENGTH:2};function En(e){return null!=e&&"object"==typeof e&&null!=e.name&&"string"==typeof e.name&&null!=e.label&&"string"==typeof e.label&&-1<["fixed","promise","observable","observableArray","function"].indexOf(e.type)&&e.choices instanceof Array}Tn[Tn.String]="String",Tn[Tn.Number]="Number",Tn[Tn.LENGTH]="LENGTH",e.AJF_SEARCH_ALERT_THRESHOLD=ln,e.AjfAttachmentsOriginSerializer=cn,e.AjfAttachmentsType=wn,e.AjfBaseFieldComponent=u,e.AjfChoicesOriginSerializer=fn,e.AjfChoicesType=Tn,e.AjfDateValuePipe=d,e.AjfDateValueStringPipe=f,e.AjfFieldHost=E,e.AjfFieldIconPipe=N,e.AjfFieldIsValidPipe=C,e.AjfFieldService=I,e.AjfFieldType=S,e.AjfFieldWithChoicesComponent=P,e.AjfFormActionEvent=Pe,e.AjfFormField=w,e.AjfFormInitStatus=Ie,e.AjfFormRenderer=Ue,e.AjfFormRendererService=Ve,e.AjfFormSerializer=Cn,e.AjfFormsModule=rn,e.AjfInputFieldComponent=sn,e.AjfInvalidFieldDefinitionError=g,e.AjfNodeCompleteNamePipe=He,e.AjfNodeSerializer=Sn,e.AjfNodeType=B,e.AjfTableRowClass=Ke,e.AjfTableVisibleColumnsPipe=Xe,e.AjfValidationGroupSerializer=bn,e.AjfValidationService=Ee,e.AjfWarningGroupSerializer=xn,e.createChoicesFixedOrigin=function(e){return M({},pn(M({},e,{type:"fixed"})),{type:"fixed"})},e.createChoicesFunctionOrigin=function(e){return M({},e,{type:"function",label:e.label||"",choices:e.choices||[]})},e.createChoicesObservableArrayOrigin=function(e){return M({},e,{type:"observableArray",label:e.label||"",choices:e.choices||[]})},e.createChoicesObservableOrigin=function(e){return M({},e,{type:"observable",label:e.label||"",choices:e.choices||[]})},e.createChoicesOrigin=pn,e.createChoicesPromiseOrigin=function(e){return M({},e,{type:"promise",label:e.label||"",choices:e.choices||[]})},e.createField=re,e.createFieldInstance=de,e.createFieldWithChoicesInstance=pe,e.createForm=function(e){return void 0===e&&(e={}),{nodes:e.nodes||[],choicesOrigins:e.choicesOrigins||[],attachmentsOrigins:e.attachmentsOrigins||[],initContext:e.initContext||{},stringIdentifier:e.stringIdentifier||[],supplementaryInformations:e.supplementaryInformations}},e.createNode=te,e.createNodeInstance=ce,e.createValidation=Ne,e.createValidationGroup=he,e.createWarning=Me,e.createWarningGroup=me,e.fieldIconName=b,e.flattenNodes=Fe,e.getTypeName=function(e){var n=typeof e;return"object"==n?e.constructor.toString().match(/\w+/g)[1]:n},e.initChoicesOrigin=function(e){if("fixed"===e.type)return Promise.resolve();if("function"===e.type){var n=e;return n.choices=n.generator(),Promise.resolve()}if("promise"===e.type){var t=e;return t.generator.then(function(e){return t.choices=e}).then()}if("observable"===e.type){var r=e;if(null!=r.generator)return r.choices=[],new Promise(function(e){r.generator.subscribe(function(e){return r.choices.push(e)},function(){},function(){return e()})})}if("observableArray"===e.type){var o=e;if(null!=o.generator)return o.choices=[],new Promise(function(n){o.generator.subscribe(function(e){o.choices=e,n()})})}return Promise.resolve()},e.isChoicesFixedOrigin=function(e){return En(e)&&"fixed"===e.type},e.isChoicesOrigin=En,e.isContainerNode=ie,e.isField=G,e.isFieldWithChoices=D,e.isNumberField=function(e){return e.fieldType===S.Number},e.isRepeatingContainerNode=ve,e.isSlidesNode=oe,e.maxDigitsValidation=function(e){return Ne({condition:"$value ? $value.toString().length >= "+e.toString()+" : false",errorMessage:"Digits count must be >= "+e.toString()})},e.maxValidation=function(e){return Ne({condition:"$value >= "+e.toString(),errorMessage:"Value must be >= "+e.toString()})},e.minDigitsValidation=function(e){return Ne({condition:"$value ? $value.toString().length >= "+e.toString()+" : false",errorMessage:"Digits count must be >= "+e.toString()})},e.minValidation=function(e){return Ne({condition:"$value >= "+e.toString(),errorMessage:"Value must be >= "+e.toString()})},e.notEmptyValidation=function(){return Ne({condition:"notEmpty($value)",errorMessage:"Value must not be empty"})},e.notEmptyWarning=function(){return Me({condition:"notEmpty($value)",warningMessage:"Value must not be empty"})},e.a=De,e.b=ke,e.c=Je,e.d=$e,e.e=qe,e.f=nn,e.g=gn,e.h=yn,e.i=_n,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core-forms.umd.min.js.map
