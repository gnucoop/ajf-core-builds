{"version":3,"sources":["src/core/core-forms.umd.js"],"names":["global","factory","exports","module","require","define","amd","self","ajf","core","forms","ng","rxjs","operators","utils","esprima","models","dateFns","cdk","coercion","common","this","pageSlider","common$1","esprima__default","AjfAsFieldInstancePipe","prototype","transform","instance","decorators","type","Pipe","args","name","AjfAsRepeatingSlideInstancePipe","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","create","AjfFieldType","AjfNodeType","__assign","assign","t","s","i","n","arguments","length","call","apply","__read","o","m","Symbol","iterator","r","e","ar","next","done","push","value","error","__spread","concat","initChoicesOrigin","origin","Promise","resolve","choices","generator","po_1","then","obso_1","res","subscribe","c","aoo_1","isFieldWithChoices","field","fieldType","SingleChoice","MultipleChoice","isField","node","nodeType","AjfField","isFieldInstance","nodeInstance","isFieldWithChoicesInstance","updateConditionalBranches","context","conditionalBranches","oldBranch","verifiedBranch","idx","found","evaluateExpression","condition","updateVisibility","branchVisibility","visibility","visible","oldVisibility","newVisibility","nodeInstanceSuffix","prefix","join","nodeInstanceCompleteName","updateFormula","formula","editable","newValue","oldValue","$value","changed","updateNextSlideCondition","nextSlideCondition","evaluateValidation","validation","forceFormula","result","errorMessage","clientValidation","updateValidation","supplementaryInformations","keys","forEach","key","completeName","forceValue","validationResults","evaluateValidationGroup","ctx","deepCopy","evaluateValidationConditions","conditions","cond","maxValue","evaluateValidationMaxValue","minValue","evaluateValidationMinValue","notEmpty","evaluateValidationNotEmpty","maxDigits","evaluateValidationMaxDigits","minDigits","evaluateValidationMinDigits","valid","reduce","prev","x","updateWarning","warning","warningResults","evaluateWarningGroup","evaluateWarningConditions","map","evaluateWarning","warningMessage","updateFilteredChoices","filteredChoices","choicesFilter","choicesOrigin","filter","$choice","$choiceValue","createNode","alwaysCondition","parentNode","label","createField","Formula","Table","defaultValue","size","componentsMap","isCustomFieldWithChoices","isFieldWithChoice","isSlidesNode","AjfRepeatingSlide","AjfSlide","isContainerNode","AjfNodeGroup","flattenNodesInstances","nodes","includeGroups","flatNodes","isContainerNodeInstance","isSlidesInstance","isNodeGroupInstance","isNodeGroup","createNodeInstance","updatedEvt","EventEmitter","createFieldInstance","warningTrigger","createFieldWithChoicesInstance","fieldInstance","firstTriggerConditionDone","selectionTrigger","createSlideInstance","slideNodes","position","createValidationGroup","group","createWarningGroup","isRepeatingContainerNode","getInstanceCondition","ancestorsNames","oldCondition","newCondition","normalizeExpression","getInstanceConditions","newConditions","getInstanceFormula","oldFormula","newFormula","createValidation","createWarning","isRepeatingSlideInstance","isRepeatingSlide","flattenNodes","orderedNodes","parent","newNodes","sort","n1","n2","id","updateRepsNum","oldReps","reps","formulaReps","ctxReps","newReps","canAdd","maxReps","canRemove","minReps","AjfValidationService","_baseUtilFunctions","_functions","_functionsStr","_initFunctions","addFunction","f","addFunctionHandler","fn","undefined","AjfExpressionUtils","functionsStr","toString","UTIL_FUNCTIONS","Injectable","ctorParameters","tokenize","AjfFormRendererService","_","_visibilityNodesMapUpdates","Subject","_repetitionNodesMapUpdates","_conditionalBranchNodesMapUpdates","_formulaNodesMapUpdates","_validationNodesMapUpdates","_warningNodesMapUpdates","_filteredChoicesNodesMapUpdates","_triggerConditionsNodesMapUpdates","_nextSlideConditionsNodesMapUpdates","_formInitEvent","formInitEvent","asObservable","_formGroup","BehaviorSubject","formGroup","_form","_nodesUpdates","_formGroupSubscription","Subscription","EMPTY","_valueChanged","_nextSlideTrigger","nextSlideTrigger","_slidesNum","slidesNum","_initUpdateMapStreams","_initNodesStreams","_initErrorsStreams","_initFormStreams","_updateFormValueAndValidity","defineProperty","get","_flatNodesTree","enumerable","configurable","_errorPositions","_errors","form","getValue","setForm","initContext","currentForm","getFormValue","addGroup","_this","Observable","subscriber","complete","_adjustReps","removeGroup","getControl","pipe","fieldName","contains","controls","withLatestFrom","_nodes","v","currentPosition","errors","rsNode","slide","indexOf","v1","v2","sNode","publishReplay","refCount","startWith","_visibilityNodesMap","scan","rmap","op","share","_repetitionNodesMap","_conditionalBranchNodesMap","_formulaNodesMap","_validationNodesMap","_warningNodesMap","_filteredChoicesNodesMap","_triggerConditionsNodesMap","_nextSlideConditionsNodesMap","_nodesMaps","formObs","_initFormGroupStreams","FormGroup","switchMap","of","choicesOrigins","from","all","co","_nodesInstances","_orderedNodesInstancesTree","_initNodeInstance","allNodes","nodeToNodeInstance","createInstance","createTableFieldInstance","normalizeRows","rows","row","rowIdx","elem","elemIdx","hideEmptyRows","createNodeGroupInstance","createRepeatingSlideInstance","slideInstance","getAncestorRepeatingNodesNames","names","getAncestorRepeatingNodes","nodeGroups","curParent","curNode","find","sn","createCondition","ngInstance","createFormula","fNode","fInstance","getInstanceValidations","validations","newValidations","newValidation","getInstanceValidation","oldValidation","newWarnings","getInstanceWarnings","warnings","newWarning","getInstanceWarning","oldWarning","fwcNode","fwcInstance","triggerConditions","_explodeRepeatingNode","isTableFieldInstance","isTableField","tfInstance_1","tNode_1","formGroup_1","controlsWithLabels_1","columnLabels","cell","tableFormControl","control","FormControl","show","setValue","registerControl","fakeInstance","_addToNodesFormulaMap","rowLabels","updateFieldInstanceState","_addNodeInstance","added","removed","newNodes_1","Empty","newInstance","slice","_loop_1","this_1","nodesNum","splice","_removeNodeInstance","fg","rsInstance","nodesPerSlide","startNode","values","updateValueAndValidity","nodesInstances","curSuffix","parentNodeInstance","ni","nni","_formValueDelta","k","unsubscribe","init","initForm","emit","valueChanges","pairwise","debounceTime","_flatNodes","oldFormValue","newFormValue","visibilityMap","repetitionMap","conditionalBranchesMap","formulaMap","validationMap","warningMap","nextSlideConditionsMap","filteredChoicesMap","triggerConditionsMap","delta","deltaLen","updatedNodes","visibilityChanged","fg_1","s_1","timer","closed","rnInstance","_condition","_showSubtree","_hideSubtree","currentSupplementaryInformations","updateTriggerConditions","conditionsNum","subNodesNum","subNode","branch","_updateSubtreeVisibility","subNodes","nodeSuffix","isContainer","cn","flattenNodesInstancesTree","flatTree","slides","nodeName","_removeNodesVisibilityMapIndex","_removeNodesRepetitionMapIndex","_removeNodesConditionalBranchMapIndex","_removeNodesFormulaMapIndex","_removeNodesValidationMapIndex","_removeNodesWarningMapIndex","_removeNodesNextSlideConditionsMapIndex","_removeNodesFilteredChoicesMapIndex","_removeNodesTriggerConditionsMapIndex","_removeSlideInstance","_removeNodeGroupInstance","_removeFieldInstance","_removeFromNodesVisibilityMap","conditionalBranch","_removeFromNodesConditionalBranchMap","nodeGroupInstance","nodeGroup","_removeFromNodesRepetitionMap","fieldInstanceName","removeControl","vmap","_removeFromNodesFormulaMap","_removeFromNodesValidationMap","_removeFromNodesWarningMap","_removeFromNodesNextSlideConditionsMap","_removeFromNodesFilteredChoicesMap","_removeFromNodesTriggerConditionsMap","_addNodeGroupInstance","isSlideInstance","isSlideNode","_addSlideInstance","_addFieldInstance","_addToNodesVisibilityMap","_addToNodesConditionalBranchMap","_addToNodesRepetitionMap","_addToNodesValidationMap","_addToNodesWarningMap","_addToNodesNextSlideConditionsMap","_addToNodesFilteredChoicesMap","_addToNodesTriggerConditionsMap","nodeGroupInstanceName","index","_removeNodesMapIndex","nodesMap","_removeFromNodesMap","tokens","token","tokenName","_addToNodesMap","AjfBaseFieldComponent","_changeDetectorRef","_service","_warningAlertService","_warningTriggerSub","_instanceUpdateSub","_control","defer","ctrl","_instance","set","_setUpInstanceUpdate","_onInstanceChange","ngOnInit","showWarningAlertPrompt","w","_e","ngOnDestroy","detectChanges","Directive","ChangeDetectorRef","AjfBoolToIntPipe","AjfDateValuePipe","date","Date","AjfDateValueStringPipe","dateObj","format","AjfInvalidFieldDefinitionError","_super","message","AjfError","AjfExpandFieldWithChoicesPipe","threshold","forceNarrow","forceExpanded","AjfFieldHost","viewContainerRef","selector","ViewContainerRef","AjfFormField","_cdr","_cfr","_init","_updatedSub","_loadComponent","_readonly","readonly","coerceBooleanProperty","fieldHost","vcr","clear","componentDef","component","readOnlyComponent","componentFactory","resolveComponentFactory","componentRef","createComponent","_componentInstance","inputs","markForCheck","console","log","ComponentFactoryResolver","propDecorators","ViewChild","static","Input","fieldIconName","toLowerCase","AjfFieldIconPipe","AjfFieldIsValidPipe","AjfFieldService","registerCustomField","Error","AjfFieldWithChoicesComponent","cdr","service","warningAlertService","searchThreshold","_searchThreshold","AjfFormActionEvent","AjfFormRenderer","_rendererService","ajfFieldTypes","_orientationChange","orientationChange","_saveDisabled","_hasStartMessage","_hasEndMessage","_hideTopToolbar","_hideBottomToolbar","_hideNavigationButtons","_fixedOrientation","_orientation","_errorMoveEvent","_nextSlideSubscription","_errorMoveSubscription","_formAction","formAction","nodesTree","errorPositions","formIsInit","saveDisabled","hasStartMessage","hasEndMessage","hideTopToolbar","hideBottomToolbar","hideNavigationButtons","fixedOrientation","orientation","goToNextError","goToPrevError","delayWhen","formSlider","pageScrollFinish","dir","onSave","_evt","source","action","onFormAction","ngAfterViewInit","ngAfterViewChecked","move","currentPage","prevIdx","nextIdx","errorsLen","to","orientationChangeHandler","trackNodeById","title","Output","fields","ViewChildren","AjfGetTableCellControlPipe","AjfIncrementPipe","increment","AjfIsCellEditablePipe","AjfIsRepeatingSlideInstancePipe","AjfNodeCompleteNamePipe","AjfRangePipe","start","step","range","length_1","AjfInputFieldComponent","AJF_WARNING_ALERT_SERVICE","InjectionToken","AjfReadOnlyFieldComponent","was","Component","template","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","styles","Inject","AjfReadOnlyTableFieldComponent","AjfTableRowClass","AjfTableVisibleColumnsPipe","val","col","cur","AjfValidSlidePipe","pure","AjfFormsModule","NgModule","declarations","imports","AjfCommonModule","CommonModule","providers","AJF_SEARCH_ALERT_THRESHOLD","AjfAttachmentsOriginSerializer","fromJson","createAttachmentsOrigin","attachments","createChoicesOrigin","AjfChoicesOriginSerializer","createContainerNode","containerNode","createRepeatingNode","repeatingNode","createNodeGroup","createRepeatingSlide","createSlide","AjfValidationGroupSerializer","AjfWarningGroupSerializer","AjfNodeSerializer","json","attachmentsOrigins","err","obj","AjfConditionSerializer","_fieldFromJson","AjfFieldNodeLink","_fieldNodeLinkFromJson","_nodeGroupFromJson","_repeatingSlideFromJson","_slideFromJson","_containerNodeFromJson","attachmentsOriginRef","attachmentOrigin","a","_fieldWithChoicesFromJson","_formulaFieldFromJson","choicesOriginRef","AjfFormulaSerializer","createFieldWithChoices","_repeatingNodeFromJson","AjfFormSerializer","stringIdentifier","AjfTableFieldComponent","goToNextCell","ev","column","currentCell","_showCell","preventDefault","stopPropagation","goToCell","_resetControls","nextCell","isChoicesOrigin","createChoicesFixedOrigin","createChoicesFunctionOrigin","createChoicesObservableArrayOrigin","createChoicesObservableOrigin","createChoicesPromiseOrigin","createForm","getTypeName","typeStr","match","isChoicesFixedOrigin","isNumberField","Number","maxDigitsValidation","maxValidation","minDigitsValidation","minValidation","notEmptyValidation","notEmptyWarning","ɵgc_ajf_src_core_forms_forms_a","ɵgc_ajf_src_core_forms_forms_b","ɵgc_ajf_src_core_forms_forms_c","ɵgc_ajf_src_core_forms_forms_d"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('@angular/forms'), require('rxjs'), require('rxjs/operators'), require('@ajf/core/utils'), require('esprima'), require('@ajf/core/models'), require('date-fns'), require('@angular/cdk/coercion'), require('@ajf/core/page-slider'), require('@ajf/core/common'), require('@angular/common')) :\n    typeof define === 'function' && define.amd ? define('@ajf/core/forms', ['exports', '@angular/core', '@angular/forms', 'rxjs', 'rxjs/operators', '@ajf/core/utils', 'esprima', '@ajf/core/models', 'date-fns', '@angular/cdk/coercion', '@ajf/core/page-slider', '@ajf/core/common', '@angular/common'], factory) :\n    (global = global || self, factory((global.ajf = global.ajf || {}, global.ajf.core = global.ajf.core || {}, global.ajf.core.forms = {}), global.ng.core, global.ng.forms, global.rxjs, global.rxjs.operators, global.ng.core.utils, global.esprima, global.ng.core.models, global.dateFns, global.ng.cdk.coercion, global.ng.core.pageSlider, global.ng.core.common, global.ng.common));\n}(this, (function (exports, core, forms, rxjs, operators, utils, esprima, models, dateFns, coercion, pageSlider, common, common$1) { 'use strict';\n\n    var esprima__default = 'default' in esprima ? esprima['default'] : esprima;\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfAsFieldInstancePipe = /** @class */ (function () {\n        function AjfAsFieldInstancePipe() {\n        }\n        AjfAsFieldInstancePipe.prototype.transform = function (instance) {\n            return instance;\n        };\n        AjfAsFieldInstancePipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfAsFieldInstance' },] }\n        ];\n        return AjfAsFieldInstancePipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfAsRepeatingSlideInstancePipe = /** @class */ (function () {\n        function AjfAsRepeatingSlideInstancePipe() {\n        }\n        AjfAsRepeatingSlideInstancePipe.prototype.transform = function (instance) {\n            return instance;\n        };\n        AjfAsRepeatingSlideInstancePipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfAsRepeatingSlideInstance' },] }\n        ];\n        return AjfAsRepeatingSlideInstancePipe;\n    }());\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation. All rights reserved.\r\n    Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n    this file except in compliance with the License. You may obtain a copy of the\r\n    License at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n    MERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n    See the Apache Version 2.0 License for specific language governing permissions\r\n    and limitations under the License.\r\n    ***************************************************************************** */\r\n    /* global Reflect, Promise */\r\n\r\n    var extendStatics = function(d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n\r\n    function __extends(d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    }\r\n\r\n    var __assign = function() {\r\n        __assign = Object.assign || function __assign(t) {\r\n            for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                s = arguments[i];\r\n                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n            }\r\n            return t;\r\n        };\r\n        return __assign.apply(this, arguments);\r\n    };\r\n\r\n    function __rest(s, e) {\r\n        var t = {};\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n            t[p] = s[p];\r\n        if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n            for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n                if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                    t[p[i]] = s[p[i]];\r\n            }\r\n        return t;\r\n    }\r\n\r\n    function __decorate(decorators, target, key, desc) {\r\n        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n        if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n        else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n        return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n    }\r\n\r\n    function __param(paramIndex, decorator) {\r\n        return function (target, key) { decorator(target, key, paramIndex); }\r\n    }\r\n\r\n    function __metadata(metadataKey, metadataValue) {\r\n        if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n    }\r\n\r\n    function __awaiter(thisArg, _arguments, P, generator) {\r\n        return new (P || (P = Promise))(function (resolve, reject) {\r\n            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n            function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n            function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n            step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n        });\r\n    }\r\n\r\n    function __generator(thisArg, body) {\r\n        var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n        return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n        function verb(n) { return function (v) { return step([n, v]); }; }\r\n        function step(op) {\r\n            if (f) throw new TypeError(\"Generator is already executing.\");\r\n            while (_) try {\r\n                if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n                if (y = 0, t) op = [op[0] & 2, t.value];\r\n                switch (op[0]) {\r\n                    case 0: case 1: t = op; break;\r\n                    case 4: _.label++; return { value: op[1], done: false };\r\n                    case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                    case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                    default:\r\n                        if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                        if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                        if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                        if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                        if (t[2]) _.ops.pop();\r\n                        _.trys.pop(); continue;\r\n                }\r\n                op = body.call(thisArg, _);\r\n            } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n            if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n        }\r\n    }\r\n\r\n    function __exportStar(m, exports) {\r\n        for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n    }\r\n\r\n    function __values(o) {\r\n        var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n        if (m) return m.call(o);\r\n        return {\r\n            next: function () {\r\n                if (o && i >= o.length) o = void 0;\r\n                return { value: o && o[i++], done: !o };\r\n            }\r\n        };\r\n    }\r\n\r\n    function __read(o, n) {\r\n        var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n        if (!m) return o;\r\n        var i = m.call(o), r, ar = [], e;\r\n        try {\r\n            while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n        }\r\n        catch (error) { e = { error: error }; }\r\n        finally {\r\n            try {\r\n                if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n            }\r\n            finally { if (e) throw e.error; }\r\n        }\r\n        return ar;\r\n    }\r\n\r\n    function __spread() {\r\n        for (var ar = [], i = 0; i < arguments.length; i++)\r\n            ar = ar.concat(__read(arguments[i]));\r\n        return ar;\r\n    }\r\n\r\n    function __spreadArrays() {\r\n        for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n        for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n            for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n                r[k] = a[j];\r\n        return r;\r\n    };\r\n\r\n    function __await(v) {\r\n        return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n    }\r\n\r\n    function __asyncGenerator(thisArg, _arguments, generator) {\r\n        if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n        var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n        return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n        function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n        function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n        function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n        function fulfill(value) { resume(\"next\", value); }\r\n        function reject(value) { resume(\"throw\", value); }\r\n        function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n    }\r\n\r\n    function __asyncDelegator(o) {\r\n        var i, p;\r\n        return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n        function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n    }\r\n\r\n    function __asyncValues(o) {\r\n        if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n        var m = o[Symbol.asyncIterator], i;\r\n        return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n        function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n        function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n    }\r\n\r\n    function __makeTemplateObject(cooked, raw) {\r\n        if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n        return cooked;\r\n    };\r\n\r\n    function __importStar(mod) {\r\n        if (mod && mod.__esModule) return mod;\r\n        var result = {};\r\n        if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n        result.default = mod;\r\n        return result;\r\n    }\r\n\r\n    function __importDefault(mod) {\r\n        return (mod && mod.__esModule) ? mod : { default: mod };\r\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    (function (AjfFieldType) {\n        AjfFieldType[AjfFieldType[\"String\"] = 0] = \"String\";\n        AjfFieldType[AjfFieldType[\"Text\"] = 1] = \"Text\";\n        AjfFieldType[AjfFieldType[\"Number\"] = 2] = \"Number\";\n        AjfFieldType[AjfFieldType[\"Boolean\"] = 3] = \"Boolean\";\n        AjfFieldType[AjfFieldType[\"SingleChoice\"] = 4] = \"SingleChoice\";\n        AjfFieldType[AjfFieldType[\"MultipleChoice\"] = 5] = \"MultipleChoice\";\n        AjfFieldType[AjfFieldType[\"Formula\"] = 6] = \"Formula\";\n        AjfFieldType[AjfFieldType[\"Empty\"] = 7] = \"Empty\";\n        AjfFieldType[AjfFieldType[\"Date\"] = 8] = \"Date\";\n        AjfFieldType[AjfFieldType[\"DateInput\"] = 9] = \"DateInput\";\n        AjfFieldType[AjfFieldType[\"Time\"] = 10] = \"Time\";\n        AjfFieldType[AjfFieldType[\"Table\"] = 11] = \"Table\";\n        AjfFieldType[AjfFieldType[\"Geolocation\"] = 12] = \"Geolocation\";\n        AjfFieldType[AjfFieldType[\"Barcode\"] = 13] = \"Barcode\";\n        AjfFieldType[AjfFieldType[\"LENGTH\"] = 14] = \"LENGTH\";\n    })(exports.AjfFieldType || (exports.AjfFieldType = {}));\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    (function (AjfNodeType) {\n        AjfNodeType[AjfNodeType[\"AjfField\"] = 0] = \"AjfField\";\n        AjfNodeType[AjfNodeType[\"AjfFieldNodeLink\"] = 1] = \"AjfFieldNodeLink\";\n        AjfNodeType[AjfNodeType[\"AjfNodeGroup\"] = 2] = \"AjfNodeGroup\";\n        AjfNodeType[AjfNodeType[\"AjfSlide\"] = 3] = \"AjfSlide\";\n        AjfNodeType[AjfNodeType[\"AjfRepeatingSlide\"] = 4] = \"AjfRepeatingSlide\";\n        AjfNodeType[AjfNodeType[\"LENGTH\"] = 5] = \"LENGTH\";\n    })(exports.AjfNodeType || (exports.AjfNodeType = {}));\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function initChoicesOrigin(origin) {\n        if (origin.type === 'fixed') {\n            return Promise.resolve();\n        }\n        if (origin.type === 'function') {\n            var fo = origin;\n            fo.choices = fo.generator();\n            return Promise.resolve();\n        }\n        if (origin.type === 'promise') {\n            var po_1 = origin;\n            return po_1.generator.then(function (choices) { return po_1.choices = choices; }).then();\n        }\n        if (origin.type === 'observable') {\n            var obso_1 = origin;\n            if (obso_1.generator != null) {\n                obso_1.choices = [];\n                return new Promise(function (res) {\n                    obso_1.generator.subscribe(function (c) { return obso_1.choices.push(c); }, function () { }, function () { return res(); });\n                });\n            }\n        }\n        if (origin.type === 'observableArray') {\n            var aoo_1 = origin;\n            if (aoo_1.generator != null) {\n                aoo_1.choices = [];\n                return new Promise(function (res) {\n                    aoo_1.generator.subscribe(function (choices) {\n                        aoo_1.choices = choices;\n                        res();\n                    });\n                });\n            }\n        }\n        return Promise.resolve();\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isFieldWithChoices(field) {\n        return field.fieldType === exports.AjfFieldType.SingleChoice ||\n            field.fieldType === exports.AjfFieldType.MultipleChoice;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isField(node) {\n        return node != null && node.nodeType === exports.AjfNodeType.AjfField;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isFieldInstance(nodeInstance) {\n        return nodeInstance != null && nodeInstance.node != null && isField(nodeInstance.node);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isFieldWithChoicesInstance(nodeInstance) {\n        return nodeInstance != null && isFieldInstance(nodeInstance) &&\n            isFieldWithChoices(nodeInstance.node);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isTableField(field) {\n        return field.fieldType === exports.AjfFieldType.Table;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isTableFieldInstance(nodeInstance) {\n        return nodeInstance != null && isFieldInstance(nodeInstance) &&\n            isTableField(nodeInstance.node);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateConditionalBranches(instance, context) {\n        var conditionalBranches = instance.conditionalBranches;\n        if (conditionalBranches != null) {\n            var oldBranch = instance.verifiedBranch;\n            var idx = 0;\n            var found = false;\n            while (idx < conditionalBranches.length && !found) {\n                var verified = models.evaluateExpression(conditionalBranches[idx].condition, context);\n                if (verified) {\n                    found = true;\n                    if (idx !== instance.verifiedBranch) {\n                        instance.verifiedBranch = idx;\n                    }\n                }\n                idx++;\n            }\n            if (oldBranch !== instance.verifiedBranch) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateVisibility(instance, context, branchVisibility) {\n        if (branchVisibility === void 0) { branchVisibility = true; }\n        if (instance.visibility == null) {\n            instance.visible = false;\n            return false;\n        }\n        var visibility = instance.visibility;\n        var oldVisibility = instance.visible;\n        var newVisibility = branchVisibility && models.evaluateExpression(visibility.condition, context);\n        if (newVisibility !== instance.visible) {\n            instance.visible = newVisibility;\n        }\n        return oldVisibility !== newVisibility;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function nodeInstanceSuffix(instance) {\n        if (instance.prefix == null || instance.prefix.length == 0) {\n            return '';\n        }\n        return \"__\" + instance.prefix.join('__');\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function nodeInstanceCompleteName(instance) {\n        return instance != null && instance.node != null ?\n            \"\" + instance.node.name + nodeInstanceSuffix(instance) :\n            '';\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    /**\n     * update the relative instance value and the context\n     * if !editable evaluate expression once one time and flag changed is false\n     */\n    function updateFormula(instance, context) {\n        var formula = instance.formula;\n        var editable = instance.node.editable;\n        if (formula != null && instance.visible && (!editable || (editable && instance.value == null))) {\n            var newValue = models.evaluateExpression(formula.formula, context);\n            var oldValue = instance.value;\n            if (newValue !== instance.value) {\n                instance.value = newValue;\n                context[nodeInstanceCompleteName(instance)] = instance.value;\n                context.$value = instance.value;\n            }\n            return { changed: newValue !== oldValue, value: newValue };\n        }\n        return { changed: false, value: instance.value };\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateNextSlideCondition(instance, context) {\n        if (instance.nextSlideCondition != null) {\n            return models.evaluateExpression(instance.nextSlideCondition.condition, context);\n        }\n        return false;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateValidation(validation, context, forceFormula) {\n        return {\n            result: models.evaluateExpression(validation.condition, context, forceFormula),\n            error: validation.errorMessage,\n            clientValidation: validation.clientValidation,\n        };\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateValidationConditions(validation, context) {\n        var res = [];\n        validation.conditions.forEach(function (cond) {\n            res.push(evaluateValidation(cond, context));\n        });\n        return res;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateValidationMaxDigits(validation, value) {\n        if (validation.maxDigits == null) {\n            return null;\n        }\n        var ctx = { '$value': value };\n        if (typeof validation.maxDigits === 'number') {\n            return {\n                result: models.evaluateExpression(\"$value.toString().length <= \" + validation.maxDigits, ctx),\n                error: \"Digits count must be <= \" + validation.maxDigits,\n                clientValidation: false\n            };\n        }\n        return evaluateValidation(validation.maxDigits, ctx);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateValidationMaxValue(validation, value) {\n        if (validation.maxValue == null) {\n            return null;\n        }\n        var ctx = { '$value': value };\n        if (typeof validation.maxValue === 'number') {\n            return {\n                result: models.evaluateExpression(\"$value.length <= \" + validation.maxValue, ctx),\n                error: \"Value must be <= \" + validation.maxValue,\n                clientValidation: false\n            };\n        }\n        return evaluateValidation(validation.maxValue, { '$value': value });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateValidationMinDigits(validation, value) {\n        if (validation.minDigits == null) {\n            return null;\n        }\n        var ctx = { '$value': value };\n        if (typeof validation.minDigits === 'number') {\n            return {\n                result: models.evaluateExpression(\"$value.toString().length >= \" + validation.minDigits, ctx),\n                error: \"Digits count must be >= \" + validation.minDigits,\n                clientValidation: false\n            };\n        }\n        return evaluateValidation(validation.minDigits, ctx);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateValidationMinValue(validation, value) {\n        if (validation.minValue == null) {\n            return null;\n        }\n        var ctx = { '$value': value };\n        if (typeof validation.minValue === 'number') {\n            return {\n                result: models.evaluateExpression(\"$value.length <= \" + validation.minValue, ctx),\n                error: \"Value must be >= \" + validation.minValue,\n                clientValidation: false\n            };\n        }\n        return evaluateValidation(validation.minValue, { '$value': value });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateValidationNotEmpty(validation, value) {\n        if (validation.notEmpty == null) {\n            return null;\n        }\n        var ctx = { '$value': value };\n        if (typeof validation.notEmpty === 'boolean') {\n            return {\n                result: models.evaluateExpression(\"($value != null) === \" + validation.notEmpty, ctx),\n                error: 'Value must not be empty',\n                clientValidation: false\n            };\n        }\n        return evaluateValidation(validation.notEmpty, ctx);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateValidationGroup(validation, value, context) {\n        var res = [];\n        var ctx = utils.deepCopy(context);\n        ctx['$value'] = value;\n        res = evaluateValidationConditions(validation, ctx);\n        if (validation.maxValue) {\n            var maxValue = evaluateValidationMaxValue(validation, value);\n            if (maxValue != null) {\n                res.push(maxValue);\n            }\n        }\n        if (validation.minValue) {\n            var minValue = evaluateValidationMinValue(validation, value);\n            if (minValue != null) {\n                res.push(minValue);\n            }\n        }\n        if (validation.notEmpty) {\n            var notEmpty = evaluateValidationNotEmpty(validation, value);\n            if (notEmpty != null) {\n                res.push(notEmpty);\n            }\n        }\n        if (validation.maxDigits) {\n            var maxDigits = evaluateValidationMaxDigits(validation, value);\n            if (maxDigits != null) {\n                res.push(maxDigits);\n            }\n        }\n        if (validation.minDigits) {\n            var minDigits = evaluateValidationMinDigits(validation, value);\n            if (minDigits != null) {\n                res.push(minDigits);\n            }\n        }\n        return res;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateValidation(instance, context, supplementaryInformations) {\n        var validation = instance.validation;\n        if (validation == null) {\n            instance.valid = true;\n            return;\n        }\n        if (supplementaryInformations) {\n            Object.keys(supplementaryInformations).forEach(function (key) {\n                context[\"__supplementary__\" + key + \"__\"] = supplementaryInformations[key];\n            });\n        }\n        var completeName = nodeInstanceCompleteName(instance);\n        if (context[completeName] != null && validation && validation.forceValue) {\n            instance.value = models.evaluateExpression(validation.forceValue.condition, context);\n            context[completeName] = instance.value;\n            context.$value = instance.value;\n        }\n        instance.validationResults = evaluateValidationGroup(validation, context[completeName], context);\n        instance.valid = instance.validationResults.reduce(function (prev, x) { return prev && x.result; }, true);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateWarning(warning, context, forceFormula) {\n        return {\n            result: models.evaluateExpression(warning.condition, context, forceFormula),\n            warning: warning.warningMessage,\n        };\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateWarningConditions(warning, context) {\n        return warning.conditions.map(function (cond) { return evaluateWarning(cond, context); });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function evaluateWarningGroup(warning, context) {\n        return evaluateWarningConditions(warning, context);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateWarning(instance, context) {\n        var warning = instance.warning;\n        if (warning == null) {\n            return;\n        }\n        var completeName = nodeInstanceCompleteName(instance);\n        if (context[completeName] != null && warning) {\n            instance.warningResults = evaluateWarningGroup(warning, context);\n        }\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateFieldInstanceState(instance, context, branchVisibility) {\n        if (branchVisibility === void 0) { branchVisibility = true; }\n        updateVisibility(instance, context, branchVisibility);\n        updateConditionalBranches(instance, context);\n        updateFormula(instance, context);\n        updateValidation(instance, context);\n        updateWarning(instance, context);\n        updateNextSlideCondition(instance, context);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateFilteredChoices(instance, context) {\n        if (instance.choicesFilter != null) {\n            instance.filteredChoices = instance.node.choicesOrigin.choices.filter(function (c) {\n                context.$choice = c;\n                context.$choiceValue = c.value;\n                return models.evaluateExpression(instance.choicesFilter.formula, context);\n            });\n        }\n        else {\n            instance.filteredChoices = instance.node.choicesOrigin.choices;\n        }\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateTriggerConditions(instance, context) {\n        if (instance.triggerConditions == null) {\n            return false;\n        }\n        var completeName = nodeInstanceCompleteName(instance);\n        if (instance.firstTriggerConditionDone[completeName]) {\n            return false;\n        }\n        var found = false;\n        var conditionsNum = instance.triggerConditions.length;\n        for (var i = 0; i < conditionsNum; i++) {\n            if (models.evaluateExpression(instance.triggerConditions[i].condition, context)) {\n                found = true;\n                break;\n            }\n        }\n        instance.firstTriggerConditionDone[completeName] = found;\n        return found;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createNode(node) {\n        var conditionalBranches = node.conditionalBranches != null && node.conditionalBranches.length > 0 ?\n            node.conditionalBranches :\n            [models.alwaysCondition()];\n        return __assign(__assign({}, node), { parentNode: node.parentNode != null ? node.parentNode : 0, label: node.label || '', visibility: node.visibility || models.alwaysCondition(), conditionalBranches: conditionalBranches });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createField(field) {\n        var node = createNode(__assign(__assign({}, field), { nodeType: exports.AjfNodeType.AjfField }));\n        var editable = field.editable != null ?\n            field.editable :\n            field.fieldType !== exports.AjfFieldType.Formula && field.fieldType !== exports.AjfFieldType.Table;\n        return __assign(__assign(__assign({}, node), field), { nodeType: exports.AjfNodeType.AjfField, editable: editable, defaultValue: field.defaultValue != null ? field.defaultValue : null, size: field.size || 'normal' });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var componentsMap = {};\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isCustomFieldWithChoices(field) {\n        return field.fieldType > 100 && componentsMap[field.fieldType] != null &&\n            componentsMap[field.fieldType].isFieldWithChoice === true;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isSlidesNode(node) {\n        return node != null &&\n            (node.nodeType === exports.AjfNodeType.AjfRepeatingSlide || node.nodeType === exports.AjfNodeType.AjfSlide);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isContainerNode(node) {\n        return node != null && (node.nodeType === exports.AjfNodeType.AjfNodeGroup || isSlidesNode(node));\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isContainerNodeInstance(nodeInstance) {\n        return nodeInstance != null && nodeInstance.node != null && isContainerNode(nodeInstance.node);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function flattenNodesInstances(nodes, includeGroups) {\n        if (includeGroups === void 0) { includeGroups = false; }\n        var flatNodes = [];\n        nodes.forEach(function (nodeInstance) {\n            if (isFieldInstance(nodeInstance)) {\n                flatNodes.push(nodeInstance);\n            }\n            if (isContainerNodeInstance(nodeInstance)) {\n                if (includeGroups) {\n                    flatNodes.push(nodeInstance);\n                }\n                flatNodes = flatNodes.concat(flattenNodesInstances(nodeInstance.nodes, includeGroups));\n            }\n        });\n        return flatNodes;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isSlidesInstance(nodeInstance) {\n        return nodeInstance != null && nodeInstance.node != null && isSlidesNode(nodeInstance.node);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function flattenNodesInstancesTree(nodes) {\n        var flatTree = [];\n        nodes.forEach(function (nodeInstance) {\n            if (isSlidesInstance(nodeInstance)) {\n                var ni = nodeInstance;\n                flatTree.push(ni);\n                ni.flatNodes = flattenNodesInstances(ni.nodes);\n            }\n        });\n        return flatTree;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isNodeGroup(node) {\n        return node != null && node.nodeType === exports.AjfNodeType.AjfNodeGroup;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isNodeGroupInstance(nodeInstance) {\n        return nodeInstance != null && nodeInstance.node != null && isNodeGroup(nodeInstance.node);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isSlideNode(node) {\n        return node != null && node.nodeType === exports.AjfNodeType.AjfSlide;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isSlideInstance(nodeInstance) {\n        return nodeInstance != null && nodeInstance.node != null && isSlideNode(nodeInstance.node);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createNodeInstance(instance) {\n        return {\n            node: instance.node,\n            prefix: instance.prefix ? __spread(instance.prefix) : [],\n            visible: instance.visible != null ? instance.visible : true,\n            conditionalBranches: [],\n            updatedEvt: new core.EventEmitter()\n        };\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createFieldInstance(instance, context) {\n        var nodeInstance = createNodeInstance(instance);\n        var value = null;\n        if (nodeInstance.node != null && context != null) {\n            var completeName = nodeInstanceCompleteName(nodeInstance);\n            if (context[nodeInstance.node.name] != null) {\n                value = context[nodeInstance.node.name];\n            }\n            else if (context[completeName] != null) {\n                value = context[completeName];\n            }\n        }\n        return __assign(__assign({}, nodeInstance), { node: instance.node, value: value, valid: false, defaultValue: instance.defaultValue != null ? instance.defaultValue : null, validationResults: instance.validationResults || [], warningResults: instance.warningResults || [], warningTrigger: new core.EventEmitter() });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createFieldWithChoicesInstance(instance, context) {\n        var fieldInstance = createFieldInstance(instance, context);\n        return __assign(__assign({}, fieldInstance), { node: instance.node, filteredChoices: __spread(instance.node.choices), firstTriggerConditionDone: {}, selectionTrigger: new core.EventEmitter() });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    /**\n     * to mantain retrocompatibility with old string type convert string to AjfTableCell\n     * check  node.rows: (string|AjfTableCell)[][];\n     * if elem of map is string convert in to AjfTableCell object\n     */\n    function normalizeRows(node) {\n        node.rows.forEach(function (row, rowIdx) {\n            row.forEach(function (elem, elemIdx) {\n                if (typeof elem === 'string') {\n                    node.rows[rowIdx][elemIdx] = { formula: elem, editable: node.editable };\n                }\n            });\n        });\n    }\n    function createTableFieldInstance(instance, context) {\n        normalizeRows(instance.node);\n        var fieldInstance = createFieldInstance(instance, context);\n        return __assign(__assign({}, fieldInstance), { node: instance.node, context: context, hideEmptyRows: instance.hideEmptyRows || false, controls: [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createNodeGroupInstance(instance) {\n        var nodeInstance = createNodeInstance(instance);\n        return __assign(__assign({}, nodeInstance), { node: instance.node, formulaReps: instance.formulaReps, reps: 0, nodes: [], flatNodes: [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createSlideInstance(instance) {\n        var nodeInstance = createNodeInstance(instance);\n        return __assign(__assign({}, nodeInstance), { node: instance.node, nodes: [], slideNodes: [], flatNodes: [], valid: false, position: 0 });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createRepeatingSlideInstance(instance) {\n        var slideInstance = createSlideInstance(instance);\n        return __assign(__assign({}, slideInstance), { node: instance.node, slideNodes: [], formulaReps: instance.formulaReps, reps: 0, nodes: [], flatNodes: [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createValidationGroup(group) {\n        return __assign(__assign({}, group), { conditions: group.conditions || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createWarningGroup(group) {\n        return __assign(__assign({}, group), { conditions: group.conditions || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isRepeatingContainerNode(node) {\n        return node != null &&\n            (node.nodeType === exports.AjfNodeType.AjfNodeGroup ||\n                node.nodeType === exports.AjfNodeType.AjfRepeatingSlide);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getAncestorRepeatingNodes(allNodes, node) {\n        var nodeGroups = [];\n        var curParent = node.parent;\n        while (curParent != null) {\n            var curNode = allNodes.map(function (n) { return n.node || n; })\n                .find(function (n) { return n.id == curParent; });\n            if (curNode) {\n                if (isRepeatingContainerNode(curNode)) {\n                    nodeGroups.push(curNode);\n                }\n            }\n            curParent = curNode != null ? curNode.parent : null;\n        }\n        return nodeGroups;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getAncestorRepeatingNodesNames(allNodes, node) {\n        var names = {};\n        var nodeGroups = getAncestorRepeatingNodes(allNodes, node);\n        nodeGroups.forEach(function (n, idx) { return (n.nodes || []).forEach(function (sn) {\n            if (isField(sn)) {\n                names[sn.name] = idx;\n            }\n        }); });\n        return names;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getInstanceCondition(condition, ancestorsNames, prefix) {\n        var oldCondition = condition.condition;\n        var newCondition = models.normalizeExpression(oldCondition, ancestorsNames, prefix);\n        if (newCondition === oldCondition) {\n            return condition;\n        }\n        return { condition: newCondition };\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getInstanceConditions(conditions, ancestorsNames, prefix) {\n        var changed = false;\n        var newConditions = conditions.map(function (condition) {\n            var newCondition = getInstanceCondition(condition, ancestorsNames, prefix);\n            if (newCondition !== condition) {\n                changed = true;\n            }\n            return newCondition;\n        });\n        return changed ? newConditions : conditions;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getInstanceFormula(formula, ancestorsNames, prefix) {\n        var oldFormula = formula.formula;\n        var newFormula = models.normalizeExpression(oldFormula, ancestorsNames, prefix);\n        if (newFormula === oldFormula) {\n            return formula;\n        }\n        return { formula: newFormula };\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createValidation(validation) {\n        return __assign(__assign({}, validation), { clientValidation: validation.clientValidation || false, errorMessage: validation.errorMessage || 'Undefined Error' });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getInstanceValidation(validation, ancestorsNames, prefix) {\n        var oldValidation = validation.condition;\n        var newValidation = models.normalizeExpression(oldValidation, ancestorsNames, prefix);\n        if (newValidation === oldValidation) {\n            return validation;\n        }\n        return createValidation({ condition: newValidation });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getInstanceValidations(validations, ancestorsNames, prefix) {\n        var changed = false;\n        var newValidations = validations.map(function (validation) {\n            var newValidation = getInstanceValidation(validation, ancestorsNames, prefix);\n            if (newValidation !== validation) {\n                changed = true;\n            }\n            return newValidation;\n        });\n        return changed ? newValidations : validations;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createWarning(warning) {\n        return __assign(__assign({}, warning), { warningMessage: warning.warningMessage || 'Undefined Warning' });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getInstanceWarning(warning, ancestorsNames, prefix) {\n        var oldWarning = warning.condition;\n        var newWarning = models.normalizeExpression(oldWarning, ancestorsNames, prefix);\n        if (newWarning === oldWarning) {\n            return warning;\n        }\n        return createWarning({ condition: newWarning });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getInstanceWarnings(warnings, ancestorsNames, prefix) {\n        var changed = false;\n        var newWarnings = warnings.map(function (warning) {\n            var newWarning = getInstanceWarning(warning, ancestorsNames, prefix);\n            if (newWarning !== warning) {\n                changed = true;\n            }\n            return newWarning;\n        });\n        return changed ? newWarnings : warnings;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isRepeatingSlide(node) {\n        return node != null && node.nodeType === exports.AjfNodeType.AjfRepeatingSlide;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isRepeatingSlideInstance(nodeInstance) {\n        return nodeInstance != null && nodeInstance.node != null && isSlidesInstance(nodeInstance) &&\n            isRepeatingSlide(nodeInstance.node);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function nodeToNodeInstance(allNodes, node, prefix, context) {\n        var instance = null;\n        var nodeType = node.nodeType;\n        switch (nodeType) {\n            case exports.AjfNodeType.AjfField:\n                var field = node;\n                if (field.fieldType > 100) {\n                    if (componentsMap[field.fieldType] != null &&\n                        componentsMap[field.fieldType].createInstance != null) {\n                        instance = componentsMap[field.fieldType].createInstance({ node: node, prefix: prefix }, context);\n                    }\n                    else {\n                        instance = createFieldInstance({ node: node, prefix: prefix }, context);\n                    }\n                }\n                else {\n                    switch (field.fieldType) {\n                        case exports.AjfFieldType.SingleChoice:\n                        case exports.AjfFieldType.MultipleChoice:\n                            instance = createFieldWithChoicesInstance({ node: node, prefix: prefix }, context);\n                            break;\n                        case exports.AjfFieldType.Table:\n                            instance = createTableFieldInstance({ node: node, prefix: prefix }, context);\n                            break;\n                        default:\n                            instance = createFieldInstance({ node: node, prefix: prefix }, context);\n                            break;\n                    }\n                }\n                break;\n            case exports.AjfNodeType.AjfNodeGroup:\n                instance = createNodeGroupInstance({ node: node, prefix: prefix });\n                break;\n            case exports.AjfNodeType.AjfRepeatingSlide:\n                instance = createRepeatingSlideInstance({ node: node, prefix: prefix });\n                break;\n            case exports.AjfNodeType.AjfSlide:\n                instance = createSlideInstance({ node: node, prefix: prefix });\n                break;\n        }\n        if (instance != null) {\n            var hasPrefix = prefix != null && prefix.length > 0;\n            if (hasPrefix) {\n                var ancestorsNames = getAncestorRepeatingNodesNames(allNodes, node);\n                if (node.visibility != null) {\n                    var oldVisibility = node.visibility.condition;\n                    var newVisibility = models.normalizeExpression(oldVisibility, ancestorsNames, prefix);\n                    instance.visibility = newVisibility !== oldVisibility ?\n                        models.createCondition({ condition: newVisibility }) :\n                        node.visibility;\n                }\n                var conditionalBranches = instance.node.conditionalBranches != null &&\n                    instance.node.conditionalBranches.length > 0 ?\n                    instance.node.conditionalBranches :\n                    [models.alwaysCondition()];\n                instance.conditionalBranches =\n                    getInstanceConditions(conditionalBranches, ancestorsNames, prefix);\n                if (nodeType === exports.AjfNodeType.AjfNodeGroup || nodeType === exports.AjfNodeType.AjfRepeatingSlide) {\n                    var ngInstance = instance;\n                    var formulaReps = ngInstance.node.formulaReps;\n                    if (formulaReps != null) {\n                        var oldFormula = formulaReps.formula;\n                        var newFormula = models.normalizeExpression(oldFormula, ancestorsNames, prefix);\n                        ngInstance.formulaReps =\n                            newFormula !== oldFormula ? models.createFormula({ formula: newFormula }) : formulaReps;\n                    }\n                }\n                else if (nodeType === exports.AjfNodeType.AjfField) {\n                    var fInstance = instance;\n                    var fNode = fInstance.node;\n                    if (fNode.formula) {\n                        fInstance.formula = getInstanceFormula(fNode.formula, ancestorsNames, prefix);\n                    }\n                    if (fNode.validation != null) {\n                        var newConditions = getInstanceValidations(fNode.validation.conditions, ancestorsNames, prefix);\n                        if (newConditions !== fNode.validation.conditions) {\n                            fInstance.validation = createValidationGroup(fNode.validation);\n                            fInstance.validation.conditions = newConditions;\n                        }\n                        else {\n                            fInstance.validation = fNode.validation;\n                        }\n                    }\n                    if (fNode.warning != null) {\n                        var newWarnings = getInstanceWarnings(fNode.warning.conditions, ancestorsNames, prefix);\n                        if (newWarnings !== fNode.warning.conditions) {\n                            fInstance.warning = createWarningGroup(fNode.warning);\n                            fInstance.warning.conditions = newWarnings;\n                        }\n                        else {\n                            fInstance.warning = fNode.warning;\n                        }\n                    }\n                    if (fNode.nextSlideCondition != null) {\n                        fInstance.nextSlideCondition =\n                            getInstanceCondition(fNode.nextSlideCondition, ancestorsNames, prefix);\n                    }\n                    if (isFieldWithChoices(fNode)) {\n                        var fwcInstance = instance;\n                        var fwcNode = fwcInstance.node;\n                        if (fwcNode.choicesFilter != null) {\n                            fwcInstance.choicesFilter =\n                                getInstanceFormula(fwcNode.choicesFilter, ancestorsNames, prefix);\n                        }\n                        if (fwcNode.triggerConditions != null) {\n                            fwcInstance.triggerConditions =\n                                getInstanceConditions(fwcNode.triggerConditions, ancestorsNames, prefix);\n                        }\n                    }\n                }\n            }\n            else {\n                instance.visibility = instance.node.visibility;\n                var conditionalBranches = instance.node.conditionalBranches != null &&\n                    instance.node.conditionalBranches.length > 0 ?\n                    instance.node.conditionalBranches :\n                    [models.alwaysCondition()];\n                instance.conditionalBranches = conditionalBranches;\n                if (isNodeGroupInstance(instance) || isRepeatingSlideInstance(instance)) {\n                    var rgInstance = instance;\n                    rgInstance.formulaReps = rgInstance.node.formulaReps;\n                }\n                else if (isFieldInstance(instance)) {\n                    var fInstance = instance;\n                    fInstance.validation = fInstance.node.validation;\n                    fInstance.warning = fInstance.node.warning;\n                    fInstance.nextSlideCondition = fInstance.node.nextSlideCondition;\n                    if (isFieldWithChoicesInstance(instance)) {\n                        var fwcInstance = instance;\n                        fwcInstance.choicesFilter = fwcInstance.node.choicesFilter;\n                        fwcInstance.triggerConditions = fwcInstance.node.triggerConditions;\n                    }\n                    fInstance.formula = fInstance.node.formula;\n                }\n            }\n        }\n        return instance;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function flattenNodes(nodes) {\n        var flatNodes = [];\n        nodes.forEach(function (node) {\n            flatNodes.push(node);\n            if (isContainerNode(node)) {\n                flatNodes = flatNodes.concat(flattenNodes(node.nodes));\n            }\n        });\n        return flatNodes;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function orderedNodes(nodes, parent) {\n        var newNodes = [];\n        nodes\n            .filter(function (n) { return parent != null ? n.parent == parent : n.parent == null || n.parent === 0; })\n            .sort(function (n1, n2) { return n1.parentNode - n2.parentNode; })\n            .forEach(function (n) {\n            newNodes.push(n);\n            newNodes = newNodes.concat(orderedNodes(nodes, n.id));\n        });\n        return newNodes;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function updateRepsNum(instance, context) {\n        var oldReps = instance.reps || 0;\n        context = context || {};\n        if (instance.node.formulaReps == null) {\n            var ctxReps = context[nodeInstanceCompleteName(instance)];\n            if (ctxReps != null) {\n                instance.reps = ctxReps;\n            }\n            else if (oldReps == 0) {\n                instance.reps = 1;\n            }\n        }\n        else {\n            var newReps = models.evaluateExpression(instance.node.formulaReps.formula, context);\n            if (newReps !== oldReps) {\n                instance.reps = newReps;\n            }\n        }\n        instance.canAdd = instance.node.maxReps === 0 || instance.reps < instance.node.maxReps;\n        instance.canRemove = instance.node.minReps === 0 || instance.reps > instance.node.minReps;\n        return oldReps;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function validSlide(slide, idx) {\n        if (idx >= slide.slideNodes.length) {\n            return true;\n        }\n        return slide.slideNodes[idx]\n            .map(function (n) {\n            if (n.visible && Object.keys(n).indexOf('valid') > -1) {\n                return n.valid;\n            }\n            return true;\n        })\n            .reduce(function (v1, v2) { return v1 && v2; }, true);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfValidationService = /** @class */ (function () {\n        function AjfValidationService() {\n            this._baseUtilFunctions = [\n                \"/**\\n        * count the number of digit contained on x.\\n        * @param  x the value used for digit count\\n        * @return the count of the digit\\n      */\\n    var digitCount = function(x) { return x.toString().length; }\",\n                \"/**\\n        * count the number of decimal contained on x.\\n        * @param  x the value used for decimal count\\n        * @return the count of the decimal\\n      */\\n    var decimalCount = function(x) {\\n      return (parseFloat(x).toString().split('.')[1] || []).length;\\n    }\",\n                \"/**\\n        * check if x is integer\\n        * @param  x the value used for check\\n        * @return true if x is a number\\n      */\\n    var isInt = function(x) { return !/[,.]/.test(x); }\",\n                \"/**\\n        * check if x is not empity\\n        * @param  x the value used for check\\n        * @return true if x defined and not null and the number of digit is > 0\\n      */\\n    var notEmpty = function (x) {\\n      return (typeof x !== 'undefined' && x !== null ? x.toString().length > 0 : false);\\n    }\",\n                \"/**\\n        * check if x is contained on array\\n        * @param  x the value used for check\\n        * @return the position of x on array or if array === x\\n      */\\n    var valueInChoice = function(array, x) { return array.indexOf(x) > -1 || array === x; }\",\n                \"var scanGroupField = function(reps, acc, callback) {\\n        for (var i = 0; i < reps; i++) {\\n            acc = callback(acc, i);\\n        }\\n        return acc;\\n    }\",\n                \"/**\\n        * sum the value contained on array\\n        * @param  x the array\\n        * @return the sum\\n      */\\n    var sum = function(array) {return array.reduce(function(a, b){ return a + b; }, 0); }\",\n                \"var dateOperations = function(dString, period, operation, v) {\\n        fmt = 'mm/dd/yyyy';\\n        var d = (typeof dString !== 'undefined') ? dateUtils.parse(dString) : new Date();\\n        if (operation == 'remove') {\\n          v = -v;\\n        }\\n        var dateOp;\\n        switch (period) {\\n          case 'day':\\n            dateOp = dateUtils.addDays;\\n            break;\\n          case 'month':\\n            dateOp = dateUtils.addMonths;\\n            break;\\n          case 'year':\\n            dateOp = dateUtils.addYears;\\n            break;\\n          default:\\n            return -1;\\n        }\\n        return dateUtils.format(dateOp(d, v), fmt);\\n      }\",\n                \"/**\\n        * round the num\\n        * @param  num the value to round\\n        * @param  digits how many digit\\n        * @return num rounded\\n      */\\n      var round = function(num, digits) {\\n        digits = digits || 0;\\n        var f = 0;\\n        try { f = parseFloat(num); } catch (e) { }\\n        var m = Math.pow(10, digits);\\n        return Math.round(f * m) / m;\\n      }\",\n                \"/**\\n        * extract the property of the source object with property != null\\n        * @param  source array of object wich contains property\\n        * @param  property the property on wich we want filter\\n        * @return array of dates\\n      */\\n      var extractArray = function(source, property, property2) {\\n        source = (source || []).slice(0);\\n        var l = source.length;\\n        var res = [];\\n        for (var i = 0; i < l ; i++) {\\n          if (source[i][property] != null && source[i][property2] != null) {\\n            res.push(source[i][property] + source[i][property2]);\\n          }\\n          else if (source[i][property] != null) {\\n            res.push(source[i][property]);\\n          }\\n        }\\n        return res;\\n      }\",\n                \"/**\\n        * extract the property of the source object with property != null\\n        * @param  source array of object wich contains property\\n        * @param  propertues string array the properties to sum\\n        * @return the sum\\n      */\\n      var extractSum = function(source, properties) {\\n        var sum = 0;\\n        properties = (properties || []).slice(0);\\n        var l = properties.length;\\n\\n        for (var i = 0; i < l ; i++) {\\n          var array = extractArray(source, properties[i]);\\n          var leng = array.length;\\n          for(var j = 0; j < leng; i++) {\\n            sum += array[j];\\n          }\\n        }\\n        return sum;\\n      }\",\n                \"/**\\n        * extract the array of sum for each week != null\\n        * @param  source array of object wich contains property\\n        * @param  propertues string array the properties to sum\\n        * @return the sum\\n      */\\n      var extractArraySum = function(source, properties) {\\n        var arrays = [];\\n        properties = (properties || []).slice(0);\\n\\n        for (var propI = 0; propI < properties.length ; propI++) {\\n          var array = extractArray(source, properties[propI]);\\n          arrays.push(array);\\n        }\\n\\n        var res = [];\\n        for (var weekI = 0; weekI < array.length; weekI ++ ) {\\n          var sum = 0;\\n          for (var propI = 0; propI < properties.length ; propI++) {\\n            sum = sum + arrays[propI][weekI]\\n          }\\n          res.push(sum);\\n        }\\n        return res;\\n      }\",\n                \"/**\\n        * draw a threshold line on chart related to the property\\n        * @param  source array of object wich contains property\\n        * @param  property the property on wich we want filter\\n        * @return array of dates\\n      */\\n      var drawThreshold = function(source, property, threshold) {\\n        source = (source || []).slice(0);\\n        var l = source.length;\\n        var res = [];\\n        for (var i = 0; i < l ; i++) {\\n          if (source[i][property] != null) {\\n            res.push(threshold);\\n          }\\n        }\\n        return res;\\n      }\",\n                \"/**\\n        * extract the dates of the source object with property != null\\n        * @param  source array of object wich contains property and date_start\\n        * @param  property the property on wich we want to calculate dates\\n        * @param  format the format of the date\\n        * @return array of dates\\n      */\\n      var extractDates = function(source, property, format) {\\n        source = (source || []).slice(0);\\n        var l = source.length;\\n        var res = [];\\n        var prefix = '';\\n        for (var i = 0; i < l ; i++) {\\n          if (source[i][property] != null) {\\n            switch(format) {\\n              case \\\"WW\\\":\\n                prefix = \\\"W\\\";\\n                break;\\n              case \\\"mm\\\":\\n                prefix = \\\"M\\\";\\n                break;\\n              default:\\n                prefix = \\\"\\\";\\n            }\\n            res.push(prefix + formatDate(source[i][\\\"date_start\\\"], format));\\n          }\\n        }\\n        return res;\\n      }\",\n                \"/**\\n        * extract the last property contains in source != null\\n        * @param  source array of object wich contains property and date_start\\n        * @param  property the property to find\\n        * @return the last property != null\\n      */\\n      var lastProperty = function(source, property) {\\n        source = (source || []).slice(0);\\n        var l = source.length -1;\\n\\n        while (l >= 0 && source[l][property] == null) {\\n          l--;\\n          if (l < 0) return 0;\\n        }\\n        return l >= 0 ? source[l][property] : 0;\\n      }\",\n                \"var sumLastProperties = function(source, properties) {\\n        source = (source || []).slice(0);\\n        var sum = 0;\\n        for (var i = 0; i < properties.length; i++) {\\n          sum += lastProperty(source, properties[i]);\\n        }\\n\\n        return sum;\\n      }\",\n                \"/**\\n        * compute the trend of the property contained on the source.\\n        * @param  source array of object wich contains property\\n        * @param  property the property on wich we want to calculate the trend\\n        * @return an html icon that identifies the trend\\n      */\\n      var calculateTrendProperty = function(source, property) {\\n        source = (source || []).slice(0);\\n        var last = source.length - 1;\\n        while (source[last][property] == null) {\\n          if (last == 0) {\\n            break;\\n          }\\n          last--;\\n        }\\n        var lastLast = last - 1;\\n        if (last == 0) {\\n          lastLast = last;\\n        } else {\\n          while (source[lastLast][property] == null) {\\n            if (lastLast == 0) {\\n              lastLast = last;\\n              break;\\n            }\\n            lastLast--;\\n          }\\n        }\\n\\n        var lastProperty = source[last]?(source[last][property] || 0): 0;\\n        var lastLastProperty = source[lastLast]?(source[lastLast][property] || 0): 0;\\n\\n        if (lastProperty == lastLastProperty) {\\n          return '<p><i class=\\\"material-icons\\\" style=\\\"color:blue\\\">trending_flat</i></p>';\\n        } else if (lastProperty > lastLastProperty) {\\n          return '<p><i class=\\\"material-icons\\\" style=\\\"color:green\\\">trending_up</i></p>';\\n        } else {\\n          return '<p><i class=\\\"material-icons\\\" style=\\\"color:red\\\">trending_down</i></p>';\\n        }\\n      }\",\n                \"/**\\n        * compute the average value of the property contained on the source.\\n        * @param  source array of object wich contains property\\n        * @param  property the property on wich we want to calculate the average\\n        * @param  range the range on wich we want to calculate the average\\n        * @param  coefficent the coefficent used for calculate the threshold\\n                  if coefficent is 0 mean return the count of property > 0\\n        * @return the average value || the count of property > 0\\n      */\\n      var calculateAvgProperty = function(source, property, range, coefficient) {\\n        source = (source || []).slice(0);\\n\\n        source.pop();\\n\\n        coefficient = coefficient || 1;\\n        range = range || 12;\\n\\n        var l = source.length;\\n        var res = 0;\\n        var counter = 0;\\n        var noZero = 0;\\n\\n        if(l < range) {\\n          range = l;\\n        }\\n\\n        while (range != 0) {\\n          counter++;\\n          if (source[l - 1][property] != null) {\\n            res += source[l - 1][property];\\n\\n            if (source[l - 1][property] > 0) {\\n              noZero++;\\n            }\\n          }\\n          l--;\\n          range--;\\n        }\\n\\n        if (coefficient == 0) {\\n          return noZero;\\n        } else {\\n          var threshold = (res/counter)*coefficient || 0;\\n          return threshold;\\n        }\\n      }\",\n                \"var alert = function(source, property, threshold, fmt) {\\n        source = (source || []).slice(0);\\n        var l = source.length;\\n\\n        if ( lastProperty(source, property)  > threshold ) {\\n          return '<p><i class=\\\"material-icons\\\" style=\\\"color:red\\\">warning</i></p>';\\n          } else {\\n            return '<p></p>';\\n          }\\n      }\",\n                \"var formatNumber = function(num, fmt) {\\n        fmt = fmt || '0,0[.]0';\\n        return numeral(num).format(fmt);\\n      }\",\n                \"var formatDate = function(date, fmt) {\\n        fmt = fmt || 'mm-dd-yyyy';\\n        return dateUtils.format(date, fmt);\\n      }\",\n                \"var isoMonth = function(date, fmt) {\\n        fmt = fmt || 'mm';\\n        var du = dateUtils;\\n        return du.format(du.addDays(du.startOfMonth(date), 4),fmt)\\n      }\",\n                \"var nextCounterValue = function(counterName, firstValue) {\\n        firstValue = firstValue != null ? firstValue : 0;\\n        if (execContext['$$'+counterName] == null) {\\n          execContext['$$'+counterName] = firstValue;\\n        } else {\\n          execContext['$$'+counterName]++;\\n        }\\n        return execContext['$$'+counterName];\\n      }\",\n                \"var getCoordinate = function(source, zoom) {\\n        zoom = zoom || 6;\\n        if(source == null) {\\n          return [51.505,-0.09, zoom];\\n        } else {\\n          return [source[0], source[1], zoom];\\n        }\\n      }\"\n            ];\n            this._functions = [];\n            this._functionsStr = '';\n            this._initFunctions();\n        }\n        AjfValidationService.prototype.addFunction = function (f) {\n            this._functions.push(f);\n            this._initFunctions();\n        };\n        AjfValidationService.prototype.addFunctionHandler = function (name, fn) {\n            if (models.AjfExpressionUtils.utils[name] === undefined) {\n                models.AjfExpressionUtils.utils[name] = { fn: fn };\n            }\n        };\n        AjfValidationService.prototype._initFunctions = function () {\n            var functionsStr = this._functions.map(function (f) { return typeof f === 'string' ? f : f.toString(); }).join('; ');\n            this._functionsStr = this._baseUtilFunctions.join('; ') + \"; \" + functionsStr;\n            models.AjfExpressionUtils.UTIL_FUNCTIONS = this._functionsStr;\n        };\n        AjfValidationService.decorators = [\n            { type: core.Injectable }\n        ];\n        /** @nocollapse */\n        AjfValidationService.ctorParameters = function () { return []; };\n        return AjfValidationService;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var esprimaMod = esprima__default || esprima;\n    var tokenize = esprimaMod.tokenize;\n    var AjfFormRendererService = /** @class */ (function () {\n        function AjfFormRendererService(_) {\n            this._visibilityNodesMapUpdates = new rxjs.Subject();\n            this._repetitionNodesMapUpdates = new rxjs.Subject();\n            this._conditionalBranchNodesMapUpdates = new rxjs.Subject();\n            this._formulaNodesMapUpdates = new rxjs.Subject();\n            this._validationNodesMapUpdates = new rxjs.Subject();\n            this._warningNodesMapUpdates = new rxjs.Subject();\n            this._filteredChoicesNodesMapUpdates = new rxjs.Subject();\n            this._triggerConditionsNodesMapUpdates = new rxjs.Subject();\n            this._nextSlideConditionsNodesMapUpdates = new rxjs.Subject();\n            this._formInitEvent = new core.EventEmitter();\n            this.formInitEvent = this._formInitEvent.asObservable();\n            this._formGroup = new rxjs.BehaviorSubject(null);\n            this.formGroup = this._formGroup.asObservable();\n            this._form = new rxjs.BehaviorSubject(null);\n            this._nodesUpdates = new rxjs.Subject();\n            this._formGroupSubscription = rxjs.Subscription.EMPTY;\n            this._valueChanged = new rxjs.Subject();\n            this._nextSlideTrigger = new core.EventEmitter();\n            this.nextSlideTrigger = this._nextSlideTrigger.asObservable();\n            this._slidesNum = new rxjs.BehaviorSubject(0);\n            this.slidesNum = this._slidesNum.asObservable();\n            this._initUpdateMapStreams();\n            this._initNodesStreams();\n            this._initErrorsStreams();\n            this._initFormStreams();\n            this._updateFormValueAndValidity();\n        }\n        Object.defineProperty(AjfFormRendererService.prototype, \"nodesTree\", {\n            get: function () {\n                return this._flatNodesTree;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRendererService.prototype, \"errorPositions\", {\n            get: function () {\n                return this._errorPositions;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRendererService.prototype, \"errors\", {\n            get: function () {\n                return this._errors;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRendererService.prototype, \"currentSupplementaryInformations\", {\n            get: function () {\n                var form = this._form.getValue();\n                return form != null && form.form != null ? form.form.supplementaryInformations : null;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        AjfFormRendererService.prototype.setForm = function (form, context) {\n            if (context === void 0) { context = {}; }\n            this._initUpdateMapStreams();\n            if (form != null && Object.keys(context).length === 0 &&\n                Object.keys(form.initContext || {}).length > 0) {\n                context = form.initContext || {};\n            }\n            var currentForm = this._form.getValue();\n            if ((currentForm == null && form != null) ||\n                (currentForm != null && form !== currentForm.form)) {\n                this._form.next({ form: form, context: context });\n            }\n        };\n        AjfFormRendererService.prototype.getFormValue = function () {\n            var formGroup = this._formGroup.getValue();\n            if (formGroup == null) {\n                return {};\n            }\n            var res = utils.deepCopy(formGroup.value);\n            return res;\n        };\n        AjfFormRendererService.prototype.addGroup = function (group) {\n            var _this = this;\n            return new rxjs.Observable(function (subscriber) {\n                if (group.formulaReps != null) {\n                    subscriber.next(false);\n                    subscriber.complete();\n                    return;\n                }\n                var maxReps = group.node.maxReps;\n                if (maxReps > 0 && group.reps + 1 > maxReps) {\n                    subscriber.next(false);\n                    subscriber.complete();\n                    return;\n                }\n                var oldReps = group.reps;\n                group.reps = group.reps + 1;\n                group.canAdd = group.node.maxReps === 0 || group.reps < group.node.maxReps;\n                group.canRemove = group.node.minReps === 0 || group.reps > group.node.minReps;\n                _this._nodesUpdates.next(function (nodes) {\n                    var flatNodes = flattenNodesInstances(nodes, true);\n                    _this._adjustReps(flatNodes, group, oldReps, _this.getFormValue());\n                    subscriber.next(true);\n                    subscriber.complete();\n                    return nodes;\n                });\n            });\n        };\n        AjfFormRendererService.prototype.removeGroup = function (group) {\n            var _this = this;\n            return new rxjs.Observable(function (subscriber) {\n                if (group.formulaReps != null) {\n                    subscriber.next(false);\n                    subscriber.complete();\n                    return;\n                }\n                var minReps = group.node.minReps;\n                if (group.reps - 1 < minReps) {\n                    subscriber.next(false);\n                    subscriber.complete();\n                    return;\n                }\n                var oldReps = group.reps;\n                group.reps = group.reps - 1;\n                group.canAdd = group.node.maxReps === 0 || group.reps < group.node.maxReps;\n                group.canRemove = group.node.minReps === 0 || group.reps > group.node.minReps;\n                _this._nodesUpdates.next(function (nodes) {\n                    _this._adjustReps(nodes, group, oldReps, _this.getFormValue());\n                    subscriber.next(true);\n                    subscriber.complete();\n                    return nodes;\n                });\n            });\n        };\n        AjfFormRendererService.prototype.getControl = function (field) {\n            return this.formGroup.pipe(operators.map(function (f) {\n                var fieldName = nodeInstanceCompleteName(field);\n                return f != null && f.contains(fieldName) ? f.controls[fieldName] : null;\n            }));\n        };\n        AjfFormRendererService.prototype._initErrorsStreams = function () {\n            var _this = this;\n            this._errorPositions = this._valueChanged.pipe(operators.withLatestFrom(this._nodes, this._form), operators.filter(function (v) { return v[2] != null && v[2].form != null; }), operators.map(function (v) {\n                var nodes = v[1];\n                var form = v[2].form;\n                var currentPosition = 0;\n                var errors = [];\n                nodes.forEach(function (node) {\n                    if (node.node.nodeType === exports.AjfNodeType.AjfRepeatingSlide) {\n                        var rsNode = node;\n                        for (var i = 0; i < rsNode.reps; i++) {\n                            if (node.visible) {\n                                currentPosition++;\n                                if (i == 0) {\n                                    rsNode.position = currentPosition;\n                                }\n                                if (!validSlide(rsNode, i)) {\n                                    errors.push(currentPosition);\n                                }\n                            }\n                        }\n                    }\n                    else if (node.node.nodeType === exports.AjfNodeType.AjfSlide) {\n                        var sNode = node;\n                        if (sNode.visible) {\n                            currentPosition++;\n                            sNode.position = currentPosition;\n                            if (!sNode.valid) {\n                                errors.push(currentPosition);\n                            }\n                        }\n                    }\n                });\n                form.valid = errors.length == 0;\n                _this._slidesNum.next(currentPosition);\n                return errors;\n            }), operators.publishReplay(), operators.refCount());\n            this._errors = this._errorPositions.pipe(operators.map(function (e) { return e != null ? e.length : 0; }), operators.startWith(0), operators.publishReplay(), operators.refCount());\n        };\n        AjfFormRendererService.prototype._initUpdateMapStreams = function () {\n            this._visibilityNodesMap =\n                this._visibilityNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._repetitionNodesMap =\n                this._repetitionNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._conditionalBranchNodesMap =\n                this._conditionalBranchNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._formulaNodesMap =\n                this._formulaNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._validationNodesMap =\n                this._validationNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._warningNodesMap =\n                this._warningNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._filteredChoicesNodesMap =\n                this._filteredChoicesNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._triggerConditionsNodesMap =\n                this._triggerConditionsNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._nextSlideConditionsNodesMap =\n                this._nextSlideConditionsNodesMapUpdates\n                    .pipe(operators.scan(function (rmap, op) {\n                    return op(rmap);\n                }, {}), operators.startWith({}), operators.share());\n            this._nodesMaps = [\n                this._visibilityNodesMap, this._repetitionNodesMap, this._conditionalBranchNodesMap,\n                this._formulaNodesMap, this._validationNodesMap, this._warningNodesMap,\n                this._nextSlideConditionsNodesMap, this._filteredChoicesNodesMap,\n                this._triggerConditionsNodesMap\n            ];\n        };\n        AjfFormRendererService.prototype._initFormStreams = function () {\n            var _this = this;\n            var formObs = this._form;\n            formObs\n                .pipe(operators.map(function (_form) {\n                return _this._initFormGroupStreams(new forms.FormGroup({}));\n            }))\n                .subscribe(this._formGroup);\n            formObs\n                .pipe(operators.switchMap(function (form) {\n                if (form == null || form.form == null) {\n                    return rxjs.of(form);\n                }\n                var choicesOrigins = form.form.choicesOrigins || [];\n                if (choicesOrigins.length === 0) {\n                    return rxjs.of(form);\n                }\n                return rxjs.from(Promise.all(choicesOrigins.map(function (co) { return initChoicesOrigin(co); })))\n                    .pipe(operators.map(function () { return form; }));\n            }), operators.map(function (form) {\n                return function (_nodesInstances) {\n                    var nodes = form != null && form.form != null ?\n                        _this._orderedNodesInstancesTree(flattenNodes(form.form.nodes), form.form.nodes, undefined, [], form.context || {}) :\n                        [];\n                    var currentPosition = 0;\n                    nodes.forEach(function (node) {\n                        if (node.node.nodeType === exports.AjfNodeType.AjfRepeatingSlide) {\n                            var rsNode = node;\n                            for (var i = 0; i < rsNode.reps; i++) {\n                                if (node.visible) {\n                                    currentPosition++;\n                                    if (i == 0) {\n                                        rsNode.position = currentPosition;\n                                    }\n                                }\n                            }\n                        }\n                        else if (node.node.nodeType === exports.AjfNodeType.AjfSlide) {\n                            var sNode = node;\n                            if (sNode.visible) {\n                                currentPosition++;\n                                sNode.position = currentPosition;\n                            }\n                        }\n                    });\n                    return nodes;\n                };\n            }))\n                .subscribe(this._nodesUpdates);\n        };\n        AjfFormRendererService.prototype._initNodeInstance = function (allNodes, node, prefix, context, branchVisibility) {\n            var _this = this;\n            if (branchVisibility === void 0) { branchVisibility = true; }\n            var instance = nodeToNodeInstance(allNodes, node, prefix, context);\n            if (instance != null) {\n                var nodeType = instance.node.nodeType;\n                if (nodeType === exports.AjfNodeType.AjfNodeGroup || nodeType === exports.AjfNodeType.AjfRepeatingSlide) {\n                    this._explodeRepeatingNode(allNodes, instance, context);\n                }\n                else if (nodeType === exports.AjfNodeType.AjfSlide) {\n                    var sInstance = instance;\n                    sInstance.nodes = this._orderedNodesInstancesTree(allNodes, sInstance.node.nodes, sInstance.node.id, prefix, context);\n                }\n                updateVisibility(instance, context, branchVisibility);\n                updateConditionalBranches(instance, context);\n                if (nodeType === exports.AjfNodeType.AjfField) {\n                    var fInstance = instance;\n                    if (isCustomFieldWithChoices(fInstance.node) || isFieldWithChoices(fInstance.node)) {\n                        updateFilteredChoices(fInstance, context);\n                    }\n                    else {\n                        if (isTableFieldInstance(fInstance)) {\n                            var tfInstance_1 = fInstance;\n                            var tNode_1 = tfInstance_1.node;\n                            tfInstance_1.context = context[nodeInstanceCompleteName(tfInstance_1)] || context;\n                            var formGroup_1 = this._formGroup.getValue();\n                            var controlsWithLabels_1 = [];\n                            controlsWithLabels_1.push([node.label, tNode_1.columnLabels]);\n                            if (formGroup_1 != null) {\n                                tNode_1.rows.forEach(function (row, rowIdx) {\n                                    var r = [];\n                                    row.forEach(function (cell, idx) {\n                                        /*\n                                        every control is registered with the cell position\n                                        inside the form control matrix\n                                        with this mask `${tNode.name}__${rowIdx}__${idx}`\n                                        */\n                                        var name = tNode_1.name + \"__\" + rowIdx + \"__\" + idx;\n                                        var tableFormControl = { control: new forms.FormControl(), show: false };\n                                        tableFormControl.control.setValue(tfInstance_1.context[cell.formula]);\n                                        formGroup_1.registerControl(name, tableFormControl.control);\n                                        r.push(tableFormControl);\n                                        /* create a object that respect the instance interface\n                                        with the minimum defined properties to allow to run addToNodeFormula map*/\n                                        var fakeInstance = {\n                                            formula: { formula: cell.formula },\n                                            node: { name: name, nodeType: 0, editable: false },\n                                            visible: true,\n                                            prefix: [],\n                                            conditionalBranches: [],\n                                            updatedEvt: new core.EventEmitter()\n                                        };\n                                        _this._addToNodesFormulaMap(fakeInstance, cell.formula);\n                                    });\n                                    controlsWithLabels_1.push([tNode_1.rowLabels[rowIdx], r]);\n                                });\n                                tfInstance_1.controls = controlsWithLabels_1;\n                            }\n                        }\n                        else {\n                            fInstance.value = context[nodeInstanceCompleteName(instance)];\n                        }\n                        updateFieldInstanceState(fInstance, context);\n                    }\n                }\n                this._addNodeInstance(instance);\n            }\n            return instance;\n        };\n        AjfFormRendererService.prototype._adjustReps = function (allNodes, instance, oldReps, context) {\n            var _this = this;\n            var newReps = instance.reps;\n            var result = { added: null, removed: null };\n            if (oldReps < newReps) {\n                var newNodes_1 = [];\n                if (instance.nodes == null) {\n                    instance.nodes = [];\n                }\n                if (instance.node.nodeType === exports.AjfNodeType.AjfNodeGroup) {\n                    var node = createField({\n                        id: 999,\n                        name: '',\n                        parent: -1,\n                        fieldType: exports.AjfFieldType.Empty,\n                        label: instance.node.label\n                    });\n                    var newInstance = this._initNodeInstance(allNodes, node, instance.prefix.slice(0), context);\n                    if (newInstance != null) {\n                        instance.nodes.push(newInstance);\n                    }\n                }\n                var _loop_1 = function (i) {\n                    var prefix = instance.prefix.slice(0);\n                    var group = instance.node;\n                    prefix.push(i);\n                    orderedNodes(group.nodes, instance.node.id).forEach(function (n) {\n                        var newInstance = _this._initNodeInstance(allNodes, n, prefix, context);\n                        if (newInstance != null) {\n                            newNodes_1.push(newInstance);\n                            instance.nodes.push(newInstance);\n                        }\n                    });\n                    this_1._addNodeInstance(instance);\n                };\n                var this_1 = this;\n                for (var i = oldReps; i < newReps; i++) {\n                    _loop_1(i);\n                }\n                result.added = newNodes_1;\n            }\n            else if (oldReps > newReps) {\n                var nodesNum = instance.nodes.length / oldReps;\n                if (instance.node.nodeType === exports.AjfNodeType.AjfNodeGroup) {\n                    nodesNum++;\n                }\n                result.removed = instance.nodes.splice(newReps * nodesNum, nodesNum);\n                result.removed.forEach((function (n) {\n                    _this._removeNodeInstance(n);\n                }));\n            }\n            if (oldReps != newReps && instance.formulaReps == null) {\n                var fg = this._formGroup.getValue();\n                var completeName = nodeInstanceCompleteName(instance);\n                if (fg != null && fg.contains(completeName)) {\n                    fg.controls[completeName].setValue(instance.reps);\n                }\n            }\n            instance.flatNodes = flattenNodesInstances(instance.nodes);\n            if (instance.node.nodeType === exports.AjfNodeType.AjfRepeatingSlide) {\n                var rsInstance = instance;\n                var slideNodes = [];\n                var nodesPerSlide = rsInstance.nodes != null ? rsInstance.nodes.length / rsInstance.reps : 0;\n                for (var i = 0; i < instance.reps; i++) {\n                    var startNode = i * nodesPerSlide;\n                    slideNodes.push(instance.nodes.slice(startNode, startNode + nodesPerSlide));\n                }\n                rsInstance.slideNodes = slideNodes;\n            }\n            return result;\n        };\n        AjfFormRendererService.prototype._updateFormValueAndValidity = function () {\n            this._nodesUpdates.asObservable()\n                .pipe(operators.withLatestFrom(this._formGroup), operators.filter(function (values) { return values[1] !== null; }))\n                .subscribe(function (values) {\n                var form = values[1];\n                form.updateValueAndValidity();\n            });\n        };\n        AjfFormRendererService.prototype._explodeRepeatingNode = function (allNodes, instance, context) {\n            var oldReps = updateRepsNum(instance, context);\n            if (oldReps !== instance.reps) {\n                this._adjustReps(allNodes, instance, oldReps, context);\n            }\n        };\n        AjfFormRendererService.prototype._orderedNodesInstancesTree = function (allNodes, nodes, parent, prefix, context) {\n            var _this = this;\n            if (parent === void 0) { parent = null; }\n            if (prefix === void 0) { prefix = []; }\n            var nodesInstances = [];\n            var curSuffix = prefix.length > 0 ? '__' + prefix.join('__') : '';\n            orderedNodes(nodes, parent).forEach(function (node) {\n                var parentNodeInstance = nodesInstances.find(function (ni) { return ni.node.id == node.parent && nodeInstanceSuffix(ni) == curSuffix; });\n                var branchVisibility = parentNodeInstance != null ?\n                    parentNodeInstance.verifiedBranch != null &&\n                        parentNodeInstance.verifiedBranch == node.parentNode :\n                    true;\n                var nni = _this._initNodeInstance(allNodes, node, prefix, context, branchVisibility);\n                if (nni != null) {\n                    nodesInstances.push(nni);\n                }\n            });\n            return nodesInstances;\n        };\n        AjfFormRendererService.prototype._formValueDelta = function (oldValue, newValue) {\n            return Object.keys(newValue).filter(function (k) { return oldValue[k] !== newValue[k]; });\n        };\n        AjfFormRendererService.prototype._initFormGroupStreams = function (formGroup) {\n            var _this = this;\n            this._formGroupSubscription.unsubscribe();\n            var init = true;\n            var initForm = true;\n            this._formInitEvent.emit(0 /* Initializing */);\n            this._formGroupSubscription =\n                formGroup.valueChanges\n                    .pipe(operators.startWith({}), operators.pairwise(), operators.debounceTime(200), operators.withLatestFrom.apply(void 0, __spread((this._nodesMaps), [this._flatNodes])))\n                    .subscribe(function (v) {\n                    var oldFormValue = init && {} || v[0][0];\n                    init = false;\n                    var newFormValue = v[0][1];\n                    var visibilityMap = v[1];\n                    var repetitionMap = v[2];\n                    var conditionalBranchesMap = v[3];\n                    var formulaMap = v[4];\n                    var validationMap = v[5];\n                    var warningMap = v[6];\n                    var nextSlideConditionsMap = v[7];\n                    var filteredChoicesMap = v[8];\n                    var triggerConditionsMap = v[9];\n                    var nodes = v[10];\n                    // takes the names of the fields that have changed\n                    var delta = _this._formValueDelta(oldFormValue, newFormValue);\n                    var deltaLen = delta.length;\n                    var updatedNodes = [];\n                    /*\n                      for each field update all properties map\n                      with the following rule  \"if fieldname is in map update it\" and\n                      push on updateNodes the node instance that wrap field\n                    */\n                    delta.forEach(function (fieldName) {\n                        updatedNodes = updatedNodes.concat(nodes.filter(function (n) { return nodeInstanceCompleteName(n) === fieldName; }));\n                        if (visibilityMap[fieldName] != null) {\n                            visibilityMap[fieldName].forEach(function (nodeInstance) {\n                                var completeName = nodeInstanceCompleteName(nodeInstance);\n                                var visibilityChanged = updateVisibility(nodeInstance, newFormValue);\n                                var isField = isFieldInstance(nodeInstance);\n                                if (visibilityChanged && !nodeInstance.visible) {\n                                    var fg_1 = _this._formGroup.getValue();\n                                    if (fg_1 != null) {\n                                        var s_1 = rxjs.timer(200).subscribe(function () {\n                                            if (s_1 && !s_1.closed) {\n                                                s_1.unsubscribe();\n                                            }\n                                            fg_1.controls[completeName].setValue(null);\n                                        });\n                                    }\n                                    if (isField) {\n                                        nodeInstance.value = null;\n                                    }\n                                }\n                                else if (visibilityChanged && nodeInstance.visible && isField) {\n                                    var fg = _this._formGroup.getValue();\n                                    var res = updateFormula(nodeInstance, newFormValue);\n                                    if (fg != null && res.changed) {\n                                        fg.controls[completeName].setValue(res.value);\n                                    }\n                                }\n                                if (updatedNodes.indexOf(nodeInstance) === -1) {\n                                    updatedNodes.push(nodeInstance);\n                                }\n                            });\n                        }\n                        if (repetitionMap[fieldName] != null) {\n                            repetitionMap[fieldName].forEach(function (nodeInstance) {\n                                if (isRepeatingContainerNode(nodeInstance.node)) {\n                                    var rnInstance = nodeInstance;\n                                    var oldReps = updateRepsNum(rnInstance, newFormValue);\n                                    if (oldReps !== rnInstance.reps) {\n                                        _this._adjustReps(nodes, rnInstance, oldReps, newFormValue);\n                                    }\n                                }\n                                if (updatedNodes.indexOf(nodeInstance) === -1) {\n                                    updatedNodes.push(nodeInstance);\n                                }\n                            });\n                        }\n                        if (conditionalBranchesMap[fieldName] != null) {\n                            conditionalBranchesMap[fieldName].forEach(function (nodeInstance) {\n                                // const branchChanged = nodeInstance.updateConditionalBranches(newFormValue);\n                                updateConditionalBranches(nodeInstance, newFormValue);\n                                // if (branchChanged) {\n                                var verifiedBranch = nodeInstance.verifiedBranch;\n                                nodeInstance.conditionalBranches.forEach(function (_condition, idx) {\n                                    if (idx == verifiedBranch) {\n                                        _this._showSubtree(newFormValue, nodes, nodeInstance, idx);\n                                    }\n                                    else {\n                                        _this._hideSubtree(newFormValue, nodes, nodeInstance, idx);\n                                    }\n                                });\n                                // }\n                                if (updatedNodes.indexOf(nodeInstance) === -1) {\n                                    updatedNodes.push(nodeInstance);\n                                }\n                            });\n                        }\n                        if (formulaMap[fieldName] != null) {\n                            formulaMap[fieldName].forEach(function (nodeInstance) {\n                                if (isFieldInstance(nodeInstance)) {\n                                    var fInstance = nodeInstance;\n                                    var res = updateFormula(fInstance, newFormValue);\n                                    var fg = _this._formGroup.getValue();\n                                    if (fg != null && res.changed) {\n                                        updateValidation(fInstance, newFormValue);\n                                        fg.controls[nodeInstanceCompleteName(nodeInstance)].setValue(res.value);\n                                    }\n                                }\n                                if (updatedNodes.indexOf(nodeInstance) === -1) {\n                                    updatedNodes.push(nodeInstance);\n                                }\n                            });\n                        }\n                        if (validationMap[fieldName] != null) {\n                            validationMap[fieldName].forEach(function (nodeInstance) {\n                                if (isFieldInstance(nodeInstance)) {\n                                    var fInstance = nodeInstance;\n                                    newFormValue.$value = newFormValue[nodeInstanceCompleteName(nodeInstance)];\n                                    updateValidation(fInstance, newFormValue, _this.currentSupplementaryInformations);\n                                }\n                                if (updatedNodes.indexOf(nodeInstance) === -1) {\n                                    updatedNodes.push(nodeInstance);\n                                }\n                            });\n                        }\n                        if (warningMap[fieldName] != null) {\n                            warningMap[fieldName].forEach(function (nodeInstance) {\n                                if (isFieldInstance(nodeInstance)) {\n                                    var fInstance = nodeInstance;\n                                    updateWarning(fInstance, newFormValue);\n                                    if (fInstance.warningResults != null &&\n                                        fInstance.warningResults.filter(function (warning) { return warning.result; }).length > 0) {\n                                        fInstance.warningTrigger.emit();\n                                    }\n                                }\n                                if (updatedNodes.indexOf(nodeInstance) === -1) {\n                                    updatedNodes.push(nodeInstance);\n                                }\n                            });\n                        }\n                        if (deltaLen == 1 && nextSlideConditionsMap[fieldName] != null) {\n                            if (nextSlideConditionsMap[fieldName]\n                                .filter(function (nodeInstance) {\n                                if (isFieldInstance(nodeInstance)) {\n                                    var fInstance = nodeInstance;\n                                    return updateNextSlideCondition(fInstance, newFormValue);\n                                }\n                                return false;\n                            })\n                                .length == 1) {\n                                _this._nextSlideTrigger.emit();\n                            }\n                        }\n                        if (filteredChoicesMap[fieldName] != null) {\n                            filteredChoicesMap[fieldName].forEach(function (nodeInstance) {\n                                if (isFieldInstance(nodeInstance)) {\n                                    var fInstance = nodeInstance;\n                                    if (isFieldWithChoices(fInstance.node)) {\n                                        updateFilteredChoices(fInstance, newFormValue);\n                                    }\n                                }\n                                if (updatedNodes.indexOf(nodeInstance) === -1) {\n                                    updatedNodes.push(nodeInstance);\n                                }\n                            });\n                        }\n                        if (deltaLen == 1 && triggerConditionsMap[fieldName] != null) {\n                            var res = triggerConditionsMap[fieldName].filter(function (nodeInstance) {\n                                if (!isFieldInstance(nodeInstance)) {\n                                    return false;\n                                }\n                                var fInstance = nodeInstance;\n                                if (!isFieldWithChoices(fInstance.node)) {\n                                    return false;\n                                }\n                                return updateTriggerConditions(fInstance, newFormValue);\n                            });\n                            if (res.length == 1) {\n                                res[0].selectionTrigger.emit();\n                            }\n                        }\n                    });\n                    updatedNodes.forEach(function (n) {\n                        var nodeIdx = nodes.indexOf(n);\n                        var idx = nodeIdx - 1;\n                        while (idx >= 0) {\n                            var curNode = nodes[idx];\n                            if (isSlidesInstance(curNode)) {\n                                var slide = curNode;\n                                var subNodesNum = slide.flatNodes.length;\n                                var valid = true;\n                                for (var i = 0; i < subNodesNum; i++) {\n                                    var subNode = slide.flatNodes[i];\n                                    if (subNode.visible && isFieldInstance(subNode) &&\n                                        !subNode.valid) {\n                                        valid = false;\n                                        break;\n                                    }\n                                }\n                                if (slide.valid !== valid) {\n                                    slide.valid = valid;\n                                }\n                                slide.updatedEvt.emit();\n                            }\n                            idx--;\n                        }\n                        n.updatedEvt.emit();\n                    });\n                    if (initForm) {\n                        initForm = false;\n                        _this._formInitEvent.emit(1 /* Complete */);\n                    }\n                    _this._valueChanged.next();\n                });\n            return formGroup;\n        };\n        AjfFormRendererService.prototype._showSubtree = function (context, nodes, node, branch) {\n            this._updateSubtreeVisibility(context, nodes, node, true, branch);\n        };\n        AjfFormRendererService.prototype._hideSubtree = function (context, nodes, node, branch) {\n            this._updateSubtreeVisibility(context, nodes, node, false, branch);\n        };\n        AjfFormRendererService.prototype._updateSubtreeVisibility = function (context, nodes, node, visible, branch) {\n            var _this = this;\n            var subNodes;\n            var nodeSuffix = nodeInstanceSuffix(node);\n            if (branch != null) {\n                subNodes = nodes.filter(function (n) {\n                    var suffix = nodeInstanceSuffix(n);\n                    return suffix == nodeSuffix && n.node.parent == node.node.id && n.node.parentNode == branch;\n                });\n            }\n            else {\n                subNodes = nodes.filter(function (n) {\n                    var suffix = nodeInstanceSuffix(n);\n                    return suffix == nodeSuffix && n.node.parent == node.node.id;\n                });\n            }\n            var isContainer = isContainerNode(node.node);\n            subNodes.forEach(function (n) {\n                if (!isContainer ||\n                    (isContainer && node.node.nodes.find(function (cn) { return cn.id == n.node.id; }) == null)) {\n                    updateVisibility(n, context, visible);\n                    updateFormula(n, context);\n                    _this._updateSubtreeVisibility(context, nodes, n, visible);\n                }\n            });\n        };\n        AjfFormRendererService.prototype._initNodesStreams = function () {\n            this._nodes =\n                this._nodesUpdates.pipe(operators.scan(function (nodes, op) {\n                    return op(nodes);\n                }, []), operators.share());\n            this._flatNodesTree = this._nodes.pipe(operators.map(function (nodes) { return flattenNodesInstancesTree(nodes); }), operators.share());\n            this._flatNodes = this._flatNodesTree.pipe(operators.map(function (slides) {\n                var nodes = [];\n                slides.forEach(function (s) {\n                    nodes.push(s);\n                    nodes = nodes.concat(s.flatNodes);\n                });\n                return nodes;\n            }), operators.share());\n        };\n        AjfFormRendererService.prototype._removeNodeInstance = function (nodeInstance) {\n            var nodeName = nodeInstanceCompleteName(nodeInstance);\n            this._removeNodesVisibilityMapIndex(nodeName);\n            this._removeNodesRepetitionMapIndex(nodeName);\n            this._removeNodesConditionalBranchMapIndex(nodeName);\n            this._removeNodesFormulaMapIndex(nodeName);\n            this._removeNodesValidationMapIndex(nodeName);\n            this._removeNodesWarningMapIndex(nodeName);\n            this._removeNodesNextSlideConditionsMapIndex(nodeName);\n            this._removeNodesFilteredChoicesMapIndex(nodeName);\n            this._removeNodesTriggerConditionsMapIndex(nodeName);\n            if (isSlidesInstance(nodeInstance)) {\n                return this._removeSlideInstance(nodeInstance);\n            }\n            else if (isRepeatingContainerNode(nodeInstance.node)) {\n                this._removeNodeGroupInstance(nodeInstance);\n            }\n            else if (isFieldInstance(nodeInstance)) {\n                this._removeFieldInstance(nodeInstance);\n            }\n            return nodeInstance;\n        };\n        AjfFormRendererService.prototype._removeSlideInstance = function (slideInstance) {\n            var _this = this;\n            var slide = slideInstance.node;\n            if (slide.visibility != null) {\n                this._removeFromNodesVisibilityMap(slideInstance, slide.visibility.condition);\n            }\n            slideInstance.conditionalBranches.forEach(function (conditionalBranch) {\n                _this._removeFromNodesConditionalBranchMap(slideInstance, conditionalBranch.condition);\n            });\n            return slideInstance;\n        };\n        AjfFormRendererService.prototype._removeNodeGroupInstance = function (nodeGroupInstance) {\n            var nodeGroup = nodeGroupInstance.node;\n            if (nodeGroup.visibility != null) {\n                this._removeFromNodesVisibilityMap(nodeGroupInstance, nodeGroup.visibility.condition);\n            }\n            if (nodeGroupInstance.formulaReps != null && nodeGroup.formulaReps != null) {\n                this._removeFromNodesRepetitionMap(nodeGroupInstance, nodeGroup.formulaReps.formula);\n            }\n            return nodeGroupInstance;\n        };\n        AjfFormRendererService.prototype._removeFieldInstance = function (fieldInstance) {\n            var _this = this;\n            var formGroup = this._formGroup.getValue();\n            var fieldInstanceName = nodeInstanceCompleteName(fieldInstance);\n            if (formGroup != null && formGroup.contains(fieldInstanceName)) {\n                formGroup.removeControl(fieldInstanceName);\n            }\n            if (fieldInstance.validation != null) {\n                this._validationNodesMapUpdates.next(function (vmap) {\n                    if (vmap[fieldInstanceName] == null) {\n                        delete vmap[fieldInstanceName];\n                    }\n                    return vmap;\n                });\n            }\n            if (fieldInstance.visibility != null) {\n                this._removeFromNodesVisibilityMap(fieldInstance, fieldInstance.visibility.condition);\n            }\n            fieldInstance.conditionalBranches.forEach(function (conditionalBranch) {\n                _this._removeFromNodesConditionalBranchMap(fieldInstance, conditionalBranch.condition);\n            });\n            if (fieldInstance.formula) {\n                this._removeFromNodesFormulaMap(fieldInstance, fieldInstance.formula.formula);\n            }\n            // TODO: check this, probably is never verified\n            if (isRepeatingContainerNode(fieldInstance.node)) {\n                var rcInstance = fieldInstance;\n                if (rcInstance.formulaReps != null) {\n                    this._removeFromNodesRepetitionMap(fieldInstance, rcInstance.formulaReps.formula);\n                }\n            }\n            if (fieldInstance.validation != null && fieldInstance.validation.conditions != null) {\n                fieldInstance.validation.conditions.forEach(function (condition) {\n                    _this._removeFromNodesValidationMap(fieldInstance, condition.condition);\n                });\n            }\n            if (fieldInstance.warning != null) {\n                fieldInstance.warning.conditions.forEach(function (condition) {\n                    _this._removeFromNodesWarningMap(fieldInstance, condition.condition);\n                });\n            }\n            if (fieldInstance.nextSlideCondition != null) {\n                this._removeFromNodesNextSlideConditionsMap(fieldInstance, fieldInstance.nextSlideCondition.condition);\n            }\n            if (isFieldWithChoices(fieldInstance.node)) {\n                var fwcInstance = fieldInstance;\n                if (fwcInstance.choicesFilter != null) {\n                    this._removeFromNodesFilteredChoicesMap(fieldInstance, fwcInstance.choicesFilter.formula);\n                    if (fwcInstance.triggerConditions != null) {\n                        fwcInstance.triggerConditions.forEach(function (condition) {\n                            _this._removeFromNodesTriggerConditionsMap(fieldInstance, condition.condition);\n                        });\n                    }\n                }\n            }\n            return fieldInstance;\n        };\n        AjfFormRendererService.prototype._addNodeInstance = function (nodeInstance) {\n            if (isRepeatingContainerNode(nodeInstance.node)) {\n                return this._addNodeGroupInstance(nodeInstance);\n            }\n            else if (isSlideInstance(nodeInstance)) {\n                return this._addSlideInstance(nodeInstance);\n            }\n            else if (isFieldInstance(nodeInstance)) {\n                return this._addFieldInstance(nodeInstance);\n            }\n            return nodeInstance;\n        };\n        AjfFormRendererService.prototype._addFieldInstance = function (fieldInstance) {\n            var _this = this;\n            var formGroup = this._formGroup.getValue();\n            var fieldInstanceName = nodeInstanceCompleteName(fieldInstance);\n            if (formGroup != null && !formGroup.contains(fieldInstanceName)) {\n                var control = new forms.FormControl();\n                control.setValue(fieldInstance.value);\n                formGroup.registerControl(fieldInstanceName, control);\n            }\n            if (fieldInstance.validation != null) {\n                this._validationNodesMapUpdates.next(function (vmap) {\n                    if (vmap[fieldInstanceName] == null) {\n                        vmap[fieldInstanceName] = [];\n                    }\n                    if (vmap[fieldInstanceName].indexOf(fieldInstance) == -1) {\n                        vmap[fieldInstanceName].push(fieldInstance);\n                    }\n                    return vmap;\n                });\n            }\n            else {\n                fieldInstance.valid = true;\n            }\n            if (fieldInstance.visibility != null) {\n                this._addToNodesVisibilityMap(fieldInstance, fieldInstance.visibility.condition);\n            }\n            fieldInstance.conditionalBranches.forEach(function (conditionalBranch) {\n                _this._addToNodesConditionalBranchMap(fieldInstance, conditionalBranch.condition);\n            });\n            if (fieldInstance.formula) {\n                this._addToNodesFormulaMap(fieldInstance, fieldInstance.formula.formula);\n            }\n            if (isNodeGroupInstance(fieldInstance)) {\n                var ngInstance = fieldInstance;\n                if (ngInstance.formulaReps != null) {\n                    this._addToNodesRepetitionMap(fieldInstance, ngInstance.formulaReps.formula);\n                }\n            }\n            if (fieldInstance.validation != null && fieldInstance.validation.conditions != null) {\n                fieldInstance.validation.conditions.forEach(function (condition) {\n                    _this._addToNodesValidationMap(fieldInstance, condition.condition);\n                });\n            }\n            if (fieldInstance.warning != null) {\n                fieldInstance.warning.conditions.forEach(function (condition) {\n                    _this._addToNodesWarningMap(fieldInstance, condition.condition);\n                });\n            }\n            if (fieldInstance.nextSlideCondition != null) {\n                this._addToNodesNextSlideConditionsMap(fieldInstance, fieldInstance.nextSlideCondition.condition);\n            }\n            if (isCustomFieldWithChoices(fieldInstance.node) || isFieldWithChoicesInstance(fieldInstance)) {\n                var fwcInstance = fieldInstance;\n                if (fwcInstance.choicesFilter != null) {\n                    this._addToNodesFilteredChoicesMap(fieldInstance, fwcInstance.choicesFilter.formula);\n                }\n                if (fwcInstance.triggerConditions != null) {\n                    fwcInstance.triggerConditions.forEach(function (condition) {\n                        _this._addToNodesTriggerConditionsMap(fieldInstance, condition.condition);\n                    });\n                }\n            }\n            return fieldInstance;\n        };\n        AjfFormRendererService.prototype._addSlideInstance = function (slideInstance) {\n            var _this = this;\n            var slide = slideInstance.node;\n            if (slide.visibility != null) {\n                this._addToNodesVisibilityMap(slideInstance, slide.visibility.condition);\n            }\n            slideInstance.conditionalBranches.forEach(function (conditionalBranch) {\n                _this._addToNodesConditionalBranchMap(slideInstance, conditionalBranch.condition);\n            });\n            return slideInstance;\n        };\n        AjfFormRendererService.prototype._addNodeGroupInstance = function (nodeGroupInstance) {\n            var _this = this;\n            var nodeGroup = nodeGroupInstance.node;\n            if (nodeGroup.visibility != null) {\n                this._addToNodesVisibilityMap(nodeGroupInstance, nodeGroup.visibility.condition);\n            }\n            nodeGroupInstance.conditionalBranches.forEach(function (conditionalBranch) {\n                _this._addToNodesConditionalBranchMap(nodeGroupInstance, conditionalBranch.condition);\n            });\n            if (nodeGroupInstance.formulaReps != null) {\n                if (nodeGroup.formulaReps != null) {\n                    this._addToNodesRepetitionMap(nodeGroupInstance, nodeGroup.formulaReps.formula);\n                }\n            }\n            else {\n                var formGroup = this._formGroup.getValue();\n                var nodeGroupInstanceName = nodeInstanceCompleteName(nodeGroupInstance);\n                if (formGroup != null && !formGroup.contains(nodeGroupInstanceName)) {\n                    var control = new forms.FormControl();\n                    control.setValue(nodeGroupInstance.reps);\n                    formGroup.registerControl(nodeGroupInstanceName, control);\n                }\n            }\n            return nodeGroupInstance;\n        };\n        AjfFormRendererService.prototype._removeNodesVisibilityMapIndex = function (index) {\n            this._removeNodesMapIndex(this._visibilityNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesRepetitionMapIndex = function (index) {\n            this._removeNodesMapIndex(this._repetitionNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesConditionalBranchMapIndex = function (index) {\n            this._removeNodesMapIndex(this._conditionalBranchNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesFormulaMapIndex = function (index) {\n            this._removeNodesMapIndex(this._formulaNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesValidationMapIndex = function (index) {\n            this._removeNodesMapIndex(this._validationNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesWarningMapIndex = function (index) {\n            this._removeNodesMapIndex(this._warningNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesFilteredChoicesMapIndex = function (index) {\n            this._removeNodesMapIndex(this._filteredChoicesNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesTriggerConditionsMapIndex = function (index) {\n            this._removeNodesMapIndex(this._triggerConditionsNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesNextSlideConditionsMapIndex = function (index) {\n            this._removeNodesMapIndex(this._nextSlideConditionsNodesMapUpdates, index);\n        };\n        AjfFormRendererService.prototype._removeNodesMapIndex = function (nodesMap, index) {\n            nodesMap.next(function (vmap) {\n                if (Object.keys(vmap).indexOf(index) > -1) {\n                    delete vmap[index];\n                }\n                return vmap;\n            });\n        };\n        AjfFormRendererService.prototype._removeFromNodesVisibilityMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._visibilityNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesRepetitionMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._repetitionNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesConditionalBranchMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._conditionalBranchNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesFormulaMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._formulaNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesValidationMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._validationNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesWarningMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._warningNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesFilteredChoicesMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._filteredChoicesNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesTriggerConditionsMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._filteredChoicesNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesNextSlideConditionsMap = function (nodeInstance, formula) {\n            this._removeFromNodesMap(this._nextSlideConditionsNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._removeFromNodesMap = function (nodesMap, nodeInstance, formula) {\n            var tokens = tokenize(formula).filter(function (token) { return token.type == 'Identifier' && token.value != '$value'; });\n            if (tokens.length > 0) {\n                nodesMap.next(function (vmap) {\n                    tokens.forEach(function (token) {\n                        var tokenName = token.value;\n                        if (vmap[tokenName] != null) {\n                            var idx = vmap[tokenName].indexOf(nodeInstance);\n                            if (idx > -1) {\n                                vmap[tokenName].splice(idx, 1);\n                                if (vmap[tokenName].length == 0) {\n                                    delete vmap[tokenName];\n                                }\n                            }\n                        }\n                    });\n                    return vmap;\n                });\n            }\n        };\n        AjfFormRendererService.prototype._addToNodesVisibilityMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._visibilityNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesRepetitionMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._repetitionNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesConditionalBranchMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._conditionalBranchNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesFormulaMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._formulaNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesValidationMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._validationNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesWarningMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._warningNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesFilteredChoicesMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._filteredChoicesNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesTriggerConditionsMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._triggerConditionsNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesNextSlideConditionsMap = function (nodeInstance, formula) {\n            this._addToNodesMap(this._nextSlideConditionsNodesMapUpdates, nodeInstance, formula);\n        };\n        AjfFormRendererService.prototype._addToNodesMap = function (nodesMap, nodeInstance, formula) {\n            var tokens = tokenize(formula).filter(function (token) { return token.type == 'Identifier' && token.value != '$value'; });\n            if (tokens.length > 0) {\n                nodesMap.next(function (vmap) {\n                    tokens.forEach(function (token) {\n                        var tokenName = token.value;\n                        if (vmap[tokenName] == null) {\n                            vmap[tokenName] = [];\n                        }\n                        if (vmap[tokenName].indexOf(nodeInstance) === -1) {\n                            vmap[tokenName].push(nodeInstance);\n                        }\n                    });\n                    return vmap;\n                });\n            }\n        };\n        AjfFormRendererService.decorators = [\n            { type: core.Injectable }\n        ];\n        /** @nocollapse */\n        AjfFormRendererService.ctorParameters = function () { return [\n            { type: AjfValidationService }\n        ]; };\n        return AjfFormRendererService;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfBaseFieldComponent = /** @class */ (function () {\n        function AjfBaseFieldComponent(_changeDetectorRef, _service, _warningAlertService) {\n            var _this = this;\n            this._changeDetectorRef = _changeDetectorRef;\n            this._service = _service;\n            this._warningAlertService = _warningAlertService;\n            this._warningTriggerSub = rxjs.Subscription.EMPTY;\n            this._instanceUpdateSub = rxjs.Subscription.EMPTY;\n            this._control = rxjs.defer(function () { return _this._service.getControl(_this.instance)\n                .pipe(operators.map(function (ctrl) { return ctrl || new forms.FormControl(); })); });\n        }\n        Object.defineProperty(AjfBaseFieldComponent.prototype, \"instance\", {\n            get: function () {\n                return this._instance;\n            },\n            set: function (instance) {\n                if (instance !== this._instance) {\n                    this._instance = instance;\n                    this._setUpInstanceUpdate();\n                    this._onInstanceChange();\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfBaseFieldComponent.prototype, \"control\", {\n            get: function () {\n                return this._control;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        AjfBaseFieldComponent.prototype.ngOnInit = function () {\n            var _this = this;\n            this._warningTriggerSub =\n                this.instance.warningTrigger.pipe(operators.withLatestFrom(this.control), operators.filter(function (v) { return v[1] != null; }))\n                    .subscribe(function (v) {\n                    if (_this.instance.warningResults == null) {\n                        return;\n                    }\n                    var control = v[1];\n                    var s = _this._warningAlertService\n                        .showWarningAlertPrompt(_this.instance.warningResults.filter(function (w) { return w.result; }).map(function (w) { return w.warning; }))\n                        .subscribe(function (r) {\n                        if (r.result) {\n                            control.setValue(null);\n                        }\n                    }, function (_e) {\n                        if (s) {\n                            s.unsubscribe();\n                        }\n                    }, function () {\n                        if (s) {\n                            s.unsubscribe();\n                        }\n                    });\n                });\n        };\n        AjfBaseFieldComponent.prototype.ngOnDestroy = function () {\n            this._warningTriggerSub.unsubscribe();\n            this._instanceUpdateSub.unsubscribe();\n        };\n        AjfBaseFieldComponent.prototype._onInstanceChange = function () { };\n        AjfBaseFieldComponent.prototype._setUpInstanceUpdate = function () {\n            var _this = this;\n            this._instanceUpdateSub.unsubscribe();\n            if (this._instance != null) {\n                this._instanceUpdateSub = this._instance.updatedEvt.subscribe(function () {\n                    if (_this._changeDetectorRef) {\n                        try {\n                            _this._changeDetectorRef.detectChanges();\n                        }\n                        catch (e) {\n                        }\n                    }\n                });\n            }\n            else {\n                this._instanceUpdateSub = rxjs.Subscription.EMPTY;\n            }\n            this._changeDetectorRef.detectChanges();\n        };\n        AjfBaseFieldComponent.decorators = [\n            { type: core.Directive }\n        ];\n        /** @nocollapse */\n        AjfBaseFieldComponent.ctorParameters = function () { return [\n            { type: core.ChangeDetectorRef },\n            { type: AjfFormRendererService },\n            { type: undefined }\n        ]; };\n        return AjfBaseFieldComponent;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfBoolToIntPipe = /** @class */ (function () {\n        function AjfBoolToIntPipe() {\n        }\n        AjfBoolToIntPipe.prototype.transform = function (value) {\n            return value ? 1 : 0;\n        };\n        AjfBoolToIntPipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfBoolToInt' },] }\n        ];\n        return AjfBoolToIntPipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfDateValuePipe = /** @class */ (function () {\n        function AjfDateValuePipe() {\n        }\n        AjfDateValuePipe.prototype.transform = function (date) {\n            if (date == null) {\n                return null;\n            }\n            return date === 'today' ? new Date() : date;\n        };\n        AjfDateValuePipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfDateValue' },] }\n        ];\n        return AjfDateValuePipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfDateValueStringPipe = /** @class */ (function () {\n        function AjfDateValueStringPipe() {\n        }\n        AjfDateValueStringPipe.prototype.transform = function (date) {\n            if (date == null) {\n                return undefined;\n            }\n            var dateObj = date === 'today' ? new Date() : date;\n            return dateFns.format(dateObj, 'yyyy-MM-dd');\n        };\n        AjfDateValueStringPipe.decorators = [\n            { type: core.Injectable },\n            { type: core.Pipe, args: [{ name: 'ajfDateValueString' },] }\n        ];\n        return AjfDateValueStringPipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    /**\n     * This class will define an Ajf invalid field definition error\n     */\n    var AjfInvalidFieldDefinitionError = /** @class */ (function (_super) {\n        __extends(AjfInvalidFieldDefinitionError, _super);\n        function AjfInvalidFieldDefinitionError(message) {\n            return _super.call(this, message) || this;\n        }\n        Object.defineProperty(AjfInvalidFieldDefinitionError.prototype, \"name\", {\n            get: function () {\n                return 'AjfInvalidFieldDefinitionError';\n            },\n            enumerable: true,\n            configurable: true\n        });\n        return AjfInvalidFieldDefinitionError;\n    }(models.AjfError));\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfExpandFieldWithChoicesPipe = /** @class */ (function () {\n        function AjfExpandFieldWithChoicesPipe() {\n        }\n        AjfExpandFieldWithChoicesPipe.prototype.transform = function (instance, threshold) {\n            return !instance.node.forceNarrow &&\n                (instance.node.forceExpanded ||\n                    (instance.filteredChoices && instance.filteredChoices.length <= threshold));\n        };\n        AjfExpandFieldWithChoicesPipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfExpandFieldWithChoices' },] }\n        ];\n        return AjfExpandFieldWithChoicesPipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFieldHost = /** @class */ (function () {\n        function AjfFieldHost(viewContainerRef) {\n            this.viewContainerRef = viewContainerRef;\n        }\n        AjfFieldHost.decorators = [\n            { type: core.Directive, args: [{ selector: '[ajf-field-host]' },] }\n        ];\n        /** @nocollapse */\n        AjfFieldHost.ctorParameters = function () { return [\n            { type: core.ViewContainerRef }\n        ]; };\n        return AjfFieldHost;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFormField = /** @class */ (function () {\n        function AjfFormField(_cdr, _cfr) {\n            this._cdr = _cdr;\n            this._cfr = _cfr;\n            this._init = false;\n            this._updatedSub = rxjs.Subscription.EMPTY;\n        }\n        Object.defineProperty(AjfFormField.prototype, \"instance\", {\n            get: function () {\n                return this._instance;\n            },\n            set: function (instance) {\n                if (this._instance !== instance) {\n                    this._instance = instance;\n                    if (this._init) {\n                        this._loadComponent();\n                    }\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormField.prototype, \"readonly\", {\n            get: function () {\n                return this._readonly;\n            },\n            set: function (readonly) {\n                this._readonly = coercion.coerceBooleanProperty(readonly);\n                if (this._init) {\n                    this._loadComponent();\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        AjfFormField.prototype.ngOnDestroy = function () {\n            this._updatedSub.unsubscribe();\n        };\n        AjfFormField.prototype.ngOnInit = function () {\n            this._init = true;\n            this._loadComponent();\n        };\n        AjfFormField.prototype._loadComponent = function () {\n            var _this = this;\n            this._updatedSub.unsubscribe();\n            this._updatedSub = rxjs.Subscription.EMPTY;\n            if (this._instance == null || this.fieldHost == null) {\n                return;\n            }\n            var vcr = this.fieldHost.viewContainerRef;\n            vcr.clear();\n            var componentDef = this.componentsMap[this._instance.node.fieldType];\n            if (componentDef == null) {\n                return;\n            }\n            var component = this._readonly && componentDef.readOnlyComponent ?\n                componentDef.readOnlyComponent :\n                componentDef.component;\n            try {\n                var componentFactory = this._cfr.resolveComponentFactory(component);\n                var componentRef = vcr.createComponent(componentFactory);\n                this._componentInstance = componentRef.instance;\n                this._componentInstance.instance = this._instance;\n                if (componentDef.inputs) {\n                    Object.keys(componentDef.inputs).forEach(function (key) {\n                        if (key in _this._componentInstance) {\n                            _this._componentInstance[key] = componentDef.inputs[key];\n                        }\n                    });\n                }\n                this._updatedSub = this._instance.updatedEvt.subscribe(function () { return _this._cdr.markForCheck(); });\n            }\n            catch (e) {\n                console.log(e);\n            }\n        };\n        AjfFormField.decorators = [\n            { type: core.Directive }\n        ];\n        /** @nocollapse */\n        AjfFormField.ctorParameters = function () { return [\n            { type: core.ChangeDetectorRef },\n            { type: core.ComponentFactoryResolver }\n        ]; };\n        AjfFormField.propDecorators = {\n            fieldHost: [{ type: core.ViewChild, args: [AjfFieldHost, { static: true },] }],\n            instance: [{ type: core.Input }],\n            readonly: [{ type: core.Input }]\n        };\n        return AjfFormField;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function fieldIconName(type) {\n        return \"ajf-icon-field-\" + (typeof exports.AjfFieldType[type] === 'string' ? exports.AjfFieldType[type].toLowerCase() : type);\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFieldIconPipe = /** @class */ (function () {\n        function AjfFieldIconPipe() {\n        }\n        AjfFieldIconPipe.prototype.transform = function (field) {\n            return fieldIconName(field.fieldType ? field.fieldType : field);\n        };\n        AjfFieldIconPipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfFieldIcon' },] }\n        ];\n        return AjfFieldIconPipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFieldIsValidPipe = /** @class */ (function () {\n        function AjfFieldIsValidPipe() {\n        }\n        AjfFieldIsValidPipe.prototype.transform = function (validationResults) {\n            return validationResults != null && validationResults.filter(function (f) { return !f.result; }).length === 0;\n        };\n        AjfFieldIsValidPipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfFieldIsValid' },] }\n        ];\n        return AjfFieldIsValidPipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFieldService = /** @class */ (function () {\n        function AjfFieldService() {\n            this.componentsMap = componentsMap;\n        }\n        AjfFieldService.prototype.registerCustomField = function (field) {\n            var fieldType = field.fieldType, component = field.component;\n            if (fieldType < 100) {\n                throw new Error('Invalid custom field type, it must be greater than 100');\n            }\n            if (component == null) {\n                throw new Error('Invalid custom field component');\n            }\n            this.componentsMap[fieldType] = field;\n        };\n        return AjfFieldService;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFieldWithChoicesComponent = /** @class */ (function (_super) {\n        __extends(AjfFieldWithChoicesComponent, _super);\n        function AjfFieldWithChoicesComponent(cdr, service, warningAlertService, searchThreshold) {\n            var _this = _super.call(this, cdr, service, warningAlertService) || this;\n            _this._searchThreshold = 6;\n            if (searchThreshold != null) {\n                _this._searchThreshold = searchThreshold;\n            }\n            return _this;\n        }\n        Object.defineProperty(AjfFieldWithChoicesComponent.prototype, \"searchThreshold\", {\n            get: function () {\n                return this._searchThreshold;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        return AjfFieldWithChoicesComponent;\n    }(AjfBaseFieldComponent));\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFormActionEvent = /** @class */ (function () {\n        function AjfFormActionEvent() {\n        }\n        return AjfFormActionEvent;\n    }());\n    var AjfFormRenderer = /** @class */ (function () {\n        /**\n         * this constructor will init current formula by ajfBuilderService\n         */\n        function AjfFormRenderer(_rendererService, _changeDetectorRef) {\n            this._rendererService = _rendererService;\n            this._changeDetectorRef = _changeDetectorRef;\n            // ajfFieldTypes [ Text, Number, Boolean, SingleChoice, MultipleChoice,\n            // Formula, Empty, Composed, LENGTH ]\n            this.ajfFieldTypes = exports.AjfFieldType;\n            this._orientationChange = new core.EventEmitter();\n            this.orientationChange = this._orientationChange.asObservable();\n            this._saveDisabled = false;\n            this._hasStartMessage = false;\n            this._hasEndMessage = false;\n            this._hideTopToolbar = false;\n            this._hideBottomToolbar = false;\n            this._hideNavigationButtons = false;\n            this._fixedOrientation = false;\n            this._readonly = false;\n            this._orientation = 'horizontal';\n            this._errorMoveEvent = new core.EventEmitter();\n            // _init is a private boolean\n            this._init = false;\n            this._nextSlideSubscription = rxjs.Subscription.EMPTY;\n            this._errorMoveSubscription = rxjs.Subscription.EMPTY;\n            this._formAction = new core.EventEmitter();\n            this.formAction = this._formAction.asObservable();\n            this.formGroup = _rendererService.formGroup;\n            this.slides = _rendererService.nodesTree;\n            this._errorPositions = _rendererService.errorPositions;\n            this.errors = _rendererService.errors;\n            this.slidesNum = _rendererService.slidesNum;\n            this.formIsInit =\n                _rendererService.formInitEvent.pipe(operators.map(function (e) { return e === 1 /* Complete */; }));\n        }\n        Object.defineProperty(AjfFormRenderer.prototype, \"saveDisabled\", {\n            get: function () {\n                return this._saveDisabled;\n            },\n            set: function (saveDisabled) {\n                this._saveDisabled = coercion.coerceBooleanProperty(saveDisabled);\n                this._changeDetectorRef.markForCheck();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"hasStartMessage\", {\n            get: function () {\n                return this._hasStartMessage;\n            },\n            set: function (hasStartMessage) {\n                this._hasStartMessage = coercion.coerceBooleanProperty(hasStartMessage);\n                this._changeDetectorRef.markForCheck();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"hasEndMessage\", {\n            get: function () {\n                return this._hasEndMessage;\n            },\n            set: function (hasEndMessage) {\n                this._hasEndMessage = coercion.coerceBooleanProperty(hasEndMessage);\n                this._changeDetectorRef.markForCheck();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"hideTopToolbar\", {\n            get: function () {\n                return this._hideTopToolbar;\n            },\n            set: function (hideTopToolbar) {\n                this._hideTopToolbar = coercion.coerceBooleanProperty(hideTopToolbar);\n                this._changeDetectorRef.markForCheck();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"hideBottompToolbar\", {\n            get: function () {\n                return this._hideBottomToolbar;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"hideBottomToolbar\", {\n            set: function (hideBottomToolbar) {\n                this._hideBottomToolbar = coercion.coerceBooleanProperty(hideBottomToolbar);\n                this._changeDetectorRef.markForCheck();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"hideNavigationButtons\", {\n            get: function () {\n                return this._hideNavigationButtons;\n            },\n            set: function (hideNavigationButtons) {\n                this._hideNavigationButtons = coercion.coerceBooleanProperty(hideNavigationButtons);\n                this._changeDetectorRef.markForCheck();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"fixedOrientation\", {\n            get: function () {\n                return this._fixedOrientation;\n            },\n            set: function (fixedOrientation) {\n                this._fixedOrientation = coercion.coerceBooleanProperty(fixedOrientation);\n                this._changeDetectorRef.markForCheck();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"readonly\", {\n            get: function () {\n                return this._readonly;\n            },\n            set: function (readonly) {\n                this._readonly = coercion.coerceBooleanProperty(readonly);\n                this._changeDetectorRef.markForCheck();\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"orientation\", {\n            get: function () {\n                return this._orientation;\n            },\n            set: function (orientation) {\n                if (orientation !== 'horizontal' && orientation !== 'vertical') {\n                    return;\n                }\n                if (orientation !== this._orientation) {\n                    this._orientation = orientation;\n                    this._changeDetectorRef.markForCheck();\n                    this._orientationChange.emit(this._orientation);\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AjfFormRenderer.prototype, \"form\", {\n            set: function (form) {\n                this._form = form;\n                if (this._init) {\n                    this._rendererService.setForm(this._form);\n                }\n            },\n            enumerable: true,\n            configurable: true\n        });\n        /**\n         * this method will scroll to next error received by subscribe\n         */\n        AjfFormRenderer.prototype.goToNextError = function () {\n            this._errorMoveEvent.emit(true);\n        };\n        /**\n         * this method will scroll to prev error received by subscribe\n         */\n        AjfFormRenderer.prototype.goToPrevError = function () {\n            this._errorMoveEvent.emit(false);\n        };\n        /**\n         * this method will add group\n         */\n        AjfFormRenderer.prototype.addGroup = function (nodeGroup) {\n            var _this = this;\n            var s = this._rendererService.addGroup(nodeGroup)\n                .pipe(operators.delayWhen(function () { return _this.formSlider.pageScrollFinish; }))\n                .subscribe(function (r) {\n                if (r && _this.formSlider != null) {\n                    _this.formSlider.slide({ dir: 'down' });\n                }\n            }, function (_e) {\n                if (s) {\n                    s.unsubscribe();\n                }\n            }, function () {\n                if (s) {\n                    s.unsubscribe();\n                }\n            });\n        };\n        /**\n         * this method will remove group\n         */\n        AjfFormRenderer.prototype.removeGroup = function (nodeGroup) {\n            var _this = this;\n            var s = this._rendererService.removeGroup(nodeGroup)\n                .pipe(operators.delayWhen(function () { return _this.formSlider.pageScrollFinish; }))\n                .subscribe(function (r) {\n                if (r && _this.formSlider != null) {\n                    _this.formSlider.slide({ dir: 'up' });\n                }\n            }, function (_e) {\n                if (s) {\n                    s.unsubscribe();\n                }\n            }, function () {\n                if (s) {\n                    s.unsubscribe();\n                }\n            });\n        };\n        AjfFormRenderer.prototype.onSave = function (_evt) {\n            this._formAction.emit({ source: this, action: 'save', value: this._rendererService.getFormValue() });\n        };\n        AjfFormRenderer.prototype.onFormAction = function (_evt, action) {\n            this._formAction.emit({ source: this, value: this._rendererService.getFormValue(), action: action });\n        };\n        /**\n         * this method will set current form in rederer service when init form\n         */\n        AjfFormRenderer.prototype.ngAfterViewInit = function () {\n            if (this._form != null) {\n                this._rendererService.setForm(this._form);\n                this._changeDetectorRef.detectChanges();\n            }\n        };\n        AjfFormRenderer.prototype.ngAfterViewChecked = function () {\n            var _this = this;\n            if (!this._init && this.formSlider != null) {\n                this._init = true;\n                this._errorMoveSubscription =\n                    this._errorMoveEvent\n                        .pipe(operators.withLatestFrom(this._errorPositions))\n                        .subscribe(function (v) {\n                        var move = v[0];\n                        var currentPosition = _this.formSlider.currentPage - (+_this.hasStartMessage) + 1;\n                        var errors = v[1];\n                        if (errors == null) {\n                            return;\n                        }\n                        var found = false;\n                        var prevIdx = -1;\n                        var nextIdx = -1;\n                        var idx = 0;\n                        var errorsLen = errors.length;\n                        while (!found && idx < errorsLen) {\n                            if (errors[idx] == currentPosition) {\n                                found = true;\n                                prevIdx = idx > 0 ? idx - 1 : errorsLen - 1;\n                                nextIdx = idx < errorsLen - 1 ? idx + 1 : 0;\n                            }\n                            else if (errors[idx] > currentPosition) {\n                                found = true;\n                                prevIdx = idx > 0 ? idx - 1 : errorsLen - 1;\n                                nextIdx = idx;\n                            }\n                            idx++;\n                        }\n                        if (!found) {\n                            prevIdx = errorsLen - 1;\n                            nextIdx = 0;\n                        }\n                        _this.formSlider.slide({ to: move ? errors[nextIdx] - 1 : errors[prevIdx] - 1 });\n                        _this._changeDetectorRef.detectChanges();\n                    });\n            }\n        };\n        AjfFormRenderer.prototype.ngOnDestroy = function () {\n            this._nextSlideSubscription.unsubscribe();\n            this._errorMoveSubscription.unsubscribe();\n            this._orientationChange.complete();\n            this._errorMoveEvent.complete();\n            this._formAction.complete();\n        };\n        AjfFormRenderer.prototype.orientationChangeHandler = function (orientation) {\n            this.orientation = orientation;\n        };\n        AjfFormRenderer.prototype.trackNodeById = function (_, node) {\n            return nodeInstanceCompleteName(node);\n        };\n        AjfFormRenderer.decorators = [\n            { type: core.Directive }\n        ];\n        /** @nocollapse */\n        AjfFormRenderer.ctorParameters = function () { return [\n            { type: AjfFormRendererService },\n            { type: core.ChangeDetectorRef }\n        ]; };\n        AjfFormRenderer.propDecorators = {\n            title: [{ type: core.Input }],\n            orientationChange: [{ type: core.Output }],\n            saveDisabled: [{ type: core.Input }],\n            hasStartMessage: [{ type: core.Input }],\n            hasEndMessage: [{ type: core.Input }],\n            hideTopToolbar: [{ type: core.Input }],\n            hideBottomToolbar: [{ type: core.Input }],\n            hideNavigationButtons: [{ type: core.Input }],\n            fixedOrientation: [{ type: core.Input }],\n            readonly: [{ type: core.Input }],\n            orientation: [{ type: core.Input }],\n            formSlider: [{ type: core.ViewChild, args: ['formSlider', { static: false },] }],\n            fields: [{ type: core.ViewChildren, args: [AjfFormField,] }],\n            formAction: [{ type: core.Output }],\n            form: [{ type: core.Input }]\n        };\n        return AjfFormRenderer;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfGetTableCellControlPipe = /** @class */ (function () {\n        function AjfGetTableCellControlPipe() {\n        }\n        AjfGetTableCellControlPipe.prototype.transform = function (ctrl) {\n            if (ctrl == null || typeof ctrl === 'string') {\n                return null;\n            }\n            return ctrl;\n        };\n        AjfGetTableCellControlPipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfGetTableCellControl' },] }\n        ];\n        return AjfGetTableCellControlPipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfIncrementPipe = /** @class */ (function () {\n        function AjfIncrementPipe() {\n        }\n        AjfIncrementPipe.prototype.transform = function (value, increment) {\n            if (increment === void 0) { increment = 1; }\n            return value + increment;\n        };\n        AjfIncrementPipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfIncrement' },] }\n        ];\n        return AjfIncrementPipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfIsCellEditablePipe = /** @class */ (function () {\n        function AjfIsCellEditablePipe() {\n        }\n        AjfIsCellEditablePipe.prototype.transform = function (cell) {\n            if (cell == null || typeof cell === 'string') {\n                return false;\n            }\n            return cell.editable === true;\n        };\n        AjfIsCellEditablePipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfIsCellEditable' },] }\n        ];\n        return AjfIsCellEditablePipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfIsRepeatingSlideInstancePipe = /** @class */ (function () {\n        function AjfIsRepeatingSlideInstancePipe() {\n        }\n        AjfIsRepeatingSlideInstancePipe.prototype.transform = function (instance) {\n            return isRepeatingSlideInstance(instance);\n        };\n        AjfIsRepeatingSlideInstancePipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfIsRepeatingSlideInstance' },] }\n        ];\n        return AjfIsRepeatingSlideInstancePipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfNodeCompleteNamePipe = /** @class */ (function () {\n        function AjfNodeCompleteNamePipe() {\n        }\n        AjfNodeCompleteNamePipe.prototype.transform = function (instance) {\n            return instance ? nodeInstanceCompleteName(instance) : '';\n        };\n        AjfNodeCompleteNamePipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfNodeCompleteName' },] }\n        ];\n        return AjfNodeCompleteNamePipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfRangePipe = /** @class */ (function () {\n        function AjfRangePipe() {\n        }\n        AjfRangePipe.prototype.transform = function (size, start, step) {\n            if (size === void 0) { size = 0; }\n            if (start === void 0) { start = 1; }\n            if (step === void 0) { step = 1; }\n            var range = [];\n            for (var length_1 = 0; length_1 < size; ++length_1) {\n                range.push(start);\n                start += step;\n            }\n            return range;\n        };\n        AjfRangePipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfRange' },] }\n        ];\n        return AjfRangePipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfInputFieldComponent = /** @class */ (function (_super) {\n        __extends(AjfInputFieldComponent, _super);\n        function AjfInputFieldComponent() {\n            var _this = _super !== null && _super.apply(this, arguments) || this;\n            _this.type = 'text';\n            return _this;\n        }\n        return AjfInputFieldComponent;\n    }(AjfBaseFieldComponent));\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AJF_WARNING_ALERT_SERVICE = new core.InjectionToken('ajf-warning-alert-service');\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfReadOnlyFieldComponent = /** @class */ (function (_super) {\n        __extends(AjfReadOnlyFieldComponent, _super);\n        function AjfReadOnlyFieldComponent(cdr, service, was) {\n            return _super.call(this, cdr, service, was) || this;\n        }\n        AjfReadOnlyFieldComponent.decorators = [\n            { type: core.Component, args: [{\n                        selector: 'ajf-read-only-field',\n                        template: \"<span *ngIf=\\\"control|async as ctrl\\\">{{ctrl.value}}</span>\\n\",\n                        changeDetection: core.ChangeDetectionStrategy.OnPush,\n                        encapsulation: core.ViewEncapsulation.None,\n                        styles: [\"ajf-read-only-field span{min-height:1em;display:block}\\n\"]\n                    }] }\n        ];\n        /** @nocollapse */\n        AjfReadOnlyFieldComponent.ctorParameters = function () { return [\n            { type: core.ChangeDetectorRef },\n            { type: AjfFormRendererService },\n            { type: undefined, decorators: [{ type: core.Inject, args: [AJF_WARNING_ALERT_SERVICE,] }] }\n        ]; };\n        return AjfReadOnlyFieldComponent;\n    }(AjfInputFieldComponent));\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfReadOnlyTableFieldComponent = /** @class */ (function (_super) {\n        __extends(AjfReadOnlyTableFieldComponent, _super);\n        function AjfReadOnlyTableFieldComponent(cdr, service, was) {\n            return _super.call(this, cdr, service, was) || this;\n        }\n        AjfReadOnlyTableFieldComponent.decorators = [\n            { type: core.Component, args: [{\n                        template: \"<table class=\\\"ajf-table-field\\\">\\n  <ng-container *ngIf=\\\"instance.node as node\\\">\\n    <ng-container *ngFor=\\\"let columns of instance.controls; let row = index\\\">\\n      <tr [ngClass]=\\\"row | ajfTableRowClass\\\">\\n        <td>\\n          <ng-container *ngIf=\\\"columns && columns.length > 0 && columns[0] != null\\\">\\n            {{ columns[0] | ajfTranslateIfString | ajfFormatIfNumber: '.0-2' }}\\n          </ng-container>\\n        </td>\\n        <ng-container *ngIf=\\\"columns && columns.length > 1 && columns[1] != null\\\">\\n          <td *ngFor=\\\"let c of columns[1]; let column = index\\\">\\n            <ng-container *ngIf=\\\"c|ajfGetTableCellControl as contr\\\">\\n              <ng-container *ngIf=\\\"contr != null\\\">\\n                <span *ngIf=\\\"row > 0; else labelCell\\\"\\n                  class=\\\"ajf-table-cell\\\">{{ contr.control!.value | ajfTranslateIfString | ajfFormatIfNumber: '.0-2' }}</span>\\n                <ng-template #labelCell>{{ contr | ajfTranslateIfString | ajfFormatIfNumber: '.0-2' }}</ng-template>\\n              </ng-container>\\n            </ng-container>\\n          </td>\\n        </ng-container>\\n      </tr>\\n    </ng-container>\\n  </ng-container>\\n</table>\\n\",\n                        changeDetection: core.ChangeDetectionStrategy.OnPush,\n                        encapsulation: core.ViewEncapsulation.None,\n                        styles: [\"\\n\"]\n                    }] }\n        ];\n        /** @nocollapse */\n        AjfReadOnlyTableFieldComponent.ctorParameters = function () { return [\n            { type: core.ChangeDetectorRef },\n            { type: AjfFormRendererService },\n            { type: undefined, decorators: [{ type: core.Inject, args: [AJF_WARNING_ALERT_SERVICE,] }] }\n        ]; };\n        return AjfReadOnlyTableFieldComponent;\n    }(AjfBaseFieldComponent));\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfTableRowClass = /** @class */ (function () {\n        function AjfTableRowClass() {\n        }\n        AjfTableRowClass.prototype.transform = function (value) {\n            return value % 2 == 0 ? 'ajf-row-even' : 'ajf-row-odd';\n        };\n        AjfTableRowClass.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfTableRowClass' },] }\n        ];\n        return AjfTableRowClass;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfTableVisibleColumnsPipe = /** @class */ (function () {\n        function AjfTableVisibleColumnsPipe() {\n        }\n        AjfTableVisibleColumnsPipe.prototype.transform = function (instance) {\n            if (!instance.node.editable) {\n                var val = instance.value || [];\n                return instance.hideEmptyRows ?\n                    val.filter(function (col) { return col[1].reduce(function (prev, cur) {\n                        return prev || (cur != null && cur !== '' && cur !== 0 && cur !== '0');\n                    }, false); })\n                        .map(function (v) { return __spread([v[0]], v[1]); }) :\n                    val.map(function (v) { return __spread([v[0]], v[1]); });\n            }\n            return (instance.controls || [])\n                .map(function (v) { return __spread([v[0]], v[1]); });\n        };\n        AjfTableVisibleColumnsPipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfTableVisibleColumns' },] }\n        ];\n        return AjfTableVisibleColumnsPipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfValidSlidePipe = /** @class */ (function () {\n        function AjfValidSlidePipe() {\n        }\n        AjfValidSlidePipe.prototype.transform = function (slide, idx) {\n            if (idx == null || typeof idx !== 'number') {\n                return false;\n            }\n            if (idx >= slide.slideNodes.length) {\n                return true;\n            }\n            return slide.slideNodes[idx]\n                .map(function (n) {\n                if (n.visible && Object.keys(n).indexOf('valid') > -1) {\n                    return n.valid;\n                }\n                return true;\n            })\n                .reduce(function (v1, v2) { return v1 && v2; }, true);\n        };\n        AjfValidSlidePipe.decorators = [\n            { type: core.Pipe, args: [{ name: 'ajfValidSlide', pure: false },] }\n        ];\n        return AjfValidSlidePipe;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFormsModule = /** @class */ (function () {\n        function AjfFormsModule() {\n        }\n        AjfFormsModule.decorators = [\n            { type: core.NgModule, args: [{\n                        declarations: [\n                            AjfAsFieldInstancePipe,\n                            AjfAsRepeatingSlideInstancePipe,\n                            AjfBoolToIntPipe,\n                            AjfDateValuePipe,\n                            AjfDateValueStringPipe,\n                            AjfExpandFieldWithChoicesPipe,\n                            AjfFieldHost,\n                            AjfFieldIconPipe,\n                            AjfFieldIsValidPipe,\n                            AjfGetTableCellControlPipe,\n                            AjfIncrementPipe,\n                            AjfIsCellEditablePipe,\n                            AjfIsRepeatingSlideInstancePipe,\n                            AjfNodeCompleteNamePipe,\n                            AjfRangePipe,\n                            AjfReadOnlyFieldComponent,\n                            AjfReadOnlyTableFieldComponent,\n                            AjfTableRowClass,\n                            AjfTableVisibleColumnsPipe,\n                            AjfValidSlidePipe,\n                        ],\n                        imports: [common.AjfCommonModule, common$1.CommonModule],\n                        exports: [\n                            AjfAsFieldInstancePipe,\n                            AjfAsRepeatingSlideInstancePipe,\n                            AjfBoolToIntPipe,\n                            AjfDateValuePipe,\n                            AjfDateValueStringPipe,\n                            AjfExpandFieldWithChoicesPipe,\n                            AjfFieldHost,\n                            AjfFieldIconPipe,\n                            AjfFieldIsValidPipe,\n                            AjfGetTableCellControlPipe,\n                            AjfIncrementPipe,\n                            AjfIsCellEditablePipe,\n                            AjfIsRepeatingSlideInstancePipe,\n                            AjfNodeCompleteNamePipe,\n                            AjfRangePipe,\n                            AjfReadOnlyFieldComponent,\n                            AjfReadOnlyTableFieldComponent,\n                            AjfTableRowClass,\n                            AjfTableVisibleColumnsPipe,\n                            AjfValidSlidePipe,\n                        ],\n                        providers: [\n                            AjfDateValueStringPipe,\n                            AjfFormRendererService,\n                            AjfValidationService,\n                        ],\n                    },] }\n        ];\n        return AjfFormsModule;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function getTypeName(v) {\n        var typeStr = typeof v;\n        return typeStr === 'object' ? v.constructor.toString().match(/\\w+/g)[1] : typeStr;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AJF_SEARCH_ALERT_THRESHOLD = new core.InjectionToken('AJF_SEARCH_ALERT_THRESHOLD');\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createAttachmentsOrigin(origin) {\n        return __assign(__assign({}, origin), { attachments: origin.attachments || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfAttachmentsOriginSerializer = /** @class */ (function () {\n        function AjfAttachmentsOriginSerializer() {\n        }\n        AjfAttachmentsOriginSerializer.fromJson = function (origin) {\n            if (origin.name == null) {\n                throw new Error('Malformed attachments origin');\n            }\n            return createAttachmentsOrigin(origin);\n        };\n        return AjfAttachmentsOriginSerializer;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createChoicesOrigin(origin) {\n        return __assign(__assign({}, origin), { type: origin.type, label: origin.label || '', choices: origin.choices || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfChoicesOriginSerializer = /** @class */ (function () {\n        function AjfChoicesOriginSerializer() {\n        }\n        AjfChoicesOriginSerializer.fromJson = function (origin) {\n            return createChoicesOrigin(__assign(__assign({}, origin), { type: origin.type || 'fixed', name: origin.name || '' }));\n        };\n        return AjfChoicesOriginSerializer;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createFieldWithChoices(field) {\n        var node = createField(__assign({}, field));\n        return __assign(__assign(__assign({}, node), field), { choices: field.choices || [], forceExpanded: field.forceExpanded || false, forceNarrow: field.forceNarrow || false });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createContainerNode(containerNode) {\n        var node = createNode(containerNode);\n        return __assign(__assign({}, node), { nodes: containerNode.nodes || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createRepeatingNode(repeatingNode) {\n        var node = createNode(repeatingNode);\n        return __assign(__assign(__assign({}, repeatingNode), node), { minReps: repeatingNode.minReps != null ? repeatingNode.minReps : 1, maxReps: repeatingNode.maxReps != null ? repeatingNode.maxReps : 0 });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createNodeGroup(nodeGroup) {\n        return __assign(__assign(__assign({}, createContainerNode(nodeGroup)), createRepeatingNode(nodeGroup)), { nodeType: exports.AjfNodeType.AjfNodeGroup });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createRepeatingSlide(nodeGroup) {\n        return __assign(__assign(__assign({}, createContainerNode(nodeGroup)), createRepeatingNode(nodeGroup)), { nodeType: exports.AjfNodeType.AjfRepeatingSlide });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createSlide(nodeGroup) {\n        return __assign(__assign({}, createContainerNode(nodeGroup)), { nodeType: exports.AjfNodeType.AjfSlide });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfValidationGroupSerializer = /** @class */ (function () {\n        function AjfValidationGroupSerializer() {\n        }\n        AjfValidationGroupSerializer.fromJson = function (group) {\n            return createValidationGroup(group);\n        };\n        return AjfValidationGroupSerializer;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfWarningGroupSerializer = /** @class */ (function () {\n        function AjfWarningGroupSerializer() {\n        }\n        AjfWarningGroupSerializer.fromJson = function (group) {\n            return createWarningGroup(group);\n        };\n        return AjfWarningGroupSerializer;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfNodeSerializer = /** @class */ (function () {\n        function AjfNodeSerializer() {\n        }\n        AjfNodeSerializer.fromJson = function (json, choicesOrigins, attachmentsOrigins) {\n            var err = 'Malformed node';\n            json.name = json.name || '';\n            if (json.id == null || json.parent == null || json.nodeType == null) {\n                throw new Error(err);\n            }\n            var obj = json;\n            if (obj.visibility) {\n                obj.visibility = models.AjfConditionSerializer.fromJson(obj.visibility);\n            }\n            obj.conditionalBranches =\n                (obj.conditionalBranches || []).map(function (c) { return models.AjfConditionSerializer.fromJson(c); });\n            switch (obj.nodeType) {\n                case exports.AjfNodeType.AjfField:\n                    return AjfNodeSerializer._fieldFromJson(obj, choicesOrigins, attachmentsOrigins);\n                case exports.AjfNodeType.AjfFieldNodeLink:\n                    return AjfNodeSerializer._fieldNodeLinkFromJson(obj);\n                case exports.AjfNodeType.AjfNodeGroup:\n                    return AjfNodeSerializer._nodeGroupFromJson(obj, choicesOrigins, attachmentsOrigins);\n                case exports.AjfNodeType.AjfRepeatingSlide:\n                    return AjfNodeSerializer._repeatingSlideFromJson(obj, choicesOrigins, attachmentsOrigins);\n                case exports.AjfNodeType.AjfSlide:\n                    return AjfNodeSerializer._slideFromJson(obj, choicesOrigins, attachmentsOrigins);\n            }\n            throw new Error(err);\n        };\n        AjfNodeSerializer._containerNodeFromJson = function (json, choicesOrigins, attachmentsOrigins) {\n            json.nodes = (json.nodes ||\n                []).map(function (n) { return AjfNodeSerializer.fromJson(n, choicesOrigins, attachmentsOrigins); });\n            return createContainerNode(json);\n        };\n        AjfNodeSerializer._fieldFromJson = function (json, choicesOrigins, attachmentsOrigins) {\n            if (json.fieldType == null) {\n                throw new Error('Malformed field');\n            }\n            var obj = json;\n            if (obj.validation) {\n                obj.validation = AjfValidationGroupSerializer.fromJson(obj.validation);\n            }\n            if (obj.warning) {\n                obj.warning = AjfWarningGroupSerializer.fromJson(obj.warning);\n            }\n            if (json.attachmentsOriginRef) {\n                obj.attachmentOrigin =\n                    (attachmentsOrigins || []).find(function (a) { return a.name === json.attachmentsOriginRef; });\n            }\n            if (obj.nextSlideCondition) {\n                obj.nextSlideCondition = models.AjfConditionSerializer.fromJson(obj.nextSlideCondition);\n            }\n            var isCustomFieldWithChoice = obj.fieldType > 100 && componentsMap[obj.fieldType] != null &&\n                componentsMap[obj.fieldType].isFieldWithChoice === true;\n            if (isCustomFieldWithChoice) {\n                return AjfNodeSerializer._fieldWithChoicesFromJson(json, choicesOrigins);\n            }\n            switch (obj.fieldType) {\n                case exports.AjfFieldType.Formula:\n                    return AjfNodeSerializer._formulaFieldFromJson(json);\n                case exports.AjfFieldType.MultipleChoice:\n                case exports.AjfFieldType.SingleChoice:\n                    return AjfNodeSerializer._fieldWithChoicesFromJson(json, choicesOrigins);\n            }\n            return createField(obj);\n        };\n        AjfNodeSerializer._fieldNodeLinkFromJson = function (json) {\n            return __assign(__assign({}, createNode(json)), { nodeType: exports.AjfNodeType.AjfFieldNodeLink });\n        };\n        AjfNodeSerializer._fieldWithChoicesFromJson = function (json, choicesOrigins) {\n            var err = 'Malformed field with choices';\n            if (json.choicesOriginRef == null) {\n                throw new Error(err);\n            }\n            var choicesOrigin = (choicesOrigins || []).find(function (c) { return c.name === json.choicesOriginRef; });\n            if (choicesOrigin == null) {\n                throw new Error(err);\n            }\n            if (json.choicesFilter) {\n                json.choicesFilter = models.AjfFormulaSerializer.fromJson(json.choicesFilter);\n            }\n            if (json.triggerConditions) {\n                json.triggerConditions = json.triggerConditions.map(function (t) { return models.AjfConditionSerializer.fromJson(t); });\n            }\n            return createFieldWithChoices(__assign(__assign({}, json), { choicesOrigin: choicesOrigin }));\n        };\n        AjfNodeSerializer._formulaFieldFromJson = function (json) {\n            if (json.formula) {\n                json.formula = models.AjfFormulaSerializer.fromJson(json.formula);\n            }\n            return __assign(__assign({}, createField(json)), { fieldType: exports.AjfFieldType.Formula });\n        };\n        AjfNodeSerializer._nodeGroupFromJson = function (json, choicesOrigins, attachmentsOrigins) {\n            return createNodeGroup(__assign(__assign({}, AjfNodeSerializer._containerNodeFromJson(json, choicesOrigins, attachmentsOrigins)), AjfNodeSerializer._repeatingNodeFromJson(json)));\n        };\n        AjfNodeSerializer._repeatingNodeFromJson = function (json) {\n            if (json.formulaReps) {\n                json.formulaReps = models.AjfFormulaSerializer.fromJson(json.formulaReps);\n            }\n            return createRepeatingNode(json);\n        };\n        AjfNodeSerializer._repeatingSlideFromJson = function (json, choicesOrigins, attachmentsOrigins) {\n            return createRepeatingSlide(__assign(__assign({}, AjfNodeSerializer._containerNodeFromJson(json, choicesOrigins, attachmentsOrigins)), AjfNodeSerializer._repeatingNodeFromJson(json)));\n        };\n        AjfNodeSerializer._slideFromJson = function (json, choicesOrigins, attachmentsOrigins) {\n            return createSlide(AjfNodeSerializer._containerNodeFromJson(json, choicesOrigins, attachmentsOrigins));\n        };\n        return AjfNodeSerializer;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfFormSerializer = /** @class */ (function () {\n        function AjfFormSerializer() {\n        }\n        AjfFormSerializer.fromJson = function (form, context) {\n            var choicesOrigins = (form.choicesOrigins || []).map(function (c) { return AjfChoicesOriginSerializer.fromJson(c); });\n            var attachmentsOrigins = (form.attachmentsOrigins || []).map(function (a) { return AjfAttachmentsOriginSerializer.fromJson(a); });\n            var nodes = (form.nodes || [])\n                .map(function (n) { return AjfNodeSerializer.fromJson(n, choicesOrigins, attachmentsOrigins); });\n            return __assign(__assign({}, form), { choicesOrigins: choicesOrigins,\n                attachmentsOrigins: attachmentsOrigins,\n                nodes: nodes, stringIdentifier: form.stringIdentifier || [], initContext: utils.deepCopy(context || {}) });\n        };\n        return AjfFormSerializer;\n    }());\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    var AjfTableFieldComponent = /** @class */ (function (_super) {\n        __extends(AjfTableFieldComponent, _super);\n        function AjfTableFieldComponent(cdr, service, was) {\n            return _super.call(this, cdr, service, was) || this;\n        }\n        AjfTableFieldComponent.prototype.goToNextCell = function (ev, row, column) {\n            if (this.instance.controls.length < row ||\n                (this.instance.controls.length >= row && this.instance.controls[row].length < 1) ||\n                this.instance.controls[row][1].length < column) {\n                return;\n            }\n            var rowLength = this.instance.controls[row][1].length;\n            var currentCell = this.instance.controls[row][1][column];\n            if (column + 1 >= rowLength) {\n                column = 0;\n                if (row + 1 >= this.instance.controls.length) {\n                    row = 1;\n                }\n                else {\n                    row += 1;\n                }\n            }\n            else {\n                column += 1;\n            }\n            if (typeof currentCell !== 'string') {\n                currentCell.show = false;\n            }\n            this._showCell(row, column);\n            ev.preventDefault();\n            ev.stopPropagation();\n        };\n        AjfTableFieldComponent.prototype.goToCell = function (row, column) {\n            this._resetControls();\n            this._showCell(row, column);\n        };\n        AjfTableFieldComponent.prototype._resetControls = function () {\n            this.instance.controls.forEach(function (row) { return row[1].forEach(function (cell) {\n                if (typeof cell !== 'string') {\n                    cell.show = false;\n                }\n            }); });\n        };\n        AjfTableFieldComponent.prototype._showCell = function (row, column) {\n            if (row >= this.instance.controls.length || column >= this.instance.controls[row][1].length) {\n                return;\n            }\n            var nextCell = this.instance.controls[row][1][column];\n            if (typeof nextCell !== 'string') {\n                nextCell.show = true;\n            }\n        };\n        /** @nocollapse */\n        AjfTableFieldComponent.ctorParameters = function () { return [\n            { type: core.ChangeDetectorRef },\n            { type: AjfFormRendererService },\n            { type: undefined, decorators: [{ type: core.Inject, args: [AJF_WARNING_ALERT_SERVICE,] }] }\n        ]; };\n        return AjfTableFieldComponent;\n    }(AjfBaseFieldComponent));\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createChoicesFixedOrigin(origin) {\n        var type = 'fixed';\n        return __assign(__assign({}, createChoicesOrigin(__assign(__assign({}, origin), { type: type }))), { type: type });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createChoicesFunctionOrigin(origin) {\n        return __assign(__assign({}, origin), { type: 'function', label: origin.label || '', choices: origin.choices || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createChoicesObservableArrayOrigin(origin) {\n        return __assign(__assign({}, origin), { type: 'observableArray', label: origin.label || '', choices: origin.choices || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createChoicesObservableOrigin(origin) {\n        return __assign(__assign({}, origin), { type: 'observable', label: origin.label || '', choices: origin.choices || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createChoicesPromiseOrigin(origin) {\n        return __assign(__assign({}, origin), { type: 'promise', label: origin.label || '', choices: origin.choices || [] });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isChoicesOrigin(co) {\n        return co != null && typeof co === 'object' && co.name != null && typeof co.name === 'string' &&\n            co.label != null && typeof co.label === 'string' &&\n            ['fixed', 'promise', 'observable', 'observableArray', 'function'].indexOf(co.type) > -1 &&\n            co.choices instanceof Array;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isChoicesFixedOrigin(origin) {\n        return isChoicesOrigin(origin) && origin.type === 'fixed';\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function isNumberField(field) {\n        return field.fieldType === exports.AjfFieldType.Number;\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function createForm(form) {\n        if (form === void 0) { form = {}; }\n        return {\n            nodes: form.nodes || [],\n            choicesOrigins: form.choicesOrigins || [],\n            attachmentsOrigins: form.attachmentsOrigins || [],\n            initContext: form.initContext || {},\n            stringIdentifier: form.stringIdentifier || [],\n            supplementaryInformations: form.supplementaryInformations,\n        };\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function maxDigitsValidation(maxValue) {\n        return createValidation({\n            condition: \"$value ? $value.toString().length <= \" + maxValue.toString() + \" : false\",\n            errorMessage: 'Digits count must be <= ' + maxValue.toString()\n        });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function maxValidation(maxValue) {\n        return createValidation({\n            condition: '$value <= ' + maxValue.toString(),\n            errorMessage: 'Value must be <= ' + maxValue.toString()\n        });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function minDigitsValidation(minValue) {\n        return createValidation({\n            condition: \"$value ? $value.toString().length >= \" + minValue.toString() + \" : false\",\n            errorMessage: 'Digits count must be >= ' + minValue.toString()\n        });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function minValidation(minValue) {\n        return createValidation({\n            condition: '$value >= ' + minValue.toString(),\n            errorMessage: 'Value must be >= ' + minValue.toString()\n        });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function notEmptyValidation() {\n        return createValidation({ condition: \"notEmpty($value)\", errorMessage: \"Value must not be empty\" });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n    function notEmptyWarning() {\n        return createWarning({ condition: 'notEmpty($value)', warningMessage: 'Value must not be empty' });\n    }\n\n    /**\n     * @license\n     * Copyright (C) Gnucoop soc. coop.\n     *\n     * This file is part of the Advanced JSON forms (ajf).\n     *\n     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n     * modify it under the terms of the GNU Affero General Public License as\n     * published by the Free Software Foundation, either version 3 of the License,\n     * or (at your option) any later version.\n     *\n     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n     * but WITHOUT ANY WARRANTY; without even the implied warranty of\n     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n     * General Public License for more details.\n     *\n     * You should have received a copy of the GNU Affero General Public License\n     * along with Advanced JSON forms (ajf).\n     * If not, see http://www.gnu.org/licenses/.\n     *\n     */\n\n    /**\n     * Generated bundle index. Do not edit.\n     */\n\n    exports.AJF_SEARCH_ALERT_THRESHOLD = AJF_SEARCH_ALERT_THRESHOLD;\n    exports.AJF_WARNING_ALERT_SERVICE = AJF_WARNING_ALERT_SERVICE;\n    exports.AjfAsFieldInstancePipe = AjfAsFieldInstancePipe;\n    exports.AjfAsRepeatingSlideInstancePipe = AjfAsRepeatingSlideInstancePipe;\n    exports.AjfAttachmentsOriginSerializer = AjfAttachmentsOriginSerializer;\n    exports.AjfBaseFieldComponent = AjfBaseFieldComponent;\n    exports.AjfBoolToIntPipe = AjfBoolToIntPipe;\n    exports.AjfChoicesOriginSerializer = AjfChoicesOriginSerializer;\n    exports.AjfDateValuePipe = AjfDateValuePipe;\n    exports.AjfDateValueStringPipe = AjfDateValueStringPipe;\n    exports.AjfExpandFieldWithChoicesPipe = AjfExpandFieldWithChoicesPipe;\n    exports.AjfFieldHost = AjfFieldHost;\n    exports.AjfFieldIconPipe = AjfFieldIconPipe;\n    exports.AjfFieldIsValidPipe = AjfFieldIsValidPipe;\n    exports.AjfFieldService = AjfFieldService;\n    exports.AjfFieldWithChoicesComponent = AjfFieldWithChoicesComponent;\n    exports.AjfFormActionEvent = AjfFormActionEvent;\n    exports.AjfFormField = AjfFormField;\n    exports.AjfFormRenderer = AjfFormRenderer;\n    exports.AjfFormRendererService = AjfFormRendererService;\n    exports.AjfFormSerializer = AjfFormSerializer;\n    exports.AjfFormsModule = AjfFormsModule;\n    exports.AjfGetTableCellControlPipe = AjfGetTableCellControlPipe;\n    exports.AjfIncrementPipe = AjfIncrementPipe;\n    exports.AjfInputFieldComponent = AjfInputFieldComponent;\n    exports.AjfInvalidFieldDefinitionError = AjfInvalidFieldDefinitionError;\n    exports.AjfIsCellEditablePipe = AjfIsCellEditablePipe;\n    exports.AjfIsRepeatingSlideInstancePipe = AjfIsRepeatingSlideInstancePipe;\n    exports.AjfNodeCompleteNamePipe = AjfNodeCompleteNamePipe;\n    exports.AjfNodeSerializer = AjfNodeSerializer;\n    exports.AjfRangePipe = AjfRangePipe;\n    exports.AjfReadOnlyFieldComponent = AjfReadOnlyFieldComponent;\n    exports.AjfReadOnlyTableFieldComponent = AjfReadOnlyTableFieldComponent;\n    exports.AjfTableFieldComponent = AjfTableFieldComponent;\n    exports.AjfTableRowClass = AjfTableRowClass;\n    exports.AjfTableVisibleColumnsPipe = AjfTableVisibleColumnsPipe;\n    exports.AjfValidSlidePipe = AjfValidSlidePipe;\n    exports.AjfValidationGroupSerializer = AjfValidationGroupSerializer;\n    exports.AjfValidationService = AjfValidationService;\n    exports.AjfWarningGroupSerializer = AjfWarningGroupSerializer;\n    exports.createChoicesFixedOrigin = createChoicesFixedOrigin;\n    exports.createChoicesFunctionOrigin = createChoicesFunctionOrigin;\n    exports.createChoicesObservableArrayOrigin = createChoicesObservableArrayOrigin;\n    exports.createChoicesObservableOrigin = createChoicesObservableOrigin;\n    exports.createChoicesOrigin = createChoicesOrigin;\n    exports.createChoicesPromiseOrigin = createChoicesPromiseOrigin;\n    exports.createContainerNode = createContainerNode;\n    exports.createField = createField;\n    exports.createFieldInstance = createFieldInstance;\n    exports.createFieldWithChoicesInstance = createFieldWithChoicesInstance;\n    exports.createForm = createForm;\n    exports.createNode = createNode;\n    exports.createNodeInstance = createNodeInstance;\n    exports.createValidation = createValidation;\n    exports.createValidationGroup = createValidationGroup;\n    exports.createWarning = createWarning;\n    exports.createWarningGroup = createWarningGroup;\n    exports.fieldIconName = fieldIconName;\n    exports.flattenNodes = flattenNodes;\n    exports.getTypeName = getTypeName;\n    exports.initChoicesOrigin = initChoicesOrigin;\n    exports.isChoicesFixedOrigin = isChoicesFixedOrigin;\n    exports.isChoicesOrigin = isChoicesOrigin;\n    exports.isContainerNode = isContainerNode;\n    exports.isCustomFieldWithChoices = isCustomFieldWithChoices;\n    exports.isField = isField;\n    exports.isFieldWithChoices = isFieldWithChoices;\n    exports.isNumberField = isNumberField;\n    exports.isRepeatingContainerNode = isRepeatingContainerNode;\n    exports.isSlidesNode = isSlidesNode;\n    exports.maxDigitsValidation = maxDigitsValidation;\n    exports.maxValidation = maxValidation;\n    exports.minDigitsValidation = minDigitsValidation;\n    exports.minValidation = minValidation;\n    exports.notEmptyValidation = notEmptyValidation;\n    exports.notEmptyWarning = notEmptyWarning;\n    exports.ɵgc_ajf_src_core_forms_forms_a = createNodeGroup;\n    exports.ɵgc_ajf_src_core_forms_forms_b = createRepeatingSlide;\n    exports.ɵgc_ajf_src_core_forms_forms_c = createSlide;\n    exports.ɵgc_ajf_src_core_forms_forms_d = componentsMap;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=core-forms.umd.js.map\n"]}