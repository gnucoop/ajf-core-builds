{"version":3,"file":"core-forms.umd.min.js","sources":["../../node_modules/tslib/tslib.es6.js","../../src/core/forms/base-field.ts","../../src/core/forms/date-value.ts","../../src/core/forms/date-value-string.ts","../../src/core/forms/errors.ts","../../src/core/forms/interface/fields/field-type.ts","../../src/core/forms/field-utils.ts","../../src/core/forms/field-icon.ts","../../src/core/forms/field-is-valid.ts","../../src/core/forms/field.ts","../../src/core/forms/field-host.ts","../../src/core/forms/utils/fields/fields-map.ts","../../src/core/forms/field-service.ts","../../src/core/forms/field-with-choices.ts","../../src/core/forms/interface/nodes/node-type.ts","../../src/core/forms/utils/fields/is-custom-field-with-choices.ts","../../src/core/forms/utils/fields/is-field-with-choices.ts","../../src/core/forms/utils/nodes/is-field.ts","../../src/core/forms/utils/nodes-instances/is-field-instance.ts","../../src/core/forms/utils/fields-instances/is-field-with-choices-instance.ts","../../src/core/forms/utils/fields-instances/is-table-field-instance.ts","../../src/core/forms/utils/fields/is-table-field.ts","../../src/core/forms/utils/nodes-instances/update-conditional-branches.ts","../../src/core/forms/utils/nodes-instances/update-visibility.ts","../../src/core/forms/utils/nodes-instances/node-instance-suffix.ts","../../src/core/forms/utils/nodes-instances/node-instance-complete-name.ts","../../src/core/forms/utils/fields-instances/update-formula.ts","../../src/core/forms/utils/fields-instances/update-next-slide-condition.ts","../../src/core/forms/utils/validation/evaluate-validation.ts","../../src/core/forms/utils/validation/evaluate-validation-group.ts","../../src/core/forms/utils/validation/evaluate-validation-conditions.ts","../../src/core/forms/utils/validation/evaluate-validation-max-value.ts","../../src/core/forms/utils/validation/evaluate-validation-min-value.ts","../../src/core/forms/utils/validation/evaluate-validation-not-empty.ts","../../src/core/forms/utils/validation/evaluate-validation-max-digits.ts","../../src/core/forms/utils/validation/evaluate-validation-min-digits.ts","../../src/core/forms/utils/fields-instances/update-validation.ts","../../src/core/forms/utils/warning/evaluate-warning-conditions.ts","../../src/core/forms/utils/warning/evaluate-warning.ts","../../src/core/forms/utils/fields-instances/update-warning.ts","../../src/core/forms/utils/warning/evaluate-warning-group.ts","../../src/core/forms/utils/fields-instances/update-filtered-choices.ts","../../src/core/forms/utils/nodes/create-node.ts","../../src/core/forms/utils/fields/create-field.ts","../../src/core/forms/utils/nodes/is-slides-node.ts","../../src/core/forms/utils/nodes/is-container-node.ts","../../src/core/forms/utils/nodes-instances/flatten-nodes-instances.ts","../../src/core/forms/utils/nodes-instances/is-container-node-instance.ts","../../src/core/forms/utils/nodes-instances/is-slides-instance.ts","../../src/core/forms/utils/nodes-instances/is-node-group-instance.ts","../../src/core/forms/utils/nodes/is-node-group.ts","../../src/core/forms/utils/nodes-instances/is-slide-instance.ts","../../src/core/forms/utils/nodes/is-slide-node.ts","../../src/core/forms/utils/nodes-instances/create-node-instance.ts","../../src/core/forms/utils/fields-instances/create-field-instance.ts","../../src/core/forms/utils/fields-instances/create-field-with-choices-instance.ts","../../src/core/forms/utils/slides-instances/create-slide-instance.ts","../../src/core/forms/utils/validation/create-validation-group.ts","../../src/core/forms/utils/warning/create-warning-group.ts","../../src/core/forms/utils/nodes/is-repeating-container-node.ts","../../src/core/forms/utils/nodes-instances/get-ancestor-repeating-nodes-names.ts","../../src/core/forms/utils/nodes-instances/get-ancestor-repeating-nodes.ts","../../src/core/forms/utils/nodes-instances/get-instance-condition.ts","../../src/core/forms/utils/nodes-instances/get-instance-conditions.ts","../../src/core/forms/utils/nodes-instances/get-instance-formula.ts","../../src/core/forms/utils/validation/create-validation.ts","../../src/core/forms/utils/nodes-instances/get-instance-validations.ts","../../src/core/forms/utils/nodes-instances/get-instance-validation.ts","../../src/core/forms/utils/warning/create-warning.ts","../../src/core/forms/utils/nodes-instances/get-instance-warnings.ts","../../src/core/forms/utils/nodes-instances/get-instance-warning.ts","../../src/core/forms/utils/nodes-instances/is-repeating-slide-instance.ts","../../src/core/forms/utils/nodes/is-repeating-slide.ts","../../src/core/forms/utils/nodes-instances/node-to-node-instance.ts","../../src/core/forms/utils/fields-instances/create-table-field-instance.ts","../../src/core/forms/utils/nodes-instances/create-node-group-instance.ts","../../src/core/forms/utils/slides-instances/create-repeating-slide-instance.ts","../../src/core/forms/utils/nodes/flatten-nodes.ts","../../src/core/forms/utils/nodes/ordered-nodes.ts","../../src/core/forms/utils/slides-instances/update-reps-num.ts","../../src/core/forms/validation-service.ts","../../src/core/forms/form-renderer.ts","../../src/core/forms/utils/slides-instances/valid-slide.ts","../../src/core/forms/utils/fields-instances/update-field-instance-state.ts","../../src/core/forms/utils/fields-instances/update-trigger-conditions.ts","../../src/core/forms/utils/nodes-instances/flatten-nodes-instances-tree.ts","../../src/core/forms/form.ts","../../src/core/forms/bool-to-int.ts","../../src/core/forms/expand-input-with-choices.ts","../../src/core/forms/increment.ts","../../src/core/forms/is-repeating-slide.ts","../../src/core/forms/node-complete-name.ts","../../src/core/forms/range.ts","../../src/core/forms/table-row-class.ts","../../src/core/forms/table-visible-columns.ts","../../src/core/forms/valid-slide.ts","../../src/core/forms/forms-module.ts","../../src/core/forms/input-field.ts","../../src/core/forms/search-alert-threshold.ts","../../src/core/forms/serializers/attachments-origin-serializer.ts","../../src/core/forms/utils/attachments/create-attachments-origin.ts","../../src/core/forms/utils/choices/create-choices-origin.ts","../../src/core/forms/serializers/choices-origin-serializer.ts","../../src/core/forms/utils/nodes/create-container-node.ts","../../src/core/forms/utils/nodes/create-repeating-node.ts","../../src/core/forms/utils/nodes/create-node-group.ts","../../src/core/forms/utils/slides/create-repeating-slide.ts","../../src/core/forms/utils/slides/create-slide.ts","../../src/core/forms/serializers/validation-group-serializer.ts","../../src/core/forms/serializers/warning-group-serializer.ts","../../src/core/forms/serializers/node-serializer.ts","../../src/core/forms/utils/fields/create-field-with-choices.ts","../../src/core/forms/serializers/form-serializer.ts","../../src/core/forms/interface/attachments/attachments-type.ts","../../src/core/forms/interface/choices/choices-type.ts","../../src/core/forms/utils/choices/is-choices-origin.ts","../../src/core/forms/utils/choices/create-choices-fixed-origin.ts","../../src/core/forms/utils/choices/create-choices-function-origin.ts","../../src/core/forms/utils/choices/create-choices-observable-array-origin.ts","../../src/core/forms/utils/choices/create-choices-observable-origin.ts","../../src/core/forms/utils/choices/create-choices-promise-origin.ts","../../src/core/forms/utils/forms/create-form.ts","../../src/core/forms/get-type-name.ts","../../src/core/forms/utils/choices/init-choices-origin.ts","../../src/core/forms/utils/choices/is-choices-fixed-origin.ts","../../src/core/forms/utils/fields/is-number-field.ts","../../src/core/forms/utils/validation/max-digits-validation.ts","../../src/core/forms/utils/validation/max-validation.ts","../../src/core/forms/utils/validation/min-digits-validation.ts","../../src/core/forms/utils/validation/min-validation.ts","../../src/core/forms/utils/validation/not-empty-validation.ts","../../src/core/forms/utils/warning/not-empty-warning.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {coerceBooleanProperty} from '@ajf/core/utils';\nimport {ChangeDetectorRef, OnDestroy, OnInit} from '@angular/core';\nimport {AbstractControl, FormControl} from '@angular/forms';\nimport {defer, Observable, Subscription} from 'rxjs';\nimport {filter, map, withLatestFrom} from 'rxjs/operators';\n\nimport {AjfFieldWarningAlertResult} from './field-warning-alert-result';\nimport {AjfFormRendererService} from './form-renderer';\nimport {AjfFieldInstance} from './interface/fields-instances/field-instance';\nimport {AjfWarningAlertService} from './warning-alert-service';\n\nexport abstract class AjfBaseFieldComponent<T extends AjfFieldInstance = AjfFieldInstance>\n    implements OnDestroy, OnInit {\n  private _instance: T;\n  get instance(): T { return this._instance; }\n  set instance(instance: T) {\n    if (instance !== this._instance) {\n      this._instance = instance;\n      this._setUpInstanceUpdate();\n      this._onInstanceChange();\n    }\n  }\n\n  protected _readonly: boolean;\n  get readonly(): boolean { return this._readonly; }\n  set readonly(readonly: boolean) {\n    this._readonly = coerceBooleanProperty(readonly);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _control: Observable<AbstractControl | null>;\n  get control(): Observable<AbstractControl | null> { return this._control; }\n\n  private _warningTriggerSub: Subscription = Subscription.EMPTY;\n  private _instanceUpdateSub: Subscription = Subscription.EMPTY;\n\n  constructor(\n    protected _changeDetectorRef: ChangeDetectorRef,\n    private _service: AjfFormRendererService,\n    private _warningAlertService: AjfWarningAlertService,\n  ) {\n    this._control = defer(() => this._service.getControl(this.instance).pipe(\n      map(ctrl => ctrl || new FormControl()),\n    ));\n  }\n\n  ngOnInit(): void {\n    this._warningTriggerSub = this.instance.warningTrigger.pipe(\n      withLatestFrom(this.control),\n      filter(v => v[1] != null)\n    ).subscribe((v: [void, AbstractControl | null]) => {\n      if (this.instance.warningResults == null) { return; }\n      const control = v[1];\n      const s = this._warningAlertService.showWarningAlertPrompt(\n        this.instance.warningResults.filter(w => w.result).map(w => w.warning)\n      ).subscribe(\n        (r: AjfFieldWarningAlertResult) => {\n          if (r.result) { control!.setValue(null); }\n        },\n        (_e: any) => { if (s) { s.unsubscribe(); }},\n        () => { if (s) { s.unsubscribe(); }}\n      );\n    });\n  }\n\n  ngOnDestroy(): void {\n    this._warningTriggerSub.unsubscribe();\n    this._instanceUpdateSub.unsubscribe();\n  }\n\n  protected _onInstanceChange(): void { }\n\n  private _setUpInstanceUpdate(): void {\n    this._instanceUpdateSub.unsubscribe();\n    if (this._instance != null) {\n      this._instanceUpdateSub = this._instance.updatedEvt.subscribe(() => {\n        if (this._changeDetectorRef) {\n          try {\n            this._changeDetectorRef.detectChanges();\n          } catch (e) { }\n        }\n      });\n    } else {\n      this._instanceUpdateSub = Subscription.EMPTY;\n    }\n    this._changeDetectorRef.detectChanges();\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\n\n@Pipe({name: 'ajfDateValue'})\nexport class AjfDateValuePipe implements PipeTransform {\n  transform(date: Date|'today'|undefined): Date|undefined {\n    if (date == null) { return undefined; }\n    return date === 'today' ? new Date() : date as Date;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable, Pipe, PipeTransform} from '@angular/core';\nimport {format} from 'date-fns';\n\n@Injectable()\n@Pipe({name: 'ajfDateValueString'})\nexport class AjfDateValueStringPipe implements PipeTransform {\n  transform(date: Date|'today'|undefined): string|undefined {\n    if (date == null) { return undefined; }\n    const dateObj = date === 'today' ? new Date() : date;\n    return format(dateObj, 'YYYY-MM-DD');\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfError} from '@ajf/core/models';\n\n/**\n * This class will define an Ajf invalid field definition error\n */\nexport class AjfInvalidFieldDefinitionError extends AjfError {\n  get name(): string { return 'AjfInvalidFieldDefinitionError'; }\n\n  constructor(message?: string) {\n    super(message);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfFieldType {\n  String,\n  Text,\n  Number,\n  Boolean,\n  SingleChoice,\n  MultipleChoice,\n  Formula,\n  Empty,\n  Date,\n  DateInput,\n  Time,\n  Table,\n  Geolocation,\n  Barcode,\n  LENGTH\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfFieldType} from './interface/fields/field-type';\n\nexport function fieldIconName(type: AjfFieldType): string {\n  return `ajf-icon-field-${\n    typeof AjfFieldType[type] === 'string'\n    ? AjfFieldType[type].toLowerCase()\n    : type}`;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\n\nimport {fieldIconName} from './field-utils';\nimport {AjfField} from './interface/fields/field';\nimport {AjfFieldType} from './interface/fields/field-type';\n\n@Pipe({name: 'ajfFieldIcon'})\nexport class AjfFieldIconPipe implements PipeTransform {\n  transform(field: AjfField | AjfFieldType): string {\n    return fieldIconName(\n        (field as AjfField).fieldType ? (field as AjfField).fieldType : field as AjfFieldType);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe} from '@angular/core';\n\nimport {AjfValidationResult} from './interface/validation/validation-results';\n\n@Pipe({name: 'ajfFieldIsValid'})\nexport class AjfFieldIsValidPipe {\n    transform(validationResults?: AjfValidationResult[]): boolean {\n        return validationResults != null\n            && validationResults.filter((f) => !f.result).length === 0;\n    }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {coerceBooleanProperty} from '@ajf/core/utils';\nimport {ChangeDetectorRef, ComponentFactoryResolver, OnDestroy, OnInit} from '@angular/core';\nimport {Subscription} from 'rxjs';\n\nimport {AjfFieldComponentsMap} from './interface/fields/field-components-map';\nimport {AjfFieldInstance} from './interface/fields-instances/field-instance';\nimport {AjfFieldHost} from './field-host';\nimport {AjfBaseFieldComponent} from '.';\n\nexport abstract class AjfFormField implements OnDestroy, OnInit {\n  fieldHost: AjfFieldHost;\n\n  private _instance: AjfFieldInstance;\n  get instance(): AjfFieldInstance { return this._instance; }\n  set instance(instance: AjfFieldInstance) {\n    if (this._instance !== instance) {\n      this._instance = instance;\n      this._loadComponent();\n    }\n  }\n\n  private _readonly: boolean;\n  get readonly(): boolean { return this._readonly; }\n  set readonly(readonly: boolean) {\n    this._readonly = coerceBooleanProperty(readonly);\n    if (this._componentInstance != null) {\n      this._componentInstance.readonly = this._readonly;\n    }\n    this._cdr.markForCheck();\n  }\n\n  private _componentInstance: AjfBaseFieldComponent<AjfFieldInstance>;\n\n  protected abstract componentsMap: AjfFieldComponentsMap;\n  private _updatedSub = Subscription.EMPTY;\n\n  constructor(\n    private _cdr: ChangeDetectorRef,\n    private _cfr: ComponentFactoryResolver\n  ) { }\n\n  ngOnDestroy(): void {\n    this._updatedSub.unsubscribe();\n  }\n\n  ngOnInit(): void {\n    this._loadComponent();\n  }\n\n  private _loadComponent(): void {\n    this._updatedSub.unsubscribe();\n    this._updatedSub = Subscription.EMPTY;\n    if (this._instance == null || this.fieldHost == null) { return; }\n\n    const vcr = this.fieldHost.viewContainerRef;\n    vcr.clear();\n    const componentDef = this.componentsMap[this._instance.node.fieldType];\n    if (componentDef == null) { return; }\n    const component = componentDef.component;\n    try {\n      const componentFactory = this._cfr.resolveComponentFactory(component);\n      const componentRef = vcr.createComponent(componentFactory);\n      this._componentInstance = componentRef.instance;\n      this._componentInstance.instance = this._instance;\n      this._componentInstance.readonly = this._readonly;\n\n      if (componentDef.inputs) {\n        Object.keys(componentDef.inputs).forEach(key => {\n          if (key in  this._componentInstance) {\n            ( this._componentInstance as any)[key] = componentDef.inputs![key];\n          }\n        });\n      }\n      this._updatedSub = this._instance.updatedEvt.subscribe(() => this._cdr.markForCheck());\n    } catch (e) {\n      console.log(e);\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Directive, ViewContainerRef} from '@angular/core';\n\n@Directive({selector: '[ajf-field-host]'})\nexport class AjfFieldHost {\n  constructor(readonly viewContainerRef: ViewContainerRef) {}\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfFieldComponentsMap} from '../../interface/fields/field-components-map';\n\nexport const componentsMap: AjfFieldComponentsMap = {};\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\nimport {Type} from '@angular/core';\n\nimport {AjfBaseFieldComponent} from './base-field';\nimport {AjfFieldComponentsMap} from './interface/fields/field-components-map';\nimport {AjfFieldInstance} from './interface/fields-instances/field-instance';\nimport {componentsMap} from './utils/fields/fields-map';\nimport {AjfFieldInstanceCreate} from './utils/fields-instances/create-field-instance';\n\nexport abstract class AjfFieldService {\n  readonly componentsMap: AjfFieldComponentsMap = componentsMap;\n\n  registerCustomField(field: {\n    fieldType: number,\n    component: Type<AjfBaseFieldComponent>,\n    createInstance?: (instance: AjfFieldInstanceCreate, context: AjfContext) => AjfFieldInstance;\n    isFieldWithChoice?: boolean,\n  }): void {\n    const {fieldType, component} = field;\n    if (fieldType < 100) {\n      throw new Error('Invalid custom field type, it must be greater than 100');\n    }\n    if (component == null) {\n      throw new Error('Invalid custom field component');\n    }\n    this.componentsMap[fieldType] = field;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef} from '@angular/core';\n\nimport {\n  AjfFieldWithChoicesInstance\n} from './interface/fields-instances/field-with-choices-instance';\nimport {AjfBaseFieldComponent} from './base-field';\nimport {AjfFormRendererService} from './form-renderer';\nimport {AjfWarningAlertService} from './warning-alert-service';\n\nexport abstract class AjfFieldWithChoicesComponent<T>\n    extends AjfBaseFieldComponent<AjfFieldWithChoicesInstance<T>> {\n  private _searchThreshold: number = 6;\n  get searchThreshold(): number { return this._searchThreshold; }\n\n  constructor(\n    cdr: ChangeDetectorRef,\n    service: AjfFormRendererService,\n    warningAlertService: AjfWarningAlertService,\n    searchThreshold: number\n  ) {\n    super(cdr, service, warningAlertService);\n    if (searchThreshold != null) {\n      this._searchThreshold = searchThreshold;\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfNodeType {\n  AjfField,\n  AjfFieldNodeLink,\n  AjfNodeGroup,\n  AjfSlide,\n  AjfRepeatingSlide,\n  LENGTH\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfField} from '../../interface/fields/field';\nimport {componentsMap} from './fields-map';\n\nexport function isCustomFieldWithChoices(field: AjfField): boolean {\n  return field.fieldType > 100\n    && componentsMap[field.fieldType] != null\n    && componentsMap[field.fieldType].isFieldWithChoice === true;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfField} from '../../interface/fields/field';\nimport {AjfFieldType} from '../../interface/fields/field-type';\n\nexport function isFieldWithChoices(field: AjfField): boolean {\n  return field.fieldType === AjfFieldType.SingleChoice ||\n      field.fieldType === AjfFieldType.MultipleChoice;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\n\nexport function isField(node: AjfNode): boolean {\n  return node != null && node.nodeType === AjfNodeType.AjfField;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {isField} from '../nodes/is-field';\n\nexport function isFieldInstance(nodeInstance: AjfNodeInstance): boolean {\n  return nodeInstance != null && nodeInstance.node != null && isField(nodeInstance.node);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {isFieldWithChoices} from '../fields/is-field-with-choices';\nimport {isFieldInstance} from '../nodes-instances/is-field-instance';\n\nexport function isFieldWithChoicesInstance(nodeInstance: AjfNodeInstance): boolean {\n  return nodeInstance != null && isFieldInstance(nodeInstance) &&\n      isFieldWithChoices((nodeInstance as AjfFieldInstance).node);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {isTableField} from '../fields/is-table-field';\nimport {isFieldInstance} from '../nodes-instances/is-field-instance';\n\nexport function isTableFieldInstance(nodeInstance: AjfNodeInstance): boolean {\n  return nodeInstance != null && isFieldInstance(nodeInstance) &&\n      isTableField((nodeInstance as AjfFieldInstance).node);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfField} from '../../interface/fields/field';\nimport {AjfFieldType} from '../../interface/fields/field-type';\n\nexport function isTableField(field: AjfField): boolean {\n  return field.fieldType === AjfFieldType.Table;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\n\nexport function updateConditionalBranches(instance: AjfNodeInstance, context: AjfContext): boolean {\n  const conditionalBranches = instance.conditionalBranches;\n\n  if (conditionalBranches != null) {\n    const oldBranch = instance.verifiedBranch;\n    let idx = 0;\n    let found = false;\n    while (idx < conditionalBranches.length && !found) {\n      let verified: boolean = evaluateExpression(conditionalBranches[idx].condition, context);\n      if (verified) {\n        found = true;\n        if (idx !== instance.verifiedBranch) {\n          instance.verifiedBranch = idx;\n        }\n      }\n      idx++;\n    }\n\n    if (oldBranch !== instance.verifiedBranch) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfCondition, AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\n\nexport function updateVisibility(\n    instance: AjfNodeInstance, context: AjfContext, branchVisibility = true): boolean {\n  if (instance.visibility == null) {\n    instance.visible = false;\n    return false;\n  }\n  const visibility: AjfCondition = instance.visibility;\n\n  const oldVisibility: boolean = instance.visible;\n  let newVisibility: boolean =\n      branchVisibility && evaluateExpression(visibility.condition, context);\n  if (newVisibility !== instance.visible) {\n    instance.visible = newVisibility;\n  }\n\n  return oldVisibility !== newVisibility;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\n\nexport function nodeInstanceSuffix(instance: AjfNodeInstance): string {\n  if (instance.prefix == null || instance.prefix.length == 0) {\n    return '';\n  }\n  return `__${instance.prefix.join('__')}`;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {nodeInstanceSuffix} from './node-instance-suffix';\n\nexport function nodeInstanceCompleteName(instance: AjfNodeInstance): string {\n  return instance != null && instance.node != null\n    ? `${instance.node.name}${nodeInstanceSuffix(instance)}`\n    : '';\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\nimport {nodeInstanceCompleteName} from '../nodes-instances/node-instance-complete-name';\n\n/**\n * update the relative instance value and the context\n * if !editable evaluate expression once one time and flag changed is false\n */\nexport function updateFormula(\n    instance: AjfFieldInstance, context: AjfContext): {changed: boolean, value: any} {\n  const formula = instance.formula;\n  const editable = instance.node.editable;\n  if (formula != null && instance.visible && (!editable || (editable && instance.value == null))) {\n    let newValue: any = evaluateExpression(formula.formula, context);\n    const oldValue = instance.value;\n    if (newValue !== instance.value) {\n      instance.value = newValue;\n      context[nodeInstanceCompleteName(instance)] = instance.value;\n      context.$value = instance.value;\n    }\n    return {changed: newValue !== oldValue, value: newValue};\n  }\n  return {changed: false, value: instance.value};\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\n\nexport function updateNextSlideCondition(instance: AjfFieldInstance, context: AjfContext): boolean {\n  if (instance.nextSlideCondition != null) {\n    return evaluateExpression(instance.nextSlideCondition.condition, context);\n  }\n  return false;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {AjfValidation} from '../../interface/validation/validation';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\n\nexport function evaluateValidation(\n    validation: AjfValidation, context?: AjfContext, forceFormula?: string): AjfValidationResult {\n  return {\n    result: evaluateExpression(validation.condition, context, forceFormula),\n    error: validation.errorMessage,\n    clientValidation: validation.clientValidation,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\nimport {deepCopy} from '@ajf/core/utils';\n\nimport {AjfValidationGroup} from '../../interface/validation/validation-group';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\n\nimport {evaluateValidationConditions} from './evaluate-validation-conditions';\nimport {evaluateValidationMaxDigits} from './evaluate-validation-max-digits';\nimport {evaluateValidationMaxValue} from './evaluate-validation-max-value';\nimport {evaluateValidationMinDigits} from './evaluate-validation-min-digits';\nimport {evaluateValidationMinValue} from './evaluate-validation-min-value';\nimport {evaluateValidationNotEmpty} from './evaluate-validation-not-empty';\n\nexport function evaluateValidationGroup(\n    validation: AjfValidationGroup, value: any, context?: AjfContext): AjfValidationResult[] {\n  let res: AjfValidationResult[] = [];\n  let ctx = deepCopy(context);\n  ctx['$value'] = value;\n  res = evaluateValidationConditions(validation, ctx);\n  if (validation.maxValue) {\n    const maxValue = evaluateValidationMaxValue(validation, value);\n    if (maxValue != null) {\n      res.push(maxValue);\n    }\n  }\n  if (validation.minValue) {\n    const minValue = evaluateValidationMinValue(validation, value);\n    if (minValue != null) {\n      res.push(minValue);\n    }\n  }\n  if (validation.notEmpty) {\n    const notEmpty = evaluateValidationNotEmpty(validation, value);\n    if (notEmpty != null) {\n      res.push(notEmpty);\n    }\n  }\n  if (validation.maxDigits) {\n    const maxDigits = evaluateValidationMaxDigits(validation, value);\n    if (maxDigits != null) {\n      res.push(maxDigits);\n    }\n  }\n  if (validation.minDigits) {\n    const minDigits = evaluateValidationMinDigits(validation, value);\n    if (minDigits != null) {\n      res.push(minDigits);\n    }\n  }\n  return res;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\n\nimport {AjfValidationGroup} from '../../interface/validation/validation-group';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\nimport {evaluateValidation} from './evaluate-validation';\n\nexport function evaluateValidationConditions(\n    validation: AjfValidationGroup, context?: AjfContext): AjfValidationResult[] {\n  let res: AjfValidationResult[] = [];\n  validation.conditions.forEach((cond) => {\n    res.push(evaluateValidation(cond, context));\n  });\n  return res;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {evaluateExpression} from '@ajf/core/models';\nimport {AjfValidationGroup} from '../../interface/validation/validation-group';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\nimport {evaluateValidation} from './evaluate-validation';\n\nexport function evaluateValidationMaxValue(\n    validation: AjfValidationGroup, value: any): AjfValidationResult|null {\n  if (validation.maxValue == null) {\n    return null;\n  }\n  const ctx = {'$value': value};\n  if (typeof validation.maxValue === 'number') {\n    return {\n      result: evaluateExpression(`$value.length <= ${validation.maxValue}`, ctx),\n      error: `Value must be <= ${validation.maxValue}`,\n      clientValidation: false\n    };\n  }\n  return evaluateValidation(validation.maxValue, {'$value': value});\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {evaluateExpression} from '@ajf/core/models';\nimport {AjfValidationGroup} from '../../interface/validation/validation-group';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\nimport {evaluateValidation} from './evaluate-validation';\n\nexport function evaluateValidationMinValue(\n    validation: AjfValidationGroup, value: any): AjfValidationResult|null {\n  if (validation.minValue == null) {\n    return null;\n  }\n  const ctx = {'$value': value};\n  if (typeof validation.minValue === 'number') {\n    return {\n      result: evaluateExpression(`$value.length <= ${validation.minValue}`, ctx),\n      error: `Value must be >= ${validation.minValue}`,\n      clientValidation: false\n    };\n  }\n  return evaluateValidation(validation.minValue, {'$value': value});\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {evaluateExpression} from '@ajf/core/models';\nimport {AjfValidationGroup} from '../../interface/validation/validation-group';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\nimport {evaluateValidation} from './evaluate-validation';\n\nexport function evaluateValidationNotEmpty(\n    validation: AjfValidationGroup, value: any): AjfValidationResult|null {\n  if (validation.notEmpty == null) {\n    return null;\n  }\n  const ctx = {'$value': value};\n  if (typeof validation.notEmpty === 'boolean') {\n    return {\n      result: evaluateExpression(`($value != null) === ${validation.notEmpty}`, ctx),\n      error: 'Value must not be empty',\n      clientValidation: false\n    };\n  }\n  return evaluateValidation(validation.notEmpty, ctx);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {evaluateExpression} from '@ajf/core/models';\nimport {AjfValidationGroup} from '../../interface/validation/validation-group';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\nimport {evaluateValidation} from './evaluate-validation';\n\nexport function evaluateValidationMaxDigits(\n    validation: AjfValidationGroup, value: any): AjfValidationResult|null {\n  if (validation.maxDigits == null) {\n    return null;\n  }\n  const ctx = {'$value': value};\n  if (typeof validation.maxDigits === 'number') {\n    return {\n      result: evaluateExpression(`$value.toString().length <= ${validation.maxDigits}`, ctx),\n      error: `Digits count must be <= ${validation.maxDigits}`,\n      clientValidation: false\n    };\n  }\n  return evaluateValidation(validation.maxDigits, ctx);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {evaluateExpression} from '@ajf/core/models';\nimport {AjfValidationGroup} from '../../interface/validation/validation-group';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\nimport {evaluateValidation} from './evaluate-validation';\n\nexport function evaluateValidationMinDigits(\n    validation: AjfValidationGroup, value: any): AjfValidationResult|null {\n  if (validation.minDigits == null) {\n    return null;\n  }\n  const ctx = {'$value': value};\n  if (typeof validation.minDigits === 'number') {\n    return {\n      result: evaluateExpression(`$value.toString().length >= ${validation.minDigits}`, ctx),\n      error: `Digits count must be >= ${validation.minDigits}`,\n      clientValidation: false\n    };\n  }\n  return evaluateValidation(validation.minDigits, ctx);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\nimport {AjfValidationResult} from '../../interface/validation/validation-results';\nimport {nodeInstanceCompleteName} from '../nodes-instances/node-instance-complete-name';\nimport {evaluateValidationGroup} from '../validation/evaluate-validation-group';\n\nexport function updateValidation(\n    instance: AjfFieldInstance, context: AjfContext, supplementaryInformations?: any): void {\n  const validation = instance.validation;\n  if (validation == null) {\n    instance.valid = true;\n    return;\n  }\n\n  if (supplementaryInformations) {\n    Object.keys(supplementaryInformations).forEach((key) => {\n      context[`__supplementary__${key}__`] = supplementaryInformations[key];\n    });\n  }\n\n  const completeName = nodeInstanceCompleteName(instance);\n\n  if (context[completeName] != null && validation && validation.forceValue) {\n    instance.value = evaluateExpression(validation.forceValue.condition, context);\n    context[completeName] = instance.value;\n    context.$value = instance.value;\n  }\n\n  instance.validationResults =\n      evaluateValidationGroup(validation, context[completeName], context);\n  instance.valid = instance.validationResults.reduce(\n      (prev: boolean, x: AjfValidationResult) => prev && x.result, true);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\n\nimport {AjfWarningGroup} from '../../interface/warning/warning-group';\nimport {AjfWarningResult} from '../../interface/warning/warning-result';\nimport {evaluateWarning} from './evaluate-warning';\n\nexport function evaluateWarningConditions(\n    warning: AjfWarningGroup, context?: AjfContext): AjfWarningResult[] {\n  return warning.conditions.map(cond => evaluateWarning(cond, context));\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {AjfWarning} from '../../interface/warning/warning';\nimport {AjfWarningResult} from '../../interface/warning/warning-result';\n\nexport function evaluateWarning(\n    warning: AjfWarning, context?: AjfContext, forceFormula?: string): AjfWarningResult {\n  return {\n    result: evaluateExpression(warning.condition, context, forceFormula),\n    warning: warning.warningMessage,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\nimport {nodeInstanceCompleteName} from '../nodes-instances/node-instance-complete-name';\nimport {evaluateWarningGroup} from '../warning/evaluate-warning-group';\n\nexport function updateWarning(instance: AjfFieldInstance, context: AjfContext): void {\n  const warning = instance.warning;\n  if (warning == null) {\n    return;\n  }\n\n  const completeName = nodeInstanceCompleteName(instance);\n\n  if (context[completeName] != null && warning) {\n    instance.warningResults = evaluateWarningGroup(warning, context);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\n\nimport {AjfWarningGroup} from '../../interface/warning/warning-group';\nimport {AjfWarningResult} from '../../interface/warning/warning-result';\nimport {evaluateWarningConditions} from './evaluate-warning-conditions';\n\nexport function evaluateWarningGroup(\n    warning: AjfWarningGroup, context?: AjfContext): AjfWarningResult[] {\n  return evaluateWarningConditions(warning, context);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {\n  AjfFieldWithChoicesInstance\n} from '../../interface/fields-instances/field-with-choices-instance';\n\nexport function updateFilteredChoices(\n    instance: AjfFieldWithChoicesInstance<any>, context: AjfContext): void {\n  if (instance.choicesFilter != null) {\n    instance.filteredChoices = instance.node.choicesOrigin.choices.filter(c => {\n      context.$choice = c;\n      context.$choiceValue = c.value;\n      return evaluateExpression(instance.choicesFilter!.formula, context);\n    });\n  } else {\n    instance.filteredChoices = instance.node.choicesOrigin.choices;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {alwaysCondition} from '@ajf/core/models';\n\nimport {AjfNode} from '../../interface/nodes/node';\n\nexport type AjfNodeCreate = Pick<AjfNode, 'nodeType'|'id'|'parent'|'name'>&Partial<AjfNode>;\n\nexport function createNode(node: AjfNodeCreate): AjfNode {\n  const conditionalBranches =\n      node.conditionalBranches != null && node.conditionalBranches.length > 0 ?\n      node.conditionalBranches :\n      [alwaysCondition()];\n  return {\n    ...node,\n    parentNode: node.parentNode != null ? node.parentNode : 0,\n    label: node.label || '',\n    visibility: node.visibility || alwaysCondition(),\n    conditionalBranches,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfField} from '../../interface/fields/field';\nimport {AjfFieldType} from '../../interface/fields/field-type';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\nimport {AjfNodeCreate, createNode} from '../nodes/create-node';\n\nexport type AjfFieldCreate =\n    Omit<AjfNodeCreate, 'nodeType'>&Pick<AjfField, 'fieldType'>&Partial<AjfField>;\n\nexport function createField(field: AjfFieldCreate): AjfField {\n  const node = createNode({...field, nodeType: AjfNodeType.AjfField});\n  const editable = field.editable != null ?\n      field.editable :\n      field.fieldType !== AjfFieldType.Formula && field.fieldType !== AjfFieldType.Table;\n  return {\n    ...node,\n    ...field,\n    nodeType: AjfNodeType.AjfField,\n    editable,\n    defaultValue: field.defaultValue != null ? field.defaultValue : null,\n    size: field.size || 'normal',\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\n\nexport function isSlidesNode(node: AjfNode): boolean {\n  return node != null &&\n      (node.nodeType === AjfNodeType.AjfRepeatingSlide || node.nodeType === AjfNodeType.AjfSlide);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\nimport {isSlidesNode} from './is-slides-node';\n\nexport function isContainerNode(node: AjfNode): boolean {\n  return node != null && (node.nodeType === AjfNodeType.AjfNodeGroup || isSlidesNode(node));\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContainerNodeInstance} from '../../interface/nodes-instances/container-node-instance';\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\n\nimport {isContainerNodeInstance} from './is-container-node-instance';\nimport {isFieldInstance} from './is-field-instance';\n\nexport function flattenNodesInstances(\n    nodes: AjfNodeInstance[], includeGroups = false): AjfNodeInstance[] {\n  let flatNodes: AjfNodeInstance[] = [];\n  nodes.forEach((nodeInstance: AjfNodeInstance) => {\n    if (isFieldInstance(nodeInstance)) {\n      flatNodes.push(nodeInstance);\n    }\n    if (isContainerNodeInstance(nodeInstance)) {\n      if (includeGroups) {\n        flatNodes.push(nodeInstance);\n      }\n      flatNodes = flatNodes.concat(\n          flattenNodesInstances((nodeInstance as AjfContainerNodeInstance).nodes, includeGroups));\n    }\n  });\n  return flatNodes;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {isContainerNode} from '../nodes/is-container-node';\n\nexport function isContainerNodeInstance(nodeInstance: AjfNodeInstance): boolean {\n  return nodeInstance != null && nodeInstance.node != null && isContainerNode(nodeInstance.node);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {isSlidesNode} from '../nodes/is-slides-node';\n\nexport function isSlidesInstance(nodeInstance: AjfNodeInstance): boolean {\n  return nodeInstance != null && nodeInstance.node != null && isSlidesNode(nodeInstance.node);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {isNodeGroup} from '../nodes/is-node-group';\n\nexport function isNodeGroupInstance(nodeInstance: AjfNodeInstance): boolean {\n  return nodeInstance != null && nodeInstance.node != null && isNodeGroup(nodeInstance.node);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\n\nexport function isNodeGroup(node: AjfNode): boolean {\n  return node != null && node.nodeType === AjfNodeType.AjfNodeGroup;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {isSlideNode} from '../nodes/is-slide-node';\n\nexport function isSlideInstance(nodeInstance: AjfNodeInstance): boolean {\n  return nodeInstance != null && nodeInstance.node != null && isSlideNode(nodeInstance.node);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\n\nexport function isSlideNode(node: AjfNode): boolean {\n  return node != null && node.nodeType === AjfNodeType.AjfSlide;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {EventEmitter} from '@angular/core';\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\n\nexport type AjfNodeInstanceCreate = Pick<AjfNodeInstance, 'node'>&Partial<AjfNodeInstance>;\n\nexport function createNodeInstance(instance: AjfNodeInstanceCreate): AjfNodeInstance {\n  return {\n    node: instance.node,\n    prefix: instance.prefix ? [...instance.prefix] : [],\n    visible: instance.visible != null ? instance.visible : true,\n    conditionalBranches: [],\n    updatedEvt: new EventEmitter<void>()\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\nimport {EventEmitter} from '@angular/core';\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\nimport {AjfNodeInstanceCreate, createNodeInstance} from '../nodes-instances/create-node-instance';\nimport {nodeInstanceCompleteName} from '../nodes-instances/node-instance-complete-name';\n\nexport type AjfFieldInstanceCreate = AjfNodeInstanceCreate&Partial<AjfFieldInstance>;\n\nexport function createFieldInstance(\n    instance: AjfFieldInstanceCreate, context: AjfContext): AjfFieldInstance {\n  const nodeInstance = createNodeInstance(instance);\n  let value: any = null;\n  if (nodeInstance.node != null && context != null) {\n    const completeName = nodeInstanceCompleteName(nodeInstance);\n    if (context[nodeInstance.node.name] != null) {\n      value = context[nodeInstance.node.name];\n    } else if (context[completeName] != null) {\n      value = context[completeName];\n    }\n  }\n  return {\n    ...nodeInstance,\n    node: instance.node,\n    value,\n    valid: false,\n    defaultValue: instance.defaultValue != null ? instance.defaultValue : null,\n    validationResults: instance.validationResults || [],\n    warningResults: instance.warningResults || [],\n    warningTrigger: new EventEmitter<void>(),\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\nimport {EventEmitter} from '@angular/core';\n\nimport {\n  AjfFieldWithChoicesInstance\n} from '../../interface/fields-instances/field-with-choices-instance';\n\nimport {AjfFieldInstanceCreate, createFieldInstance} from './create-field-instance';\n\nexport type AjfFieldWithChoicesInstanceCreate<T> =\n    AjfFieldInstanceCreate&Partial<AjfFieldWithChoicesInstance<T>>;\n\nexport function createFieldWithChoicesInstance<T>(\n    instance: AjfFieldWithChoicesInstanceCreate<T>,\n    context: AjfContext): AjfFieldWithChoicesInstance<T> {\n  const fieldInstance = createFieldInstance(instance, context);\n  return {\n    ...fieldInstance,\n    node: instance.node,\n    filteredChoices: [...instance.node.choices],\n    firstTriggerConditionDone: {},\n    selectionTrigger: new EventEmitter<void>(),\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfSlideInstance} from '../../interface/slides-instances/slide-instance';\nimport {createNodeInstance} from '../nodes-instances/create-node-instance';\nimport {AjfBaseSlideInstanceCreate} from './base';\n\nexport type AjfSlideInstanceCreate = AjfBaseSlideInstanceCreate&Partial<AjfSlideInstance>;\n\nexport function createSlideInstance(instance: AjfSlideInstanceCreate): AjfSlideInstance {\n  const nodeInstance = createNodeInstance(instance);\n  return {\n    ...nodeInstance,\n    node: instance.node,\n    nodes: [],\n    slideNodes: [],\n    flatNodes: [],\n    valid: false,\n    position: 0,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidationGroup} from '../../interface/validation/validation-group';\n\nexport function createValidationGroup(group: Partial<AjfValidationGroup>): AjfValidationGroup {\n  return {...group, conditions: group.conditions || []};\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfWarningGroup} from '../../interface/warning/warning-group';\n\nexport function createWarningGroup(group: Partial<AjfWarningGroup>): AjfWarningGroup {\n  return {...group, conditions: group.conditions || []};\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\n\nexport function isRepeatingContainerNode(node: AjfNode): boolean {\n  return node != null &&\n      (node.nodeType === AjfNodeType.AjfNodeGroup ||\n       node.nodeType === AjfNodeType.AjfRepeatingSlide);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeGroup} from '../../interface/nodes/node-group';\nimport {isField} from '../nodes/is-field';\n\nimport {getAncestorRepeatingNodes} from './get-ancestor-repeating-nodes';\n\nexport function getAncestorRepeatingNodesNames(\n    allNodes: (AjfNode|AjfNodeInstance)[], node: AjfNode): {[prop: string]: number} {\n  let names: {[prop: string]: number} = {};\n  const nodeGroups = getAncestorRepeatingNodes(allNodes, node) as AjfNodeGroup[];\n  nodeGroups.forEach((n, idx) => (n.nodes || []).forEach((sn) => {\n    if (isField(sn)) {\n      names[sn.name] = idx;\n    }\n  }));\n  return names;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {AjfNode} from '../../interface/nodes/node';\nimport {isRepeatingContainerNode} from '../nodes/is-repeating-container-node';\n\nexport function getAncestorRepeatingNodes(\n    allNodes: (AjfNode|AjfNodeInstance)[], node: AjfNode): AjfNode[] {\n  let nodeGroups: AjfNode[] = [];\n  let curParent: number|null = node.parent;\n  while (curParent != null) {\n    const curNode =\n        allNodes.map((n: AjfNode|AjfNodeInstance) => (n as AjfNodeInstance).node || n as AjfNode)\n            .find(n => n.id == curParent);\n    if (curNode) {\n      if (isRepeatingContainerNode(curNode)) {\n        nodeGroups.push(curNode);\n      }\n    }\n    curParent = curNode != null ? curNode.parent : null;\n  }\n  return nodeGroups;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfCondition, normalizeExpression} from '@ajf/core/models';\n\nexport function getInstanceCondition(\n    condition: AjfCondition, ancestorsNames: {[prop: string]: number},\n    prefix: number[]): AjfCondition {\n  const oldCondition = condition.condition;\n  let newCondition = normalizeExpression(oldCondition, ancestorsNames, prefix);\n  if (newCondition === oldCondition) {\n    return condition;\n  }\n  return {condition: newCondition};\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfCondition} from '@ajf/core/models';\n\nimport {getInstanceCondition} from './get-instance-condition';\n\nexport function getInstanceConditions(\n    conditions: AjfCondition[], ancestorsNames: {[prop: string]: number},\n    prefix: number[]): AjfCondition[] {\n  let changed = false;\n  const newConditions = conditions.map((condition) => {\n    const newCondition = getInstanceCondition(condition, ancestorsNames, prefix);\n    if (newCondition !== condition) {\n      changed = true;\n    }\n    return newCondition;\n  });\n  return changed ? newConditions : conditions;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfFormula, normalizeExpression} from '@ajf/core/models';\n\nexport function getInstanceFormula(\n    formula: AjfFormula, ancestorsNames: {[prop: string]: number}, prefix: number[]): AjfFormula {\n  const oldFormula = formula.formula;\n  let newFormula = normalizeExpression(oldFormula, ancestorsNames, prefix);\n  if (newFormula === oldFormula) {\n    return formula;\n  }\n  return {formula: newFormula};\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidation} from '../../interface/validation/validation';\n\nexport function createValidation(validation: Pick<AjfValidation, 'condition'>&\n                                 Partial<AjfValidation>): AjfValidation {\n  return {\n    ...validation,\n    clientValidation: validation.clientValidation || false,\n    errorMessage: validation.errorMessage || 'Undefined Error'\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidation} from '../../interface/validation/validation';\nimport {getInstanceValidation} from './get-instance-validation';\n\nexport function getInstanceValidations(\n    validations: AjfValidation[], ancestorsNames: {[prop: string]: number},\n    prefix: number[]): AjfValidation[] {\n  let changed = false;\n  const newValidations = validations.map((validation) => {\n    const newValidation = getInstanceValidation(validation, ancestorsNames, prefix);\n    if (newValidation !== validation) {\n      changed = true;\n    }\n    return newValidation;\n  });\n  return changed ? newValidations : validations;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {normalizeExpression} from '@ajf/core/models';\n\nimport {AjfValidation} from '../../interface/validation/validation';\nimport {createValidation} from '../validation/create-validation';\n\nexport function getInstanceValidation(\n    validation: AjfValidation, ancestorsNames: {[prop: string]: number},\n    prefix: number[]): AjfValidation {\n  const oldValidation = validation.condition;\n  let newValidation = normalizeExpression(oldValidation, ancestorsNames, prefix);\n  if (newValidation === oldValidation) {\n    return validation;\n  }\n  return createValidation({condition: newValidation});\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfWarning} from '../../interface/warning/warning';\n\nexport function createWarning(warning: Pick<AjfWarning, 'condition'>&\n                              Partial<AjfWarning>): AjfWarning {\n  return {...warning, warningMessage: warning.warningMessage || 'Undefined Warning'};\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfWarning} from '../../interface/warning/warning';\nimport {getInstanceWarning} from './get-instance-warning';\n\nexport function getInstanceWarnings(\n    warnings: AjfWarning[], ancestorsNames: {[prop: string]: number},\n    prefix: number[]): AjfWarning[] {\n  let changed = false;\n  const newWarnings = warnings.map((warning) => {\n    const newWarning = getInstanceWarning(warning, ancestorsNames, prefix);\n    if (newWarning !== warning) {\n      changed = true;\n    }\n    return newWarning;\n  });\n  return changed ? newWarnings : warnings;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {normalizeExpression} from '@ajf/core/models';\n\nimport {AjfWarning} from '../../interface/warning/warning';\nimport {createWarning} from '../warning/create-warning';\n\nexport function getInstanceWarning(\n    warning: AjfWarning, ancestorsNames: {[prop: string]: number}, prefix: number[]): AjfWarning {\n  const oldWarning = warning.condition;\n  let newWarning = normalizeExpression(oldWarning, ancestorsNames, prefix);\n  if (newWarning === oldWarning) {\n    return warning;\n  }\n  return createWarning({condition: newWarning});\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {isSlidesInstance} from '../nodes-instances/is-slides-instance';\nimport {isRepeatingSlide} from '../nodes/is-repeating-slide';\n\nexport function isRepeatingSlideInstance(nodeInstance: AjfNodeInstance): boolean {\n  return nodeInstance != null && nodeInstance.node != null && isSlidesInstance(nodeInstance) &&\n      isRepeatingSlide(nodeInstance.node);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\n\nexport function isRepeatingSlide(node: AjfNode): boolean {\n  return node != null && node.nodeType === AjfNodeType.AjfRepeatingSlide;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AjfContext, createCondition, createFormula, normalizeExpression, alwaysCondition\n} from '@ajf/core/models';\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\nimport {\n  AjfFieldWithChoicesInstance\n} from '../../interface/fields-instances/field-with-choices-instance';\nimport {AjfField} from '../../interface/fields/field';\nimport {AjfFieldType} from '../../interface/fields/field-type';\nimport {AjfFieldWithChoices} from '../../interface/fields/field-with-choices';\nimport {AjfTableField} from '../../interface/fields/table-field';\nimport {AjfNodeGroupInstance} from '../../interface/nodes-instances/node-group-instance';\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {\n  AjfRepeatingContainerNodeInstance\n} from '../../interface/nodes-instances/repeating-container-node-instance';\nimport {AjfNode} from '../../interface/nodes/node';\nimport {AjfNodeGroup} from '../../interface/nodes/node-group';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\nimport {AjfRepeatingSlideInstance} from '../../interface/slides-instances/repeating-slide-instance';\nimport {AjfRepeatingSlide} from '../../interface/slides/repeating-slide';\nimport {AjfSlide} from '../../interface/slides/slide';\nimport {componentsMap} from '../fields/fields-map';\nimport {createFieldInstance} from '../fields-instances/create-field-instance';\nimport {\n  createFieldWithChoicesInstance\n} from '../fields-instances/create-field-with-choices-instance';\nimport {createTableFieldInstance} from '../fields-instances/create-table-field-instance';\nimport {isFieldWithChoicesInstance} from '../fields-instances/is-field-with-choices-instance';\nimport {isFieldWithChoices} from '../fields/is-field-with-choices';\nimport {createNodeGroupInstance} from '../nodes-instances/create-node-group-instance';\nimport {createRepeatingSlideInstance} from '../slides-instances/create-repeating-slide-instance';\nimport {createSlideInstance} from '../slides-instances/create-slide-instance';\nimport {createValidationGroup} from '../validation/create-validation-group';\nimport {createWarningGroup} from '../warning/create-warning-group';\n\nimport {getAncestorRepeatingNodesNames} from './get-ancestor-repeating-nodes-names';\nimport {getInstanceCondition} from './get-instance-condition';\nimport {getInstanceConditions} from './get-instance-conditions';\nimport {getInstanceFormula} from './get-instance-formula';\nimport {getInstanceValidations} from './get-instance-validations';\nimport {getInstanceWarnings} from './get-instance-warnings';\nimport {isFieldInstance} from './is-field-instance';\nimport {isNodeGroupInstance} from './is-node-group-instance';\nimport {isRepeatingSlideInstance} from './is-repeating-slide-instance';\n\nexport function nodeToNodeInstance(\n    allNodes: AjfNode[]|AjfNodeInstance[], node: AjfNode, prefix: number[],\n    context: AjfContext): AjfNodeInstance|null {\n  let instance: AjfNodeInstance|null = null;\n  const nodeType = node.nodeType;\n  switch (nodeType) {\n    case AjfNodeType.AjfField:\n      const field = node as AjfField;\n      if (field.fieldType > 100) {\n        if (\n          componentsMap[field.fieldType] != null\n          && componentsMap[field.fieldType].createInstance != null\n        ) {\n          instance = componentsMap[field.fieldType].createInstance!(\n            {node: node as AjfField, prefix}, context);\n        } else {\n          instance = createFieldInstance({node: node as AjfField, prefix}, context);\n        }\n      } else {\n        switch (field.fieldType) {\n          case AjfFieldType.SingleChoice:\n          case AjfFieldType.MultipleChoice:\n            instance = createFieldWithChoicesInstance(\n                {node: node as AjfFieldWithChoices<any>, prefix}, context);\n            break;\n          case AjfFieldType.Table:\n            instance = createTableFieldInstance({node: node as AjfTableField, prefix}, context);\n            break;\n          default:\n            instance = createFieldInstance({node: node as AjfField, prefix}, context);\n            break;\n        }\n      }\n      break;\n    case AjfNodeType.AjfNodeGroup:\n      instance = createNodeGroupInstance({node: node as AjfNodeGroup, prefix});\n      break;\n    case AjfNodeType.AjfRepeatingSlide:\n      instance = createRepeatingSlideInstance({node: node as AjfRepeatingSlide, prefix});\n      break;\n    case AjfNodeType.AjfSlide:\n      instance = createSlideInstance({node: node as AjfSlide, prefix});\n      break;\n  }\n  if (instance != null) {\n    const hasPrefix = prefix != null && prefix.length > 0;\n    if (hasPrefix) {\n      const ancestorsNames = getAncestorRepeatingNodesNames(allNodes, node);\n\n      if (node.visibility != null) {\n        const oldVisibility = node.visibility.condition;\n        const newVisibility = normalizeExpression(oldVisibility, ancestorsNames, prefix);\n        instance.visibility = newVisibility !== oldVisibility ?\n            createCondition({condition: newVisibility}) :\n            node.visibility;\n      }\n\n      const conditionalBranches = instance.node.conditionalBranches != null\n        && instance.node.conditionalBranches.length > 0\n        ? instance.node.conditionalBranches\n        : [alwaysCondition()];\n      instance.conditionalBranches = getInstanceConditions(\n        conditionalBranches, ancestorsNames, prefix);\n\n      if (nodeType === AjfNodeType.AjfNodeGroup || nodeType === AjfNodeType.AjfRepeatingSlide) {\n        const ngInstance = instance as AjfNodeGroupInstance | AjfRepeatingSlideInstance;\n        const formulaReps = ngInstance.node.formulaReps;\n        if (formulaReps != null) {\n          const oldFormula = formulaReps.formula;\n          let newFormula = normalizeExpression(oldFormula, ancestorsNames, prefix);\n          ngInstance.formulaReps =\n              newFormula !== oldFormula ? createFormula({formula: newFormula}) : formulaReps;\n        }\n      } else if (nodeType === AjfNodeType.AjfField) {\n        const fInstance = instance as AjfFieldInstance;\n        const fNode = fInstance.node;\n\n        if (fNode.formula) {\n          fInstance.formula = getInstanceFormula(fNode.formula, ancestorsNames, prefix);\n        }\n\n        if (fNode.validation != null) {\n          const newConditions =\n              getInstanceValidations(fNode.validation.conditions, ancestorsNames, prefix);\n          if (newConditions !== fNode.validation.conditions) {\n            fInstance.validation = createValidationGroup(fNode.validation);\n            fInstance.validation.conditions = newConditions;\n          } else {\n            fInstance.validation = fNode.validation;\n          }\n        }\n\n        if (fNode.warning != null) {\n          const newWarnings = getInstanceWarnings(fNode.warning.conditions, ancestorsNames, prefix);\n          if (newWarnings !== fNode.warning.conditions) {\n            fInstance.warning = createWarningGroup(fNode.warning);\n            fInstance.warning.conditions = newWarnings;\n          } else {\n            fInstance.warning = fNode.warning;\n          }\n        }\n\n        if (fNode.nextSlideCondition != null) {\n          fInstance.nextSlideCondition =\n              getInstanceCondition(fNode.nextSlideCondition, ancestorsNames, prefix);\n        }\n\n        if (isFieldWithChoices(fNode)) {\n          const fwcInstance = instance as AjfFieldWithChoicesInstance<any>;\n          const fwcNode = fwcInstance.node;\n          if (fwcNode.choicesFilter != null) {\n            fwcInstance.choicesFilter =\n                getInstanceFormula(fwcNode.choicesFilter, ancestorsNames, prefix);\n          }\n          if (fwcNode.triggerConditions != null) {\n            fwcInstance.triggerConditions =\n                getInstanceConditions(fwcNode.triggerConditions, ancestorsNames, prefix);\n          }\n        }\n      }\n    } else {\n      instance.visibility = instance.node.visibility;\n      const conditionalBranches = instance.node.conditionalBranches != null\n        && instance.node.conditionalBranches.length > 0\n        ? instance.node.conditionalBranches\n        : [alwaysCondition()];\n      instance.conditionalBranches = conditionalBranches;\n      if (isNodeGroupInstance(instance) || isRepeatingSlideInstance(instance)) {\n        const rgInstance = instance as AjfRepeatingContainerNodeInstance;\n        rgInstance.formulaReps = rgInstance.node.formulaReps;\n      } else if (isFieldInstance(instance)) {\n        const fInstance = instance as AjfFieldInstance;\n        fInstance.validation = fInstance.node.validation;\n        fInstance.warning = fInstance.node.warning;\n        fInstance.nextSlideCondition = fInstance.node.nextSlideCondition;\n        if (isFieldWithChoicesInstance(instance)) {\n          const fwcInstance = instance as AjfFieldWithChoicesInstance<any>;\n          fwcInstance.choicesFilter = fwcInstance.node.choicesFilter;\n          fwcInstance.triggerConditions = fwcInstance.node.triggerConditions;\n        }\n        fInstance.formula = fInstance.node.formula;\n      }\n    }\n  }\n  return instance;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\n\nimport {AjfFieldInstanceCreate, createFieldInstance} from './create-field-instance';\nimport {AjfTableField, AjfTableCell} from '../../interface/fields/table-field';\nimport {AjfTableFieldInstance} from '../../interface/fields-instances/table-field-instance';\n\nexport type AjfTableFieldInstanceCreate = AjfFieldInstanceCreate&Partial<AjfTableFieldInstance>;\n/**\n * to mantain retrocompatibility with old string type convert string to AjfTableCell\n * check  node.rows: (string|AjfTableCell)[][];\n * if elem of map is string convert in to AjfTableCell object\n */\nfunction normalizeRows(node: AjfTableField): void {\n  node.rows.forEach((row, rowIdx) => {\n    row.forEach( (elem, elemIdx) => {\n      if (typeof elem === 'string') {\n        node.rows[rowIdx][elemIdx] = {\n          formula: elem,\n          editable: node.editable\n        } as AjfTableCell;\n      }\n    });\n  });\n}\n\nexport function createTableFieldInstance(\n    instance: AjfTableFieldInstanceCreate, context: AjfContext): AjfTableFieldInstance {\n      normalizeRows(instance.node as AjfTableField);\n      const fieldInstance = createFieldInstance(instance, context);\n      return {\n        ...fieldInstance,\n        node: instance.node,\n        context,\n        hideEmptyRows: instance.hideEmptyRows || false,\n        controls: []\n      };\n    }\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeGroupInstance} from '../../interface/nodes-instances/node-group-instance';\nimport {AjfNodeInstanceCreate, createNodeInstance} from './create-node-instance';\n\nexport type AjfNodeGroupInstanceCreate = AjfNodeInstanceCreate&Partial<AjfNodeGroupInstance>;\n\nexport function createNodeGroupInstance(instance: AjfNodeGroupInstanceCreate):\n    AjfNodeGroupInstance {\n  const nodeInstance = createNodeInstance(instance);\n  return {\n    ...nodeInstance,\n    node: instance.node,\n    formulaReps: instance.formulaReps,\n    reps: 0,\n    nodes: [],\n    flatNodes: [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfRepeatingSlideInstance} from '../../interface/slides-instances/repeating-slide-instance';\nimport {AjfSlideInstanceCreate, createSlideInstance} from './create-slide-instance';\n\nexport type AjfRepeatingSlideInstanceCreate = Omit<AjfSlideInstanceCreate, 'node'>&\n    Pick<AjfRepeatingSlideInstance, 'node'>&Partial<AjfRepeatingSlideInstance>;\n\nexport function createRepeatingSlideInstance(instance: AjfRepeatingSlideInstanceCreate):\n    AjfRepeatingSlideInstance {\n  const slideInstance = createSlideInstance(instance);\n  return {\n    ...slideInstance,\n    node: instance.node,\n    slideNodes: [],\n    formulaReps: instance.formulaReps,\n    reps: 0,\n    nodes: [],\n    flatNodes: [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContainerNode} from '../../interface/nodes/container-node';\nimport {AjfNode} from '../../interface/nodes/node';\nimport {isContainerNode} from './is-container-node';\n\nexport function flattenNodes(nodes: AjfNode[]): AjfNode[] {\n  let flatNodes: AjfNode[] = [];\n  nodes.forEach((node: AjfNode) => {\n    flatNodes.push(node);\n    if (isContainerNode(node)) {\n      flatNodes = flatNodes.concat(flattenNodes((node as AjfContainerNode).nodes));\n    }\n  });\n  return flatNodes;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNode} from '../../interface/nodes/node';\n\nexport function orderedNodes(nodes: AjfNode[], parent: number|null): AjfNode[] {\n  let newNodes: AjfNode[] = [];\n  nodes\n      .filter(\n          (n: AjfNode) => parent != null ? n.parent == parent : n.parent == null || n.parent === 0)\n      .sort((n1: AjfNode, n2: AjfNode) => n1.parentNode - n2.parentNode)\n      .forEach((n: AjfNode) => {\n        newNodes.push(n);\n        newNodes = newNodes.concat(orderedNodes(nodes, n.id));\n      });\n  return newNodes;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {AjfRepeatingNodeInstance} from '../../interface/nodes-instances/repeating-node-instance';\nimport {nodeInstanceCompleteName} from '../nodes-instances/node-instance-complete-name';\n\nexport function updateRepsNum(instance: AjfRepeatingNodeInstance, context?: AjfContext): number {\n  const oldReps: number = instance.reps || 0;\n  context = context || {};\n  if (instance.node.formulaReps == null) {\n    const ctxReps = context[nodeInstanceCompleteName(instance)];\n    if (ctxReps != null) {\n      instance.reps = ctxReps;\n    } else if (oldReps == 0) {\n      instance.reps = 1;\n    }\n  } else {\n    let newReps = evaluateExpression(instance.node.formulaReps.formula, context);\n    if (newReps !== oldReps) {\n      instance.reps = newReps;\n    }\n  }\n  instance.canAdd = instance.node.maxReps === 0 || instance.reps < instance.node.maxReps;\n  instance.canRemove = instance.node.minReps === 0 || instance.reps > instance.node.minReps;\n  return oldReps;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfExpressionUtils} from '@ajf/core/models';\nimport {Injectable} from '@angular/core';\n\n@Injectable()\nexport class AjfValidationService {\n  private _baseUtilFunctions: string[] = [\n    `/**\n        * count the number of digit contained on x.\n        * @param  x the value used for digit count\n        * @return the count of the digit\n      */\n    var digitCount = function(x) { return x.toString().length; }`,\n    `/**\n        * count the number of decimal contained on x.\n        * @param  x the value used for decimal count\n        * @return the count of the decimal\n      */\n    var decimalCount = function(x) {\n      return (parseFloat(x).toString().split('.')[1] || []).length;\n    }`,\n    `/**\n        * check if x is integer\n        * @param  x the value used for check\n        * @return true if x is a number\n      */\n    var isInt = function(x) { return !/[,.]/.test(x); }`,\n    `/**\n        * check if x is not empity\n        * @param  x the value used for check\n        * @return true if x defined and not null and the number of digit is > 0\n      */\n    var notEmpty = function (x) {\n      return (typeof x !== 'undefined' && x !== null ? x.toString().length > 0 : false);\n    }`,\n    `/**\n        * check if x is contained on array\n        * @param  x the value used for check\n        * @return the position of x on array or if array === x\n      */\n    var valueInChoice = function(array, x) { return array.indexOf(x) > -1 || array === x; }`,\n    `var scanGroupField = function(reps, acc, callback) {\n        for (var i = 0; i < reps; i++) {\n            acc = callback(acc, i);\n        }\n        return acc;\n    }`,\n    `/**\n        * sum the value contained on array\n        * @param  x the array\n        * @return the sum\n      */\n    var sum = function(array) {return array.reduce(function(a, b){ return a + b; }, 0); }`,\n    `var dateOperations = function(dString, period, operation, v) {\n        fmt = 'MM/DD/YYYY';\n        var d = (typeof dString !== 'undefined') ? dateUtils.parse(dString) : new Date();\n        if (operation == 'remove') {\n          v = -v;\n        }\n        var dateOp;\n        switch (period) {\n          case 'day':\n            dateOp = dateUtils.addDays;\n            break;\n          case 'month':\n            dateOp = dateUtils.addMonths;\n            break;\n          case 'year':\n            dateOp = dateUtils.addYears;\n            break;\n          default:\n            return -1;\n        }\n        return dateUtils.format(dateOp(d, v), fmt);\n      }`,\n    `/**\n        * round the num\n        * @param  num the value to round\n        * @param  digits how many digit\n        * @return num rounded\n      */\n      var round = function(num, digits) {\n        digits = digits || 0;\n        var f = 0;\n        try { f = parseFloat(num); } catch (e) { }\n        var m = Math.pow(10, digits);\n        return Math.round(f * m) / m;\n      }`,\n    `/**\n        * extract the property of the source object with property != null\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want filter\n        * @return array of dates\n      */\n      var extractArray = function(source, property, property2) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null && source[i][property2] != null) {\n            res.push(source[i][property] + source[i][property2]);\n          }\n          else if (source[i][property] != null) {\n            res.push(source[i][property]);\n          }\n        }\n        return res;\n      }`,\n    `/**\n        * extract the property of the source object with property != null\n        * @param  source array of object wich contains property\n        * @param  propertues string array the properties to sum\n        * @return the sum\n      */\n      var extractSum = function(source, properties) {\n        var sum = 0;\n        properties = (properties || []).slice(0);\n        var l = properties.length;\n\n        for (var i = 0; i < l ; i++) {\n          var array = extractArray(source, properties[i]);\n          var leng = array.length;\n          for(var j = 0; j < leng; i++) {\n            sum += array[j];\n          }\n        }\n        return sum;\n      }`,\n      `/**\n        * extract the array of sum for each week != null\n        * @param  source array of object wich contains property\n        * @param  propertues string array the properties to sum\n        * @return the sum\n      */\n      var extractArraySum = function(source, properties) {\n        var arrays = [];\n        properties = (properties || []).slice(0);\n\n        for (var propI = 0; propI < properties.length ; propI++) {\n          var array = extractArray(source, properties[propI]);\n          arrays.push(array);\n        }\n\n        var res = [];\n        for (var weekI = 0; weekI < array.length; weekI ++ ) {\n          var sum = 0;\n          for (var propI = 0; propI < properties.length ; propI++) {\n            sum = sum + arrays[propI][weekI]\n          }\n          res.push(sum);\n        }\n        return res;\n      }`,\n    `/**\n        * draw a threshold line on chart related to the property\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want filter\n        * @return array of dates\n      */\n      var drawThreshold = function(source, property, threshold) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null) {\n            res.push(threshold);\n          }\n        }\n        return res;\n      }`,\n    `/**\n        * extract the dates of the source object with property != null\n        * @param  source array of object wich contains property and date_start\n        * @param  property the property on wich we want to calculate dates\n        * @param  format the format of the date\n        * @return array of dates\n      */\n      var extractDates = function(source, property, format) {\n        source = (source || []).slice(0);\n        var l = source.length;\n        var res = [];\n        var prefix = '';\n        for (var i = 0; i < l ; i++) {\n          if (source[i][property] != null) {\n            switch(format) {\n              case \"WW\":\n                prefix = \"W\";\n                break;\n              case \"MM\":\n                prefix = \"M\";\n                break;\n              default:\n                prefix = \"\";\n            }\n            res.push(prefix + formatDate(source[i][\"date_start\"], format));\n          }\n        }\n        return res;\n      }`,\n    `/**\n        * extract the last property contains in source != null\n        * @param  source array of object wich contains property and date_start\n        * @param  property the property to find\n        * @return the last property != null\n      */\n      var lastProperty = function(source, property) {\n        source = (source || []).slice(0);\n        var l = source.length -1;\n\n        while (l >= 0 && source[l][property] == null) {\n          l--;\n          if (l < 0) return 0;\n        }\n        return l >= 0 ? source[l][property] : 0;\n      }`,\n    `var sumLastProperties = function(source, properties) {\n        source = (source || []).slice(0);\n        var sum = 0;\n        for (var i = 0; i < properties.length; i++) {\n          sum += lastProperty(source, properties[i]);\n        }\n\n        return sum;\n      }`,\n    `/**\n        * compute the trend of the property contained on the source.\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want to calculate the trend\n        * @return an html icon that identifies the trend\n      */\n      var calculateTrendProperty = function(source, property) {\n        source = (source || []).slice(0);\n        var last = source.length - 1;\n        while (source[last][property] == null) {\n          if (last == 0) {\n            break;\n          }\n          last--;\n        }\n        var lastLast = last - 1;\n        if (last == 0) {\n          lastLast = last;\n        } else {\n          while (source[lastLast][property] == null) {\n            if (lastLast == 0) {\n              lastLast = last;\n              break;\n            }\n            lastLast--;\n          }\n        }\n\n        var lastProperty = source[last]?(source[last][property] || 0): 0;\n        var lastLastProperty = source[lastLast]?(source[lastLast][property] || 0): 0;\n\n        if (lastProperty == lastLastProperty) {\n          return '<p><i class=\"material-icons\" style=\"color:blue\">trending_flat</i></p>';\n        } else if (lastProperty > lastLastProperty) {\n          return '<p><i class=\"material-icons\" style=\"color:green\">trending_up</i></p>';\n        } else {\n          return '<p><i class=\"material-icons\" style=\"color:red\">trending_down</i></p>';\n        }\n      }`,\n    `/**\n        * compute the average value of the property contained on the source.\n        * @param  source array of object wich contains property\n        * @param  property the property on wich we want to calculate the average\n        * @param  range the range on wich we want to calculate the average\n        * @param  coefficent the coefficent used for calculate the threshold\n                  if coefficent is 0 mean return the count of property > 0\n        * @return the average value || the count of property > 0\n      */\n      var calculateAvgProperty = function(source, property, range, coefficient) {\n        source = (source || []).slice(0);\n\n        source.pop();\n\n        coefficient = coefficient || 1;\n        range = range || 12;\n\n        var l = source.length;\n        var res = 0;\n        var counter = 0;\n        var noZero = 0;\n\n        if(l < range) {\n          range = l;\n        }\n\n        while (range != 0) {\n          counter++;\n          if (source[l - 1][property] != null) {\n            res += source[l - 1][property];\n\n            if (source[l - 1][property] > 0) {\n              noZero++;\n            }\n          }\n          l--;\n          range--;\n        }\n\n        if (coefficient == 0) {\n          return noZero;\n        } else {\n          var threshold = (res/counter)*coefficient || 0;\n          return threshold;\n        }\n      }`,\n    `var alert = function(source, property, threshold, fmt) {\n        source = (source || []).slice(0);\n        var l = source.length;\n\n        if ( lastProperty(source, property)  > threshold ) {\n          return '<p><i class=\"material-icons\" style=\"color:red\">warning</i></p>';\n          } else {\n            return '<p></p>';\n          }\n      }`,\n    `var formatNumber = function(num, fmt) {\n        fmt = fmt || '0,0[.]0';\n        return numeral(num).format(fmt);\n      }`,\n    `var formatDate = function(date, fmt) {\n        fmt = fmt || 'MM-DD-YYYY';\n        return dateUtils.format(date, fmt);\n      }`,\n    `var isoMonth = function(date, fmt) {\n        fmt = fmt || 'MM';\n        var du = dateUtils;\n        return du.format(du.addDays(du.startOfMonth(date), 4),fmt)\n      }`,\n    `var nextCounterValue = function(counterName, firstValue) {\n        firstValue = firstValue != null ? firstValue : 0;\n        if (execContext['$$'+counterName] == null) {\n          execContext['$$'+counterName] = firstValue;\n        } else {\n          execContext['$$'+counterName]++;\n        }\n        return execContext['$$'+counterName];\n      }`,\n    `var getCoordinate = function(source, zoom) {\n        zoom = zoom || 6;\n        if(source == null) {\n          return [51.505,-0.09, zoom];\n        } else {\n          return [source[0], source[1], zoom];\n        }\n      }`\n  ];\n\n  private _functions: (Function | string)[] = [];\n  private _functionsStr: string = '';\n\n  constructor() {\n    this._initFunctions();\n  }\n\n  addFunction(f: Function | string): void {\n    this._functions.push(f);\n    this._initFunctions();\n  }\n\n  addFunctionHandler(name: string, fn: any): void {\n    if (AjfExpressionUtils.utils[name] === undefined) {\n      AjfExpressionUtils.utils[name] = {fn};\n    }\n  }\n\n  private _initFunctions(): void {\n    const functionsStr = this._functions\n      .map(f => typeof f === 'string' ? f : f.toString())\n      .join('; ');\n    this._functionsStr = `${this._baseUtilFunctions.join('; ')}; ${functionsStr}`;\n    AjfExpressionUtils.UTIL_FUNCTIONS = this._functionsStr;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfCondition, AjfContext} from '@ajf/core/models';\nimport {deepCopy} from '@ajf/core/utils';\nimport {EventEmitter, Injectable} from '@angular/core';\nimport {AbstractControl, FormControl, FormGroup} from '@angular/forms';\nimport * as esprima from 'esprima';\nimport {BehaviorSubject, Observable, Subject, Subscriber, Subscription, timer} from 'rxjs';\nimport {\n  debounceTime, filter, map, pairwise, publishReplay, refCount, scan, share, startWith,\n  withLatestFrom\n} from 'rxjs/operators';\n\nimport {AjfFieldInstance} from './interface/fields-instances/field-instance';\nimport {\n  AjfFieldWithChoicesInstance\n} from './interface/fields-instances/field-with-choices-instance';\nimport {AjfFormulaFieldInstance} from './interface/fields-instances/formula-field-instance';\nimport {AjfTableFieldInstance} from './interface/fields-instances/table-field-instance';\nimport {AjfEmptyField} from './interface/fields/empty-field';\nimport {AjfFieldType} from './interface/fields/field-type';\nimport {AjfForm} from './interface/forms/form';\nimport {AjfNodeGroupInstance} from './interface/nodes-instances/node-group-instance';\nimport {AjfNodeInstance} from './interface/nodes-instances/node-instance';\nimport {\n  AjfRepeatingContainerNodeInstance\n} from './interface/nodes-instances/repeating-container-node-instance';\nimport {AjfNode} from './interface/nodes/node';\nimport {AjfNodeGroup} from './interface/nodes/node-group';\nimport {AjfNodeType} from './interface/nodes/node-type';\nimport {AjfNodesInstancesOperation} from './interface/operations/nodes-instances-operation';\nimport {AjfRendererUpdateMapOperation} from './interface/operations/renderer-update-map-operation';\nimport {AjfRendererUpdateMap} from './interface/renderer-maps/update-map';\nimport {AjfBaseSlideInstance} from './interface/slides-instances/base-slide-instance';\nimport {AjfRepeatingSlideInstance} from './interface/slides-instances/repeating-slide-instance';\nimport {AjfSlideInstance} from './interface/slides-instances/slide-instance';\nimport {AjfTableCell} from './interface/fields/table-field';\nimport {isCustomFieldWithChoices} from './utils/fields/is-custom-field-with-choices';\nimport {isFieldWithChoicesInstance} from './utils/fields-instances/is-field-with-choices-instance';\nimport {isTableFieldInstance} from './utils/fields-instances/is-table-field-instance';\nimport {updateFieldInstanceState} from './utils/fields-instances/update-field-instance-state';\nimport {updateFilteredChoices} from './utils/fields-instances/update-filtered-choices';\nimport {updateFormula} from './utils/fields-instances/update-formula';\nimport {updateNextSlideCondition} from './utils/fields-instances/update-next-slide-condition';\nimport {updateTriggerConditions} from './utils/fields-instances/update-trigger-conditions';\nimport {updateValidation} from './utils/fields-instances/update-validation';\nimport {updateWarning} from './utils/fields-instances/update-warning';\nimport {createField} from './utils/fields/create-field';\nimport {isFieldWithChoices} from './utils/fields/is-field-with-choices';\nimport {flattenNodesInstances} from './utils/nodes-instances/flatten-nodes-instances';\nimport {flattenNodesInstancesTree} from './utils/nodes-instances/flatten-nodes-instances-tree';\nimport {isFieldInstance} from './utils/nodes-instances/is-field-instance';\nimport {isNodeGroupInstance} from './utils/nodes-instances/is-node-group-instance';\nimport {isSlideInstance} from './utils/nodes-instances/is-slide-instance';\nimport {isSlidesInstance} from './utils/nodes-instances/is-slides-instance';\nimport {nodeInstanceCompleteName} from './utils/nodes-instances/node-instance-complete-name';\nimport {nodeInstanceSuffix} from './utils/nodes-instances/node-instance-suffix';\nimport {nodeToNodeInstance} from './utils/nodes-instances/node-to-node-instance';\nimport {updateConditionalBranches} from './utils/nodes-instances/update-conditional-branches';\nimport {updateVisibility} from './utils/nodes-instances/update-visibility';\nimport {flattenNodes} from './utils/nodes/flatten-nodes';\nimport {isContainerNode} from './utils/nodes/is-container-node';\nimport {isRepeatingContainerNode} from './utils/nodes/is-repeating-container-node';\nimport {orderedNodes} from './utils/nodes/ordered-nodes';\nimport {updateRepsNum} from './utils/slides-instances/update-reps-num';\nimport {validSlide} from './utils/slides-instances/valid-slide';\nimport {AjfValidationService} from './validation-service';\n\nconst esprimaMod: any = (esprima as any).default || esprima;\nconst {tokenize} = esprimaMod;\n\nexport enum AjfFormInitStatus {\n  Initializing,\n  Complete\n}\n\n@Injectable()\nexport class AjfFormRendererService {\n  private _visibilityNodesMap: Observable<AjfRendererUpdateMap>;\n  private _visibilityNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _repetitionNodesMap: Observable<AjfRendererUpdateMap>;\n  private _repetitionNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _conditionalBranchNodesMap: Observable<AjfRendererUpdateMap>;\n  private _conditionalBranchNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _formulaNodesMap: Observable<AjfRendererUpdateMap>;\n  private _formulaNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _validationNodesMap: Observable<AjfRendererUpdateMap>;\n  private _validationNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _warningNodesMap: Observable<AjfRendererUpdateMap>;\n  private _warningNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _filteredChoicesNodesMap: Observable<AjfRendererUpdateMap>;\n  private _filteredChoicesNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _triggerConditionsNodesMap: Observable<AjfRendererUpdateMap>;\n  private _triggerConditionsNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _nextSlideConditionsNodesMap: Observable<AjfRendererUpdateMap>;\n  private _nextSlideConditionsNodesMapUpdates: Subject<AjfRendererUpdateMapOperation> =\n      new Subject<AjfRendererUpdateMapOperation>();\n\n  private _formInitEvent: EventEmitter<AjfFormInitStatus> = new EventEmitter<AjfFormInitStatus>();\n  readonly formInitEvent: Observable<AjfFormInitStatus> = this._formInitEvent.asObservable();\n\n  private _formGroup: BehaviorSubject<FormGroup | null> =\n    new BehaviorSubject<FormGroup | null>(null);\n  readonly formGroup: Observable<FormGroup | null> = this._formGroup.asObservable();\n\n  private _form: BehaviorSubject<{form: AjfForm | null, context?: AjfContext}|null> =\n      new BehaviorSubject<{form: AjfForm | null, context?: AjfContext}|null>(null);\n  private _nodes: Observable<AjfNodeInstance[]>;\n  private _flatNodes: Observable<AjfNodeInstance[]>;\n  private _flatNodesTree: Observable<AjfSlideInstance[]>;\n  private _nodesUpdates: Subject<AjfNodesInstancesOperation> =\n      new Subject<AjfNodesInstancesOperation>();\n  private _errorPositions: Observable<number[]>;\n  private _errors: Observable<number>;\n\n  private _formGroupSubscription: Subscription = Subscription.EMPTY;\n  private _valueChanged: Subject<void> = new Subject<void>();\n\n  private _nodesMaps: Observable<AjfRendererUpdateMap>[];\n\n  private _nextSlideTrigger: EventEmitter<AjfNodeInstance> = new EventEmitter<AjfNodeInstance>();\n  readonly nextSlideTrigger: Observable<AjfNodeInstance> = this._nextSlideTrigger.asObservable();\n\n  private _slidesNum: BehaviorSubject<number> = new BehaviorSubject<number>(0);\n  readonly slidesNum: Observable<number> = this._slidesNum.asObservable();\n\n  get nodesTree(): Observable<AjfSlideInstance[]> {\n    return this._flatNodesTree;\n  }\n  get errorPositions(): Observable<number[]> { return this._errorPositions; }\n  get errors(): Observable<number> { return this._errors; }\n  get currentSupplementaryInformations(): any {\n    const form = this._form.getValue();\n    return form != null && form.form != null ? form.form.supplementaryInformations : null;\n  }\n\n  constructor(_: AjfValidationService) {\n    this._initUpdateMapStreams();\n    this._initNodesStreams();\n    this._initErrorsStreams();\n    this._initFormStreams();\n    this._updateFormValueAndValidity();\n  }\n\n  setForm(form: AjfForm|null, context: AjfContext = {}) {\n    this._initUpdateMapStreams();\n    if (form != null && Object.keys(context).length === 0 &&\n        Object.keys(form.initContext || {}).length > 0) {\n      context = form.initContext || {};\n    }\n    const currentForm = this._form.getValue();\n    if (\n      (currentForm == null && form != null) ||\n      (currentForm != null && form !== currentForm.form)\n    ) {\n      this._form.next({form: form, context: context});\n    }\n  }\n\n  getFormValue(): any {\n    const formGroup = this._formGroup.getValue();\n    if (formGroup == null) { return {}; }\n    let res = deepCopy(formGroup.value);\n    return res;\n  }\n\n  addGroup(group: AjfNodeGroupInstance | AjfRepeatingSlideInstance): Observable<boolean> {\n    return new Observable<boolean>((subscriber: Subscriber<boolean>) => {\n      if (group.formulaReps != null) {\n        subscriber.next(false);\n        subscriber.complete();\n        return;\n      }\n      const maxReps = group.node.maxReps;\n      if (maxReps > 0 && group.reps + 1 > maxReps) {\n        subscriber.next(false);\n        subscriber.complete();\n        return;\n      }\n      const oldReps = group.reps;\n      group.reps = group.reps + 1;\n      group.canAdd = group.node.maxReps === 0 || group.reps < group.node.maxReps;\n      group.canRemove = group.node.minReps === 0 || group.reps > group.node.minReps;\n      this._nodesUpdates.next((nodes: AjfNodeInstance[]): AjfNodeInstance[] => {\n        const flatNodes = flattenNodesInstances(nodes, true);\n        this._adjustReps(flatNodes, group, oldReps, this.getFormValue());\n        subscriber.next(true);\n        subscriber.complete();\n        return nodes;\n      });\n    });\n  }\n\n  removeGroup(group: AjfNodeGroupInstance | AjfRepeatingSlideInstance): Observable<boolean> {\n    return new Observable<boolean>((subscriber: Subscriber<boolean>) => {\n      if (group.formulaReps != null) {\n        subscriber.next(false);\n        subscriber.complete();\n        return;\n      }\n      const minReps = group.node.minReps;\n      if (group.reps - 1 < minReps) {\n        subscriber.next(false);\n        subscriber.complete();\n        return;\n      }\n      const oldReps = group.reps;\n      group.reps = group.reps - 1;\n      group.canAdd = group.node.maxReps === 0 || group.reps < group.node.maxReps;\n      group.canRemove = group.node.minReps === 0 || group.reps > group.node.minReps;\n      this._nodesUpdates.next((nodes: AjfNodeInstance[]): AjfNodeInstance[] => {\n        this._adjustReps(nodes, group, oldReps, this.getFormValue());\n        subscriber.next(true);\n        subscriber.complete();\n        return nodes;\n      });\n    });\n  }\n\n  getControl(field: AjfFieldInstance): Observable<AbstractControl | null> {\n    return this.formGroup.pipe(map((f) => {\n      const fieldName = nodeInstanceCompleteName(field);\n      return f != null && f.contains(fieldName) ? f.controls[fieldName] : null;\n    }));\n  }\n\n  private _initErrorsStreams(): void {\n    this._errorPositions = this._valueChanged.pipe(\n        withLatestFrom(this._nodes, this._form), filter(v => v[2] != null && v[2].form != null),\n        map((v: [void, AjfNodeInstance[], {form: AjfForm | null, context?: AjfContext}|null]) => {\n          const nodes = v[1];\n          const form = v[2]!.form!;\n          let currentPosition = 0;\n          const errors: number[] = [];\n          nodes.forEach((node) => {\n            if (node.node.nodeType === AjfNodeType.AjfRepeatingSlide) {\n              const rsNode = node as AjfRepeatingSlideInstance;\n              for (let i = 0; i < rsNode.reps; i++) {\n                if (node.visible) {\n                  currentPosition++;\n                  if (i == 0) {\n                    rsNode.position = currentPosition;\n                  }\n                  if (!validSlide(rsNode, i)) {\n                    errors.push(currentPosition);\n                  }\n                }\n              }\n            } else if (node.node.nodeType === AjfNodeType.AjfSlide) {\n              const sNode = node as AjfSlideInstance;\n              if (sNode.visible) {\n                currentPosition++;\n                sNode.position = currentPosition;\n                if (!sNode.valid) {\n                  errors.push(currentPosition);\n                }\n              }\n            }\n          });\n          form.valid = errors.length == 0;\n          this._slidesNum.next(currentPosition);\n          return errors;\n        }),\n        publishReplay(), refCount());\n    this._errors = this._errorPositions.pipe(\n      map(e => e != null ? e.length : 0),\n      startWith(0),\n      publishReplay(),\n      refCount()\n    );\n  }\n\n  private _initUpdateMapStreams(): void {\n    this._visibilityNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._visibilityNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n    this._repetitionNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._repetitionNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n    this._conditionalBranchNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._conditionalBranchNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n    this._formulaNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._formulaNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n    this._validationNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._validationNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n    this._warningNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._warningNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n    this._filteredChoicesNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._filteredChoicesNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n    this._triggerConditionsNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._triggerConditionsNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n    this._nextSlideConditionsNodesMap =\n        (<Observable<AjfRendererUpdateMapOperation>>this._nextSlideConditionsNodesMapUpdates)\n            .pipe(scan((rmap: AjfRendererUpdateMap, op: AjfRendererUpdateMapOperation) => {\n                    return op(rmap);\n                  }, {}), startWith<AjfRendererUpdateMap>({}), share());\n\n    this._nodesMaps = [\n      this._visibilityNodesMap,\n      this._repetitionNodesMap,\n      this._conditionalBranchNodesMap,\n      this._formulaNodesMap,\n      this._validationNodesMap,\n      this._warningNodesMap,\n      this._nextSlideConditionsNodesMap,\n      this._filteredChoicesNodesMap,\n      this._triggerConditionsNodesMap\n    ];\n  }\n\n  private _initFormStreams(): void {\n    const formObs = <Observable<{form: AjfForm | null, context?: AjfContext}>>this._form;\n    formObs\n      .pipe(map((_form) => {\n        return this._initFormGroupStreams(new FormGroup({}));\n      }))\n      .subscribe(this._formGroup);\n    formObs\n        .pipe(map((form) => {\n          return (_nodesInstances: AjfNodeInstance[]): AjfNodeInstance[] => {\n            const nodes = form != null && form.form != null ?\n                this._orderedNodesInstancesTree(\n                    flattenNodes(form.form.nodes), form.form.nodes, undefined, [],\n                    form.context || {}) :\n                [];\n            let currentPosition = 0;\n            nodes.forEach((node) => {\n              if (node.node.nodeType === AjfNodeType.AjfRepeatingSlide) {\n                const rsNode = node as AjfRepeatingSlideInstance;\n                for (let i = 0; i < rsNode.reps; i++) {\n                  if (node.visible) {\n                    currentPosition++;\n                    if (i == 0) {\n                      rsNode.position = currentPosition;\n                    }\n                  }\n                }\n              } else if (node.node.nodeType === AjfNodeType.AjfSlide) {\n                const sNode = node as AjfSlideInstance;\n                if (sNode.visible) {\n                  currentPosition++;\n                  sNode.position = currentPosition;\n                }\n              }\n            });\n            return nodes;\n          };\n        }))\n        .subscribe(this._nodesUpdates);\n  }\n\n  private _initNodeInstance(\n      allNodes: AjfNode[]|AjfNodeInstance[], node: AjfNode, prefix: number[], context: AjfContext,\n      branchVisibility = true): AjfNodeInstance|null {\n    let instance = nodeToNodeInstance(allNodes, node, prefix, context);\n    if (instance != null) {\n      const nodeType = instance.node.nodeType;\n      if (nodeType === AjfNodeType.AjfNodeGroup || nodeType === AjfNodeType.AjfRepeatingSlide) {\n        this._explodeRepeatingNode(\n            allNodes, instance as AjfNodeGroupInstance | AjfRepeatingSlideInstance, context);\n      } else if (nodeType === AjfNodeType.AjfSlide) {\n        const sInstance = instance as AjfSlideInstance;\n        sInstance.nodes = this._orderedNodesInstancesTree(\n            allNodes, sInstance.node.nodes, sInstance.node.id, prefix, context);\n      }\n      updateVisibility(instance, context, branchVisibility);\n      updateConditionalBranches(instance, context);\n      if (nodeType === AjfNodeType.AjfField) {\n        const fInstance = instance as AjfFieldInstance;\n\n        if (isCustomFieldWithChoices(fInstance.node) || isFieldWithChoices(fInstance.node)) {\n          updateFilteredChoices(fInstance as AjfFieldWithChoicesInstance<any>, context);\n        } else {\n          if (isTableFieldInstance(fInstance)) {\n            const tfInstance = fInstance as AjfTableFieldInstance;\n            const tNode = tfInstance.node;\n            tfInstance.context = context[nodeInstanceCompleteName(tfInstance)] || context;\n              const formGroup = this._formGroup.getValue();\n              let controlsWithLabels: [string, (string|FormControl)[]][] = [];\n              controlsWithLabels.push([node.label, tNode.columnLabels]);\n              if (formGroup != null) {\n                tNode.rows.forEach((row, rowIdx) => {\n                  let r: FormControl[] = [];\n                  (row as AjfTableCell[]).forEach((cell, idx) => {\n                    /*\n                    every control is registered with the cell position\n                    inside the form control matrix\n                    with this mask `${tNode.name}__${rowIdx}__${idx}`\n                    */\n                    const name = `${tNode.name}__${rowIdx}__${idx}`;\n                    const control = new FormControl();\n                    control.setValue(tfInstance.context[cell.formula]);\n                    formGroup\n                      .registerControl(name, control);\n                    r.push(control);\n                    /* create a object that respect the instance interface\n                    with the minimum defined properties to allow to run addToNodeFormula map*/\n                    const fakeInstance = {\n                      formula: {formula: cell.formula},\n                      node: {\n                        name,\n                        nodeType: 0,\n                        editable: false\n                      },\n                      visible: true,\n                      prefix: [],\n                      conditionalBranches: [],\n                      updatedEvt: new EventEmitter<void>()\n                    } as unknown as AjfNodeInstance;\n                    this._addToNodesFormulaMap(fakeInstance, cell.formula);\n                  });\n                  controlsWithLabels.push([tNode.rowLabels[rowIdx], r]);\n                });\n                tfInstance.controls = controlsWithLabels;\n              }\n          } else {\n            fInstance.value = context[nodeInstanceCompleteName(instance)];\n          }\n          updateFieldInstanceState(fInstance, context);\n        }\n      }\n      this._addNodeInstance(instance);\n    }\n    return instance;\n  }\n\n  private _adjustReps(\n      allNodes: AjfNode[]|AjfNodeInstance[], instance: AjfRepeatingContainerNodeInstance,\n      oldReps: number,\n      context: AjfContext): {added: AjfNodeInstance[]|null, removed: AjfNodeInstance[]|null} {\n    const newReps = instance.reps;\n    const result: { added: AjfNodeInstance[] | null, removed: AjfNodeInstance[] | null } = {\n      added: null,\n      removed: null\n    };\n    if (oldReps < newReps) {\n      const newNodes: AjfNodeInstance[] = [];\n      if (instance.nodes == null) {\n        instance.nodes = [];\n      }\n      if (instance.node.nodeType === AjfNodeType.AjfNodeGroup) {\n        const node = createField({\n                       id: 999,\n                       name: '',\n                       parent: -1,\n                       fieldType: AjfFieldType.Empty,\n                       label: instance.node.label\n                     }) as AjfEmptyField;\n        const newInstance = this._initNodeInstance(\n          allNodes, node, instance.prefix.slice(0), context);\n        if (newInstance != null) {\n          instance.nodes.push(newInstance);\n        }\n      }\n      for (let i = oldReps ; i < newReps ; i++) {\n        const prefix = instance.prefix.slice(0);\n        const group = instance.node;\n        prefix.push(i);\n        orderedNodes(group.nodes, instance.node.id)\n          .forEach((n) => {\n            const newInstance = this._initNodeInstance(allNodes, n, prefix, context);\n            if (newInstance != null) {\n              newNodes.push(newInstance);\n              instance.nodes.push(newInstance);\n            }\n          });\n        this._addNodeInstance(instance);\n      }\n      result.added = newNodes;\n    } else if (oldReps > newReps) {\n      let nodesNum = instance.nodes.length / oldReps;\n      if (instance.node.nodeType === AjfNodeType.AjfNodeGroup) {\n        nodesNum ++;\n      }\n      result.removed = instance.nodes.splice(newReps * nodesNum, nodesNum);\n      result.removed.forEach((n => {\n        this._removeNodeInstance(n);\n      }));\n    }\n    if (oldReps != newReps && instance.formulaReps == null) {\n      const fg = this._formGroup.getValue();\n      const completeName = nodeInstanceCompleteName(instance);\n      if (fg != null && fg.contains(completeName)) {\n        fg.controls[completeName].setValue(instance.reps);\n      }\n    }\n    instance.flatNodes = flattenNodesInstances(instance.nodes);\n    if (instance.node.nodeType === AjfNodeType.AjfRepeatingSlide) {\n      const rsInstance = instance as AjfRepeatingSlideInstance;\n      const slideNodes: AjfNodeInstance[][] = [];\n      const nodesPerSlide =\n          rsInstance.nodes != null ? rsInstance.nodes.length / rsInstance.reps : 0;\n      for (let i = 0 ; i < instance.reps ; i++) {\n        const startNode = i * nodesPerSlide;\n        slideNodes.push(instance.nodes.slice(startNode, startNode + nodesPerSlide));\n      }\n      rsInstance.slideNodes = slideNodes;\n    }\n    return result;\n  }\n\n  private _updateFormValueAndValidity(): void {\n    this._nodesUpdates.asObservable()\n        .pipe(\n            withLatestFrom(this._formGroup),\n            filter((values: [AjfNodesInstancesOperation, FormGroup|null]) => values[1] !== null))\n        .subscribe((values: [AjfNodesInstancesOperation, FormGroup|null]) => {\n          const form: FormGroup = <FormGroup>values[1];\n          form.updateValueAndValidity();\n        });\n  }\n\n  private _explodeRepeatingNode(\n      allNodes: AjfNode[]|AjfNodeInstance[],\n      instance: AjfNodeGroupInstance|AjfRepeatingSlideInstance, context: AjfContext) {\n    const oldReps = updateRepsNum(instance, context);\n    if (oldReps !== instance.reps) {\n      this._adjustReps(allNodes, instance, oldReps, context);\n    }\n  }\n\n  private _orderedNodesInstancesTree(\n      allNodes: AjfNode[]|AjfNodeInstance[], nodes: AjfNode[], parent: number|null = null,\n      prefix: number[] = [], context: AjfContext): AjfNodeInstance[] {\n    let nodesInstances: AjfNodeInstance[] = [];\n    const curSuffix = prefix.length > 0 ? '__' + prefix.join('__') : '';\n    orderedNodes(nodes, parent).forEach((node: AjfNode) => {\n      const parentNodeInstance = nodesInstances.find(\n          ni => ni.node.id == node.parent && nodeInstanceSuffix(ni) == curSuffix);\n      const branchVisibility = parentNodeInstance != null ?\n          parentNodeInstance.verifiedBranch != null &&\n              parentNodeInstance.verifiedBranch == node.parentNode :\n          true;\n      const nni = this._initNodeInstance(allNodes, node, prefix, context, branchVisibility);\n      if (nni != null) {\n        nodesInstances.push(nni);\n      }\n    });\n    return nodesInstances;\n  }\n\n  private _formValueDelta(oldValue: any, newValue: any): string[] {\n    return Object.keys(newValue)\n      .filter((k) => oldValue[k] !== newValue[k]);\n  }\n\n  private _initFormGroupStreams(formGroup: FormGroup): FormGroup {\n    this._formGroupSubscription.unsubscribe();\n    let init = true;\n    let initForm = true;\n    this._formInitEvent.emit(AjfFormInitStatus.Initializing);\n    this._formGroupSubscription =\n        formGroup.valueChanges\n            .pipe(\n                startWith<any>({}), pairwise(), debounceTime(200),\n                withLatestFrom<\n                    [any, any],\n                    [\n                      [any, any], AjfRendererUpdateMap, AjfRendererUpdateMap, AjfRendererUpdateMap,\n                      AjfRendererUpdateMap, AjfRendererUpdateMap, AjfRendererUpdateMap,\n                      AjfRendererUpdateMap, AjfRendererUpdateMap, AjfRendererUpdateMap,\n                      AjfNodeInstance[]\n                    ]>(...(this._nodesMaps), this._flatNodes))\n            .subscribe((v: [\n                         [any, any], AjfRendererUpdateMap, AjfRendererUpdateMap,\n                         AjfRendererUpdateMap, AjfRendererUpdateMap, AjfRendererUpdateMap,\n                         AjfRendererUpdateMap, AjfRendererUpdateMap, AjfRendererUpdateMap,\n                         AjfRendererUpdateMap, AjfNodeInstance[]\n                       ]) => {\n              const oldFormValue = init && {} || v[0][0];\n              init = false;\n              const newFormValue = v[0][1];\n              const visibilityMap = v[1];\n              const repetitionMap = v[2];\n              const conditionalBranchesMap = v[3];\n              const formulaMap = v[4];\n              const validationMap = v[5];\n              const warningMap = v[6];\n              const nextSlideConditionsMap = v[7];\n              const filteredChoicesMap = v[8];\n              const triggerConditionsMap = v[9];\n              const nodes = v[10];\n\n              // takes the names of the fields that have changed\n              const delta = this._formValueDelta(oldFormValue, newFormValue);\n              const deltaLen = delta.length;\n              let updatedNodes: AjfNodeInstance[] = [];\n\n              /*\n                for each field update all properties map\n                with the following rule  \"if fieldname is in map update it\" and\n                push on updateNodes the node instance that wrap field\n              */\n              delta.forEach((fieldName) => {\n                updatedNodes = updatedNodes.concat(\n                    nodes.filter(n => nodeInstanceCompleteName(n) === fieldName));\n                if (visibilityMap[fieldName] != null) {\n                  visibilityMap[fieldName].forEach(nodeInstance => {\n                    const completeName = nodeInstanceCompleteName(nodeInstance);\n                    const visibilityChanged = updateVisibility(nodeInstance, newFormValue);\n                    const isField = isFieldInstance(nodeInstance);\n                    if (visibilityChanged && !nodeInstance.visible) {\n                      const fg = this._formGroup.getValue();\n                      if (fg != null) {\n                        const s = timer(200).subscribe(() => {\n                          if (s && !s.closed) {\n                            s.unsubscribe();\n                          }\n                          fg.controls[completeName].setValue(null);\n                        });\n                      }\n                      if (isField) {\n                        (nodeInstance as AjfFieldInstance).value = null;\n                      }\n                    } else if (visibilityChanged && nodeInstance.visible && isField) {\n                      const fg = this._formGroup.getValue();\n                      const res = updateFormula(nodeInstance as AjfFieldInstance, newFormValue);\n                      if (fg != null && res.changed) {\n                        fg.controls[completeName].setValue(res.value);\n                      }\n                    }\n                    if (updatedNodes.indexOf(nodeInstance) === -1) {\n                      updatedNodes.push(nodeInstance);\n                    }\n                  });\n                }\n\n                if (repetitionMap[fieldName] != null) {\n                  repetitionMap[fieldName].forEach(nodeInstance => {\n                    if (isRepeatingContainerNode(nodeInstance.node)) {\n                      const rnInstance = nodeInstance as AjfRepeatingContainerNodeInstance;\n                      const oldReps = updateRepsNum(rnInstance, newFormValue);\n                      if (oldReps !== rnInstance.reps) {\n                        this._adjustReps(nodes, rnInstance, oldReps, newFormValue);\n                      }\n                    }\n                    if (updatedNodes.indexOf(nodeInstance) === -1) {\n                      updatedNodes.push(nodeInstance);\n                    }\n                  });\n                }\n\n                if (conditionalBranchesMap[fieldName] != null) {\n                  conditionalBranchesMap[fieldName].forEach((nodeInstance) => {\n                    // const branchChanged = nodeInstance.updateConditionalBranches(newFormValue);\n                    updateConditionalBranches(nodeInstance, newFormValue);\n                    // if (branchChanged) {\n                    const verifiedBranch = nodeInstance.verifiedBranch;\n                    nodeInstance.conditionalBranches.forEach((_condition, idx) => {\n                      if (idx == verifiedBranch) {\n                        this._showSubtree(newFormValue, nodes, nodeInstance, idx);\n                      } else {\n                        this._hideSubtree(newFormValue, nodes, nodeInstance, idx);\n                      }\n                    });\n                    // }\n                    if (updatedNodes.indexOf(nodeInstance) === -1) {\n                      updatedNodes.push(nodeInstance);\n                    }\n                  });\n                }\n\n                if (formulaMap[fieldName] != null) {\n                  formulaMap[fieldName].forEach((nodeInstance) => {\n                    if (isFieldInstance(nodeInstance)) {\n                      const fInstance = nodeInstance as AjfFieldInstance;\n                      const res = updateFormula(fInstance, newFormValue);\n                      const fg = this._formGroup.getValue();\n                      if (fg != null && res.changed) {\n                        updateValidation(fInstance, newFormValue);\n                        fg.controls[nodeInstanceCompleteName(nodeInstance)].setValue(res.value);\n                      }\n                    }\n                    if (updatedNodes.indexOf(nodeInstance) === -1) {\n                      updatedNodes.push(nodeInstance);\n                    }\n                  });\n                }\n\n                if (validationMap[fieldName] != null) {\n                  validationMap[fieldName].forEach((nodeInstance) => {\n                    if (isFieldInstance(nodeInstance)) {\n                      const fInstance = nodeInstance as AjfFieldInstance;\n                      newFormValue.$value = newFormValue[nodeInstanceCompleteName(nodeInstance)];\n                      updateValidation(\n                          fInstance, newFormValue, this.currentSupplementaryInformations);\n                    }\n                    if (updatedNodes.indexOf(nodeInstance) === -1) {\n                      updatedNodes.push(nodeInstance);\n                    }\n                  });\n                }\n\n                if (warningMap[fieldName] != null) {\n                  warningMap[fieldName].forEach((nodeInstance) => {\n                    if (isFieldInstance(nodeInstance)) {\n                      const fInstance = nodeInstance as AjfFieldInstance;\n                      updateWarning(fInstance, newFormValue);\n                      if (fInstance.warningResults != null &&\n                          fInstance.warningResults.filter(warning => warning.result).length > 0) {\n                        fInstance.warningTrigger.emit();\n                      }\n                    }\n                    if (updatedNodes.indexOf(nodeInstance) === -1) {\n                      updatedNodes.push(nodeInstance);\n                    }\n                  });\n                }\n\n                if (deltaLen == 1 && nextSlideConditionsMap[fieldName] != null) {\n                  if (nextSlideConditionsMap[fieldName]\n                          .filter((nodeInstance) => {\n                            if (isFieldInstance(nodeInstance)) {\n                              const fInstance = nodeInstance as AjfFieldInstance;\n                              return updateNextSlideCondition(fInstance, newFormValue);\n                            }\n                            return false;\n                          })\n                          .length == 1) {\n                    this._nextSlideTrigger.emit();\n                  }\n                }\n\n                if (filteredChoicesMap[fieldName] != null) {\n                  filteredChoicesMap[fieldName].forEach((nodeInstance) => {\n                    if (isFieldInstance(nodeInstance)) {\n                      const fInstance = nodeInstance as AjfFieldInstance;\n                      if (isFieldWithChoices(fInstance.node)) {\n                        updateFilteredChoices(\n                            fInstance as AjfFieldWithChoicesInstance<any>, newFormValue);\n                      }\n                    }\n                    if (updatedNodes.indexOf(nodeInstance) === -1) {\n                      updatedNodes.push(nodeInstance);\n                    }\n                  });\n                }\n\n                if (deltaLen == 1 && triggerConditionsMap[fieldName] != null) {\n                  const res = triggerConditionsMap[fieldName].filter((nodeInstance) => {\n                    if (!isFieldInstance(nodeInstance)) {\n                      return false;\n                    }\n                    const fInstance = nodeInstance as AjfFieldInstance;\n                    if (!isFieldWithChoices(fInstance.node)) {\n                      return false;\n                    }\n                    return updateTriggerConditions(\n                        fInstance as AjfFieldWithChoicesInstance<any>, newFormValue);\n                  });\n                  if (res.length == 1) {\n                    (res[0] as AjfFieldWithChoicesInstance<any>).selectionTrigger.emit();\n                  }\n                }\n              });\n              updatedNodes.forEach(n => {\n                const nodeIdx = nodes.indexOf(n);\n                let idx = nodeIdx - 1;\n                while (idx >= 0) {\n                  const curNode = nodes[idx];\n                  if (isSlidesInstance(curNode)) {\n                    const slide = curNode as (AjfRepeatingSlideInstance | AjfSlideInstance);\n                    const subNodesNum = slide.flatNodes.length;\n                    let valid = true;\n                    for (let i = 0 ; i < subNodesNum ; i++) {\n                      const subNode = slide.flatNodes[i];\n                      if (\n                        subNode.visible && isFieldInstance(subNode)\n                        && !(subNode as AjfFieldInstance).valid\n                      ) {\n                        valid = false;\n                        break;\n                      }\n                    }\n                    if (slide.valid !== valid) {\n                      slide.valid = valid;\n                    }\n                    slide.updatedEvt.emit();\n                  }\n                  idx--;\n                }\n                n.updatedEvt.emit();\n              });\n              if (initForm) {\n                initForm = false;\n                this._formInitEvent.emit(AjfFormInitStatus.Complete);\n              }\n              this._valueChanged.next();\n            });\n    return formGroup;\n  }\n\n  private _showSubtree(\n      context: AjfContext, nodes: AjfNodeInstance[], node: AjfNodeInstance, branch?: number) {\n    this._updateSubtreeVisibility(context, nodes, node, true, branch);\n  }\n\n  private _hideSubtree(\n      context: AjfContext, nodes: AjfNodeInstance[], node: AjfNodeInstance, branch?: number) {\n    this._updateSubtreeVisibility(context, nodes, node, false, branch);\n  }\n\n  private _updateSubtreeVisibility(\n      context: AjfContext, nodes: AjfNodeInstance[], node: AjfNodeInstance, visible: boolean,\n      branch?: number) {\n    let subNodes: AjfNodeInstance[];\n    const nodeSuffix = nodeInstanceSuffix(node);\n    if (branch != null) {\n      subNodes = nodes.filter(n => {\n        const suffix = nodeInstanceSuffix(n);\n        return suffix == nodeSuffix && n.node.parent == node.node.id && n.node.parentNode == branch;\n      });\n    } else {\n      subNodes = nodes.filter(n => {\n        const suffix = nodeInstanceSuffix(n);\n        return suffix == nodeSuffix && n.node.parent == node.node.id;\n      });\n    }\n    const isContainer = isContainerNode(node.node);\n    subNodes.forEach((n) => {\n      if (\n        !isContainer ||\n        (isContainer && (<AjfNodeGroup>node.node).nodes.find(cn => cn.id == n.node.id) == null)\n      ) {\n        updateVisibility(n, context, visible);\n        updateFormula(n as AjfFormulaFieldInstance, context);\n        this._updateSubtreeVisibility(context, nodes, n, visible);\n      }\n    });\n  }\n\n  private _initNodesStreams(): void {\n    this._nodes =\n        this._nodesUpdates.pipe(scan((nodes: AjfNodeInstance[], op: AjfNodesInstancesOperation) => {\n                                  return op(nodes);\n                                }, []), share());\n    this._flatNodesTree = this._nodes.pipe(map(nodes => flattenNodesInstancesTree(nodes)), share());\n    this._flatNodes = this._flatNodesTree.pipe(\n        map(slides => {\n          let nodes: AjfNodeInstance[] = [];\n          slides.forEach(s => {\n            nodes.push(s);\n            nodes = nodes.concat(s.flatNodes);\n          });\n          return nodes;\n        }),\n        share());\n  }\n\n  private _removeNodeInstance(nodeInstance: AjfNodeInstance): AjfNodeInstance {\n    const nodeName = nodeInstanceCompleteName(nodeInstance);\n    this._removeNodesVisibilityMapIndex(nodeName);\n    this._removeNodesRepetitionMapIndex(nodeName);\n    this._removeNodesConditionalBranchMapIndex(nodeName);\n    this._removeNodesFormulaMapIndex(nodeName);\n    this._removeNodesValidationMapIndex(nodeName);\n    this._removeNodesWarningMapIndex(nodeName);\n    this._removeNodesNextSlideConditionsMapIndex(nodeName);\n    this._removeNodesFilteredChoicesMapIndex(nodeName);\n    this._removeNodesTriggerConditionsMapIndex(nodeName);\n    if (isSlidesInstance(nodeInstance)) {\n      return this._removeSlideInstance(nodeInstance as AjfBaseSlideInstance);\n    } else if (isRepeatingContainerNode(nodeInstance.node)) {\n      this._removeNodeGroupInstance(nodeInstance as AjfRepeatingContainerNodeInstance);\n    } else if (isFieldInstance(nodeInstance)) {\n      this._removeFieldInstance(nodeInstance as AjfFieldInstance);\n    }\n\n    return nodeInstance;\n  }\n\n  private _removeSlideInstance(slideInstance: AjfBaseSlideInstance): AjfBaseSlideInstance {\n    const slide = slideInstance.node;\n    if (slide.visibility != null) {\n      this._removeFromNodesVisibilityMap(slideInstance, slide.visibility.condition);\n    }\n    slideInstance.conditionalBranches.forEach((conditionalBranch: AjfCondition) => {\n      this._removeFromNodesConditionalBranchMap(slideInstance, conditionalBranch.condition);\n    });\n    return slideInstance;\n  }\n\n  private _removeNodeGroupInstance(nodeGroupInstance: AjfRepeatingContainerNodeInstance):\n      AjfRepeatingContainerNodeInstance {\n    const nodeGroup = nodeGroupInstance.node;\n    if (nodeGroup.visibility != null) {\n      this._removeFromNodesVisibilityMap(nodeGroupInstance, nodeGroup.visibility.condition);\n    }\n    if (nodeGroupInstance.formulaReps != null && nodeGroup.formulaReps != null) {\n      this._removeFromNodesRepetitionMap(nodeGroupInstance, nodeGroup.formulaReps.formula);\n    }\n    return nodeGroupInstance;\n  }\n\n  private _removeFieldInstance(fieldInstance: AjfFieldInstance): AjfFieldInstance {\n    const formGroup = this._formGroup.getValue();\n    const fieldInstanceName = nodeInstanceCompleteName(fieldInstance);\n    if (formGroup != null && formGroup.contains(fieldInstanceName)) {\n      formGroup.removeControl(fieldInstanceName);\n    }\n    if (fieldInstance.validation != null) {\n      this._validationNodesMapUpdates.next((vmap: AjfRendererUpdateMap): AjfRendererUpdateMap => {\n        if (vmap[fieldInstanceName] == null) {\n          delete vmap[fieldInstanceName];\n        }\n        return vmap;\n      });\n    }\n\n    if (fieldInstance.visibility != null) {\n      this._removeFromNodesVisibilityMap(fieldInstance, fieldInstance.visibility.condition);\n    }\n\n    fieldInstance.conditionalBranches.forEach((conditionalBranch: AjfCondition) => {\n      this._removeFromNodesConditionalBranchMap(fieldInstance, conditionalBranch.condition);\n    });\n\n    if (fieldInstance.formula) {\n      this._removeFromNodesFormulaMap(fieldInstance, fieldInstance.formula.formula);\n    }\n\n    // TODO: check this, probably is never verified\n    if (isRepeatingContainerNode(fieldInstance.node)) {\n      const rcInstance = (fieldInstance as AjfNodeInstance as AjfRepeatingContainerNodeInstance);\n      if (rcInstance.formulaReps != null) {\n        this._removeFromNodesRepetitionMap(fieldInstance, rcInstance.formulaReps.formula);\n      }\n    }\n\n    if (fieldInstance.validation != null && fieldInstance.validation.conditions != null) {\n      fieldInstance.validation.conditions.forEach((condition) => {\n        this._removeFromNodesValidationMap(fieldInstance, condition.condition);\n      });\n    }\n\n    if (fieldInstance.warning != null) {\n      fieldInstance.warning.conditions.forEach((condition) => {\n        this._removeFromNodesWarningMap(fieldInstance, condition.condition);\n      });\n    }\n\n    if (fieldInstance.nextSlideCondition != null) {\n      this._removeFromNodesNextSlideConditionsMap(\n        fieldInstance, fieldInstance.nextSlideCondition.condition\n      );\n    }\n\n    if (isFieldWithChoices(fieldInstance.node)) {\n      const fwcInstance = fieldInstance as AjfFieldWithChoicesInstance<any>;\n      if (fwcInstance.choicesFilter != null) {\n        this._removeFromNodesFilteredChoicesMap(fieldInstance, fwcInstance.choicesFilter.formula);\n        if (fwcInstance.triggerConditions != null) {\n          fwcInstance.triggerConditions.forEach((condition) => {\n            this._removeFromNodesTriggerConditionsMap(fieldInstance, condition.condition);\n          });\n        }\n      }\n    }\n\n    return fieldInstance;\n  }\n\n  private _addNodeInstance(nodeInstance: AjfNodeInstance): AjfNodeInstance {\n    if (isRepeatingContainerNode(nodeInstance.node)) {\n      return this._addNodeGroupInstance(nodeInstance as AjfRepeatingContainerNodeInstance);\n    } else if (isSlideInstance(nodeInstance)) {\n      return this._addSlideInstance(nodeInstance as AjfSlideInstance);\n    } else if (isFieldInstance(nodeInstance)) {\n      return this._addFieldInstance(nodeInstance as AjfFieldInstance);\n    }\n\n    return nodeInstance;\n  }\n\n  private _addFieldInstance(fieldInstance: AjfFieldInstance): AjfFieldInstance {\n    const formGroup = this._formGroup.getValue();\n    const fieldInstanceName = nodeInstanceCompleteName(fieldInstance);\n    if (formGroup != null && !formGroup.contains(fieldInstanceName)) {\n      const control = new FormControl();\n      control.setValue(fieldInstance.value);\n      formGroup.registerControl(fieldInstanceName, control);\n    }\n    if (fieldInstance.validation != null) {\n      this._validationNodesMapUpdates.next((vmap: AjfRendererUpdateMap): AjfRendererUpdateMap => {\n        if (vmap[fieldInstanceName] == null) {\n          vmap[fieldInstanceName] = [];\n        }\n        if (vmap[fieldInstanceName].indexOf(fieldInstance) == -1) {\n          vmap[fieldInstanceName].push(fieldInstance);\n        }\n        return vmap;\n      });\n    }\n\n    if (fieldInstance.visibility != null) {\n      this._addToNodesVisibilityMap(fieldInstance, fieldInstance.visibility.condition);\n    }\n\n    fieldInstance.conditionalBranches.forEach((conditionalBranch: AjfCondition) => {\n      this._addToNodesConditionalBranchMap(fieldInstance, conditionalBranch.condition);\n    });\n\n    if (fieldInstance.formula) {\n      this._addToNodesFormulaMap(fieldInstance, fieldInstance.formula.formula);\n    }\n\n    if (isNodeGroupInstance(fieldInstance)) {\n      const ngInstance = fieldInstance as AjfNodeInstance as AjfNodeGroupInstance;\n      if (ngInstance.formulaReps != null) {\n        this._addToNodesRepetitionMap(fieldInstance, ngInstance.formulaReps.formula);\n      }\n    }\n\n    if (fieldInstance.validation != null && fieldInstance.validation.conditions != null) {\n      fieldInstance.validation.conditions.forEach((condition) => {\n        this._addToNodesValidationMap(fieldInstance, condition.condition);\n      });\n    }\n\n    if (fieldInstance.warning != null) {\n      fieldInstance.warning.conditions.forEach((condition) => {\n        this._addToNodesWarningMap(fieldInstance, condition.condition);\n      });\n    }\n\n    if (fieldInstance.nextSlideCondition != null) {\n      this._addToNodesNextSlideConditionsMap(\n        fieldInstance, fieldInstance.nextSlideCondition.condition\n      );\n    }\n\n    if (isCustomFieldWithChoices(fieldInstance.node) || isFieldWithChoicesInstance(fieldInstance)) {\n      const fwcInstance = fieldInstance as AjfFieldWithChoicesInstance<any>;\n      if (fwcInstance.choicesFilter != null) {\n        this._addToNodesFilteredChoicesMap(fieldInstance, fwcInstance.choicesFilter.formula);\n      }\n      if (fwcInstance.triggerConditions != null) {\n        fwcInstance.triggerConditions.forEach((condition: AjfCondition) => {\n          this._addToNodesTriggerConditionsMap(fieldInstance, condition.condition);\n        });\n      }\n    }\n\n    return fieldInstance;\n  }\n\n  private _addSlideInstance(slideInstance: AjfSlideInstance): AjfSlideInstance {\n    const slide = slideInstance.node;\n    if (slide.visibility != null) {\n      this._addToNodesVisibilityMap(slideInstance, slide.visibility.condition);\n    }\n    slideInstance.conditionalBranches.forEach((conditionalBranch: AjfCondition) => {\n      this._addToNodesConditionalBranchMap(slideInstance, conditionalBranch.condition);\n    });\n    return slideInstance;\n  }\n\n  private _addNodeGroupInstance(nodeGroupInstance: AjfRepeatingContainerNodeInstance):\n      AjfRepeatingContainerNodeInstance {\n    const nodeGroup = nodeGroupInstance.node;\n    if (nodeGroup.visibility != null) {\n      this._addToNodesVisibilityMap(nodeGroupInstance, nodeGroup.visibility.condition);\n    }\n    nodeGroupInstance.conditionalBranches.forEach((conditionalBranch: AjfCondition) => {\n      this._addToNodesConditionalBranchMap(nodeGroupInstance, conditionalBranch.condition);\n    });\n    if (nodeGroupInstance.formulaReps != null) {\n      if (nodeGroup.formulaReps != null) {\n        this._addToNodesRepetitionMap(nodeGroupInstance, nodeGroup.formulaReps.formula);\n      }\n    } else {\n      let formGroup = this._formGroup.getValue();\n      let nodeGroupInstanceName = nodeInstanceCompleteName(nodeGroupInstance);\n      if (formGroup != null && !formGroup.contains(nodeGroupInstanceName)) {\n        const control = new FormControl();\n        control.setValue(nodeGroupInstance.reps);\n        formGroup.registerControl(nodeGroupInstanceName, control);\n      }\n    }\n    return nodeGroupInstance;\n  }\n\n  private _removeNodesVisibilityMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._visibilityNodesMapUpdates, index);\n  }\n\n  private _removeNodesRepetitionMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._repetitionNodesMapUpdates, index);\n  }\n\n  private _removeNodesConditionalBranchMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._conditionalBranchNodesMapUpdates, index);\n  }\n\n  private _removeNodesFormulaMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._formulaNodesMapUpdates, index);\n  }\n\n  private _removeNodesValidationMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._validationNodesMapUpdates, index);\n  }\n\n  private _removeNodesWarningMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._warningNodesMapUpdates, index);\n  }\n\n  private _removeNodesFilteredChoicesMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._filteredChoicesNodesMapUpdates, index);\n  }\n\n  private _removeNodesTriggerConditionsMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._triggerConditionsNodesMapUpdates, index);\n  }\n\n  private _removeNodesNextSlideConditionsMapIndex(index: string): void {\n    this._removeNodesMapIndex(this._nextSlideConditionsNodesMapUpdates, index);\n  }\n\n  private _removeNodesMapIndex(nodesMap: Subject<AjfRendererUpdateMapOperation>, index: string) {\n    nodesMap.next((vmap: AjfRendererUpdateMap): AjfRendererUpdateMap => {\n      if (Object.keys(vmap).indexOf(index) > -1) {\n        delete vmap[index];\n      }\n      return vmap;\n    });\n  }\n\n  private _removeFromNodesVisibilityMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._removeFromNodesMap(this._visibilityNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesRepetitionMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._removeFromNodesMap(this._repetitionNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesConditionalBranchMap(\n    nodeInstance: AjfNodeInstance, formula: string\n  ): void {\n    this._removeFromNodesMap(this._conditionalBranchNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesFormulaMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._removeFromNodesMap(this._formulaNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesValidationMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._removeFromNodesMap(this._validationNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesWarningMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._removeFromNodesMap(this._warningNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesFilteredChoicesMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._removeFromNodesMap(this._filteredChoicesNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesTriggerConditionsMap(\n    nodeInstance: AjfNodeInstance, formula: string\n  ): void {\n    this._removeFromNodesMap(this._filteredChoicesNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesNextSlideConditionsMap(\n    nodeInstance: AjfNodeInstance, formula: string\n  ): void {\n    this._removeFromNodesMap(this._nextSlideConditionsNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _removeFromNodesMap(\n      nodesMap: Subject<AjfRendererUpdateMapOperation>, nodeInstance: AjfNodeInstance,\n      formula: string): void {\n    let tokens = tokenize(formula)\n      .filter((token: any) => token.type == 'Identifier' && token.value != '$value');\n    if (tokens.length > 0) {\n      nodesMap.next((vmap: AjfRendererUpdateMap): AjfRendererUpdateMap => {\n        tokens.forEach((token: any) => {\n          let tokenName = token.value;\n          if (vmap[tokenName] != null) {\n            const idx = vmap[tokenName].indexOf(nodeInstance);\n            if (idx > -1) {\n              vmap[tokenName].splice(idx, 1);\n              if (vmap[tokenName].length == 0) {\n                delete vmap[tokenName];\n              }\n            }\n          }\n        });\n        return vmap;\n      });\n    }\n  }\n\n  private _addToNodesVisibilityMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._visibilityNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesRepetitionMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._repetitionNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesConditionalBranchMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._conditionalBranchNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesFormulaMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._formulaNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesValidationMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._validationNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesWarningMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._warningNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesFilteredChoicesMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._filteredChoicesNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesTriggerConditionsMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._triggerConditionsNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesNextSlideConditionsMap(nodeInstance: AjfNodeInstance, formula: string): void {\n    this._addToNodesMap(this._nextSlideConditionsNodesMapUpdates, nodeInstance, formula);\n  }\n\n  private _addToNodesMap(\n      nodesMap: Subject<AjfRendererUpdateMapOperation>, nodeInstance: AjfNodeInstance,\n      formula: string): void {\n    let tokens = tokenize(formula)\n      .filter((token: any) => token.type == 'Identifier' && token.value != '$value');\n    if (tokens.length > 0) {\n      nodesMap.next((vmap: AjfRendererUpdateMap): AjfRendererUpdateMap => {\n        tokens.forEach((token: any) => {\n          let tokenName = token.value;\n          if (vmap[tokenName] == null) {\n            vmap[tokenName] = [];\n          }\n          if (vmap[tokenName].indexOf(nodeInstance) === -1) {\n            vmap[tokenName].push(nodeInstance);\n          }\n        });\n        return vmap;\n      });\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfBaseSlideInstance} from '../../interface/slides-instances/base-slide-instance';\n\nexport function validSlide(slide: AjfBaseSlideInstance, idx: number): boolean {\n  if (idx >= slide.slideNodes.length) {\n    return true;\n  }\n  return slide.slideNodes[idx]\n      .map(n => {\n        if (n.visible && Object.keys(n).indexOf('valid') > -1) {\n          return (<any>n).valid;\n        }\n        return true;\n      })\n      .reduce((v1, v2) => v1 && v2, true);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\n\nimport {AjfFieldInstance} from '../../interface/fields-instances/field-instance';\nimport {AjfFormulaFieldInstance} from '../../interface/fields-instances/formula-field-instance';\nimport {updateConditionalBranches} from '../nodes-instances/update-conditional-branches';\nimport {updateVisibility} from '../nodes-instances/update-visibility';\nimport {updateFormula} from './update-formula';\nimport {updateNextSlideCondition} from './update-next-slide-condition';\nimport {updateValidation} from './update-validation';\nimport {updateWarning} from './update-warning';\n\nexport function updateFieldInstanceState(\n    instance: AjfFieldInstance, context: AjfContext, branchVisibility = true): void {\n  updateVisibility(instance, context, branchVisibility);\n  updateConditionalBranches(instance, context);\n  updateFormula(instance as AjfFormulaFieldInstance, context);\n  updateValidation(instance, context);\n  updateWarning(instance, context);\n  updateNextSlideCondition(instance, context);\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\n\nimport {\n  AjfFieldWithChoicesInstance\n} from '../../interface/fields-instances/field-with-choices-instance';\nimport {nodeInstanceCompleteName} from '../nodes-instances/node-instance-complete-name';\n\nexport function updateTriggerConditions(\n    instance: AjfFieldWithChoicesInstance<any>, context: AjfContext): boolean {\n  if (instance.triggerConditions == null) {\n    return false;\n  }\n  const completeName = nodeInstanceCompleteName(instance);\n  if (instance.firstTriggerConditionDone[completeName]) {\n    return false;\n  }\n  let found = false;\n  const conditionsNum = instance.triggerConditions.length;\n  for (let i = 0; i < conditionsNum; i++) {\n    if (evaluateExpression(instance.triggerConditions[i].condition, context)) {\n      found = true;\n      break;\n    }\n  }\n  instance.firstTriggerConditionDone[completeName] = found;\n  return found;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeInstance} from '../../interface/nodes-instances/node-instance';\nimport {AjfSlideInstance} from '../../interface/slides-instances/slide-instance';\nimport {flattenNodesInstances} from './flatten-nodes-instances';\nimport {isSlidesInstance} from './is-slides-instance';\n\nexport function flattenNodesInstancesTree(nodes: AjfNodeInstance[]): AjfSlideInstance[] {\n  let flatTree: AjfSlideInstance[] = [];\n  nodes.forEach((nodeInstance: AjfNodeInstance) => {\n    if (isSlidesInstance(nodeInstance)) {\n      const ni = nodeInstance as AjfSlideInstance;\n      flatTree.push(ni);\n      ni.flatNodes = flattenNodesInstances(ni.nodes);\n    }\n  });\n  return flatTree;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfPageSlider, AjfPageSliderOrientation} from '@ajf/core/page-slider';\nimport {coerceBooleanProperty} from '@ajf/core/utils';\n\nimport {\n  AfterViewChecked, AfterViewInit, ChangeDetectorRef, EventEmitter, OnDestroy, QueryList\n} from '@angular/core';\nimport {FormGroup} from '@angular/forms';\n\nimport {Observable, Subscription} from 'rxjs';\nimport {delayWhen, map, withLatestFrom} from 'rxjs/operators';\n\nimport {AjfFormField} from './field';\nimport {AjfFormInitStatus, AjfFormRendererService} from './form-renderer';\n\nimport {AjfFieldType} from './interface/fields/field-type';\nimport {AjfForm} from './interface/forms/form';\nimport {AjfNodeGroupInstance} from './interface/nodes-instances/node-group-instance';\nimport {AjfNodeInstance} from './interface/nodes-instances/node-instance';\nimport {AjfRepeatingSlideInstance} from './interface/slides-instances/repeating-slide-instance';\nimport {AjfSlideInstance} from './interface/slides-instances/slide-instance';\nimport {nodeInstanceCompleteName} from './utils/nodes-instances/node-instance-complete-name';\n\nexport class AjfFormActionEvent {\n  source: AjfFormRenderer;\n  value: Object;\n  action: string;\n}\n\nexport abstract class AjfFormRenderer implements AfterViewChecked, AfterViewInit, OnDestroy {\n  // formGroup is an Observable FormGroup type\n  readonly formGroup: Observable<FormGroup | null>;\n\n  //  slides is an observable AjfSlide array type\n  readonly slides: Observable<AjfSlideInstance[]>;\n  readonly slidesNum: Observable<number>;\n  readonly errors: Observable<number>;\n  readonly formIsInit: Observable<boolean>;\n\n  // ajfFieldTypes [ Text, Number, Boolean, SingleChoice, MultipleChoice,\n  // Formula, Empty, Composed, LENGTH ]\n  readonly ajfFieldTypes = AjfFieldType;\n\n  title: string;\n\n  private _orientationChange: EventEmitter<AjfPageSliderOrientation>\n    = new EventEmitter<AjfPageSliderOrientation>();\n  readonly orientationChange: Observable<AjfPageSliderOrientation> =\n    this._orientationChange.asObservable();\n\n  private _saveDisabled: boolean = false;\n  get saveDisabled(): boolean { return this._saveDisabled; }\n  set saveDisabled(saveDisabled: boolean) {\n    this._saveDisabled = coerceBooleanProperty(saveDisabled);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _hasStartMessage = false;\n  get hasStartMessage(): boolean { return this._hasStartMessage; }\n  set hasStartMessage(hasStartMessage: boolean) {\n    this._hasStartMessage = coerceBooleanProperty(hasStartMessage);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _hasEndMessage = false;\n  get hasEndMessage(): boolean { return this._hasEndMessage; }\n  set hasEndMessage(hasEndMessage: boolean) {\n    this._hasEndMessage = coerceBooleanProperty(hasEndMessage);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _hideTopToolbar = false;\n  get hideTopToolbar(): boolean { return this._hideTopToolbar; }\n  set hideTopToolbar(hideTopToolbar: boolean) {\n    this._hideTopToolbar = coerceBooleanProperty(hideTopToolbar);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _hideBottomToolbar = false;\n  get hideBottompToolbar(): boolean { return this._hideBottomToolbar; }\n  set hideBottomToolbar(hideBottomToolbar: boolean) {\n    this._hideBottomToolbar = coerceBooleanProperty(hideBottomToolbar);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _hideNavigationButtons = false;\n  get hideNavigationButtons(): boolean { return this._hideNavigationButtons; }\n  set hideNavigationButtons(hideNavigationButtons: boolean) {\n    this._hideNavigationButtons = coerceBooleanProperty(hideNavigationButtons);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _fixedOrientation = false;\n  get fixedOrientation(): boolean { return this._fixedOrientation; }\n  set fixedOrientation(fixedOrientation: boolean) {\n    this._fixedOrientation = coerceBooleanProperty(fixedOrientation);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _readonly = false;\n  get readonly(): boolean { return this._readonly; }\n  set readonly(readonly: boolean) {\n    this._readonly = coerceBooleanProperty(readonly);\n    this._changeDetectorRef.markForCheck();\n  }\n\n  private _orientation: AjfPageSliderOrientation = 'horizontal';\n  get orientation(): AjfPageSliderOrientation { return this._orientation; }\n  set orientation(orientation: AjfPageSliderOrientation) {\n    if (orientation !== 'horizontal' && orientation !== 'vertical') { return; }\n    if (orientation !== this._orientation) {\n      this._orientation = orientation;\n      this._changeDetectorRef.markForCheck();\n      this._orientationChange.emit(this._orientation);\n    }\n  }\n\n  formSlider: AjfPageSlider;\n  fields: QueryList<AjfFormField>;\n\n  private _errorMoveEvent: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  // _errorPositions is a private subject structure that contains next and prev\n  private _errorPositions: Observable<number[]>;\n\n  // _form is a private ajFForm\n  private _form: AjfForm;\n  // _init is a private boolean\n  private _init = false;\n\n  private _nextSlideSubscription: Subscription = Subscription.EMPTY;\n  private _errorMoveSubscription: Subscription = Subscription.EMPTY;\n\n  private _formAction: EventEmitter<AjfFormActionEvent> = new EventEmitter<AjfFormActionEvent>();\n  readonly formAction: Observable<AjfFormActionEvent> = this._formAction.asObservable();\n\n  set form(form: AjfForm) {\n    this._form = form;\n\n    if (this._init) {\n      this._rendererService.setForm(this._form);\n    }\n  }\n\n  /**\n   * this constructor will init current formula by ajfBuilderService\n   */\n  constructor(\n    private _rendererService: AjfFormRendererService,\n    protected _changeDetectorRef: ChangeDetectorRef\n  ) {\n    this.formGroup = _rendererService.formGroup;\n    this.slides = _rendererService.nodesTree;\n    this._errorPositions = _rendererService.errorPositions;\n    this.errors = _rendererService.errors;\n    this.slidesNum = _rendererService.slidesNum;\n    this.formIsInit = _rendererService.formInitEvent.pipe(\n      map(e => e === AjfFormInitStatus.Complete)\n    );\n  }\n\n  /**\n   * this method will scroll to next error received by subscribe\n   */\n  goToNextError(): void { this._errorMoveEvent.emit(true); }\n  /**\n   * this method will scroll to prev error received by subscribe\n   */\n  goToPrevError(): void { this._errorMoveEvent.emit(false); }\n\n  /**\n   * this method will add group\n   */\n  addGroup(nodeGroup: AjfNodeGroupInstance | AjfRepeatingSlideInstance): void {\n    let s = this._rendererService.addGroup(nodeGroup).pipe(\n      delayWhen(() => this.formSlider.pageScrollFinish),\n    ).subscribe(\n        (r) => { if (r && this.formSlider != null) { this.formSlider.slide({dir: 'down'}); } },\n        (_e) => { if (s) { s.unsubscribe(); } },\n        () => { if (s) { s.unsubscribe(); } }\n      );\n  }\n\n  /**\n   * this method will remove group\n   */\n  removeGroup(nodeGroup: AjfNodeGroupInstance | AjfRepeatingSlideInstance): void {\n    let s = this._rendererService.removeGroup(nodeGroup).pipe(\n      delayWhen(() => this.formSlider.pageScrollFinish),\n    ).subscribe(\n        (r) => { if (r && this.formSlider != null) { this.formSlider.slide({dir: 'up'}); } },\n        (_e) => { if (s) { s.unsubscribe(); } },\n        () => { if (s) { s.unsubscribe(); } }\n      );\n  }\n\n  onSave(_evt: any): void {\n    this._formAction.emit({\n      source: this,\n      action: 'save',\n      value: this._rendererService.getFormValue()\n    });\n  }\n\n  onFormAction(_evt: any, action: string) {\n    this._formAction.emit({\n      source: this,\n      value: this._rendererService.getFormValue(),\n      action: action\n    });\n  }\n\n  /**\n   * this method will set current form in rederer service when init form\n   */\n  ngAfterViewInit(): void {\n    if (this._form != null) {\n      this._rendererService.setForm(this._form);\n      this._changeDetectorRef.detectChanges();\n    }\n  }\n\n  ngAfterViewChecked(): void {\n    if (!this._init && this.formSlider != null) {\n      this._init = true;\n\n      this._errorMoveSubscription = (<Observable<boolean>>this._errorMoveEvent).pipe(\n        withLatestFrom(this._errorPositions)\n      ).subscribe((v: [boolean, number[]]) => {\n          const move = v[0];\n          const currentPosition = this.formSlider.currentPage - (+this.hasStartMessage) + 1;\n          const errors = v[1];\n          if (errors == null) { return; }\n\n          let found = false;\n          let prevIdx = -1;\n          let nextIdx = -1;\n          let idx = 0;\n          let errorsLen = errors.length;\n          while (!found && idx < errorsLen) {\n            if (errors[idx] == currentPosition) {\n              found = true;\n              prevIdx = idx > 0 ? idx - 1 : errorsLen - 1;\n              nextIdx = idx < errorsLen - 1 ? idx + 1 : 0;\n            } else if (errors[idx] > currentPosition) {\n              found = true;\n              prevIdx = idx > 0 ? idx - 1 : errorsLen - 1;\n              nextIdx = idx;\n            }\n            idx++;\n          }\n          if (!found) {\n            prevIdx = errorsLen - 1;\n            nextIdx = 0;\n          }\n\n          this.formSlider.slide({to: move ? errors[nextIdx] - 1 : errors[prevIdx] - 1});\n          this._changeDetectorRef.detectChanges();\n        });\n\n    }\n  }\n\n  ngOnDestroy(): void {\n    this._nextSlideSubscription.unsubscribe();\n    this._errorMoveSubscription.unsubscribe();\n    this._orientationChange.complete();\n    this._errorMoveEvent.complete();\n    this._formAction.complete();\n  }\n\n  orientationChangeHandler(orientation: AjfPageSliderOrientation): void {\n    this.orientation = orientation;\n  }\n\n  trackNodeById(_: number, node: AjfNodeInstance): string {\n    return nodeInstanceCompleteName(node);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\n\n\n@Pipe({name: 'ajfBoolToInt'})\nexport class AjfBoolToIntPipe implements PipeTransform {\n  transform(value: boolean): number {\n    return value ? 1 : 0;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\n\nimport {\n  AjfFieldWithChoicesInstance\n} from './interface/fields-instances/field-with-choices-instance';\n\n@Pipe({name: 'ajfExpandFieldWithChoices'})\nexport class AjfExpandFieldWithChoicesPipe implements PipeTransform {\n  transform(instance: AjfFieldWithChoicesInstance<any>, threshold: number) {\n    return !instance.node.forceNarrow && (\n      instance.node.forceExpanded\n      || (instance.filteredChoices && instance.filteredChoices.length <= threshold)\n    );\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\n\n@Pipe({name: 'ajfIncrement'})\nexport class AjfIncrementPipe implements PipeTransform {\n  transform(value: number, increment: number = 1): number {\n    return value + increment;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\nimport {AjfNodeInstance} from './interface/nodes-instances/node-instance';\nimport {isRepeatingSlideInstance} from './utils/nodes-instances/is-repeating-slide-instance';\n\n@Pipe({name: 'ajfIsRepeatingSlideInstance'})\nexport class AjfIsRepeatingSlideInstancePipe implements PipeTransform {\n  transform(instance: AjfNodeInstance): boolean {\n    return isRepeatingSlideInstance(instance);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\nimport {AjfNodeInstance} from './interface/nodes-instances/node-instance';\nimport {nodeInstanceCompleteName} from './utils/nodes-instances/node-instance-complete-name';\n\n@Pipe({name: 'ajfNodeCompleteName'})\nexport class AjfNodeCompleteNamePipe implements PipeTransform {\n  transform(instance: AjfNodeInstance): string {\n    return instance ? nodeInstanceCompleteName(instance) : '';\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\n\n@Pipe({name: 'ajfRange'})\nexport class AjfRangePipe implements PipeTransform {\n  transform(size: number = 0, start: number = 1, step: number = 1): number[] {\n    const range: number[] = [];\n    for (let length = 0; length < size; ++length) {\n      range.push(start);\n      start += step;\n    }\n    return range;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\n\n\n@Pipe({name: 'ajfTableRowClass'})\nexport class AjfTableRowClass implements PipeTransform {\n  transform(value: number): string {\n    return value % 2 == 0 ? 'ajf-row-even' : 'ajf-row-odd';\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\nimport {FormControl} from '@angular/forms';\nimport {AjfTableFieldInstance} from './interface/fields-instances/table-field-instance';\n\n@Pipe({name: 'ajfTableVisibleColumns'})\nexport class AjfTableVisibleColumnsPipe implements PipeTransform {\n  transform(instance: AjfTableFieldInstance): (string|number|FormControl)[][] {\n    if (!instance.node.editable) {\n      return instance.hideEmptyRows\n        ? (instance.value || []).filter(col => col[1].reduce((prev: boolean, cur) => {\n          return prev || (cur != null && cur !== '' && cur !== 0 && cur !== '0');\n        }, false)).map(v => [v[0], ...v[1]])\n        : instance.value.map(v => [v[0], ...v[1]]);\n    }\n    return (instance.controls || []).map(v => [v[0], ...v[1]]);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe, PipeTransform} from '@angular/core';\nimport {AjfBaseSlideInstance} from './interface/slides-instances/base-slide-instance';\n\n@Pipe({name: 'ajfValidSlide', pure: false})\nexport class AjfValidSlidePipe implements PipeTransform {\n  transform (slide: AjfBaseSlideInstance, idx: number): boolean {\n    if (idx == null || typeof idx !== 'number') {\n      return false;\n    }\n    if (idx >= slide.slideNodes.length) {\n      return true;\n    }\n    return slide.slideNodes[idx]\n      .map(n => {\n        if (n.visible && Object.keys(n).indexOf('valid') > -1) {\n          return (<any>n).valid;\n        }\n        return true;\n      }).reduce((v1, v2) => v1 && v2, true);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {AjfBoolToIntPipe} from './bool-to-int';\nimport {AjfDateValuePipe} from './date-value';\nimport {AjfDateValueStringPipe} from './date-value-string';\nimport {AjfExpandFieldWithChoicesPipe} from './expand-input-with-choices';\nimport {AjfFieldHost} from './field-host';\nimport {AjfFieldIconPipe} from './field-icon';\nimport {AjfFieldIsValidPipe} from './field-is-valid';\nimport {AjfFormRendererService} from './form-renderer';\nimport {AjfIncrementPipe} from './increment';\nimport {AjfIsRepeatingSlideInstancePipe} from './is-repeating-slide';\nimport {AjfNodeCompleteNamePipe} from './node-complete-name';\nimport {AjfRangePipe} from './range';\nimport {AjfTableRowClass} from './table-row-class';\nimport {AjfTableVisibleColumnsPipe} from './table-visible-columns';\nimport {AjfValidationService} from './validation-service';\nimport {AjfValidSlidePipe} from './valid-slide';\n\n@NgModule({\n  declarations: [\n    AjfBoolToIntPipe,\n    AjfDateValuePipe,\n    AjfDateValueStringPipe,\n    AjfExpandFieldWithChoicesPipe,\n    AjfFieldHost,\n    AjfFieldIconPipe,\n    AjfFieldIsValidPipe,\n    AjfIncrementPipe,\n    AjfIsRepeatingSlideInstancePipe,\n    AjfNodeCompleteNamePipe,\n    AjfRangePipe,\n    AjfTableRowClass,\n    AjfTableVisibleColumnsPipe,\n    AjfValidSlidePipe,\n  ],\n  exports: [\n    AjfBoolToIntPipe,\n    AjfDateValuePipe,\n    AjfDateValueStringPipe,\n    AjfExpandFieldWithChoicesPipe,\n    AjfFieldHost,\n    AjfFieldIconPipe,\n    AjfFieldIsValidPipe,\n    AjfIncrementPipe,\n    AjfIsRepeatingSlideInstancePipe,\n    AjfNodeCompleteNamePipe,\n    AjfRangePipe,\n    AjfTableRowClass,\n    AjfTableVisibleColumnsPipe,\n    AjfValidSlidePipe,\n  ],\n  providers: [AjfDateValueStringPipe, AjfFormRendererService, AjfValidationService]\n})\nexport class AjfFormsModule {\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfBaseFieldComponent} from './base-field';\n\nexport abstract class AjfInputFieldComponent extends AjfBaseFieldComponent {\n  type: 'text' | 'number' = 'text';\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nexport const AJF_SEARCH_ALERT_THRESHOLD = new InjectionToken<number>('AJF_SEARCH_ALERT_THRESHOLD');\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfAttachmentsOrigin} from '../interface/attachments/attachments-origin';\nimport {\n  AjfAttachmentsOriginCreate, createAttachmentsOrigin\n} from '../utils/attachments/create-attachments-origin';\n\nexport class AjfAttachmentsOriginSerializer {\n  static fromJson(origin: Partial<AjfAttachmentsOrigin<any>>): AjfAttachmentsOrigin<any> {\n    if (origin.name == null) {\n      throw new Error('Malformed attachments origin');\n    }\n    return createAttachmentsOrigin(origin as AjfAttachmentsOriginCreate<any>);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfAttachmentsOrigin} from '../../interface/attachments/attachments-origin';\n\nexport type AjfAttachmentsOriginCreate<T> =\n    Pick<AjfAttachmentsOrigin<T>, 'name'>&Partial<AjfAttachmentsOrigin<T>>;\n\nexport function createAttachmentsOrigin<T>(origin: AjfAttachmentsOriginCreate<T>):\n    AjfAttachmentsOrigin<T> {\n  return {\n    ...origin,\n    attachments: origin.attachments || [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfChoicesOrigin} from '../../interface/choices/choices-origin';\n\nexport type AjfChoicesOriginCreate<T> =\n    Pick<AjfChoicesOrigin<any>, 'type'|'name'>&Partial<AjfChoicesOrigin<T>>;\n\nexport function createChoicesOrigin<T>(origin: AjfChoicesOriginCreate<T>): AjfChoicesOrigin<T> {\n  return {\n    ...origin,\n    type: origin.type,\n    label: origin.label || '',\n    choices: origin.choices || [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfChoicesOrigin} from '../interface/choices/choices-origin';\nimport {AjfChoicesOriginCreate, createChoicesOrigin} from '../utils/choices/create-choices-origin';\n\nexport class AjfChoicesOriginSerializer {\n  static fromJson(origin: Partial<AjfChoicesOrigin<any>>): AjfChoicesOrigin<any> {\n    return createChoicesOrigin<any>({\n      ...origin,\n      type: origin.type || 'fixed',\n      name: origin.name || '',\n    } as AjfChoicesOriginCreate<any>);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContainerNode} from '../../interface/nodes/container-node';\nimport {AjfNodeCreate, createNode} from './create-node';\n\nexport type AjfContainerNodeCreate = AjfNodeCreate&Partial<AjfContainerNode>;\n\nexport function createContainerNode(containerNode: AjfContainerNodeCreate): AjfContainerNode {\n  const node = createNode(containerNode);\n  return {\n    ...node,\n    nodes: containerNode.nodes || [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfRepeatingNode} from '../../interface/nodes/repeating-node';\nimport {AjfNodeCreate, createNode} from './create-node';\n\nexport type AjfRepeatingNodeCreate = AjfNodeCreate&Partial<AjfRepeatingNode>;\n\nexport function createRepeatingNode(repeatingNode: AjfRepeatingNodeCreate): AjfRepeatingNode {\n  const node = createNode(repeatingNode);\n  return {\n    ...repeatingNode,\n    ...node,\n    minReps: repeatingNode.minReps != null ? repeatingNode.minReps : 1,\n    maxReps: repeatingNode.maxReps != null ? repeatingNode.maxReps : 0,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeGroup} from '../../interface/nodes/node-group';\nimport {AjfNodeType} from '../../interface/nodes/node-type';\nimport {AjfContainerNodeCreate, createContainerNode} from './create-container-node';\nimport {AjfRepeatingNodeCreate, createRepeatingNode} from './create-repeating-node';\n\nexport type AjfNodeGroupCreate = AjfContainerNodeCreate&AjfRepeatingNodeCreate;\n\nexport function createNodeGroup(nodeGroup: AjfNodeGroupCreate): AjfNodeGroup {\n  return {\n    ...createContainerNode(nodeGroup),\n    ...createRepeatingNode(nodeGroup),\n    nodeType: AjfNodeType.AjfNodeGroup,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeType} from '../../interface/nodes/node-type';\nimport {AjfRepeatingSlide} from '../../interface/slides/repeating-slide';\nimport {AjfContainerNodeCreate, createContainerNode} from '../nodes/create-container-node';\nimport {AjfRepeatingNodeCreate, createRepeatingNode} from '../nodes/create-repeating-node';\n\nexport type AjfRepeatingSlideCreate = AjfContainerNodeCreate&AjfRepeatingNodeCreate;\n\nexport function createRepeatingSlide(nodeGroup: AjfRepeatingSlideCreate): AjfRepeatingSlide {\n  return {\n    ...createContainerNode(nodeGroup),\n    ...createRepeatingNode(nodeGroup),\n    nodeType: AjfNodeType.AjfRepeatingSlide,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfNodeType} from '../../interface/nodes/node-type';\nimport {AjfSlide} from '../../interface/slides/slide';\nimport {AjfContainerNodeCreate, createContainerNode} from '../nodes/create-container-node';\n\nexport type AjfSlideCreate = AjfContainerNodeCreate;\n\nexport function createSlide(nodeGroup: AjfSlideCreate): AjfSlide {\n  return {\n    ...createContainerNode(nodeGroup),\n    nodeType: AjfNodeType.AjfSlide,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidationGroup} from '../interface/validation/validation-group';\nimport {createValidationGroup} from '../utils/validation/create-validation-group';\n\nexport class AjfValidationGroupSerializer {\n  static fromJson(group: Partial<AjfValidationGroup>): AjfValidationGroup {\n    return createValidationGroup(group);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfWarningGroup} from '../interface/warning/warning-group';\nimport {createWarningGroup} from '../utils/warning/create-warning-group';\n\nexport class AjfWarningGroupSerializer {\n  static fromJson(group: Partial<AjfWarningGroup>): AjfWarningGroup {\n    return createWarningGroup(group);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfConditionSerializer, AjfFormulaSerializer} from '@ajf/core/models';\n\nimport {AjfAttachmentsOrigin} from '../interface/attachments/attachments-origin';\nimport {AjfChoicesOrigin} from '../interface/choices/choices-origin';\nimport {AjfField} from '../interface/fields/field';\nimport {AjfFieldType} from '../interface/fields/field-type';\nimport {AjfFieldWithChoices} from '../interface/fields/field-with-choices';\nimport {AjfFormulaField} from '../interface/fields/formula-field';\nimport {AjfContainerNode} from '../interface/nodes/container-node';\nimport {AjfNode} from '../interface/nodes/node';\nimport {AjfNodeGroup} from '../interface/nodes/node-group';\nimport {AjfFieldNodeLink} from '../interface/nodes/node-link';\nimport {AjfNodeType} from '../interface/nodes/node-type';\nimport {AjfRepeatingNode} from '../interface/nodes/repeating-node';\nimport {AjfRepeatingSlide} from '../interface/slides/repeating-slide';\nimport {AjfSlide} from '../interface/slides/slide';\nimport {componentsMap} from '../utils/fields/fields-map';\nimport {AjfFieldCreate, createField} from '../utils/fields/create-field';\nimport {createFieldWithChoices} from '../utils/fields/create-field-with-choices';\nimport {createContainerNode} from '../utils/nodes/create-container-node';\nimport {AjfNodeCreate, createNode} from '../utils/nodes/create-node';\nimport {createNodeGroup} from '../utils/nodes/create-node-group';\nimport {createRepeatingNode} from '../utils/nodes/create-repeating-node';\nimport {createRepeatingSlide} from '../utils/slides/create-repeating-slide';\nimport {createSlide} from '../utils/slides/create-slide';\n\nimport {AjfValidationGroupSerializer} from './validation-group-serializer';\nimport {AjfWarningGroupSerializer} from './warning-group-serializer';\n\nexport class AjfNodeSerializer {\n  static fromJson(\n      json: Partial<AjfNode>,\n      choicesOrigins?: AjfChoicesOrigin<any>[],\n      attachmentsOrigins?: AjfAttachmentsOrigin<any>[],\n      ): AjfNode {\n    const err = 'Malformed node';\n    json.name = json.name || '';\n    if (json.id == null || json.parent == null || json.nodeType == null) {\n      throw new Error(err);\n    }\n    const obj = json as AjfNodeCreate;\n    if (obj.visibility) {\n      obj.visibility = AjfConditionSerializer.fromJson(obj.visibility);\n    }\n    obj.conditionalBranches =\n        (obj.conditionalBranches || []).map(c => AjfConditionSerializer.fromJson(c));\n    switch (obj.nodeType) {\n      case AjfNodeType.AjfField:\n        return AjfNodeSerializer._fieldFromJson(\n            obj as AjfNodeCreate & Partial<AjfField>,\n            choicesOrigins,\n            attachmentsOrigins,\n        );\n      case AjfNodeType.AjfFieldNodeLink:\n        return AjfNodeSerializer._fieldNodeLinkFromJson(\n            obj as AjfNodeCreate & Partial<AjfFieldNodeLink>);\n      case AjfNodeType.AjfNodeGroup:\n        return AjfNodeSerializer._nodeGroupFromJson(\n            obj as AjfNodeCreate & Partial<AjfNodeGroup>,\n            choicesOrigins,\n            attachmentsOrigins,\n        );\n      case AjfNodeType.AjfRepeatingSlide:\n        return AjfNodeSerializer._repeatingSlideFromJson(\n            obj as AjfNodeCreate & Partial<AjfRepeatingSlide>,\n            choicesOrigins,\n            attachmentsOrigins,\n        );\n      case AjfNodeType.AjfSlide:\n        return AjfNodeSerializer._slideFromJson(\n            obj as AjfNodeCreate & Partial<AjfSlide>,\n            choicesOrigins,\n            attachmentsOrigins,\n        );\n    }\n    throw new Error(err);\n  }\n\n  private static _containerNodeFromJson(\n      json: AjfNodeCreate&Partial<AjfContainerNode>,\n      choicesOrigins?: AjfChoicesOrigin<any>[],\n      attachmentsOrigins?: AjfAttachmentsOrigin<any>[],\n      ): AjfContainerNode {\n    json.nodes = (json.nodes ||\n                  []).map(n => AjfNodeSerializer.fromJson(n, choicesOrigins, attachmentsOrigins));\n    return createContainerNode(json);\n  }\n\n  private static _fieldFromJson(\n      json: AjfNodeCreate&Partial<AjfField>&Partial<{attachmentsOriginRef: string}>,\n      choicesOrigins?: AjfChoicesOrigin<any>[],\n      attachmentsOrigins?: AjfAttachmentsOrigin<any>[],\n      ): AjfField {\n    if (json.fieldType == null) {\n      throw new Error('Malformed field');\n    }\n    const obj = json as AjfFieldCreate;\n    if (obj.validation) {\n      obj.validation = AjfValidationGroupSerializer.fromJson(obj.validation);\n    }\n    if (obj.warning) {\n      obj.warning = AjfWarningGroupSerializer.fromJson(obj.warning);\n    }\n    if (json.attachmentsOriginRef) {\n      obj.attachmentOrigin =\n          (attachmentsOrigins || []).find(a => a.name === json.attachmentsOriginRef);\n    }\n    if (obj.nextSlideCondition) {\n      obj.nextSlideCondition = AjfConditionSerializer.fromJson(obj.nextSlideCondition);\n    }\n    const isCustomFieldWithChoice = obj.fieldType > 100\n      && componentsMap[obj.fieldType] != null\n      && componentsMap[obj.fieldType].isFieldWithChoice === true;\n    if (isCustomFieldWithChoice) {\n      return AjfNodeSerializer._fieldWithChoicesFromJson(\n        json as AjfFieldCreate & Partial<AjfFieldWithChoices<any>>,\n        choicesOrigins,\n    );\n    }\n\n    switch (obj.fieldType) {\n      case AjfFieldType.Formula:\n        return AjfNodeSerializer._formulaFieldFromJson(\n            json as AjfFieldCreate & Partial<AjfFormulaField>);\n      case AjfFieldType.MultipleChoice:\n      case AjfFieldType.SingleChoice:\n        return AjfNodeSerializer._fieldWithChoicesFromJson(\n            json as AjfFieldCreate & Partial<AjfFieldWithChoices<any>>,\n            choicesOrigins,\n        );\n    }\n    return createField(obj);\n  }\n\n  private static _fieldNodeLinkFromJson(json: AjfNodeCreate&\n                                       Partial<AjfFieldNodeLink>): AjfFieldNodeLink {\n    return {...createNode(json), nodeType: AjfNodeType.AjfFieldNodeLink};\n  }\n\n  private static _fieldWithChoicesFromJson(\n      json: AjfFieldCreate&Partial<AjfFieldWithChoices<any>>&Partial<{choicesOriginRef: string}>,\n      choicesOrigins?: AjfChoicesOrigin<any>[],\n      ): AjfFieldWithChoices<any> {\n    const err = 'Malformed field with choices';\n    if (json.choicesOriginRef == null) {\n      throw new Error(err);\n    }\n    const choicesOrigin = (choicesOrigins || []).find(c => c.name === json.choicesOriginRef);\n    if (choicesOrigin == null) {\n      throw new Error(err);\n    }\n    if (json.choicesFilter) {\n      json.choicesFilter = AjfFormulaSerializer.fromJson(json.choicesFilter);\n    }\n    if (json.triggerConditions) {\n      json.triggerConditions = json.triggerConditions.map(t => AjfConditionSerializer.fromJson(t));\n    }\n    return createFieldWithChoices<any>({...json, choicesOrigin});\n  }\n\n  private static _formulaFieldFromJson(json: AjfFieldCreate&\n                                      Partial<AjfFormulaField>): AjfFormulaField {\n    if (json.formula) {\n      json.formula = AjfFormulaSerializer.fromJson(json.formula);\n    }\n    return {\n      ...createField(json),\n      fieldType: AjfFieldType.Formula,\n    };\n  }\n\n  private static _nodeGroupFromJson(\n      json: AjfNodeCreate&Partial<AjfNodeGroup>,\n      choicesOrigins?: AjfChoicesOrigin<any>[],\n      attachmentsOrigins?: AjfAttachmentsOrigin<any>[],\n      ): AjfNodeGroup {\n    return createNodeGroup({\n      ...AjfNodeSerializer._containerNodeFromJson(json, choicesOrigins, attachmentsOrigins),\n      ...AjfNodeSerializer._repeatingNodeFromJson(json),\n    });\n  }\n\n  private static _repeatingNodeFromJson(json: AjfNodeCreate&\n                                       Partial<AjfRepeatingNode>): AjfRepeatingNode {\n    if (json.formulaReps) {\n      json.formulaReps = AjfFormulaSerializer.fromJson(json.formulaReps);\n    }\n    return createRepeatingNode(json);\n  }\n\n  private static _repeatingSlideFromJson(\n      json: AjfNodeCreate&Partial<AjfRepeatingSlide>,\n      choicesOrigins?: AjfChoicesOrigin<any>[],\n      attachmentsOrigins?: AjfAttachmentsOrigin<any>[],\n      ): AjfRepeatingSlide {\n    return createRepeatingSlide({\n      ...AjfNodeSerializer._containerNodeFromJson(json, choicesOrigins, attachmentsOrigins),\n      ...AjfNodeSerializer._repeatingNodeFromJson(json),\n    });\n  }\n\n  private static _slideFromJson(\n      json: AjfNodeCreate&Partial<AjfSlide>,\n      choicesOrigins?: AjfChoicesOrigin<any>[],\n      attachmentsOrigins?: AjfAttachmentsOrigin<any>[],\n      ): AjfSlide {\n    return createSlide(\n        AjfNodeSerializer._containerNodeFromJson(json, choicesOrigins, attachmentsOrigins));\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfFieldWithChoices} from '../../interface/fields/field-with-choices';\nimport {AjfFieldCreate, createField} from './create-field';\n\nexport type AjfFieldWithChoicesCreate<T> = AjfFieldCreate&\n    Pick<AjfFieldWithChoices<T>, 'fieldType'|'choicesOrigin'>&Partial<AjfFieldWithChoices<T>>;\n\nexport function createFieldWithChoices<T>(field: AjfFieldWithChoicesCreate<T>):\n    AjfFieldWithChoices<T> {\n  const node = createField({...field});\n  return {\n    ...node,\n    ...field,\n    choices: field.choices || [],\n    forceExpanded: field.forceExpanded || false,\n    forceNarrow: field.forceNarrow || false,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\nimport {deepCopy} from '@ajf/core/utils';\nimport {AjfForm} from '../interface/forms/form';\nimport {AjfRepeatingSlide} from '../interface/slides/repeating-slide';\nimport {AjfSlide} from '../interface/slides/slide';\nimport {AjfAttachmentsOriginSerializer} from './attachments-origin-serializer';\nimport {AjfChoicesOriginSerializer} from './choices-origin-serializer';\nimport {AjfNodeSerializer} from './node-serializer';\n\nexport class AjfFormSerializer {\n  static fromJson(form: Partial<AjfForm>, context?: AjfContext): AjfForm {\n    const choicesOrigins =\n        (form.choicesOrigins || []).map(c => AjfChoicesOriginSerializer.fromJson(c));\n    const attachmentsOrigins =\n        (form.attachmentsOrigins || []).map(a => AjfAttachmentsOriginSerializer.fromJson(a));\n    const nodes =\n        (form.nodes || [])\n            .map(n => AjfNodeSerializer.fromJson(n, choicesOrigins, attachmentsOrigins)) as (\n            AjfRepeatingSlide | AjfSlide)[];\n    return {\n      ...form,\n      choicesOrigins,\n      attachmentsOrigins,\n      nodes,\n      stringIdentifier: form.stringIdentifier || [],\n      initContext: deepCopy(context || {}),\n    };\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfAttachmentsType {\n  Link,\n  Pdf,\n  LENGTH\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfChoicesType {\n  String,\n  Number,\n  LENGTH\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport function isChoicesOrigin(co: any): boolean {\n  return co != null\n    && typeof co === 'object'\n    && co.name != null\n    && typeof co.name === 'string'\n    && co.label != null\n    && typeof co.label === 'string'\n    && ['fixed', 'promise', 'observable', 'observableArray', 'function'].indexOf(co.type) > -1\n    && co.choices instanceof Array;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfChoicesFixedOrigin} from '../../interface/choices/choices-fixed-origin';\nimport {AjfChoicesOriginCreate, createChoicesOrigin} from './create-choices-origin';\n\nexport type AjfChoicesFixedOriginCreate<T> =\n    Omit<AjfChoicesOriginCreate<T>, 'type'>&Partial<AjfChoicesFixedOrigin<T>>;\n\nexport function createChoicesFixedOrigin<T = string | number>(\n    origin: AjfChoicesFixedOriginCreate<T>): AjfChoicesFixedOrigin<T> {\n  const type = 'fixed';\n  return {...createChoicesOrigin({...origin, type}), type};\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfChoicesFunctionOrigin} from '../../interface/choices/choices-function-origin';\nimport {AjfChoicesOriginCreate} from './create-choices-origin';\n\nexport type AjfChoicesFunctionOriginCreate<T> =\n  Omit<AjfChoicesOriginCreate<T>, 'type'>&Pick<AjfChoicesFunctionOrigin<T>, 'generator'>\n  &Partial<AjfChoicesFunctionOrigin<T>>;\n\nexport function createChoicesFunctionOrigin<T>(\n  origin: AjfChoicesFunctionOriginCreate<T>\n): AjfChoicesFunctionOrigin<T> {\n  return {\n    ...origin,\n    type: 'function',\n    label: origin.label || '',\n    choices: origin.choices || [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AjfChoicesObservableArrayOrigin\n} from '../../interface/choices/choices-observable-array-origin';\nimport {AjfChoicesOriginCreate} from './create-choices-origin';\n\nexport type AjfChoicesObservableArrayOriginCreate<T> =\n  Omit<AjfChoicesOriginCreate<T>, 'type'>&Pick<AjfChoicesObservableArrayOrigin<T>, 'generator'>\n  &Partial<AjfChoicesObservableArrayOrigin<T>>;\n\nexport function createChoicesObservableArrayOrigin<T>(\n  origin: AjfChoicesObservableArrayOriginCreate<T>\n): AjfChoicesObservableArrayOrigin<T> {\n  return {\n    ...origin,\n    type: 'observableArray',\n    label: origin.label || '',\n    choices: origin.choices || [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfChoicesObservableOrigin} from '../../interface/choices/choices-observable-origin';\nimport {AjfChoicesOriginCreate} from './create-choices-origin';\n\nexport type AjfChoicesObservableOriginCreate<T> =\n  Omit<AjfChoicesOriginCreate<T>, 'type'>&Pick<AjfChoicesObservableOrigin<T>, 'generator'>\n  &Partial<AjfChoicesObservableOrigin<T>>;\n\nexport function createChoicesObservableOrigin<T>(\n  origin: AjfChoicesObservableOriginCreate<T>\n): AjfChoicesObservableOrigin<T> {\n  return {\n    ...origin,\n    type: 'observable',\n    label: origin.label || '',\n    choices: origin.choices || [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AjfChoicesPromiseOrigin\n} from '../../interface/choices/choices-promise-origin';\nimport {AjfChoicesOriginCreate} from './create-choices-origin';\n\nexport type AjfChoicesPromiseOriginCreate<T> =\n  Omit<AjfChoicesOriginCreate<T>, 'type'>&Pick<AjfChoicesPromiseOrigin<T>, 'generator'>\n  &Partial<AjfChoicesPromiseOrigin<T>>;\n\nexport function createChoicesPromiseOrigin<T>(\n  origin: AjfChoicesPromiseOriginCreate<T>\n): AjfChoicesPromiseOrigin<T> {\n  return {\n    ...origin,\n    type: 'promise',\n    label: origin.label || '',\n    choices: origin.choices || [],\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfForm} from '../../interface/forms/form';\nimport {AjfFormStringIdentifier} from '../../interface/forms/form-string-identifier';\n\nexport type AjfFormCreate = Partial<AjfForm>;\n\nexport function createForm(form: AjfFormCreate = {}): AjfForm {\n  return {\n    nodes: form.nodes || [],\n    choicesOrigins: form.choicesOrigins || [],\n    attachmentsOrigins: form.attachmentsOrigins || [],\n    initContext: form.initContext || {},\n    stringIdentifier: form.stringIdentifier || [] as AjfFormStringIdentifier[],\n    supplementaryInformations: form.supplementaryInformations,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport function getTypeName(v: any): string {\n  let typeStr = typeof v;\n  return typeStr === 'object'\n    ? v.constructor.toString().match(/\\w+/g)[1]\n    : typeStr;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfChoicesFunctionOrigin} from '../../interface/choices/choices-function-origin';\nimport {\n  AjfChoicesObservableArrayOrigin\n} from '../../interface/choices/choices-observable-array-origin';\nimport {AjfChoicesObservableOrigin} from '../../interface/choices/choices-observable-origin';\nimport {AjfChoicesOrigin} from '../../interface/choices/choices-origin';\nimport {AjfChoicesPromiseOrigin} from '../../interface/choices/choices-promise-origin';\n\nexport function initChoicesOrigin(origin: AjfChoicesOrigin<any>): Promise<void> {\n  if (origin.type === 'fixed') {\n    return Promise.resolve();\n  }\n  if (origin.type === 'function') {\n    const fo = origin as AjfChoicesFunctionOrigin<any>;\n    fo.choices = fo.generator();\n    return Promise.resolve();\n  }\n  if (origin.type === 'promise') {\n    const po = origin as AjfChoicesPromiseOrigin<any>;\n    return po.generator.then(choices => po.choices = choices).then();\n  }\n  if (origin.type === 'observable') {\n    const obso = origin as AjfChoicesObservableOrigin<any>;\n    if (obso.generator != null) {\n      obso.choices = [];\n      return new Promise<void>(res => {\n        obso.generator.subscribe(\n          c => obso.choices.push(c),\n          () => {},\n          () => res(),\n        );\n      });\n    }\n  }\n  if (origin.type === 'observableArray') {\n    const aoo = origin as AjfChoicesObservableArrayOrigin<any>;\n    if (aoo.generator != null) {\n      aoo.choices = [];\n      return new Promise<void>(res => {\n        aoo.generator.subscribe(\n          choices => {\n            aoo.choices = choices;\n            res();\n          }\n        );\n      });\n    }\n  }\n  return Promise.resolve();\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfChoicesOrigin} from '../../interface/choices/choices-origin';\nimport {isChoicesOrigin} from './is-choices-origin';\n\nexport function isChoicesFixedOrigin(origin: AjfChoicesOrigin<any>): boolean {\n  return isChoicesOrigin(origin) && origin.type === 'fixed';\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfField} from '../../interface/fields/field';\nimport {AjfFieldType} from '../../interface/fields/field-type';\n\nexport function isNumberField(field: AjfField): boolean {\n  return field.fieldType === AjfFieldType.Number;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidation} from '../../interface/validation/validation';\nimport {createValidation} from './create-validation';\n\nexport function maxDigitsValidation(maxValue: number): AjfValidation {\n  return createValidation({\n    condition: `$value ? $value.toString().length <= ${maxValue.toString()} : false`,\n    errorMessage: 'Digits count must be <= ' + maxValue.toString()\n  });\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidation} from '../../interface/validation/validation';\nimport {createValidation} from './create-validation';\n\nexport function maxValidation(maxValue: number): AjfValidation {\n  return createValidation({\n    condition: '$value <= ' + maxValue.toString(),\n    errorMessage: 'Value must be <= ' + maxValue.toString()\n  });\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidation} from '../../interface/validation/validation';\nimport {createValidation} from './create-validation';\n\nexport function minDigitsValidation(minValue: number): AjfValidation {\n  return createValidation({\n    condition: `$value ? $value.toString().length >= ${minValue.toString()} : false`,\n    errorMessage: 'Digits count must be >= ' + minValue.toString()\n  });\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidation} from '../../interface/validation/validation';\nimport {createValidation} from './create-validation';\n\nexport function minValidation(minValue: number): AjfValidation {\n  return createValidation({\n    condition: '$value >= ' + minValue.toString(),\n    errorMessage: 'Value must be >= ' + minValue.toString()\n  });\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfValidation} from '../../interface/validation/validation';\nimport {createValidation} from './create-validation';\n\nexport function notEmptyValidation(): AjfValidation {\n  return createValidation({condition: `notEmpty($value)`, errorMessage: `Value must not be empty`});\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfWarning} from '../../interface/warning/warning';\nimport {createWarning} from './create-warning';\n\nexport function notEmptyWarning(): AjfWarning {\n  return createWarning({condition: 'notEmpty($value)', warningMessage: 'Value must not be empty'});\n}\n"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","defineProperty","AjfBaseFieldComponent","_instance","instance","_setUpInstanceUpdate","_onInstanceChange","_readonly","readonly","coerceBooleanProperty","_changeDetectorRef","markForCheck","_control","ngOnInit","_this","_warningTriggerSub","warningTrigger","pipe","withLatestFrom","control","filter","v","subscribe","warningResults","_warningAlertService","showWarningAlertPrompt","w","result","map","warning","r","setValue","_e","unsubscribe","ngOnDestroy","_instanceUpdateSub","updatedEvt","detectChanges","e","Subscription","EMPTY","_service","defer","getControl","ctrl","FormControl","AjfDateValuePipe","transform","date","Date","type","Pipe","args","name","AjfDateValueStringPipe","dateObj","format","Injectable","tslib_1.__extends","AjfInvalidFieldDefinitionError","AjfError","message","_super","String","Text","Number","Boolean","SingleChoice","MultipleChoice","Formula","Empty","DateInput","Time","Table","Geolocation","Barcode","LENGTH","fieldIconName","AjfFieldType","toLowerCase","AjfFieldIconPipe","field","fieldType","AjfFieldIsValidPipe","validationResults","f","AjfFormField","_loadComponent","_componentInstance","_cdr","_updatedSub","fieldHost","vcr","viewContainerRef","clear","componentDef","componentsMap","node","component","componentFactory","_cfr","resolveComponentFactory","componentRef","createComponent","inputs","keys","forEach","key","console","log","AjfFieldHost","Directive","selector","ViewContainerRef","AjfFieldService","registerCustomField","Error","AjfFieldWithChoicesComponent","_searchThreshold","cdr","service","warningAlertService","searchThreshold","AjfField","AjfFieldNodeLink","AjfNodeGroup","AjfSlide","AjfRepeatingSlide","isCustomFieldWithChoices","isFieldWithChoice","isFieldWithChoices","isField","nodeType","AjfNodeType","isFieldInstance","nodeInstance","isFieldWithChoicesInstance","isTableFieldInstance","isTableField","updateConditionalBranches","context","conditionalBranches","oldBranch","verifiedBranch","idx","found","evaluateExpression","condition","updateVisibility","branchVisibility","visibility","visible","oldVisibility","newVisibility","nodeInstanceSuffix","prefix","join","nodeInstanceCompleteName","updateFormula","formula","editable","value","newValue","oldValue","$value","changed","updateNextSlideCondition","nextSlideCondition","evaluateValidation","validation","forceFormula","error","errorMessage","clientValidation","evaluateValidationGroup","res","ctx","deepCopy","conditions","cond","push","evaluateValidationConditions","maxValue","evaluateValidationMaxValue","minValue","evaluateValidationMinValue","notEmpty","evaluateValidationNotEmpty","maxDigits","evaluateValidationMaxDigits","minDigits","evaluateValidationMinDigits","updateValidation","supplementaryInformations","completeName","forceValue","valid","reduce","prev","x","evaluateWarningConditions","warningMessage","evaluateWarning","updateWarning","evaluateWarningGroup","updateFilteredChoices","choicesFilter","filteredChoices","choicesOrigin","choices","c","$choice","$choiceValue","createNode","alwaysCondition","tslib_1.__assign","parentNode","label","createField","defaultValue","size","isSlidesNode","isContainerNode","flattenNodesInstances","nodes","includeGroups","flatNodes","isContainerNodeInstance","concat","isSlidesInstance","isNodeGroupInstance","isNodeGroup","isSlideInstance","isSlideNode","createNodeInstance","slice","EventEmitter","createFieldInstance","createFieldWithChoicesInstance","fieldInstance","firstTriggerConditionDone","selectionTrigger","createSlideInstance","slideNodes","position","createValidationGroup","group","createWarningGroup","isRepeatingContainerNode","getAncestorRepeatingNodesNames","allNodes","names","nodeGroups","curParent","parent","curNode","find","id","sn","getInstanceCondition","ancestorsNames","oldCondition","newCondition","normalizeExpression","getInstanceConditions","newConditions","getInstanceFormula","oldFormula","newFormula","createValidation","getInstanceValidations","validations","newValidations","newValidation","oldValidation","getInstanceValidation","createWarning","getInstanceWarnings","warnings","newWarnings","newWarning","oldWarning","getInstanceWarning","isRepeatingSlideInstance","isRepeatingSlide","nodeToNodeInstance","createInstance","rows","row","rowIdx","elem","elemIdx","normalizeRows","hideEmptyRows","controls","createTableFieldInstance","formulaReps","reps","createNodeGroupInstance","slideInstance","createRepeatingSlideInstance","createCondition","ngInstance","createFormula","fNode","fInstance","fwcNode","fwcInstance","triggerConditions","rgInstance","flattenNodes","orderedNodes","newNodes","sort","n1","n2","updateRepsNum","oldReps","ctxReps","newReps","canAdd","maxReps","canRemove","minReps","AjfValidationService","addFunction","_functions","_initFunctions","addFunctionHandler","fn","undefined","AjfExpressionUtils","utils","functionsStr","toString","_functionsStr","_baseUtilFunctions","UTIL_FUNCTIONS","tokenize","((/** @type {?} */ (esprima))).default","esprima","Initializing","Complete","AjfFormRendererService","_flatNodesTree","_errorPositions","_errors","form","_form","getValue","setForm","_initUpdateMapStreams","initContext","currentForm","next","getFormValue","formGroup","_formGroup","addGroup","Observable","subscriber","complete","_nodesUpdates","_adjustReps","removeGroup","fieldName","contains","_initErrorsStreams","_valueChanged","_nodes","currentPosition","errors","rsNode","slide","indexOf","v1","v2","sNode","_slidesNum","publishReplay","refCount","startWith","_visibilityNodesMap","scan","rmap","op","share","_repetitionNodesMap","_conditionalBranchNodesMap","_formulaNodesMap","_validationNodesMap","_warningNodesMap","_filteredChoicesNodesMap","_triggerConditionsNodesMap","_nextSlideConditionsNodesMap","_nodesMaps","_initFormStreams","formObs","_initFormGroupStreams","FormGroup","_nodesInstances","_orderedNodesInstancesTree","_initNodeInstance","_explodeRepeatingNode","sInstance","tfInstance_1","tNode_1","formGroup_1","controlsWithLabels_1","columnLabels","cell","registerControl","fakeInstance","_addToNodesFormulaMap","rowLabels","updateFieldInstanceState","_addNodeInstance","added","removed","newNodes_1","newInstance","_loop_1","this_1","nodesNum","splice","_removeNodeInstance","fg","rsInstance","nodesPerSlide","startNode","_updateFormValueAndValidity","asObservable","values","updateValueAndValidity","nodesInstances","curSuffix","parentNodeInstance","ni","nni","_formValueDelta","k","_formGroupSubscription","init","initForm","_formInitEvent","emit","AjfFormInitStatus","valueChanges","pairwise","debounceTime","_flatNodes","oldFormValue","newFormValue","visibilityMap","repetitionMap","conditionalBranchesMap","formulaMap","validationMap","warningMap","nextSlideConditionsMap","filteredChoicesMap","triggerConditionsMap","delta","deltaLen","updatedNodes","visibilityChanged","fg_1","s_1","timer","closed","rnInstance","_condition","_showSubtree","_hideSubtree","currentSupplementaryInformations","_nextSlideTrigger","conditionsNum","updateTriggerConditions","subNodesNum","subNode","branch","_updateSubtreeVisibility","subNodes","nodeSuffix","isContainer","cn","_initNodesStreams","flatTree","flattenNodesInstancesTree","slides","nodeName","_removeNodesVisibilityMapIndex","_removeNodesRepetitionMapIndex","_removeNodesConditionalBranchMapIndex","_removeNodesFormulaMapIndex","_removeNodesValidationMapIndex","_removeNodesWarningMapIndex","_removeNodesNextSlideConditionsMapIndex","_removeNodesFilteredChoicesMapIndex","_removeNodesTriggerConditionsMapIndex","_removeSlideInstance","_removeNodeGroupInstance","_removeFieldInstance","_removeFromNodesVisibilityMap","conditionalBranch","_removeFromNodesConditionalBranchMap","nodeGroupInstance","nodeGroup","_removeFromNodesRepetitionMap","fieldInstanceName","removeControl","_validationNodesMapUpdates","vmap","_removeFromNodesFormulaMap","rcInstance","_removeFromNodesValidationMap","_removeFromNodesWarningMap","_removeFromNodesNextSlideConditionsMap","_removeFromNodesFilteredChoicesMap","_removeFromNodesTriggerConditionsMap","_addNodeGroupInstance","_addSlideInstance","_addFieldInstance","_addToNodesVisibilityMap","_addToNodesConditionalBranchMap","_addToNodesRepetitionMap","_addToNodesValidationMap","_addToNodesWarningMap","_addToNodesNextSlideConditionsMap","_addToNodesFilteredChoicesMap","_addToNodesTriggerConditionsMap","nodeGroupInstanceName","index","_removeNodesMapIndex","_visibilityNodesMapUpdates","_repetitionNodesMapUpdates","_conditionalBranchNodesMapUpdates","_formulaNodesMapUpdates","_warningNodesMapUpdates","_filteredChoicesNodesMapUpdates","_triggerConditionsNodesMapUpdates","_nextSlideConditionsNodesMapUpdates","nodesMap","_removeFromNodesMap","tokens","token","tokenName","_addToNodesMap","_","Subject","formInitEvent","BehaviorSubject","nextSlideTrigger","slidesNum","AjfFormActionEvent","AjfFormRenderer","_saveDisabled","saveDisabled","_hasStartMessage","hasStartMessage","_hasEndMessage","hasEndMessage","_hideTopToolbar","hideTopToolbar","_hideBottomToolbar","hideBottomToolbar","_hideNavigationButtons","hideNavigationButtons","_fixedOrientation","fixedOrientation","_orientation","orientation","_orientationChange","_init","_rendererService","goToNextError","_errorMoveEvent","goToPrevError","delayWhen","formSlider","pageScrollFinish","dir","onSave","_evt","_formAction","source","action","onFormAction","ngAfterViewInit","ngAfterViewChecked","_errorMoveSubscription","move","currentPage","prevIdx","nextIdx","errorsLen","to","_nextSlideSubscription","orientationChangeHandler","trackNodeById","ajfFieldTypes","orientationChange","formAction","nodesTree","errorPositions","formIsInit","AjfBoolToIntPipe","AjfExpandFieldWithChoicesPipe","threshold","forceNarrow","forceExpanded","AjfIncrementPipe","increment","AjfIsRepeatingSlideInstancePipe","AjfNodeCompleteNamePipe","AjfRangePipe","start","step","range","length_1","AjfTableRowClass","AjfTableVisibleColumnsPipe","col","cur","AjfValidSlidePipe","pure","AjfFormsModule","NgModule","declarations","exports","providers","AjfInputFieldComponent","AJF_SEARCH_ALERT_THRESHOLD","InjectionToken","AjfAttachmentsOriginSerializer","fromJson","origin","attachments","createAttachmentsOrigin","createChoicesOrigin","AjfChoicesOriginSerializer","createContainerNode","containerNode","createRepeatingNode","repeatingNode","createNodeGroup","createRepeatingSlide","createSlide","AjfValidationGroupSerializer","AjfWarningGroupSerializer","AjfNodeSerializer","json","choicesOrigins","attachmentsOrigins","err","obj","AjfConditionSerializer","_fieldFromJson","_fieldNodeLinkFromJson","_nodeGroupFromJson","_repeatingSlideFromJson","_slideFromJson","_containerNodeFromJson","attachmentsOriginRef","attachmentOrigin","a","_fieldWithChoicesFromJson","_formulaFieldFromJson","choicesOriginRef","AjfFormulaSerializer","createFieldWithChoices","_repeatingNodeFromJson","AjfFormSerializer","stringIdentifier","Link","Pdf","isChoicesOrigin","co","typeStr","match","Promise","resolve","fo","generator","po_1","then","obso_1","aoo_1"],"mappings":"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"}