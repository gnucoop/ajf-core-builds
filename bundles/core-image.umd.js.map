{"version":3,"file":"core-image.umd.js","sources":["../../src/core/image/image.ts","../../src/core/image/image-type.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ElementRef, OnDestroy, OnInit, Renderer2, RendererStyleFlags2} from '@angular/core';\nimport {DomSanitizer, SafeResourceUrl} from '@angular/platform-browser';\n\nimport {Observable, BehaviorSubject, Subscription} from 'rxjs';\n\nimport {AjfImageIcon} from './image-icon';\nimport {AjfImageType} from './image-type';\n\nexport abstract class AjfImage implements OnDestroy, OnInit {\n  iconComponent: ElementRef;\n\n  /**\n   * if 0 take image by url\n   * if 1 take image by icon\n   * if 2 take image by class\n   *\n   */\n  set type(type: AjfImageType) {\n    this._imageType.next(type);\n  }\n\n  set imageUrl(imageUrl: string) {\n    this._url.next(\n      (imageUrl || '').startsWith('data:image/svg+xml;base64,')\n      ? this._domSanitizer.bypassSecurityTrustResourceUrl(imageUrl)\n      : imageUrl\n    );\n  }\n\n  set icon(icon: AjfImageIcon) {\n    this._iconObj.next(icon);\n  }\n\n  set flag(flag: string) {\n    this._flagName.next(flag);\n  }\n\n  readonly imageTypes = AjfImageType;\n\n  private _imageType = new BehaviorSubject<AjfImageType | null>(null);\n  readonly imageType: Observable<AjfImageType | null> = this._imageType.asObservable();\n\n  private _url = new BehaviorSubject<string | SafeResourceUrl | null>(null);\n  readonly url: Observable<string | SafeResourceUrl | null> = this._url.asObservable();\n\n  private _iconObj = new BehaviorSubject<AjfImageIcon | null>(null);\n  readonly iconObj: Observable<AjfImageIcon | null> = this._iconObj.asObservable();\n\n  private _flagName = new BehaviorSubject<string | null>(null);\n  readonly flagName: Observable<string | null> = this._flagName.asObservable();\n\n  private _iconSub = Subscription.EMPTY;\n\n  constructor(\n      private _el: ElementRef, private _renderer: Renderer2, private _domSanitizer: DomSanitizer) {\n    this._iconSub = this.iconObj.subscribe(() => this._updateIconSize());\n  }\n\n  ngOnDestroy(): void {\n    if (this._iconSub && !this._iconSub.closed) {\n      this._iconSub.unsubscribe();\n    }\n  }\n\n  ngOnInit(): void {\n    this._updateIconSize();\n  }\n\n  private _updateIconSize(): void {\n    const icon = this._iconObj.getValue();\n    if (icon == null) { return; }\n    const styles = this._el.nativeElement.style;\n    if (this.iconComponent == null || styles == null || styles.fontSize == null) { return; }\n    const fontSize: string = styles.fontSize;\n    if (fontSize.match(/^[0-9]+px$/) != null) {\n      const el = this.iconComponent.nativeElement;\n      this._renderer.setStyle(el, 'width', fontSize, RendererStyleFlags2.Important);\n      this._renderer.setStyle(el, 'height', fontSize, RendererStyleFlags2.Important);\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfImageType {\n  Image,\n  Flag,\n  Icon,\n  LENGTH\n}\n"],"names":["RendererStyleFlags2","Subscription","BehaviorSubject"],"mappings":"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"}