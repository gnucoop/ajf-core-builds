{"version":3,"file":"core-image.umd.min.js","sources":["../../src/core/image/image-type.ts","../../src/core/image/image.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfImageType {\n  Image,\n  Flag,\n  Icon,\n  LENGTH\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ElementRef, OnDestroy, OnInit, Renderer2, RendererStyleFlags2} from '@angular/core';\nimport {DomSanitizer, SafeResourceUrl} from '@angular/platform-browser';\n\nimport {Observable, BehaviorSubject, Subscription} from 'rxjs';\n\nimport {AjfImageIcon} from './image-icon';\nimport {AjfImageType} from './image-type';\n\nexport abstract class AjfImage implements OnDestroy, OnInit {\n  iconComponent: ElementRef;\n\n  /**\n   * if 0 take image by url\n   * if 1 take image by icon\n   * if 2 take image by class\n   *\n   */\n  set type(type: AjfImageType) {\n    this._imageType.next(type);\n  }\n\n  set imageUrl(imageUrl: string) {\n    this._url.next(\n      (imageUrl || '').startsWith('data:image/svg+xml;base64,')\n      ? this._domSanitizer.bypassSecurityTrustResourceUrl(imageUrl)\n      : imageUrl\n    );\n  }\n\n  set icon(icon: AjfImageIcon) {\n    this._iconObj.next(icon);\n  }\n\n  set flag(flag: string) {\n    this._flagName.next(flag);\n  }\n\n  readonly imageTypes = AjfImageType;\n\n  private _imageType = new BehaviorSubject<AjfImageType | null>(null);\n  readonly imageType: Observable<AjfImageType | null> = this._imageType.asObservable();\n\n  private _url = new BehaviorSubject<string | SafeResourceUrl | null>(null);\n  readonly url: Observable<string | SafeResourceUrl | null> = this._url.asObservable();\n\n  private _iconObj = new BehaviorSubject<AjfImageIcon | null>(null);\n  readonly iconObj: Observable<AjfImageIcon | null> = this._iconObj.asObservable();\n\n  private _flagName = new BehaviorSubject<string | null>(null);\n  readonly flagName: Observable<string | null> = this._flagName.asObservable();\n\n  private _iconSub = Subscription.EMPTY;\n\n  constructor(\n      private _el: ElementRef, private _renderer: Renderer2, private _domSanitizer: DomSanitizer) {\n    this._iconSub = this.iconObj.subscribe(() => this._updateIconSize());\n  }\n\n  ngOnDestroy(): void {\n    if (this._iconSub && !this._iconSub.closed) {\n      this._iconSub.unsubscribe();\n    }\n  }\n\n  ngOnInit(): void {\n    this._updateIconSize();\n  }\n\n  private _updateIconSize(): void {\n    const icon = this._iconObj.getValue();\n    if (icon == null) { return; }\n    const styles = this._el.nativeElement.style;\n    if (this.iconComponent == null || styles == null || styles.fontSize == null) { return; }\n    const fontSize: string = styles.fontSize;\n    if (fontSize.match(/^[0-9]+px$/) != null) {\n      const el = this.iconComponent.nativeElement;\n      this._renderer.setStyle(el, 'width', fontSize, RendererStyleFlags2.Important);\n      this._renderer.setStyle(el, 'height', fontSize, RendererStyleFlags2.Important);\n    }\n  }\n}\n"],"names":["Image","Flag","Icon","LENGTH","Object","defineProperty","AjfImage","prototype","type","this","_imageType","next","imageUrl","_url","startsWith","_domSanitizer","bypassSecurityTrustResourceUrl","icon","_iconObj","flag","_flagName","ngOnDestroy","_iconSub","closed","unsubscribe","ngOnInit","_updateIconSize","getValue","styles","_el","nativeElement","style","iconComponent","fontSize","match","el","_renderer","setStyle","RendererStyleFlags2","Important","_this","imageTypes","AjfImageType","BehaviorSubject","imageType","asObservable","url","iconObj","flagName","Subscription","EMPTY","subscribe"],"mappings":";;;;;;;;;;;;;;;;;;;;;qWAuBEA,MAAF,EACEC,KAAF,EACEC,KAAF,EACEC,OAAF,6ECIA,OASEC,OAAFC,eAAMC,EAANC,UAAA,OAAA,KAAE,SAASC,GACPC,KAAKC,WAAWC,KAAKH,oCAGvBJ,OAAFC,eAAMC,EAANC,UAAA,WAAA,KAAE,SAAaK,GACXH,KAAKI,KAAKF,MACPC,GAAY,IAAIE,WAAW,8BAC1BL,KAAKM,cAAcC,+BAA+BJ,GAClDA,oCAINR,OAAFC,eAAMC,EAANC,UAAA,OAAA,KAAE,SAASU,GACPR,KAAKS,SAASP,KAAKM,oCAGrBb,OAAFC,eAAMC,EAANC,UAAA,OAAA,KAAE,SAASY,GACPV,KAAKW,UAAUT,KAAKQ,oCAwBtBb,EAAFC,UAAAc,YAAE,WACMZ,KAAKa,WAAab,KAAKa,SAASC,QAClCd,KAAKa,SAASE,eAIlBlB,EAAFC,UAAAkB,SAAE,WACEhB,KAAKiB,mBAGCpB,EAAVC,UAAAmB,gBAAE,WAEE,GAAY,MADCjB,KAAKS,SAASS,WAC3B,CACJ,IAAUC,EAASnB,KAAKoB,IAAIC,cAAcC,MACtC,GAA0B,MAAtBtB,KAAKuB,eAAmC,MAAVJ,GAAqC,MAAnBA,EAAOK,SAA3D,CACJ,IAAUA,EAAmBL,EAAOK,SAChC,GAAoC,MAAhCA,EAASC,MAAM,cAAuB,CAC9C,IAAYC,EAAK1B,KAAKuB,cAAcF,cAC9BrB,KAAK2B,UAAUC,SAASF,EAAI,QAASF,EAAUK,EAArDA,oBAAyEC,WACnE9B,KAAK2B,UAAUC,SAASF,EAAI,SAAUF,EAAUK,EAAtDA,oBAA0EC,eAG1EjC,GA3BE,SAAFA,EACcuB,EAAyBO,EAA8BrB,GADnE,IAAFyB,EAAA/B,KACcA,KAAdoB,IAAcA,EAAyBpB,KAAvC2B,UAAuCA,EAA8B3B,KAArEM,cAAqEA,EAjB1DN,KAAXgC,WAAwBC,EAEdjC,KAAVC,WAAuB,IAAIiC,EAA3BA,gBAAgE,MACrDlC,KAAXmC,UAAwDnC,KAAKC,WAAWmC,eAE9DpC,KAAVI,KAAiB,IAAI8B,EAArBA,gBAAsE,MAC3DlC,KAAXqC,IAA8DrC,KAAKI,KAAKgC,eAE9DpC,KAAVS,SAAqB,IAAIyB,EAAzBA,gBAA8D,MACnDlC,KAAXsC,QAAsDtC,KAAKS,SAAS2B,eAE1DpC,KAAVW,UAAsB,IAAIuB,EAA1BA,gBAAyD,MAC9ClC,KAAXuC,SAAiDvC,KAAKW,UAAUyB,eAEtDpC,KAAVa,SAAqB2B,EAArBA,aAAkCC,MAI9BzC,KAAKa,SAAWb,KAAKsC,QAAQI,UAAjC,WAAiD,OAAAX,EAAKd"}