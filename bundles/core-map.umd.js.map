{"version":3,"file":"core-map.umd.js","sources":["../../src/core/map/map-module.ts","../../src/core/map/map.ts","../../src/core/map/map-container-directive.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {AjfMapContainerDirective} from './map-container-directive';\nimport {AjfMapComponent} from './map';\n\n@NgModule({\n  declarations: [\n    AjfMapComponent,\n    AjfMapContainerDirective\n  ],\n  exports: [\n    AjfMapComponent\n  ]\n})\nexport class AjfMapModule { }\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AfterViewInit, ChangeDetectionStrategy, Component, Input,\n  OnDestroy, ViewChild, ViewEncapsulation\n} from '@angular/core';\n\nimport {Subscription} from 'rxjs';\n\nimport * as L from 'leaflet';\n\nimport {AjfMapContainerDirective} from './map-container-directive';\n\n@Component({\n  moduleId: module.id,\n  selector: 'ajf-map',\n  templateUrl: 'map.html',\n  styleUrls: ['map.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class AjfMapComponent implements AfterViewInit, OnDestroy {\n  @ViewChild(AjfMapContainerDirective, {static: true}) mapContainer: AjfMapContainerDirective;\n\n  private _coordinate: number[];\n  @Input() set coordinate(coordinate: number[]) {\n    this._coordinate = coordinate.slice(0);\n    this._setMapView();\n  }\n\n  private _tileLayer: string;\n  @Input() set tileLayer(tileLayer: string) {\n    this._tileLayer = tileLayer;\n    this._addTileLayerToMap();\n  }\n\n  private _attribution: string;\n  @Input() set attribution(attribution: string) {\n    this._attribution = attribution;\n    this._addTileLayerToMap();\n  }\n\n  private _disabled: boolean;\n  @Input() set disabled(disabled: boolean) {\n    this._disabled = disabled;\n    this._disableMap();\n  }\n\n\n  private _map: L.Map;\n  get map(): L.Map { return this._map; }\n\n  private _columnWidthChanged: Subscription = Subscription.EMPTY;\n\n  ngAfterViewInit(): void {\n    if (this.mapContainer) {\n      this._initMap();\n      this._setMapView();\n      this._addTileLayerToMap();\n      this._disableMap();\n    }\n  }\n\n  redraw() {\n    if (this.mapContainer && this._map) {\n      this._map.invalidateSize();\n    }\n  }\n\n  ngOnDestroy() {\n    this._columnWidthChanged.unsubscribe();\n  }\n\n  private _initMap(): void {\n    const options = {\n      zoomControl: false,\n      attributionControl: false\n    };\n\n    this._map = L.map(this.mapContainer.htmlElement, options);\n  }\n\n  private _setMapView(): void {\n    if (this._map == null) { return; }\n\n    let x, y, z;\n    if (this._coordinate != null && this._coordinate.length === 3) {\n      x = this._coordinate[0];\n      y = this._coordinate[1];\n      z = this._coordinate[2];\n    } else {\n      x = 0;\n      y = 0;\n      z = 14;\n    }\n    this._map.setView([x, y], z);\n  }\n\n  private _addTileLayerToMap(): void {\n    if (this._map == null || this._tileLayer == null) { return; }\n    this._map.eachLayer((l) => this._map.removeLayer(l));\n    L.tileLayer(this._tileLayer, {\n      attribution: this._attribution\n    }).addTo(this._map);\n  }\n\n  private _disableMap(): void {\n    if (this._map == null) { return; }\n\n    if (this._disabled) {\n      this._map.dragging.disable();\n      this._map.touchZoom.disable();\n      this._map.doubleClickZoom.disable();\n      this._map.scrollWheelZoom.disable();\n      this._map.boxZoom.disable();\n      this._map.keyboard.disable();\n      if (this._map.tap) {\n        this._map.tap.disable();\n      }\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ElementRef, Directive} from '@angular/core';\n\n@Directive({\n  selector: '[mapContainer]'\n})\nexport class AjfMapContainerDirective {\n  get htmlElement(): HTMLElement { return this._el.nativeElement; }\n\n  constructor(private _el: ElementRef) { }\n}\n"],"names":["NgModule","Input","ViewEncapsulation","ChangeDetectionStrategy","Component","L.tileLayer","L.map","Subscription","ElementRef","Directive"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEwBA,AAAA,QAAA,wBAAA,kBAAA,YAAA;IAMA,IAAE,SAAF,wBAAA,CAAsB,GAAe,EAArC;IAAA,QAAsB,IAAtB,CAAA,GAAyB,GAAH,GAAG,CAAY;IAArC,KAA0C;IAF1C,IAAE,MAAF,CAAA,cAAA,CAAM,wBAAN,CAAA,SAAA,EAAA,aAAiB,EAAjB;;;;IAAA,QAAE,YAAF,EAAmC,OAAO,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE;;;IAAnE,KAAA,CAAA,CAAmE;;IAJnE,QAAA,EAAA,IAAA,EAACS,cAAS,EAAV,IAAA,EAAA,CAAW;IACX,oBAAE,QAAQ,EAAE,gBAAgB;IAC5B,iBAAC,EAAD,EAAA;;;;IAJA,QAAA,EAAA,IAAA,EAAQD,eAAU,EAAlB;;IASA,IAAA,OAAA,wBAAC,CAAD;IAAA,CAAC,EAAD,CAAA,CAAA;;;;;;ADEA,AAAA,QAAA,eAAA,kBAAA,YAAA;IAAA,IAAA,SAAA,eAAA,GAAA;IAuCA,QAAU,IAAV,CAAA,mBAA6B,GAAiBD,iBAAY,CAAC,KAAK,CAAC;IAqEjE,KAAC;IAhGD,IAAE,MAAF,CAAA,cAAA,CAAe,eAAf,CAAA,SAAA,EAAA,YAAyB,EAAzB;;;;;IAAA,QAAE,UAAwB,UAAoB,EAA9C;IACA,YAAI,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAC3C,YAAI,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,SAAG;;;IAAH,KAAA,CAAA,CAAG;IAGH,IAAE,MAAF,CAAA,cAAA,CAAe,eAAf,CAAA,SAAA,EAAA,WAAwB,EAAxB;;;;;IAAA,QAAE,UAAuB,SAAiB,EAA1C;IACA,YAAI,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;IAChC,YAAI,IAAI,CAAC,kBAAkB,EAAE,CAAC;IAC9B,SAAG;;;IAAH,KAAA,CAAA,CAAG;IAGH,IAAE,MAAF,CAAA,cAAA,CAAe,eAAf,CAAA,SAAA,EAAA,aAA0B,EAA1B;;;;;IAAA,QAAE,UAAyB,WAAmB,EAA9C;IACA,YAAI,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC;IACpC,YAAI,IAAI,CAAC,kBAAkB,EAAE,CAAC;IAC9B,SAAG;;;IAAH,KAAA,CAAA,CAAG;IAGH,IAAE,MAAF,CAAA,cAAA,CAAe,eAAf,CAAA,SAAA,EAAA,UAAuB,EAAvB;;;;;IAAA,QAAE,UAAsB,QAAiB,EAAzC;IACA,YAAI,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;IAC9B,YAAI,IAAI,CAAC,WAAW,EAAE,CAAC;IACvB,SAAG;;;IAAH,KAAA,CAAA,CAAG;IAIH,IAAE,MAAF,CAAA,cAAA,CAAM,eAAN,CAAA,SAAA,EAAA,KAAS,EAAT;;;;IAAA,QAAE,YAAF,EAAqB,OAAO,IAAI,CAAC,IAAI,CAAC,EAAE;;;IAAxC,KAAA,CAAA,CAAwC;;;;IAIxC,IAAE,eAAF,CAAA,SAAA,CAAA,eAAiB;;;IAAjB,IAAE,YAAF;IACA,QAAI,IAAI,IAAI,CAAC,YAAY,EAAE;IAC3B,YAAM,IAAI,CAAC,QAAQ,EAAE,CAAC;IACtB,YAAM,IAAI,CAAC,WAAW,EAAE,CAAC;IACzB,YAAM,IAAI,CAAC,kBAAkB,EAAE,CAAC;IAChC,YAAM,IAAI,CAAC,WAAW,EAAE,CAAC;IACzB,SAAK;IACL,KAAG,CAAH;;;;IAEA,IAAE,eAAF,CAAA,SAAA,CAAA,MAAQ;;;IAAR,IAAE,YAAF;IACA,QAAI,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,IAAI,EAAE;IACxC,YAAM,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;IACjC,SAAK;IACL,KAAG,CAAH;;;;IAEA,IAAE,eAAF,CAAA,SAAA,CAAA,WAAa;;;IAAb,IAAE,YAAF;IACA,QAAI,IAAI,CAAC,mBAAmB,CAAC,WAAW,EAAE,CAAC;IAC3C,KAAG,CAAH;;;;;IAEA,IAAU,eAAV,CAAA,SAAA,CAAA,QAAkB;;;;IAAlB,IAAE,YAAF;;IACA,QAAA,IAAU,OAAO,GAAG;IACpB,YAAM,WAAW,EAAE,KAAK;IACxB,YAAM,kBAAkB,EAAE,KAAK;IAC/B,SAAK,CAAL;IAEA,QAAI,IAAI,CAAC,IAAI,GAAGD,WAAK,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;IAC9D,KAAG,CAAH;;;;;IAEA,IAAU,eAAV,CAAA,SAAA,CAAA,WAAqB;;;;IAArB,IAAE,YAAF;IACA,QAAI,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,EAAE;IAA3B,YAA6B,OAAO;IAApC,SAAsC;;IAEtC,QAAA,IAAQ,CAAC,CAAT;;IAAA,QAAA,IAAW,CAAC,CAAZ;;IAAA,QAAA,IAAc,CAAC,CAAf;IACA,QAAI,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,KAAK,CAAC,EAAE;IACnE,YAAM,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;IAC9B,YAAM,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;IAC9B,YAAM,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;IAC9B,SAAK;IAAL,aAAW;IACX,YAAM,CAAC,GAAG,CAAC,CAAC;IACZ,YAAM,CAAC,GAAG,CAAC,CAAC;IACZ,YAAM,CAAC,GAAG,EAAE,CAAC;IACb,SAAK;IACL,QAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACjC,KAAG,CAAH;;;;;IAEA,IAAU,eAAV,CAAA,SAAA,CAAA,kBAA4B;;;;IAA5B,IAAE,YAAF;IAAA,QAAE,IAAF,KAAA,GAAA,IAAA,CAMG;IALH,QAAI,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,EAAE;IAAtD,YAAwD,OAAO;IAA/D,SAAiE;IACjE,QAAI,IAAI,CAAC,IAAI,CAAC,SAAS;;;;IAAvB,QAAwB,UAAC,CAAC,EAA1B,EAA+B,OAAA,KAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAvD,EAAuD,EAAC,CAAC;IACzDD,QAAIA,iBAAW,CAAC,IAAI,CAAC,UAAU,EAAE;IACjC,YAAM,WAAW,EAAE,IAAI,CAAC,YAAY;IACpC,SAAK,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACxB,KAAG,CAAH;;;;;IAEA,IAAU,eAAV,CAAA,SAAA,CAAA,WAAqB;;;;IAArB,IAAE,YAAF;IACA,QAAI,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,EAAE;IAA3B,YAA6B,OAAO;IAApC,SAAsC;IAEtC,QAAI,IAAI,IAAI,CAAC,SAAS,EAAE;IACxB,YAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;IACnC,YAAM,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;IACpC,YAAM,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC;IAC1C,YAAM,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC;IAC1C,YAAM,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IAClC,YAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;IACnC,YAAM,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE;IACzB,gBAAQ,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IAChC,aAAO;IACP,SAAK;IACL,KAAG,CAAH;;IA3GA,QAAA,EAAA,IAAA,EAACD,cAAS,EAAV,IAAA,EAAA,CAAW,CAAX,QAAA,EAAA,SAAA;IACA,oBAAE,QAAQ,EAAE,0BAAZ;IACA,oBAAE,MAAF,EAAU,CAAV,wIAAA,CAAA;IACA,oBAAE,eAAF,EAAAD,4BAAA,CAAA,MAAA;IACA,oBAAE,aAAF,EAAAD,sBAAA,CAAA,IAAA;IACA,iBAAA,EAAA,EAAA;IACA,KAAA,CAAA;IACA,IAAA,eAAA,CAAA,cAAA,GAAA;;;IAEA,QAAA,SAAA,EAAA,CAAA,EAAA,IAAA,EAAAD,UAAA,EAAA,CAAA;IAGA,QAAA,WAAA,EAAA,CAAA,EAAA,IAAA,EAAAA,UAAA,EAAA,CAAA;IAMA,QAAA,QAAA,EAAA,CAAA,EAAA,IAAA,EAAAA,UAAA,EAAA,CAAA;IAMA,KAAA,CAAA;IAMA,IAAA,OAAA,eAAA,CAAG;;;;;;;ADpCH,AAAA,QAAA,YAAA,kBAAA,YAAA;IAAA,IAAA,SAAA,YAAA,GAAA;IASA,KAA6B;;IAT7B,QAAA,EAAA,IAAA,EAACD,aAAQ,EAAT,IAAA,EAAA,CAAU;IACV,oBAAE,YAAY,EAAE;IAChB,wBAAI,eAAe;IACnB,wBAAI,wBAAwB;IAC5B,qBAAG;IACH,oBAAE,OAAO,EAAE;IACX,wBAAI,eAAe;IACnB,qBAAG;IACH,iBAAC,EAAD,EAAA;;IACA,IAA4B,OAA5B,YAA6B,CAA7B;IAAA,CAA6B,EAA7B,CAAA;;;;;;;;;;;;;;"}