{"version":3,"file":"core-map.umd.js","sources":["../../../../../src/core/map/map-container-directive.ts","../../../../../src/core/map/map.ts","../../../../../src/core/map/map-module.ts","../../../../../src/core/map/public-api.ts","../../../../../src/core/map/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Directive, ElementRef} from '@angular/core';\n\n@Directive({selector: '[mapContainer]'})\nexport class AjfMapContainerDirective {\n  get htmlElement(): HTMLElement {\n    return this._el.nativeElement;\n  }\n\n  constructor(private _el: ElementRef) {}\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  Input,\n  OnDestroy,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport {map, Map, tileLayer} from 'leaflet';\nimport {Subscription} from 'rxjs';\n\nimport {AjfMapContainerDirective} from './map-container-directive';\n\n@Component({\n  selector: 'ajf-map',\n  templateUrl: 'map.html',\n  styleUrls: ['map.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class AjfMapComponent implements AfterViewInit, OnDestroy {\n  @ViewChild(AjfMapContainerDirective, {static: true}) mapContainer: AjfMapContainerDirective;\n\n  private _coordinate: number[];\n  @Input()\n  set coordinate(coordinate: number[]) {\n    this._coordinate = coordinate.slice(0);\n    this._setMapView();\n  }\n\n  private _tileLayer: string;\n  @Input()\n  set tileLayer(tl: string) {\n    this._tileLayer = tl;\n    this._addTileLayerToMap();\n  }\n\n  private _attribution: string;\n  @Input()\n  set attribution(attribution: string) {\n    this._attribution = attribution;\n    this._addTileLayerToMap();\n  }\n\n  private _disabled: boolean;\n  @Input()\n  set disabled(disabled: boolean) {\n    this._disabled = disabled;\n    this._disableMap();\n  }\n\n  private _map: Map;\n  get map(): Map {\n    return this._map;\n  }\n\n  private _columnWidthChanged: Subscription = Subscription.EMPTY;\n\n  ngAfterViewInit(): void {\n    if (this.mapContainer) {\n      this._initMap();\n      this._setMapView();\n      this._addTileLayerToMap();\n      this._disableMap();\n    }\n  }\n\n  redraw() {\n    if (this.mapContainer && this._map) {\n      this._map.invalidateSize();\n    }\n  }\n\n  ngOnDestroy() {\n    this._columnWidthChanged.unsubscribe();\n  }\n\n  private _initMap(): void {\n    const options = {zoomControl: false, attributionControl: false};\n\n    this._map = map(this.mapContainer.htmlElement, options);\n  }\n\n  private _setMapView(): void {\n    if (this._map == null) {\n      return;\n    }\n\n    let x, y, z;\n    if (this._coordinate != null && this._coordinate.length === 3) {\n      x = this._coordinate[0];\n      y = this._coordinate[1];\n      z = this._coordinate[2];\n    } else {\n      x = 0;\n      y = 0;\n      z = 14;\n    }\n    this._map.setView([x, y], z);\n  }\n\n  private _addTileLayerToMap(): void {\n    if (this._map == null || this._tileLayer == null) {\n      return;\n    }\n    this._map.eachLayer((l) => this._map.removeLayer(l));\n    tileLayer(this._tileLayer, {attribution: this._attribution}).addTo(this._map);\n  }\n\n  private _disableMap(): void {\n    if (this._map == null) {\n      return;\n    }\n\n    if (this._disabled) {\n      this._map.dragging.disable();\n      this._map.touchZoom.disable();\n      this._map.doubleClickZoom.disable();\n      this._map.scrollWheelZoom.disable();\n      this._map.boxZoom.disable();\n      this._map.keyboard.disable();\n      if (this._map.tap) {\n        this._map.tap.disable();\n      }\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {AjfMapComponent} from './map';\nimport {AjfMapContainerDirective} from './map-container-directive';\n\n@NgModule({\n  declarations: [\n    AjfMapComponent,\n    AjfMapContainerDirective,\n  ],\n  exports: [\n    AjfMapComponent,\n  ],\n})\nexport class AjfMapModule {\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport * from './map-module';\nexport * from './map';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {AjfMapContainerDirective as Éµgc_ajf_src_core_map_map_a} from './map-container-directive';"],"names":["Directive","ElementRef","Subscription","map","tileLayer","Component","ChangeDetectionStrategy","ViewEncapsulation","ViewChild","Input","NgModule"],"mappings":"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"}