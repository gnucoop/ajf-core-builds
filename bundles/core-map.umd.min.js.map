{"version":3,"file":"core-map.umd.min.js","sources":["../../src/core/map/map-container-directive.ts","../../src/core/map/map.ts","../../src/core/map/map-module.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ElementRef, Directive} from '@angular/core';\n\n@Directive({\n  selector: '[mapContainer]'\n})\nexport class AjfMapContainerDirective {\n  get htmlElement(): HTMLElement { return this._el.nativeElement; }\n\n  constructor(private _el: ElementRef) { }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AfterViewInit, ChangeDetectionStrategy, Component, Input,\n  OnDestroy, ViewChild, ViewEncapsulation\n} from '@angular/core';\n\nimport {Subscription} from 'rxjs';\n\nimport * as L from 'leaflet';\n\nimport {AjfMapContainerDirective} from './map-container-directive';\n\n@Component({\n  moduleId: module.id,\n  selector: 'ajf-map',\n  templateUrl: 'map.html',\n  styleUrls: ['map.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class AjfMapComponent implements AfterViewInit, OnDestroy {\n  @ViewChild(AjfMapContainerDirective) mapContainer: AjfMapContainerDirective;\n\n  private _coordinate: number[];\n  @Input() set coordinate(coordinate: number[]) {\n    this._coordinate = coordinate.slice(0);\n    this._setMapView();\n  }\n\n  private _tileLayer: string;\n  @Input() set tileLayer(tileLayer: string) {\n    this._tileLayer = tileLayer;\n    this._addTileLayerToMap();\n  }\n\n  private _attribution: string;\n  @Input() set attribution(attribution: string) {\n    this._attribution = attribution;\n    this._addTileLayerToMap();\n  }\n\n  private _disabled: boolean;\n  @Input() set disabled(disabled: boolean) {\n    this._disabled = disabled;\n    this._disableMap();\n  }\n\n\n  private _map: L.Map;\n  get map(): L.Map { return this._map; }\n\n  private _columnWidthChanged: Subscription = Subscription.EMPTY;\n\n  ngAfterViewInit(): void {\n    if (this.mapContainer) {\n      this._initMap();\n      this._setMapView();\n      this._addTileLayerToMap();\n      this._disableMap();\n    }\n  }\n\n  redraw() {\n    if (this.mapContainer && this._map) {\n      this._map.invalidateSize();\n    }\n  }\n\n  ngOnDestroy() {\n    this._columnWidthChanged.unsubscribe();\n  }\n\n  private _initMap(): void {\n    const options = {\n      zoomControl: false,\n      attributionControl: false\n    };\n\n    this._map = L.map(this.mapContainer.htmlElement, options);\n  }\n\n  private _setMapView(): void {\n    if (this._map == null) { return; }\n\n    let x, y, z;\n    if (this._coordinate != null && this._coordinate.length === 3) {\n      x = this._coordinate[0];\n      y = this._coordinate[1];\n      z = this._coordinate[2];\n    } else {\n      x = 0;\n      y = 0;\n      z = 14;\n    }\n    this._map.setView([x, y], z);\n  }\n\n  private _addTileLayerToMap(): void {\n    if (this._map == null || this._tileLayer == null) { return; }\n    this._map.eachLayer((l) => this._map.removeLayer(l));\n    L.tileLayer(this._tileLayer, {\n      attribution: this._attribution\n    }).addTo(this._map);\n  }\n\n  private _disableMap(): void {\n    if (this._map == null) { return; }\n\n    if (this._disabled) {\n      this._map.dragging.disable();\n      this._map.touchZoom.disable();\n      this._map.doubleClickZoom.disable();\n      this._map.scrollWheelZoom.disable();\n      this._map.boxZoom.disable();\n      this._map.keyboard.disable();\n      if (this._map.tap) {\n        this._map.tap.disable();\n      }\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {AjfMapContainerDirective} from './map-container-directive';\nimport {AjfMapComponent} from './map';\n\n@NgModule({\n  declarations: [\n    AjfMapComponent,\n    AjfMapContainerDirective\n  ],\n  exports: [\n    AjfMapComponent\n  ]\n})\nexport class AjfMapModule { }\n"],"names":["AjfMapContainerDirective","_el","this","Object","defineProperty","prototype","nativeElement","type","Directive","args","selector","ElementRef","AjfMapComponent","_columnWidthChanged","Subscription","EMPTY","coordinate","_coordinate","slice","_setMapView","tileLayer","_tileLayer","_addTileLayerToMap","attribution","_attribution","disabled","_disabled","_disableMap","_map","ngAfterViewInit","mapContainer","_initMap","redraw","invalidateSize","ngOnDestroy","unsubscribe","L.map","map","htmlElement","zoomControl","attributionControl","x","y","z","length","setView","_this","eachLayer","l","removeLayer","L.tileLayer","addTo","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard","tap","Component","template","styles","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","propDecorators","Input","AjfMapModule","NgModule","declarations","exports"],"mappings":"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"}