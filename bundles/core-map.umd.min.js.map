{"version":3,"file":"core-map.umd.min.js","sources":["../../src/core/map/map-container-directive.ts","../../src/core/map/map.ts","../../src/core/map/map-module.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ElementRef, Directive} from '@angular/core';\n\n@Directive({\n  selector: '[mapContainer]'\n})\nexport class AjfMapContainerDirective {\n  get htmlElement(): HTMLElement { return this._el.nativeElement; }\n\n  constructor(private _el: ElementRef) { }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AfterViewInit, ChangeDetectionStrategy, Component, Input,\n  OnDestroy, ViewChild, ViewEncapsulation\n} from '@angular/core';\n\nimport {Subscription} from 'rxjs';\n\nimport * as L from 'leaflet';\n\nimport {AjfMapContainerDirective} from './map-container-directive';\n\n@Component({\n  moduleId: module.id,\n  selector: 'ajf-map',\n  templateUrl: 'map.html',\n  styleUrls: ['map.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class AjfMapComponent implements AfterViewInit, OnDestroy {\n  @ViewChild(AjfMapContainerDirective, {static: true}) mapContainer: AjfMapContainerDirective;\n\n  private _coordinate: number[];\n  @Input() set coordinate(coordinate: number[]) {\n    this._coordinate = coordinate.slice(0);\n    this._setMapView();\n  }\n\n  private _tileLayer: string;\n  @Input() set tileLayer(tileLayer: string) {\n    this._tileLayer = tileLayer;\n    this._addTileLayerToMap();\n  }\n\n  private _attribution: string;\n  @Input() set attribution(attribution: string) {\n    this._attribution = attribution;\n    this._addTileLayerToMap();\n  }\n\n  private _disabled: boolean;\n  @Input() set disabled(disabled: boolean) {\n    this._disabled = disabled;\n    this._disableMap();\n  }\n\n\n  private _map: L.Map;\n  get map(): L.Map { return this._map; }\n\n  private _columnWidthChanged: Subscription = Subscription.EMPTY;\n\n  ngAfterViewInit(): void {\n    if (this.mapContainer) {\n      this._initMap();\n      this._setMapView();\n      this._addTileLayerToMap();\n      this._disableMap();\n    }\n  }\n\n  redraw() {\n    if (this.mapContainer && this._map) {\n      this._map.invalidateSize();\n    }\n  }\n\n  ngOnDestroy() {\n    this._columnWidthChanged.unsubscribe();\n  }\n\n  private _initMap(): void {\n    const options = {\n      zoomControl: false,\n      attributionControl: false\n    };\n\n    this._map = L.map(this.mapContainer.htmlElement, options);\n  }\n\n  private _setMapView(): void {\n    if (this._map == null) { return; }\n\n    let x, y, z;\n    if (this._coordinate != null && this._coordinate.length === 3) {\n      x = this._coordinate[0];\n      y = this._coordinate[1];\n      z = this._coordinate[2];\n    } else {\n      x = 0;\n      y = 0;\n      z = 14;\n    }\n    this._map.setView([x, y], z);\n  }\n\n  private _addTileLayerToMap(): void {\n    if (this._map == null || this._tileLayer == null) { return; }\n    this._map.eachLayer((l) => this._map.removeLayer(l));\n    L.tileLayer(this._tileLayer, {\n      attribution: this._attribution\n    }).addTo(this._map);\n  }\n\n  private _disableMap(): void {\n    if (this._map == null) { return; }\n\n    if (this._disabled) {\n      this._map.dragging.disable();\n      this._map.touchZoom.disable();\n      this._map.doubleClickZoom.disable();\n      this._map.scrollWheelZoom.disable();\n      this._map.boxZoom.disable();\n      this._map.keyboard.disable();\n      if (this._map.tap) {\n        this._map.tap.disable();\n      }\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {AjfMapContainerDirective} from './map-container-directive';\nimport {AjfMapComponent} from './map';\n\n@NgModule({\n  declarations: [\n    AjfMapComponent,\n    AjfMapContainerDirective\n  ],\n  exports: [\n    AjfMapComponent\n  ]\n})\nexport class AjfMapModule { }\n"],"names":["AjfMapContainerDirective","Object","defineProperty","prototype","this","_el","nativeElement","type","Directive","args","selector","ElementRef","AjfMapComponent","coordinate","_coordinate","slice","_setMapView","tileLayer","_tileLayer","_addTileLayerToMap","attribution","_attribution","disabled","_disabled","_disableMap","_map","ngAfterViewInit","mapContainer","_initMap","redraw","invalidateSize","ngOnDestroy","_columnWidthChanged","unsubscribe","L.map","map","htmlElement","zoomControl","attributionControl","x","y","z","length","setView","_this","eachLayer","l","removeLayer","L.tileLayer","addTo","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard","tap","Component","template","styles","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","propDecorators","Input","Subscription","EMPTY","AjfMapModule","NgModule","declarations","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;mYAwBA,IAAAA,GAIEC,OAAFC,eAAMF,EAANG,UAAA,cAAA,KAAE,WAAiC,OAAOC,KAAKC,IAAIC,6DAJnD,CAAAC,KAACC,EAADA,UAAAC,KAAA,CAAW,CACTC,SAAU,wDAHZ,CAAAH,KAAQI,EAARA,cASAX,GADE,SAAFA,EAAsBK,GAAAD,KAAtBC,IAAsBA,ECGtB,IAAAO,GAYEX,OAAFC,eAAeU,EAAfT,UAAA,aAAA,KAAE,SAAwBU,GACtBT,KAAKU,YAAcD,EAAWE,MAAM,GACpCX,KAAKY,+CAIPf,OAAFC,eAAeU,EAAfT,UAAA,YAAA,KAAE,SAAuBc,GACrBb,KAAKc,WAAaD,EAClBb,KAAKe,sDAIPlB,OAAFC,eAAeU,EAAfT,UAAA,cAAA,KAAE,SAAyBiB,GACvBhB,KAAKiB,aAAeD,EACpBhB,KAAKe,sDAIPlB,OAAFC,eAAeU,EAAfT,UAAA,WAAA,KAAE,SAAsBmB,GACpBlB,KAAKmB,UAAYD,EACjBlB,KAAKoB,+CAKPvB,OAAFC,eAAMU,EAANT,UAAA,MAAA,KAAE,WAAmB,OAAOC,KAAKqB,sCAI/Bb,EAAFT,UAAAuB,gBAAE,WACMtB,KAAKuB,eACPvB,KAAKwB,WACLxB,KAAKY,cACLZ,KAAKe,qBACLf,KAAKoB,gBAITZ,EAAFT,UAAA0B,OAAE,WACMzB,KAAKuB,cAAgBvB,KAAKqB,MAC5BrB,KAAKqB,KAAKK,kBAIdlB,EAAFT,UAAA4B,YAAE,WACE3B,KAAK4B,oBAAoBC,eAGnBrB,EAAVT,UAAAyB,SAAE,WAMExB,KAAKqB,KAAOS,EAAhBC,IAAsB/B,KAAKuB,aAAaS,YALpB,CACdC,aAAa,EACbC,oBAAoB,KAMhB1B,EAAVT,UAAAa,YAAE,WAGF,IAAQuB,EAAGC,EAAGC,EAFO,MAAbrC,KAAKqB,OAMPgB,EAHsB,MAApBrC,KAAKU,aAAmD,IAA5BV,KAAKU,YAAY4B,QAC/CH,EAAInC,KAAKU,YAAY,GACrB0B,EAAIpC,KAAKU,YAAY,GACjBV,KAAKU,YAAY,KAGrB0B,EADAD,EAAI,EAEA,IAENnC,KAAKqB,KAAKkB,QAAQ,CAACJ,EAAGC,GAAIC,KAGpB7B,EAAVT,UAAAgB,mBAAE,WAAA,IAAFyB,EAAAxC,KACqB,MAAbA,KAAKqB,MAAmC,MAAnBrB,KAAKc,aAC9Bd,KAAKqB,KAAKoB,UAAd,SAAyBC,GAAM,OAAAF,EAAKnB,KAAKsB,YAAYD,KACjDE,EAAJA,UAAgB5C,KAAKc,WAAY,CAC3BE,YAAahB,KAAKiB,eACjB4B,MAAM7C,KAAKqB,QAGRb,EAAVT,UAAAqB,YAAE,WACmB,MAAbpB,KAAKqB,MAELrB,KAAKmB,YACPnB,KAAKqB,KAAKyB,SAASC,UACnB/C,KAAKqB,KAAK2B,UAAUD,UACpB/C,KAAKqB,KAAK4B,gBAAgBF,UAC1B/C,KAAKqB,KAAK6B,gBAAgBH,UAC1B/C,KAAKqB,KAAK8B,QAAQJ,UAClB/C,KAAKqB,KAAK+B,SAASL,UACf/C,KAAKqB,KAAKgC,KACZrD,KAAKqB,KAAKgC,IAAIN,0BAxGtB,CAAA5C,KAACmD,EAADA,UAAAjD,KAAA,CAAW,CAAXC,SAAA,UACEiD,SAAU,2BACVC,OAAQ,CAAV,0IACEC,gBAAFC,EAAAA,wBAAAC,OACEC,cAAFC,EAAAA,kBAAAC,SAGAtD,EAAAuD,eAAA,oFAEAlD,UAAA,CAAA,CAAAV,KAAA6D,EAAAA,QAGAhD,YAAA,CAAA,CAAAb,KAAA6D,EAAAA,QAMA9C,SAAA,CAAA,CAAAf,KAAA6D,EAAAA,SAYAxD,GA9BA,SAAAA,IAuCUR,KAAV4B,oBAA8CqC,EAA9CA,aAA2DC,MC7C3D,IAAAC,iBAAA,CAAAhE,KAACiE,EAADA,SAAA/D,KAAA,CAAU,CACRgE,aAAc,CACZ7D,EACAZ,GAEF0E,QAAS,CACP9D,OAGJ2D,GATA,SAAAA"}