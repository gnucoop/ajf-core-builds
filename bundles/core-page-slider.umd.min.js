!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("css-element-queries"),require("rxjs"),require("rxjs/operators"),require("@angular/cdk/coercion"),require("@angular/animations")):"function"==typeof define&&define.amd?define("@ajf/core/page-slider",["exports","@angular/core","css-element-queries","rxjs","rxjs/operators","@angular/cdk/coercion","@angular/animations"],e):e(((t=t||self).ajf=t.ajf||{},t.ajf.core=t.ajf.core||{},t.ajf.core.pageSlider={}),t.ng.core,t.cssElementQueries,t.rxjs,t.rxjs.operators,t.ng.cdk.coercion,t.ng.animations)}(this,(function(t,e,i,r,n,o,s){"use strict";
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var a=function(){function t(t,o){var s=this;this._el=t,this._renderer=o,this._scrollEvt=new e.EventEmitter,this.scroll=this._scrollEvt.asObservable(),this._scrollX=0,this._scrollY=0,this._resizeEvent=new e.EventEmitter,this._resizeSub=r.Subscription.EMPTY,this._resizeSensor=new i.ResizeSensor(t.nativeElement,(function(){return s._onResize()})),this._resizeSub=this._resizeEvent.pipe(n.debounceTime(300)).subscribe((function(){return s._fixScrollOnResize()}))}return t.prototype.ngOnDestroy=function(){this._resizeSensor&&this._resizeSensor.detach(),this._resizeSub.unsubscribe(),this._resizeEvent.complete()},t.prototype.setScroll=function(t,e,i){if(null==this._el||null==this.wrapper||0===e)return!1;var r,n,o,s=this._el.nativeElement,a=this.wrapper.nativeElement;"x"===t?(r=s.clientWidth,n=a.clientWidth,o=this._scrollX):(r=s.clientHeight,n=a.clientHeight,o=this._scrollY);var l=r-n;return!(n<=r||o===l&&e<0||0===o&&e>0||(e<0?"x"===t?this._scrollX=Math.max(l,this._scrollX+e):this._scrollY=Math.max(l,this._scrollY+e):"x"===t?this._scrollX=Math.min(0,this._scrollX+e):this._scrollY=Math.min(0,this._scrollY+e),this._renderer.setStyle(a,"transform","translate("+this._scrollX+"px, "+this._scrollY+"px)"),this._scrollEvt.emit({x:this._scrollX,y:this._scrollY}),0))},t.prototype._onResize=function(){this._resizeEvent.emit()},t.prototype._fixScrollOnResize=function(){if(null!=this.content&&null!=this.wrapper){var t=this.content.nativeElement,e=this.wrapper.nativeElement,i=Math.min(0,t.clientWidth-e.clientWidth),r=Math.min(0,t.clientHeight-e.clientHeight);(0!==i||0!==r||0===i&&0!==this._scrollX||0===r&&0!==this._scrollY)&&(this._scrollX=Math.max(i,this._scrollX-(null!=t.scrollLeft?t.scrollLeft:0)),this._scrollY=Math.max(r,this._scrollY-(null!=t.scrollTop?t.scrollTop:0)),t.scrollTop=t.scrollLeft=0,this._renderer.setStyle(e,"transform","translate("+this._scrollX+"px, "+this._scrollY+"px)"),this._scrollEvt.emit({x:this._scrollX,y:this._scrollY}))}},t.decorators=[{type:e.Component,args:[{selector:"ajf-page-slider-item",template:'<div #content class="ajf-page-slider-item-content">\n  <div #wrapper class="ajf-page-slider-item-content-wrapper">\n    <ng-content></ng-content>\n  </div>\n</div>\n',changeDetection:e.ChangeDetectionStrategy.OnPush,encapsulation:e.ViewEncapsulation.None,styles:["ajf-page-slider-item{display:block;position:relative}ajf-page-slider-item .ajf-page-slider-item-content{position:absolute;top:0;right:0;bottom:0;left:0;padding:0;margin:0;display:flex;align-items:flex-start;justify-content:flex-start;overflow:hidden;box-sizing:border-box}ajf-page-slider-item .ajf-page-slider-item-content .ajf-page-slider-item-content-wrapper{flex:1 1 auto;display:flex;align-items:center;justify-content:center;min-width:100%;min-height:100%}\n"]}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2}]},t.propDecorators={wrapper:[{type:e.ViewChild,args:["wrapper",{static:!0}]}],content:[{type:e.ViewChild,args:["content",{static:!0}]}],scroll:[{type:e.Output}]},t}(),l=function(){function t(t,i,o){var s=this;this._animationBuilder=t,this._cdr=i,this._renderer=o,this._pageScrollFinish=new e.EventEmitter,this.pageScrollFinish=this._pageScrollFinish.asObservable(),this._orientationChange=new e.EventEmitter,this.orientationChange=this._orientationChange.asObservable(),this.duration=300,this._orientation="horizontal",this._fixedOrientation=!1,this._currentPage=-1,this._animating=!1,this._pagesSub=r.Subscription.EMPTY,this._mouseWheelEvt=new e.EventEmitter,this._mouseWheelSub=r.Subscription.EMPTY,this._mouseWheelSub=this._mouseWheelEvt.pipe(n.map((function(t){var e=s._getCurrentPage();return null==e?null:{evt:t,res:e.setScroll(t.dir,t.amount,0)}})),n.filter((function(t){return null!=t&&!1===t.res&&("x"===t.evt.dir&&"horizontal"===s.orientation||"y"===t.evt.dir&&"vertical"===s.orientation)})),n.map((function(t){return t.evt.amount})),n.scan((function(t,e){return 0===t?e:t/Math.abs(t)!=e/Math.abs(e)?0:t+e}),0),n.filter((function(t){return!s._animating&&Math.abs(t)>150})),n.throttleTime(1500)).subscribe((function(t){s._mouseWheelEvt.emit({dir:"x",amount:t>0?-1:1}),s.slide({dir:t>0?"back":"forward"})}))}return Object.defineProperty(t.prototype,"orientation",{get:function(){return this._orientation},set:function(t){this._orientation!==t&&(this._orientation=t,this._cdr.markForCheck(),this._updateSize(),this._restoreCurrentPage(),this._orientationChange.emit(this._orientation))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fixedOrientation",{get:function(){return this._fixedOrientation},set:function(t){this._fixedOrientation=o.coerceBooleanProperty(t),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return this._currentPage},set:function(t){null==this.pages||t<0||t>=this.pages.length||(this._currentPage=t,this._doSlide())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hideNavigationButtons",{get:function(){return this._hideNavigationButtons},set:function(t){this._hideNavigationButtons=o.coerceBooleanProperty(t),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),t.prototype.ngAfterContentInit=function(){var t=this;this._onSlidesChange(),this._pagesSub=this.pages.changes.subscribe((function(){return t._onSlidesChange()}))},t.prototype.ngOnDestroy=function(){this._pagesSub.unsubscribe(),this._mouseWheelEvt.complete(),this._mouseWheelSub.unsubscribe(),this._orientationChange.complete()},t.prototype.switchOrientation=function(){this.orientation="horizontal"===this._orientation?"vertical":"horizontal"},t.prototype.slide=function(t){null!=this.pages&&(t.dir?"back"===t.dir||"up"===t.dir||"left"===t.dir?this._slideBack():"forward"!==t.dir&&"down"!==t.dir&&"right"!==t.dir||this._slideForward():t.to&&this._slideTo(t.to))},t.prototype.onMouseWheel=function(t){var e=t;if(null!=e.deltaX&&null!=e.deltaY){var i=Math.abs(e.deltaX),r=Math.abs(e.deltaY);0===i&&0===r||this._mouseWheelEvt.emit(i>r?{dir:"x",amount:-e.deltaX}:{dir:"y",amount:-e.deltaY})}},t.prototype.onTouchStart=function(t){null==t.touches||0===t.touches.length||this._animating||(this._currentOrigin={x:t.touches[0].clientX,y:t.touches[0].clientY,time:+new Date})},t.prototype.onTouchMove=function(t){if(null!=t.touches&&0!==t.touches.length&&null!=this._currentOrigin&&!this._animating){var e={x:t.touches[0].clientX,y:t.touches[0].clientY,time:+new Date},i=this._calculateMovement(e);if(this._currentOrigin=e,0!==i.velocityX||0!==i.velocityY){var r,n=Math.abs(i.velocityX),o=Math.abs(i.velocityY);n>o?"horizontal"===this.orientation&&n>1.5&&Math.abs(i.deltaX)>50?(this._resetCurrentOrigin(),this.slide({dir:i.velocityX<0?"forward":"back"})):null!=(r=this._getCurrentPage())&&r.setScroll("x",i.deltaX,i.deltaTime):"vertical"===this.orientation&&o>1.5&&Math.abs(i.deltaY)>50?(this._resetCurrentOrigin(),this.slide({dir:i.velocityY<0?"forward":"back"})):null!=(r=this._getCurrentPage())&&r.setScroll("y",i.deltaY,i.deltaTime)}}},t.prototype.onTouchEnd=function(){this._resetCurrentOrigin()},t.prototype.isCurrentPageLong=function(){var t=this._getCurrentPage();return null!=t&&t.wrapper.nativeElement.clientHeight>t.content.nativeElement.clientHeight},t.prototype._resetCurrentOrigin=function(){this._currentOrigin=null},t.prototype._getCurrentPage=function(){return null==this.pages||this.currentPage<0||this.currentPage>=this.pages.length?null:this.pages.toArray()[this.currentPage]},t.prototype._calculateMovement=function(t){var e=t.x-this._currentOrigin.x,i=t.y-this._currentOrigin.y,r=t.time-this._currentOrigin.time;return{velocityX:e/r,deltaX:e,velocityY:i/r,deltaY:i,deltaTime:r}},t.prototype._slideBack=function(){this._currentPage<=0||(this.currentPage=this._currentPage-1)},t.prototype._slideForward=function(){this._currentPage>=this.pages.length||(this.currentPage=this._currentPage+1)},t.prototype._slideTo=function(t){t>=0&&t<this.pages.length&&(this.currentPage=t)},t.prototype._doSlide=function(t){var e=this;if(void 0===t&&(t=!1),null!=this.body&&null!=this.pages&&!this._animating){this._animating=!0;var i=this._animationBuilder.build(s.animate(t?0:this.duration,s.style({transform:this._getCurrentTranslation()}))).create(this.body.nativeElement);i.onDone((function(){e._animating=!1,e._pageScrollFinish.emit()})),i.play()}},t.prototype._getCurrentTranslation=function(){return"translate"+("vertical"===this._orientation?"Y":"X")+"(-"+(-1===this._currentPage?0:this._currentPage*(100/this.pages.length))+"%)"},t.prototype._getProps=function(){return"vertical"===this._orientation?{prop:"height",removeProp:"width"}:{prop:"width",removeProp:"height"}},t.prototype._onSlidesChange=function(){this._updateSize()},t.prototype._updateSize=function(){if(null!=this.body&&null!=this.pages){var t=this._getProps(),e=t.removeProp;this._renderer.setStyle(this.body.nativeElement,t.prop,100*this.pages.length+"%"),this._renderer.setStyle(this.body.nativeElement,e,null),this._currentPage=0===this.pages.length?-1:-1===this._currentPage?0:this._currentPage>=this.pages.length?this.pages.length-1:this._currentPage,this._restoreCurrentPage()}},t.prototype._restoreCurrentPage=function(){this._doSlide(!0)},t.decorators=[{type:e.Directive}],t.ctorParameters=function(){return[{type:s.AnimationBuilder},{type:e.ChangeDetectorRef},{type:e.Renderer2}]},t.propDecorators={body:[{type:e.ViewChild,args:["body",{static:!0}]}],pages:[{type:e.ContentChildren,args:[a,{descendants:!0}]}],pageScrollFinish:[{type:e.Output}],orientationChange:[{type:e.Output}],duration:[{type:e.Input}],orientation:[{type:e.Input}],fixedOrientation:[{type:e.Input}],currentPage:[{type:e.Input}],hideNavigationButtons:[{type:e.Input}]},t}(),h=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[a],exports:[a]}]}],t}();
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
t.AjfPageSlider=l,t.AjfPageSliderItem=a,t.AjfPageSliderModule=h,Object.defineProperty(t,"__esModule",{value:!0})}));