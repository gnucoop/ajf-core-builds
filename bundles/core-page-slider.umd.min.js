/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/operators"),require("css-element-queries"),require("@angular/animations"),require("rxjs"),require("@ajf/core/utils")):"function"==typeof define&&define.amd?define("@ajf/core/page-slider",["exports","@angular/core","rxjs/operators","css-element-queries","@angular/animations","rxjs","@ajf/core/utils"],e):e(((t=t||self).ajf=t.ajf||{},t.ajf.core=t.ajf.core||{},t.ajf.core.pageSlider={}),t.ng.core,t.rxjs.operators,t.cssElementQueries,t.ng.animations,t.rxjs,t.ajf.core.utils)}(this,function(t,n,o,r,s,a,e){"use strict";var i=(l.prototype.ngOnDestroy=function(){this._resizeSensor&&this._resizeSensor.detach(),this._resizeSub.unsubscribe(),this._resizeEvent.complete()},l.prototype.setScroll=function(t,e,i){if(null==this._el||null==this.wrapper||0===e)return!1;var r,n,o,s=this._el.nativeElement,a=this.wrapper.nativeElement;o="x"===t?(r=s.clientWidth,n=a.clientWidth,this._scrollX):(r=s.clientHeight,n=a.clientHeight,this._scrollY);var l=r-n;return!(n<=r||o===l&&e<0||0===o&&0<e||(e<0?"x"===t?this._scrollX=Math.max(l,this._scrollX+e):this._scrollY=Math.max(l,this._scrollY+e):"x"===t?this._scrollX=Math.min(0,this._scrollX+e):this._scrollY=Math.min(0,this._scrollY+e),this._renderer.setStyle(a,"transform","translate("+this._scrollX+"px, "+this._scrollY+"px)"),0))},l.prototype._onResize=function(){this._resizeEvent.emit()},l.prototype._fixScrollOnResize=function(){if(null!=this.content&&null!=this.wrapper){var t=this.content.nativeElement,e=this.wrapper.nativeElement,i=Math.min(0,t.clientWidth-e.clientWidth),r=Math.min(0,t.clientHeight-e.clientHeight);(0!==i||0!==r||0===i&&0!==this._scrollX||0===r&&0!==this._scrollY)&&(this._scrollX=Math.max(i,this._scrollX-(null!=t.scrollLeft?t.scrollLeft:0)),this._scrollY=Math.max(r,this._scrollY-(null!=t.scrollTop?t.scrollTop:0)),t.scrollTop=t.scrollLeft=0,this._renderer.setStyle(e,"transform","translate("+this._scrollX+"px, "+this._scrollY+"px)"))}},l.decorators=[{type:n.Component,args:[{selector:"ajf-page-slider-item",template:'<div #content class="ajf-page-slider-item-content"><div #wrapper class="ajf-page-slider-item-content-wrapper"><ng-content></ng-content></div></div>',styles:["ajf-page-slider-item{display:block;position:relative}ajf-page-slider-item .ajf-page-slider-item-content{position:absolute;top:0;right:0;bottom:0;left:0;padding:0;margin:0;display:flex;align-items:flex-start;justify-content:flex-start;overflow:hidden;box-sizing:border-box}ajf-page-slider-item .ajf-page-slider-item-content .ajf-page-slider-item-content-wrapper{flex:1 1 auto;display:flex;align-items:center;justify-content:center;min-width:100%;min-height:100%}"],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}]}],l.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2}]},l.propDecorators={wrapper:[{type:n.ViewChild,args:["wrapper",{static:!0}]}],content:[{type:n.ViewChild,args:["content",{static:!0}]}]},l);function l(t,e){var i=this;this._el=t,this._renderer=e,this._scrollX=0,this._scrollY=0,this._resizeEvent=new n.EventEmitter,this._resizeSensor=new r.ResizeSensor(t.nativeElement,function(){return i._onResize()}),this._resizeSub=this._resizeEvent.pipe(o.debounceTime(300)).subscribe(function(){return i._fixScrollOnResize()})}var h=(Object.defineProperty(c.prototype,"orientation",{get:function(){return this._orientation},set:function(t){this._orientation!==t&&(this._orientation=t,this._cdr.markForCheck(),this._updateSize(),this._restoreCurrentPage(),this._orientationChange.emit(this._orientation))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fixedOrientation",{get:function(){return this._fixedOrientation},set:function(t){this._fixedOrientation=e.coerceBooleanProperty(t),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"currentPage",{get:function(){return this._currentPage},set:function(t){null==this.pages||t<0||t>=this.pages.length||(this._currentPage=t,this._doSlide())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hideNavigationButtons",{get:function(){return this._hideNavigationButtons},set:function(t){this._hideNavigationButtons=e.coerceBooleanProperty(t),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),c.prototype.ngAfterContentInit=function(){var t=this;this._onSlidesChange(),this._pagesSub=this.pages.changes.subscribe(function(){return t._onSlidesChange()})},c.prototype.ngOnDestroy=function(){this._pagesSub.unsubscribe(),this._mouseWheelEvt.complete(),this._mouseWheelSub.unsubscribe(),this._orientationChange.complete()},c.prototype.switchOrientation=function(){"horizontal"===this._orientation?this.orientation="vertical":this.orientation="horizontal"},c.prototype.slide=function(t){null!=this.pages&&(t.dir?"back"===t.dir||"up"===t.dir||"left"===t.dir?this._slideBack():"forward"!==t.dir&&"down"!==t.dir&&"right"!==t.dir||this._slideForward():t.to&&this._slideTo(t.to))},c.prototype.onMouseWheel=function(t){var e=Math.abs(t.deltaX),i=Math.abs(t.deltaY);0===e&&0===i||(i<e?this._mouseWheelEvt.emit({dir:"x",amount:-t.deltaX}):this._mouseWheelEvt.emit({dir:"y",amount:-t.deltaY}))},c.prototype.onTouchStart=function(t){null==t.touches||0===t.touches.length||this._animating||(this._currentOrigin={x:t.touches[0].clientX,y:t.touches[0].clientY,time:+new Date})},c.prototype.onTouchMove=function(t){if(null!=t.touches&&0!==t.touches.length&&null!=this._currentOrigin&&!this._animating){var e={x:t.touches[0].clientX,y:t.touches[0].clientY,time:+new Date},i=this._calculateMovement(e);if(this._currentOrigin=e,0!==i.velocityX||0!==i.velocityY){var r,n=Math.abs(i.velocityX),o=Math.abs(i.velocityY);o<n?"horizontal"===this.orientation&&1.5<n&&50<Math.abs(i.deltaX)?(this._resetCurrentOrigin(),this.slide({dir:i.velocityX<0?"forward":"back"})):null!=(r=this._getCurrentPage())&&r.setScroll("x",i.deltaX,i.deltaTime):"vertical"===this.orientation&&1.5<o&&50<Math.abs(i.deltaY)?(this._resetCurrentOrigin(),this.slide({dir:i.velocityY<0?"forward":"back"})):null!=(r=this._getCurrentPage())&&r.setScroll("y",i.deltaY,i.deltaTime)}}},c.prototype.onTouchEnd=function(){this._resetCurrentOrigin()},c.prototype.isCurrentPageLong=function(){var t=this._getCurrentPage();return null!=t&&t.wrapper.nativeElement.clientHeight>t.content.nativeElement.clientHeight},c.prototype._resetCurrentOrigin=function(){this._currentOrigin=null},c.prototype._getCurrentPage=function(){return null==this.pages||this.currentPage<0||this.currentPage>=this.pages.length?null:this.pages.toArray()[this.currentPage]},c.prototype._calculateMovement=function(t){var e=t.x-this._currentOrigin.x,i=t.y-this._currentOrigin.y,r=t.time-this._currentOrigin.time;return{velocityX:e/r,deltaX:e,velocityY:i/r,deltaY:i,deltaTime:r}},c.prototype._slideBack=function(){this._currentPage<=0||(this.currentPage=this._currentPage-1)},c.prototype._slideForward=function(){this._currentPage>=this.pages.length||(this.currentPage=this._currentPage+1)},c.prototype._slideTo=function(t){0<=t&&t<this.pages.length&&(this.currentPage=t)},c.prototype._doSlide=function(t){var e=this;if(void 0===t&&(t=!1),null!=this.body&&null!=this.pages&&!this._animating){this._animating=!0;var i=this._animationBuilder.build(s.animate(t?0:this.duration,s.style({transform:this._getCurrentTranslation()}))).create(this.body.nativeElement);i.onDone(function(){e._animating=!1,e._pageScrollFinish.emit()}),i.play()}},c.prototype._getCurrentTranslation=function(){var t=100/this.pages.length,e=-1===this._currentPage?0:this._currentPage*t;return"translate"+("vertical"===this._orientation?"Y":"X")+"(-"+e+"%)"},c.prototype._getProps=function(){return"vertical"===this._orientation?{prop:"height",removeProp:"width"}:{prop:"width",removeProp:"height"}},c.prototype._onSlidesChange=function(){this._updateSize()},c.prototype._updateSize=function(){if(null!=this.body&&null!=this.pages){var t,e=this._getProps(),i=e.prop,r=e.removeProp;this._renderer.setStyle(this.body.nativeElement,i,100*this.pages.length+"%"),this._renderer.setStyle(this.body.nativeElement,r,null),t=0===this.pages.length?-1:-1===this._currentPage?0:this._currentPage>=this.pages.length?this.pages.length-1:this._currentPage,this._currentPage=t,this._restoreCurrentPage()}},c.prototype._restoreCurrentPage=function(){this._doSlide(!0)},c);function c(t,e,i){var r=this;this._animationBuilder=t,this._cdr=e,this._renderer=i,this._pageScrollFinish=new n.EventEmitter,this.pageScrollFinish=this._pageScrollFinish.asObservable(),this._orientationChange=new n.EventEmitter,this.orientationChange=this._orientationChange.asObservable(),this.duration=300,this._orientation="horizontal",this._fixedOrientation=!1,this._currentPage=-1,this._animating=!1,this._pagesSub=a.Subscription.EMPTY,this._mouseWheelEvt=new n.EventEmitter,this._mouseWheelSub=a.Subscription.EMPTY,this._mouseWheelSub=this._mouseWheelEvt.pipe(o.map(function(t){var e=r._getCurrentPage();return null==e?null:{evt:t,res:e.setScroll(t.dir,t.amount,0)}}),o.filter(function(t){return null!=t&&!1===t.res&&("x"===t.evt.dir&&"horizontal"===r.orientation||"y"===t.evt.dir&&"vertical"===r.orientation)}),o.map(function(t){return t.evt.amount}),o.scan(function(t,e){return 0===t?e:t/Math.abs(t)!=e/Math.abs(e)?0:t+e},0),o.filter(function(t){return!r._animating&&150<Math.abs(t)}),o.throttleTime(1500)).subscribe(function(t){r._mouseWheelEvt.emit({dir:"x",amount:0<t?-1:1}),r.slide({dir:0<t?"back":"forward"})})}var u=(p.decorators=[{type:n.NgModule,args:[{declarations:[i],exports:[i]}]}],p);function p(){}t.AjfPageSlider=h,t.AjfPageSliderItem=i,t.AjfPageSliderModule=u,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=core-page-slider.umd.min.js.map
