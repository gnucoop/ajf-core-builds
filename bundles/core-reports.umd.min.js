!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("tslib"),require("@ajf/core/models"),require("@ajf/core/utils")):"function"==typeof define&&define.amd?define("@ajf/core/reports",["exports","@angular/core","tslib","@ajf/core/models","@ajf/core/utils"],t):t(((e=e||self).ajf=e.ajf||{},e.ajf.core=e.ajf.core||{},e.ajf.core.reports={}),e.ng.core,e.tslib,e.ng.core.models,e.ng.core.utils)}(this,(function(e,t,n,r,a){"use strict";
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var i,o=function(){function e(e,t){this._cdr=e,this.el=t}return Object.defineProperty(e.prototype,"instance",{get:function(){return this._instance},set:function(e){this._instance!==e&&(this._instance=e,this._cdr.detectChanges())},enumerable:!0,configurable:!0}),e}();
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function s(t){switch(t){case e.AjfChartType.Line:return"line";case e.AjfChartType.Bar:return"bar";case e.AjfChartType.HorizontalBar:return"horizontalBar";case e.AjfChartType.Radar:return"radar";case e.AjfChartType.Scatter:return"scatter";case e.AjfChartType.Doughnut:return"doughnut";case e.AjfChartType.Pie:return"pie";case e.AjfChartType.PolarArea:return"polarArea";case e.AjfChartType.Bubble:return"bubble";default:return"line"}}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */(i=e.AjfChartType||(e.AjfChartType={}))[i.Line=0]="Line",i[i.Bar=1]="Bar",i[i.HorizontalBar=2]="HorizontalBar",i[i.Radar=3]="Radar",i[i.Scatter=4]="Scatter",i[i.Doughnut=5]="Doughnut",i[i.Pie=6]="Pie",i[i.PolarArea=7]="PolarArea",i[i.Bubble=8]="Bubble",i[i.LENGTH=9]="LENGTH";var u,l,f=function(){function e(){}return e.prototype.transform=function(e,t){return t>=0&&t<e.content.length?e.content[t]:null},e.decorators=[{type:t.Pipe,args:[{name:"ajfGetColumnContent"}]}],e}();
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */(u=e.AjfAggregationType||(e.AjfAggregationType={}))[u.None=0]="None",u[u.Sum=1]="Sum",u[u.Average=2]="Average",u[u.WeightedAverage=3]="WeightedAverage",u[u.LENGTH=4]="LENGTH",(
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
l=e.AjfWidgetType||(e.AjfWidgetType={}))[l.Layout=0]="Layout",l[l.PageBreak=1]="PageBreak",l[l.Image=2]="Image",l[l.Text=3]="Text",l[l.Chart=4]="Chart",l[l.Table=5]="Table",l[l.Map=6]="Map",l[l.Column=7]="Column",l[l.Formula=8]="Formula",l[l.ImageContainer=9]="ImageContainer",l[l.LENGTH=10]="LENGTH";
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var c=function(){function e(e){this._cdr=e}return Object.defineProperty(e.prototype,"instance",{get:function(){return this._instance},set:function(e){this._instance=e,this._report=null!=e?e.report:null,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),e.decorators=[{type:t.Directive}],e.ctorParameters=function(){return[{type:t.ChangeDetectorRef}]},e.propDecorators={instance:[{type:t.Input}]},e}(),g=function(){function e(e){this.viewContainerRef=e}return e.decorators=[{type:t.Directive,args:[{selector:"[ajf-widget-host]"}]}],e.ctorParameters=function(){return[{type:t.ViewContainerRef}]},e}(),p=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[f,g],exports:[f,g]}]}],e}();
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function d(t){return n.__assign(n.__assign({},t),{aggregation:t.aggregation||e.AjfAggregationType.None})}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var y=function(){function e(){}return e.fromJson=function(e){if(null==e.aggregation)throw new Error("Malformed aggregation");return d(n.__assign(n.__assign({},e),{aggregation:e.aggregation}))},e}(),m=function(){function t(){}return t.fromJson=function(t){if(null==t.formula||null==t.aggregation||null==t.label)throw new Error("Malformed dataset");return t.formula=t.formula instanceof Array?t.formula=t.formula.map((function(e){return r.AjfFormulaSerializer.fromJson(e)})):r.AjfFormulaSerializer.fromJson(t.formula),t.aggregation=y.fromJson(t.aggregation),
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function a(t){return n.__assign(n.__assign({},t),{aggregation:t.aggregation||d({aggregation:e.AjfAggregationType.None})})}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */(t)},t}();
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function h(e){return n.__assign(n.__assign({},e),{styles:e.styles||{},visibility:e.visibility||r.alwaysCondition()})}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var _=function(){function t(){}return t.fromJson=function(n){if(null==n.widgetType)throw new Error("Malformed widget");n.visibility=n.visibility?r.AjfConditionSerializer.fromJson(n.visibility):r.alwaysCondition(),n.styles=n.styles||{};var a=n;if(a.widgetType===e.AjfWidgetType.Layout||a.widgetType===e.AjfWidgetType.Column)return t._widgetWithContentFromJson(a);if(a.widgetType===e.AjfWidgetType.Chart||a.widgetType===e.AjfWidgetType.Table){var i=t._dataWidgetFromJson(a);if(a.widgetType===e.AjfWidgetType.Chart){var o=i;o.labels instanceof Array?o.labels.map((function(e){return r.AjfFormulaSerializer.fromJson(e)})):null!=o.labels&&(o.labels=r.AjfFormulaSerializer.fromJson(o.labels))}return i}return a.widgetType===e.AjfWidgetType.Map&&(a.coordinate=r.AjfFormulaSerializer.fromJson(a.coordinate)),a},t._dataWidgetFromJson=function(t){var r=t.dataset?t.dataset.map(t.widgetType===e.AjfWidgetType.Table?function(e){return e.map((function(e){return m.fromJson(e)}))}:function(e){return m.fromJson(e)}):[];return n.__assign(n.__assign({},h(t)),{dataset:r})},t._widgetWithContentFromJson=function(e){var r=(e.content||[]).map((function(e){return t.fromJson(e)}));return n.__assign(n.__assign({},h(e)),{content:r})},t}(),v=function(){function e(){}return e.fromJson=function(e){return e.content=(e.content||[]).map((function(e){return _.fromJson(e)})),n.__assign(n.__assign({},e),{content:e.content,styles:e.styles||{}})},e}(),A=function(){function e(){}return e.fromJson=function(e){return["header","footer","content"].forEach((function(t){e[t]&&(e[t]=v.fromJson(e[t]))})),
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function t(e){return n.__assign({},e)}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */(e)},e}(),T=function(){function e(e,t){this._cfr=e,this._renderer=t,this._init=!1}return Object.defineProperty(e.prototype,"instance",{get:function(){return this._instance},set:function(e){this._instance!==e&&(this._instance=e,this._init&&this._loadComponent())},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this._init=!0,this._loadComponent()},e.prototype._loadComponent=function(){var e=this;if(this._init&&null!=this._instance&&null!=this.widgetHost&&this.instance.visible){var t=this.widgetHost.viewContainerRef;t.clear();var n=this.widgetsMap[this._instance.widget.widgetType];if(null!=n){var r=n.component;try{var a=this._cfr.resolveComponentFactory(r),i=t.createComponent(a).instance;Object.keys(this._instance.widget.styles).forEach((function(t){try{e._renderer.setStyle(i.el.nativeElement,t,""+e._instance.widget.styles[t])}catch(e){}})),i.instance=this._instance,n.inputs&&Object.keys(n.inputs).forEach((function(e){e in i&&(i[e]=n.inputs[e])}))}catch(e){}}}},e.decorators=[{type:t.Directive}],e.ctorParameters=function(){return[{type:t.ComponentFactoryResolver},{type:t.Renderer2}]},e.propDecorators={widgetHost:[{type:t.ViewChild,args:[g,{static:!0}]}],instance:[{type:t.Input}]},e}();
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function j(t,n,a){var i=n.map((function(e){return r.evaluateExpression(e.formula,a)}));switch(t.aggregation){case e.AjfAggregationType.None:if(1!==i.length)throw new Error("Invalid aggregation");return i[0];case e.AjfAggregationType.Sum:return i.map((function(e){return e.reduce((function(e,t){return e+t}),0)}));case e.AjfAggregationType.Average:case e.AjfAggregationType.WeightedAverage:return i.map((function(e){return e.reduce((function(e,t){return e+t}),0)/i.length}));default:return[]}}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function b(e,t,n){return{widget:e,widgetType:e.widgetType,visible:r.evaluateExpression(e.visibility.condition,t),styles:e.styles||{}}}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function w(t,i,o){var u=b(t,i);if(t.widgetType===e.AjfWidgetType.Column||t.widgetType===e.AjfWidgetType.Layout){var l=t,f=u,c=[];l.content.forEach((function(e){if(null!=l.repetitions){if(f.repetitions=r.evaluateExpression(l.repetitions.formula,i),"number"==typeof f.repetitions&&f.repetitions>0)for(var t=0;t<f.repetitions;t++)c.push(w(e,n.__assign(n.__assign({},i),{$repetition:t}),o))}else c.push(w(e,i,o));f.content=c}))}else if(t.widgetType===e.AjfWidgetType.Chart){var g=t,p=u,d=(g.labels instanceof Array?g.labels:[g.labels]).map((function(e){var t=r.evaluateExpression(e.formula,i);try{t=t instanceof Array?t.map((function(e){return null!=e&&"string"==typeof e&&e.trim().length>0?o.instant(e):e})):null!=t&&"string"==typeof t&&t.trim().length>0?o.instant(t):t}catch(e){}return t}));if(p.labels=g.labels instanceof Array?d:d[0],p.datasets=g.dataset.map((function(e){var t=n.__assign(n.__assign({},e.options||{}),{data:j(e.aggregation,e.formula,i)});if(null!=e.chartType){var r=s(e.chartType);t=n.__assign(n.__assign({},t),{chartType:r,type:r})}return null!=e.options&&(t=n.__assign(n.__assign({},t),{options:e.options})),null!=e.label&&(t=n.__assign(n.__assign({},t),{label:e.label})),null!=e.datalabels&&(t.datalabels=a.deepCopy(e.datalabels)),t})),p.data={labels:p.labels,datasets:p.datasets},p.chartType=s(g.type||g.chartType),null!=g.options&&null!=g.options.plugins){var y=g.options.plugins;Object.keys(y).forEach((function(e){var t=y[e];Object.keys(t).forEach((function(e){var n=t[e];"string"!=typeof n&&null!=n&&null!=n.formula&&(t[e]=r.evaluateExpression(n.formula,i))}))}))}}else if(t.widgetType===e.AjfWidgetType.Table){var m=t,h=u,_=function(e){var t=e.formula;if('"'===t.substr(0,1)){var n=t.slice(1,-1),a=null!=n&&"string"==typeof n&&n.trim().length>0?o.instant(n):n;n.length>0&&(t='"'+a+'"')}else t=null!=t&&"string"==typeof t&&t.trim().length>0?o.instant(t):t;return r.evaluateExpression(t,i)};h.dataset=m.dataset.map((function(e){return e.map((function(e){return e.formula instanceof Array?e.formula.map((function(e){return _(e)})):_(e.formula)}))})),h.data=(m.dataset||[]).map((function(e){return e.map((function(e){return{value:r.evaluateExpression(e.formula.formula,i),style:n.__assign(n.__assign({},m.cellStyles),e.style),rowspan:e.rowspan,colspan:e.colspan}}))}))}else if(t.widgetType===e.AjfWidgetType.Image){var v=t,A=u;v.flag&&(A.flag=r.evaluateExpression(v.flag.formula,i)),v.icon&&(A.icon=r.evaluateExpression(v.icon.formula,i)),v.url&&(A.url=r.evaluateExpression(v.url.formula,i))}else if(t.widgetType===e.AjfWidgetType.ImageContainer){var T=t,C=u;T.flags&&(C.flags=T.flags instanceof Array?T.flags.map((function(e){return r.evaluateExpression(e.formula,i)})):r.evaluateExpression(T.flags.formula,i)),T.icons&&(C.icons=T.icons instanceof Array?T.icons.map((function(e){return r.evaluateExpression(e.formula,i)})):r.evaluateExpression(T.icons.formula,i)),T.urls&&(C.urls=T.urls instanceof Array?T.urls.map((function(e){return r.evaluateExpression(e.formula,i)})):r.evaluateExpression(T.urls.formula,i))}else if(t.widgetType===e.AjfWidgetType.Text){for(var E=u,x=/\[{2}(.+?)\]{2}/g,W=[],J=void 0,S=t.htmlText;J=x.exec(S);){var P=J.index,F=J[0].length,R=r.createFormula({formula:J[1]});W.push({idx:P,len:F,formula:R})}W.reverse().forEach((function(e){var t;try{t=r.evaluateExpression(e.formula.formula,i)}catch(e){t=""}S=""+S.substr(0,e.idx)+t+S.substr(e.idx+e.len)})),E.htmlText=null!=S&&S.length>0?o.instant(S):S}else t.widgetType===e.AjfWidgetType.Formula?u.formula=r.evaluateExpression(t.formula.formula,i):t.widgetType===e.AjfWidgetType.Map&&(u.coordinate=r.evaluateExpression(t.coordinate.formula,i));return u}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function C(e,t,n){var r=e.content.map((function(e){return w(e,t,n)}));return{container:e,content:r,styles:e.styles}}
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) 2018 Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
e.AjfAggregationSerializer=y,e.AjfBaseWidgetComponent=o,e.AjfDatasetSerializer=m,e.AjfGetColumnContentPipe=f,e.AjfReportContainerSerializer=v,e.AjfReportRenderer=c,e.AjfReportSerializer=A,e.AjfReportWidget=T,e.AjfReportsModule=p,e.AjfWidgetHost=g,e.AjfWidgetSerializer=_,e.chartToChartJsType=s,e.createAggregation=d,e.createReportInstance=function E(e,t,n){return(e.variables||[]).forEach((function(e){t[e.name]=r.evaluateExpression(e.formula.formula,t)})),{report:e,header:e.header?C(e.header,t,n):void 0,content:e.content?C(e.content,t,n):void 0,footer:e.footer?C(e.footer,t,n):void 0,styles:e.styles||{}}},e.createWidget=h,e.createWidgetInstance=b,e.widgetToWidgetInstance=w,Object.defineProperty(e,"__esModule",{value:!0})}));