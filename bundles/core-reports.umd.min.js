/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ajf/core/models"),require("@ajf/core/utils"),require("rxjs"),require("@ajf/core/image")):"function"==typeof define&&define.amd?define("@ajf/core/reports",["exports","@ajf/core/models","@ajf/core/utils","rxjs","@ajf/core/image"],t):t(((e=e||self).ajf=e.ajf||{},e.ajf.core=e.ajf.core||{},e.ajf.core.reports={}),e.ajf.core.models,e.ajf.core.utils,e.rxjs,e.ajf.core.image)}(this,function(e,u,o,a,n){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function t(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var f=function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i={None:0,Sum:1,Average:2,WeightedAverage:3,LENGTH:4};i[i.None]="None",i[i.Sum]="Sum",i[i.Average]="Average",i[i.WeightedAverage]="WeightedAverage",i[i.LENGTH]="LENGTH";var s,l=(t(c,s=u.AjfJsonSerializable),c.fromJson=function(e){return new c(e=o.deepCopy(e))},c.prototype.evaluate=function(e,t){var n=e.map(function(e){return e.evaluate(t)});switch(this.aggregation){case i.None:if(1!==n.length)throw new Error("Invalid aggregation");return n[0];case i.Sum:return n.map(function(e){return e.reduce(function(e,t){return e+t},0)});case i.Average:case i.WeightedAverage:return n.map(function(e){return e.reduce(function(e,t){return e+t},0)/n.length});default:return[]}},c);function c(e){var t=s.call(this)||this;return t.jsonExportedMembers=["aggregation"],t.aggregation=e&&e.aggregation||i.None,t}var p={Line:0,Bar:1,HorizontalBar:2,Radar:3,Scatter:4,Doughnut:5,Pie:6,PolarArea:7,Bubble:8,LENGTH:9};function g(e){switch(e){case p.Line:return"line";case p.Bar:return"bar";case p.HorizontalBar:return"horizontalBar";case p.Radar:return"radar";case p.Scatter:return"scatter";case p.Doughnut:return"doughnut";case p.Pie:return"pie";case p.PolarArea:return"polarArea";case p.Bubble:return"bubble";default:return"line"}}p[p.Line]="Line",p[p.Bar]="Bar",p[p.HorizontalBar]="HorizontalBar",p[p.Radar]="Radar",p[p.Scatter]="Scatter",p[p.Doughnut]="Doughnut",p[p.Pie]="Pie",p[p.PolarArea]="PolarArea",p[p.Bubble]="Bubble",p[p.LENGTH]="LENGTH";var h,y=(t(b,h=u.AjfJsonSerializable),b.fromJson=function(e){return new b(b._parseJsonObject(e))},b._parseJsonObject=function(e){e=o.deepCopy(e);var t,n=Object.keys(e);if(-1===n.indexOf("formula"))throw new Error("dataset formula missing");if(-1===n.indexOf("aggregation"))throw new Error("dataset aggregation missing");if(-1===n.indexOf("label"))throw new Error("dataset label missing");t=e.formula instanceof Array?e.formula.map(function(e){return u.AjfFormula.fromJson(e)}):u.AjfFormula.fromJson(e.formula);var r=l.fromJson(e.aggregation);return e.formula=t,e.aggregation=r,e},b);function b(e){var t=h.call(this)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["formula","aggregation","label"]),t.formula=e&&e.formula||null,t.aggregation=e&&e.aggregation||i.None,t.label=e&&e.label||null,t}var d,m=(t(j,d=y),j.fromJson=function(e){return new j(y._parseJsonObject(e))},j);function j(e){var t=d.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["rowspan","colspan","style"]),t.rowspan=e&&e.rowspan||null,t.colspan=e&&e.colspan||null,t.style=e&&e.style||null,t}var _,v=(t(w,_=y),w.fromJson=function(e){return new w(y._parseJsonObject(e))},w);function w(e){var t=_.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["chartType","options"]),null!=e.chartType&&(t.chartType=e.chartType),null!=e.options&&(t.options=e.options),null!=e.datalabels&&(t.datalabels=e.datalabels),t}var A=(Object.defineProperty(T.prototype,"reportInstance",{get:function(){return this._reportInstance},set:function(e){this._reportInstance=e,this._report=null!=e?e.report:null,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(T.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),T);function T(e){this._cdr=e}var O={Layout:0,PageBreak:1,Image:2,Text:3,Chart:4,Table:5,Map:6,Column:7,Formula:8,ImageContainer:9,LENGTH:10};O[O.Layout]="Layout",O[O.PageBreak]="PageBreak",O[O.Image]="Image",O[O.Text]="Text",O[O.Chart]="Chart",O[O.Table]="Table",O[O.Map]="Map",O[O.Column]="Column",O[O.Formula]="Formula",O[O.ImageContainer]="ImageContainer",O[O.LENGTH]="LENGTH";var x={EPI:0,Month:1,Year:2,LENGTH:3};x[x.EPI]="EPI",x[x.Month]="Month",x[x.Year]="Year",x[x.LENGTH]="LENGTH";var P,I=(t(C,P=u.AjfJsonSerializable),C.fromJson=function(e){if(-1===Object.keys(e).indexOf("widgetType"))throw new Error("Widget type missing");var t=e.widgetType;if(null==O[t])throw new Error("Invalid widget type");return delete(e=this.parseJsonObject(e)).widgetType,C.createWidget(t,e)},C.parseJsonObject=function(e){e=o.deepCopy(e);var t=Object.keys(e);if(-1<t.indexOf("visibility")?e.visibility=u.AjfCondition.fromJson(e.visibility):e.visibility=u.AjfCondition.alwaysCondition(),-1<t.indexOf("content")&&e.content instanceof Array&&(e.content=e.content.map(function(e){return C.fromJson(e)})),-1<t.indexOf("dataset")&&e.dataset instanceof Array)if(e.widgetType==O.Table){var n=e.dataset.map(function(e){return e.map(function(e){return m.fromJson(e)})});e.dataset=n}else e.widgetType==O.Chart&&(n=e.dataset.map(function(e){return v.fromJson(e)}),e.dataset=n);return-1<t.indexOf("labels")&&(e.labels instanceof Array?e.labels=e.labels.map(function(e){return u.AjfFormula.fromJson(e)}):e.labels=u.AjfFormula.fromJson(e.labels)),-1<t.indexOf("coordinate")&&(e.coordinate=u.AjfFormula.fromJson(e.coordinate)),e},C.createWidget=function(e,t){switch(e){case O.Layout:return new M(t);case O.PageBreak:return new B(t);case O.Image:return new k(t);case O.Text:return new V(t);case O.Chart:return new te(t);case O.Table:return new oe(t);case O.Map:return new se(t);case O.Column:return new J(t);case O.Formula:return new K(t);case O.ImageContainer:return new G(t);default:throw new Error("Invalid widget type")}},Object.defineProperty(C.prototype,"widgetType",{get:function(){var e=this;if(e instanceof M)return O.Layout;if(e instanceof J)return O.Column;if(e instanceof B)return O.PageBreak;if(e instanceof k)return O.Image;if(e instanceof V)return O.Text;if(e instanceof te)return O.Chart;if(e instanceof oe)return O.Table;if(e instanceof se)return O.Map;if(e instanceof K)return O.Formula;if(e instanceof G)return O.ImageContainer;throw new Error("Invalid widget type")},enumerable:!0,configurable:!0}),C);function C(e){var t=P.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["widgetType","content","styles","visibility"]),t.content=e&&e.content||[],t.styles=e&&e.styles||{},t.visibility=e&&e.visibility||u.AjfCondition.alwaysCondition(),t}var E,M=(t(R,E=I),Object.defineProperty(R.prototype,"hasContent",{get:function(){return!0},enumerable:!0,configurable:!0}),R);function R(e){var t=E.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["columns"]),e&&e.columns?t.columns=e.columns:(t.content=[new J],t.columns=[1]),t}var F,J=(t(W,F=I),Object.defineProperty(W.prototype,"hasContent",{get:function(){return!0},enumerable:!0,configurable:!0}),W);function W(e){return F.call(this,e)||this}var L,B=(t(S,L=I),Object.defineProperty(S.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),S);function S(e){return L.call(this,e)||this}var N,k=(t(H,N=I),Object.defineProperty(H.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"imageType",{get:function(){return this._imageType},set:function(e){this._imageType=e,this._icon=null,this._flag=null,this._url=null},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"icon",{get:function(){return this._icon},set:function(e){this._imageType===n.AjfImageType.Icon&&(this._icon=e)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"flag",{get:function(){return this._flag},set:function(e){this._imageType===n.AjfImageType.Flag&&(this._flag=e)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"url",{get:function(){return this._url},set:function(e){this._imageType===n.AjfImageType.Image&&(this._url=e)},enumerable:!0,configurable:!0}),H.prototype.setUrl=function(e){this.imageType=n.AjfImageType.Image,this._url=new u.AjfFormula({formula:'"'+e+'"'})},H.prototype.setIcon=function(e){this.imageType=n.AjfImageType.Icon,this._icon=new u.AjfFormula({formula:'{fontSet: "'+e.fontSet+'", fontIcon: "'+e.fontIcon+'"}'})},H.prototype.setFlag=function(e){this.imageType=n.AjfImageType.Flag,this._flag=new u.AjfFormula({formula:'"'+e+'"'})},H);function H(e){var t=N.call(this,e)||this;return t._imageType=n.AjfImageType.Image,t.jsonExportedMembers=t.jsonExportedMembers.concat(["imageType","url","icon","flag"]),t._imageType=e&&null!=e.imageType?e.imageType:null,t._url=e&&e.url?e.url instanceof u.AjfFormula?e.url:u.AjfFormula.fromJson(e.url):null,t._icon=e&&e.icon?e.icon instanceof u.AjfFormula?e.icon:u.AjfFormula.fromJson(e.icon):null,t._flag=e&&e.flag?e.flag instanceof u.AjfFormula?e.flag:u.AjfFormula.fromJson(e.flag):null,t}var D,G=(t(z,D=I),Object.defineProperty(z.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"imageType",{get:function(){return this._imageType},set:function(e){this._imageType=e,this.urls=[],this.flags=[],this.icons=[]},enumerable:!0,configurable:!0}),z);function z(e){var t=D.call(this,e)||this;return t._imageType=n.AjfImageType.Image,t.jsonExportedMembers=t.jsonExportedMembers.concat(["imageType","urls","icons","flags"]),t._imageType=e&&null!=e.imageType?e.imageType:null,t.urls=e&&e.urls?e.urls instanceof u.AjfFormula?e.urls:e.urls instanceof Array?e.urls:u.AjfFormula.fromJson(e.urls):[],t.flags=e&&e.flags?e.flags instanceof u.AjfFormula?e.flags:e.flags instanceof Array?e.flags:u.AjfFormula.fromJson(e.flags):[],t.icons=e&&e.icons?e.icons instanceof u.AjfFormula?e.icons:e.icons.map(function(e){return u.AjfFormula.fromJson(e)}):[],t}var q,V=(t(Y,q=I),Object.defineProperty(Y.prototype,"htmlText",{get:function(){return this._htmlText},set:function(e){this._htmlText=e},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),Y);function Y(e){var t=q.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["htmlText"]),t._htmlText=e&&e.htmlText||"",t}var U,K=(t(Q,U=I),Object.defineProperty(Q.prototype,"formula",{get:function(){return this._formula},set:function(e){this._formula=e},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"hasContent",{get:function(){return!0},enumerable:!0,configurable:!0}),Q);function Q(e){var t=U.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["content","formula"]),t.content=e&&e.content||[],t.formula=e&&e.formula?e.formula instanceof u.AjfFormula?e.formula:u.AjfFormula.fromJson(e.formula):null,t}var X,Z=(t($,X=I),Object.defineProperty($.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),$);function $(e){var t=X.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["dataset"]),t.dataset=e&&e.dataset||[],t}var ee,te=(t(ne,ee=Z),ne);function ne(e){var t=ee.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["chartType","labels","options"]),t.chartType=e&&e.type||p.Line,t.dataset=e&&e.dataset||[],t.labels=e&&e.labels||[],t.options=e&&e.options||null,t}var re,oe=(t(ae,re=Z),ae);function ae(e){var t=re.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["cellStyles"]),t.cellStyles=e&&e.cellStyles||null,t}var ie,se=(t(ue,ie=Z),Object.defineProperty(ue.prototype,"coordinateMap",{get:function(){return this.coordinate},enumerable:!0,configurable:!0}),Object.defineProperty(ue.prototype,"tileLayerMap",{get:function(){return this.tileLayer},enumerable:!0,configurable:!0}),Object.defineProperty(ue.prototype,"attributionMap",{get:function(){return this.attribution},enumerable:!0,configurable:!0}),Object.defineProperty(ue.prototype,"disabledMap",{get:function(){return this.disabled},enumerable:!0,configurable:!0}),ue);function ue(e){var t=ie.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["coordinate","tileLayer","attribution","disabled"]),t.coordinate=e&&e.coordinate||"",t.tileLayer=e&&e.tileLayer||"",t.attribution=e&&e.attribution||"",t.disabled=e&&e.disabled||!1,t}var le=(Object.defineProperty(ce.prototype,"widget",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"styles",{get:function(){return this._styles},enumerable:!0,configurable:!0}),Object.defineProperty(ce.prototype,"widgetType",{get:function(){return this._widgetType},enumerable:!0,configurable:!0}),ce.create=function(e,t,n){if(e instanceof M)return new ye(e,t,n);if(e instanceof k)return new Te(e,t,n);if(e instanceof V)return new Ee(e,t,n);if(e instanceof oe)return new Fe(e,t,n);if(e instanceof te)return new Le(e,t,n);if(e instanceof se)return new Ne(e,t,n);if(e instanceof Z)return new pe(e,t,n);if(e instanceof K)return new De(e,t,n);if(e instanceof G)return new Pe(e,t,n);if(e instanceof I)return new ce(e,t,n);throw new Error("Invalid widget type")},ce.prototype.initContext=function(e){this._evaluateVisibility(e)},ce.prototype._initInstance=function(){this._populateContent()},ce.prototype._populateContent=function(){var t=this,n=[];this._widget.hasContent&&this._widget.content.forEach(function(e){n.push(ce.create(e,t._context,t.ts))}),this._content=n},ce.prototype._evaluateVisibility=function(e){null!=this._widget.visibility&&(this._visible=this._widget.visibility.evaluate(e))},ce);function ce(e,t,n){this.ts=n,this._visible=!0,null!=(this._widget=e)&&(this._styles=e.styles,this._widgetType=e.widgetType),this._context=t,this._initInstance(),this.initContext(t)}var fe,pe=(t(ge,fe=le),Object.defineProperty(ge.prototype,"widget",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(ge.prototype,"dataset",{get:function(){return this._dataset},enumerable:!0,configurable:!0}),ge.prototype.initContext=function(e){fe.prototype.initContext.call(this,e),this._populateData(e)},ge.prototype._initInstance=function(){fe.prototype._initInstance.call(this)},ge.prototype._populateData=function(n){this._dataset=(this.widget.dataset||[]).map(function(e){if(e instanceof Array)return e.map(function(e){return e.formula instanceof Array?e.formula.map(function(e){return e.evaluate(n)}):e.formula.evaluate(n)});var t=e.formula;return t instanceof Array?t.map(function(e){return e.evaluate(n)}):t.evaluate(n)})},ge);function ge(e,t,n){return fe.call(this,e,t,n)||this}var he,ye=(t(be,he=le),be.prototype.getColumnContent=function(e){return 0<=e&&e<this.content.length?this.content[e]:null},be);function be(e,t,n){return he.call(this,e,t,n)||this}var de,me=(t(je,de=le),je);function je(e,t,n){return de.call(this,e,t,n)||this}var _e,ve=(t(we,_e=le),we);function we(e,t,n){return _e.call(this,e,t,n)||this}var Ae,Te=(t(Oe,Ae=le),Object.defineProperty(Oe.prototype,"icon",{get:function(){return this._icon},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"flag",{get:function(){return this._flag},enumerable:!0,configurable:!0}),Object.defineProperty(Oe.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Oe.prototype.initContext=function(e){Ae.prototype.initContext.call(this,e);var t=this.widget,n=t.icon,r=t.flag,o=t.url;this._icon=n?n.evaluate(e):"",this._flag=r?r.evaluate(e):"",this._url=o?o.evaluate(e):""},Oe);function Oe(){return null!==Ae&&Ae.apply(this,arguments)||this}var xe,Pe=(t(Ie,xe=le),Object.defineProperty(Ie.prototype,"icons",{get:function(){return this._icons},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"flags",{get:function(){return this._flags},enumerable:!0,configurable:!0}),Object.defineProperty(Ie.prototype,"urls",{get:function(){return this._urls},enumerable:!0,configurable:!0}),Ie.prototype.initContext=function(t){xe.prototype.initContext.call(this,t);var e=this.widget;this._urls=e.urls?e.urls instanceof Array?e.urls:e.urls instanceof u.AjfFormula?e.urls.evaluate(t):[]:[],this._flags=e.flags?e.flags instanceof Array?e.flags:e.flags instanceof u.AjfFormula?e.flags.evaluate(t):[]:[],this._icons=e.icons?e.icons instanceof Array?e.icons.map(function(e){return e.evaluate(t)}):e.icons instanceof u.AjfFormula?e.icons.evaluate(t):[]:[]},Ie);function Ie(){return null!==xe&&xe.apply(this,arguments)||this}var Ce,Ee=(t(Me,Ce=le),Object.defineProperty(Me.prototype,"htmlText",{get:function(){return this._htmlText},enumerable:!0,configurable:!0}),Me.prototype.initContext=function(n){Ce.prototype.initContext.call(this,n);for(var e,t=/\[\[(.+?)\]\]/g,r=this.widget.htmlText,o=[];e=t.exec(r);){var a=e.index,i=e[0].length,s=new u.AjfFormula({formula:e[1]});o.push({idx:a,len:i,formula:s})}o.reverse().forEach(function(e){var t;try{t=e.formula.evaluate(n)}catch(e){t=""}r=""+r.substr(0,e.idx)+t+r.substr(e.idx+e.len)}),this._htmlText=r},Me);function Me(){return null!==Ce&&Ce.apply(this,arguments)||this}var Re,Fe=(t(Je,Re=le),Object.defineProperty(Je.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(Je.prototype,"recalc",{get:function(){return this._recalc},enumerable:!0,configurable:!0}),Je.prototype.initContext=function(e){Re.prototype.initContext.call(this,e);var t=this.widget;this._data=[];for(var n=t.dataset||[],r=n.length,o=0;o<r;o++){var a=n[o],i=a.length;this._data.push([]);for(var s=0;s<i;s++){var u=a[s],l=u.formula.evaluate(e),c=f({},t.cellStyles,u.style);this._data[o].push({value:l,style:c,rowspan:u.rowspan,colspan:u.colspan})}}},Je.prototype.calcValues=function(e){if(void 0!==e){for(var t=this.widget.dataset||[],n=t.length,r=0;r<n;r++)for(var o=t[r],a=o.length,i=0;i<a;i++){var s=o[i];this._data[r][i].value=s.formula.evaluate(e)}this._data=this._data.slice(0),this._recalcEvt.next(!0)}},Je);function Je(e,t,n){var r=Re.call(this,e,t,n)||this;return r._recalcEvt=new a.Subject,r._recalc=r._recalcEvt.asObservable(),r}var We,Le=(t(Be,We=pe),Object.defineProperty(Be.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(Be.prototype,"chartType",{get:function(){return this._chartType},enumerable:!0,configurable:!0}),Be.prototype._translate=function(e,t){var r=this,o=e.evaluate(t);try{return Array.isArray(o)&&o.forEach(function(e,n){Array.isArray(e)?e.forEach(function(e,t){o[n][t]=r.ts.instant(e)}):o[n]=r.ts.instant(e)}),o}catch(e){return o}},Be.prototype.initContext=function(r){var t=this;We.prototype.initContext.call(this,r);var e=this.widget;this._chartType=g(e.chartType),e.labels instanceof Array?e.labels.map(function(e){t._labels.concat(t._translate(e,r))}):this._labels=this._translate(e.labels,r),this._datasets=e.dataset.map(function(e){var t=f({},e.options||{},{data:e.aggregation.evaluate(e.formula,r)});if(null!=e.chartType){var n=g(e.chartType);t=f({},t,{chartType:n,type:n})}return null!=e.options&&(t=f({},t,{options:e.options})),null!=e.label&&(t=f({},t,{label:e.label})),null!=e.datalabels&&(t.datalabels=o.deepCopy(e.datalabels)),t}),this._data={labels:this._labels,datasets:this._datasets}},Be);function Be(e,t,n){return We.call(this,e,t,n)||this}var Se,Ne=(t(ke,Se=pe),ke.prototype.initContext=function(e){Se.prototype.initContext.call(this,e);var t=this.widget;this.coordinate=t.coordinate.evaluate(e)},ke);function ke(){return null!==Se&&Se.apply(this,arguments)||this}var He,De=(t(Ge,He=le),Object.defineProperty(Ge.prototype,"formula",{get:function(){return this._formula},enumerable:!0,configurable:!0}),Ge.prototype.initContext=function(e){He.prototype.initContext.call(this,e);var t=this.widget;this._formula=t.formula.evaluate(e)},Ge);function Ge(){return null!==He&&He.apply(this,arguments)||this}var ze=(Object.defineProperty(qe.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"styles",{get:function(){return this._styles},enumerable:!0,configurable:!0}),qe.prototype._populateContent=function(){var t=this,n=[];this._container.content.forEach(function(e){t._translate(e),n.push(le.create(e,t._context,t._ts))}),this._content=n},qe.prototype._translate=function(e){var n=this;e.hasContent&&e.content.forEach(function(e){n._translate(e)}),e instanceof V&&e.htmlText&&(e.htmlText=this._ts.instant(e.htmlText)),e instanceof te&&e.dataset&&e.dataset.forEach(function(e){e.label=e.label?n._ts.instant(e.label):""}),e instanceof oe&&e.dataset&&e.dataset.forEach(function(e){e.forEach(function(e){if(e.formula&&e.formula.formula)try{var t=e.formula.formula;'"'===t[0]?(t=t.slice(1,-1),e.formula.formula=0<t.length?'"'+n._ts.instant(t)+'"':e.formula.formula):e.formula.formula=n._ts.instant(t)}catch(e){}})})},qe);function qe(e,t,n){this._ts=n,this._styles={},this._container=e,this._styles=null!=this._container?this._container.styles:{},this._context=t,this._populateContent()}var Ve=(Object.defineProperty(Ye.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),Object.defineProperty(Ye.prototype,"header",{get:function(){return this._header},enumerable:!0,configurable:!0}),Object.defineProperty(Ye.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(Ye.prototype,"footer",{get:function(){return this._footer},enumerable:!0,configurable:!0}),Object.defineProperty(Ye.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(Ye.prototype,"styles",{get:function(){return null!=this._report?this._report.styles:{}},enumerable:!0,configurable:!0}),Object.defineProperty(Ye.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Ye.prototype._populateReport=function(){this._header=this._populateContainer(this._report.header),this._content=this._populateContainer(this._report.content),this._footer=this._populateContainer(this._report.footer)},Ye.prototype._populateContainer=function(e){return new ze(e,this._context,this._ts)},Ye);function Ye(e,t,n){this._ts=n,this._report=e,this._context=t,this._populateReport()}var Ue,Ke=(t(Qe,Ue=u.AjfJsonSerializable),Object.defineProperty(Qe.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(Qe.prototype,"styles",{get:function(){return this._styles},enumerable:!0,configurable:!0}),Qe.fromJson=function(e){return e=o.deepCopy(e),-1<Object.keys(e).indexOf("content")&&e.content instanceof Array&&(e.content=e.content.map(function(e){return I.fromJson(e)})),new Qe(e)},Qe);function Qe(e){var t=Ue.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["content","styles"]),t._content=e&&e.content||[],t._styles=e&&e.styles||{},t}var Xe,Ze=(t($e,Xe=u.AjfJsonSerializable),Object.defineProperty($e.prototype,"header",{get:function(){return this._header},enumerable:!0,configurable:!0}),Object.defineProperty($e.prototype,"footer",{get:function(){return this._footer},enumerable:!0,configurable:!0}),Object.defineProperty($e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty($e.prototype,"styles",{get:function(){return this._styles},set:function(e){this._styles=e},enumerable:!0,configurable:!0}),Object.defineProperty($e.prototype,"forms",{get:function(){return this._forms},set:function(e){this._forms=e},enumerable:!0,configurable:!0}),$e.fromJson=function(t,e){t=o.deepCopy(t);var n=Object.keys(t);return["header","footer","content"].forEach(function(e){-1<n.indexOf(e)&&(t[e]=Ke.fromJson(t[e]))}),new $e(e||[],t)},$e);function $e(e,t){var n=Xe.call(this,t)||this;return n._forms=e.slice(0),n.jsonExportedMembers=n.jsonExportedMembers.concat(["header","footer","content","styles"]),n._header=t&&t.header||null,n._footer=t&&t.footer||null,n._content=t&&t.content||null,n._styles=t&&t.styles||null,n}var et=(Object.defineProperty(tt.prototype,"widget",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"imageTypes",{get:function(){return this._imageTypes},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"widgetInstance",{get:function(){return this._widgetInstance},set:function(e){this._widgetInstance!==e&&(this._widgetInstance=e,this._widget=null!=this._widgetInstance?this._widgetInstance.widget:null,this._cdr.markForCheck())},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"imgwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"imgw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"imgcwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"imgcw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"layoutwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"layoutw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"chartwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"chartw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"tablewInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"textwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"mapwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"mapw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(tt.prototype,"formulawInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),tt);function tt(e){this._cdr=e,this.widgetTypes=O,this._imageTypes=n.AjfImageType}e.AjfAggregation=l,e.AjfAggregationType=i,e.AjfChartDataset=v,e.AjfChartType=p,e.AjfDataset=y,e.AjfReport=Ze,e.AjfReportChartWidget=te,e.AjfReportChartWidgetInstance=Le,e.AjfReportColumnWidget=J,e.AjfReportColumnWidgetInstance=me,e.AjfReportContainer=Ke,e.AjfReportContainerInstance=ze,e.AjfReportDataType=x,e.AjfReportDataWidget=Z,e.AjfReportDataWidgetInstance=pe,e.AjfReportFormulaWidget=K,e.AjfReportFormulaWidgetInstance=De,e.AjfReportImageContainerWidget=G,e.AjfReportImageContainerWidgetInstance=Pe,e.AjfReportImageWidget=k,e.AjfReportImageWidgetInstance=Te,e.AjfReportInstance=Ve,e.AjfReportLayoutWidget=M,e.AjfReportLayoutWidgetInstance=ye,e.AjfReportMapWidget=se,e.AjfReportMapWidgetInstance=Ne,e.AjfReportPageBreakWidget=B,e.AjfReportPageBreakWidgetInstance=ve,e.AjfReportRenderer=A,e.AjfReportTableWidget=oe,e.AjfReportTableWidgetInstance=Fe,e.AjfReportTextWidget=V,e.AjfReportTextWidgetInstance=Ee,e.AjfReportWidget=I,e.AjfReportWidgetInstance=le,e.AjfReportWidgetRenderer=et,e.AjfReportWidgetType=O,e.AjfTableDataset=m,e.chartToChartJsType=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core-reports.umd.min.js.map
