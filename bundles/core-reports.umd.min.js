/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ajf/core/models"),require("@ajf/core/utils"),require("rxjs"),require("@ajf/core/image")):"function"==typeof define&&define.amd?define("@ajf/core/reports",["exports","@ajf/core/models","@ajf/core/utils","rxjs","@ajf/core/image"],t):t(((e=e||self).ajf=e.ajf||{},e.ajf.core=e.ajf.core||{},e.ajf.core.reports={}),e.ajf.core.models,e.ajf.core.utils,e.rxjs,e.ajf.core.image)}(this,function(e,c,i,o,r){"use strict";var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function u(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},s={None:0,Sum:1,Average:2,WeightedAverage:3,LENGTH:4};s[s.None]="None",s[s.Sum]="Sum",s[s.Average]="Average",s[s.WeightedAverage]="WeightedAverage",s[s.LENGTH]="LENGTH";var l=function(n){function t(e){var t=n.call(this)||this;return t.jsonExportedMembers=["aggregation"],t.aggregation=e&&e.aggregation||s.None,t}return u(t,n),t.fromJson=function(e){return new t(e=i.deepCopy(e))},t.prototype.evaluate=function(e,t){var n=e.map(function(e){return e.evaluate(t)});switch(this.aggregation){case s.None:if(1!==n.length)throw new Error("Invalid aggregation");return n[0];case s.Sum:return n.map(function(e){return e.reduce(function(e,t){return e+t},0)});case s.Average:case s.WeightedAverage:return n.map(function(e){return e.reduce(function(e,t){return e+t},0)/n.length});default:return[]}},t}(c.AjfJsonSerializable),f={Line:0,Bar:1,HorizontalBar:2,Radar:3,Scatter:4,Doughnut:5,Pie:6,PolarArea:7,Bubble:8,LENGTH:9};function g(e){switch(e){case f.Line:return"line";case f.Bar:return"bar";case f.HorizontalBar:return"horizontalBar";case f.Radar:return"radar";case f.Scatter:return"scatter";case f.Doughnut:return"doughnut";case f.Pie:return"pie";case f.PolarArea:return"polarArea";case f.Bubble:return"bubble";default:return"line"}}f[f.Line]="Line",f[f.Bar]="Bar",f[f.HorizontalBar]="HorizontalBar",f[f.Radar]="Radar",f[f.Scatter]="Scatter",f[f.Doughnut]="Doughnut",f[f.Pie]="Pie",f[f.PolarArea]="PolarArea",f[f.Bubble]="Bubble",f[f.LENGTH]="LENGTH";var h=function(n){function t(e){var t=n.call(this)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["formula","aggregation","label"]),t.formula=e&&e.formula||null,t.aggregation=e&&e.aggregation||s.None,t.label=e&&e.label||null,t}return u(t,n),t.fromJson=function(e){return new t(t._parseJsonObject(e))},t._parseJsonObject=function(e){e=i.deepCopy(e);var t,n=Object.keys(e);if(-1===n.indexOf("formula"))throw new Error("dataset formula missing");if(-1===n.indexOf("aggregation"))throw new Error("dataset aggregation missing");if(-1===n.indexOf("label"))throw new Error("dataset label missing");t=e.formula instanceof Array?e.formula.map(function(e){return c.AjfFormula.fromJson(e)}):c.AjfFormula.fromJson(e.formula);var r=l.fromJson(e.aggregation);return e.formula=t,e.aggregation=r,e},t}(c.AjfJsonSerializable),y=function(n){function t(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["rowspan","colspan","style"]),t.rowspan=e&&e.rowspan||null,t.colspan=e&&e.colspan||null,t.style=e&&e.style||null,t}return u(t,n),t.fromJson=function(e){return new t(h._parseJsonObject(e))},t}(h),b=function(n){function t(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["chartType","options"]),null!=e.chartType&&(t.chartType=e.chartType),null!=e.options&&(t.options=e.options),null!=e.datalabels&&(t.datalabels=e.datalabels),t}return u(t,n),t.fromJson=function(e){return new t(h._parseJsonObject(e))},t}(h),t=function(){function e(e){this._cdr=e}return Object.defineProperty(e.prototype,"reportInstance",{get:function(){return this._reportInstance},set:function(e){this._reportInstance=e,this._report=null!=e?e.report:null,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),e}(),d={Layout:0,PageBreak:1,Image:2,Text:3,Chart:4,Table:5,Map:6,Column:7,Formula:8,ImageContainer:9,LENGTH:10};d[d.Layout]="Layout",d[d.PageBreak]="PageBreak",d[d.Image]="Image",d[d.Text]="Text",d[d.Chart]="Chart",d[d.Table]="Table",d[d.Map]="Map",d[d.Column]="Column",d[d.Formula]="Formula",d[d.ImageContainer]="ImageContainer",d[d.LENGTH]="LENGTH";var n={EPI:0,Month:1,Year:2,LENGTH:3};n[n.EPI]="EPI",n[n.Month]="Month",n[n.Year]="Year",n[n.LENGTH]="LENGTH";var m=function(n){function r(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["widgetType","content","styles","visibility"]),t.content=e&&e.content||[],t.styles=e&&e.styles||{},t.visibility=e&&e.visibility||c.AjfCondition.alwaysCondition(),t}return u(r,n),r.fromJson=function(e){if(-1===Object.keys(e).indexOf("widgetType"))throw new Error("Widget type missing");var t=e.widgetType;if(null==d[t])throw new Error("Invalid widget type");return delete(e=this.parseJsonObject(e)).widgetType,r.createWidget(t,e)},r.parseJsonObject=function(e){e=i.deepCopy(e);var t=Object.keys(e);if(-1<t.indexOf("visibility")?e.visibility=c.AjfCondition.fromJson(e.visibility):e.visibility=c.AjfCondition.alwaysCondition(),-1<t.indexOf("content")&&e.content instanceof Array&&(e.content=e.content.map(function(e){return r.fromJson(e)})),-1<t.indexOf("dataset")&&e.dataset instanceof Array)if(e.widgetType==d.Table){var n=e.dataset.map(function(e){return e.map(function(e){return y.fromJson(e)})});e.dataset=n}else if(e.widgetType==d.Chart){n=e.dataset.map(function(e){return b.fromJson(e)});e.dataset=n}return-1<t.indexOf("labels")&&(e.labels instanceof Array?e.labels=e.labels.map(function(e){return c.AjfFormula.fromJson(e)}):e.labels=c.AjfFormula.fromJson(e.labels)),-1<t.indexOf("coordinate")&&(e.coordinate=c.AjfFormula.fromJson(e.coordinate)),e},r.createWidget=function(e,t){switch(e){case d.Layout:return new j(t);case d.PageBreak:return new w(t);case d.Image:return new v(t);case d.Text:return new T(t);case d.Chart:return new P(t);case d.Table:return new I(t);case d.Map:return new C(t);case d.Column:return new _(t);case d.Formula:return new O(t);case d.ImageContainer:return new A(t);default:throw new Error("Invalid widget type")}},Object.defineProperty(r.prototype,"widgetType",{get:function(){var e=this;if(e instanceof j)return d.Layout;if(e instanceof _)return d.Column;if(e instanceof w)return d.PageBreak;if(e instanceof v)return d.Image;if(e instanceof T)return d.Text;if(e instanceof P)return d.Chart;if(e instanceof I)return d.Table;if(e instanceof C)return d.Map;if(e instanceof O)return d.Formula;if(e instanceof A)return d.ImageContainer;throw new Error("Invalid widget type")},enumerable:!0,configurable:!0}),r}(c.AjfJsonSerializable),j=function(n){function e(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["columns"]),e&&e.columns?t.columns=e.columns:(t.content=[new _],t.columns=[1]),t}return u(e,n),Object.defineProperty(e.prototype,"hasContent",{get:function(){return!0},enumerable:!0,configurable:!0}),e}(m),_=function(t){function e(e){return t.call(this,e)||this}return u(e,t),Object.defineProperty(e.prototype,"hasContent",{get:function(){return!0},enumerable:!0,configurable:!0}),e}(m),w=function(t){function e(e){return t.call(this,e)||this}return u(e,t),Object.defineProperty(e.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),e}(m),v=function(n){function e(e){var t=n.call(this,e)||this;return t._imageType=r.AjfImageType.Image,t.jsonExportedMembers=t.jsonExportedMembers.concat(["imageType","url","icon","flag"]),t._imageType=e&&null!=e.imageType?e.imageType:null,t._url=e&&e.url?e.url instanceof c.AjfFormula?e.url:c.AjfFormula.fromJson(e.url):null,t._icon=e&&e.icon?e.icon instanceof c.AjfFormula?e.icon:c.AjfFormula.fromJson(e.icon):null,t._flag=e&&e.flag?e.flag instanceof c.AjfFormula?e.flag:c.AjfFormula.fromJson(e.flag):null,t}return u(e,n),Object.defineProperty(e.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageType",{get:function(){return this._imageType},set:function(e){this._imageType=e,this._icon=null,this._flag=null,this._url=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return this._icon},set:function(e){this._imageType===r.AjfImageType.Icon&&(this._icon=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flag",{get:function(){return this._flag},set:function(e){this._imageType===r.AjfImageType.Flag&&(this._flag=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(e){this._imageType===r.AjfImageType.Image&&(this._url=e)},enumerable:!0,configurable:!0}),e.prototype.setUrl=function(e){this.imageType=r.AjfImageType.Image,this._url=new c.AjfFormula({formula:'"'+e+'"'})},e.prototype.setIcon=function(e){this.imageType=r.AjfImageType.Icon,this._icon=new c.AjfFormula({formula:'{fontSet: "'+e.fontSet+'", fontIcon: "'+e.fontIcon+'"}'})},e.prototype.setFlag=function(e){this.imageType=r.AjfImageType.Flag,this._flag=new c.AjfFormula({formula:'"'+e+'"'})},e}(m),A=function(n){function e(e){var t=n.call(this,e)||this;return t._imageType=r.AjfImageType.Image,t.jsonExportedMembers=t.jsonExportedMembers.concat(["imageType","urls","icons","flags"]),t._imageType=e&&null!=e.imageType?e.imageType:null,t.urls=e&&e.urls?e.urls instanceof c.AjfFormula?e.urls:e.urls instanceof Array?e.urls:c.AjfFormula.fromJson(e.urls):[],t.flags=e&&e.flags?e.flags instanceof c.AjfFormula?e.flags:e.flags instanceof Array?e.flags:c.AjfFormula.fromJson(e.flags):[],t.icons=e&&e.icons?e.icons instanceof c.AjfFormula?e.icons:e.icons.map(function(e){return c.AjfFormula.fromJson(e)}):[],t}return u(e,n),Object.defineProperty(e.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageType",{get:function(){return this._imageType},set:function(e){this._imageType=e,this.urls=[],this.flags=[],this.icons=[]},enumerable:!0,configurable:!0}),e}(m),T=function(n){function e(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["htmlText"]),t._htmlText=e&&e.htmlText||"",t}return u(e,n),Object.defineProperty(e.prototype,"htmlText",{get:function(){return this._htmlText},set:function(e){this._htmlText=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),e}(m),O=function(n){function e(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["content","formula"]),t.content=e&&e.content||[],t.formula=e&&e.formula?e.formula instanceof c.AjfFormula?e.formula:c.AjfFormula.fromJson(e.formula):null,t}return u(e,n),Object.defineProperty(e.prototype,"formula",{get:function(){return this._formula},set:function(e){this._formula=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasContent",{get:function(){return!0},enumerable:!0,configurable:!0}),e}(m),x=function(n){function e(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["dataset"]),t.dataset=e&&e.dataset||[],t}return u(e,n),Object.defineProperty(e.prototype,"hasContent",{get:function(){return!1},enumerable:!0,configurable:!0}),e}(m),P=function(n){function e(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["chartType","labels","options"]),t.chartType=e&&e.type||f.Line,t.dataset=e&&e.dataset||[],t.labels=e&&e.labels||[],t.options=e&&e.options||null,t}return u(e,n),e}(x),I=function(n){function e(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["cellStyles"]),t.cellStyles=e&&e.cellStyles||null,t}return u(e,n),e}(x),C=function(n){function e(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["coordinate","tileLayer","attribution","disabled"]),t.coordinate=e&&e.coordinate||"",t.tileLayer=e&&e.tileLayer||"",t.attribution=e&&e.attribution||"",t.disabled=e&&e.disabled||!1,t}return u(e,n),Object.defineProperty(e.prototype,"coordinateMap",{get:function(){return this.coordinate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileLayerMap",{get:function(){return this.tileLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributionMap",{get:function(){return this.attribution},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabledMap",{get:function(){return this.disabled},enumerable:!0,configurable:!0}),e}(x),E=function(){function r(e,t,n){this.ts=n,this._visible=!0,null!=(this._widget=e)&&(this._styles=e.styles,this._widgetType=e.widgetType),this._context=t,this._initInstance(),this.initContext(t)}return Object.defineProperty(r.prototype,"widget",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"styles",{get:function(){return this._styles},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"widgetType",{get:function(){return this._widgetType},enumerable:!0,configurable:!0}),r.create=function(e,t,n){if(e instanceof j)return new R(e,t,n);if(e instanceof v)return new W(e,t,n);if(e instanceof T)return new B(e,t,n);if(e instanceof I)return new S(e,t,n);if(e instanceof P)return new N(e,t,n);if(e instanceof C)return new k(e,t,n);if(e instanceof x)return new M(e,t,n);if(e instanceof O)return new H(e,t,n);if(e instanceof A)return new L(e,t,n);if(e instanceof m)return new r(e,t,n);throw new Error("Invalid widget type")},r.prototype.initContext=function(e){this._evaluateVisibility(e)},r.prototype._initInstance=function(){this._populateContent()},r.prototype._populateContent=function(){var t=this,n=[];this._widget.hasContent&&this._widget.content.forEach(function(e){n.push(r.create(e,t._context,t.ts))}),this._content=n},r.prototype._evaluateVisibility=function(e){null!=this._widget.visibility&&(this._visible=this._widget.visibility.evaluate(e))},r}(),M=function(r){function e(e,t,n){return r.call(this,e,t,n)||this}return u(e,r),Object.defineProperty(e.prototype,"widget",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataset",{get:function(){return this._dataset},enumerable:!0,configurable:!0}),e.prototype.initContext=function(e){r.prototype.initContext.call(this,e),this._populateData(e)},e.prototype._initInstance=function(){r.prototype._initInstance.call(this)},e.prototype._populateData=function(n){this._dataset=(this.widget.dataset||[]).map(function(e){if(e instanceof Array)return e.map(function(e){return e.formula instanceof Array?e.formula.map(function(e){return e.evaluate(n)}):e.formula.evaluate(n)});var t=e.formula;return t instanceof Array?t.map(function(e){return e.evaluate(n)}):t.evaluate(n)})},e}(E),R=function(r){function e(e,t,n){return r.call(this,e,t,n)||this}return u(e,r),e.prototype.getColumnContent=function(e){return 0<=e&&e<this.content.length?this.content[e]:null},e}(E),F=function(r){function e(e,t,n){return r.call(this,e,t,n)||this}return u(e,r),e}(E),J=function(r){function e(e,t,n){return r.call(this,e,t,n)||this}return u(e,r),e}(E),W=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return u(e,i),Object.defineProperty(e.prototype,"icon",{get:function(){return this._icon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flag",{get:function(){return this._flag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),e.prototype.initContext=function(e){i.prototype.initContext.call(this,e);var t=this.widget,n=t.icon,r=t.flag,o=t.url;this._icon=n?n.evaluate(e):"",this._flag=r?r.evaluate(e):"",this._url=o?o.evaluate(e):""},e}(E),L=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return u(e,n),Object.defineProperty(e.prototype,"icons",{get:function(){return this._icons},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flags",{get:function(){return this._flags},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"urls",{get:function(){return this._urls},enumerable:!0,configurable:!0}),e.prototype.initContext=function(t){n.prototype.initContext.call(this,t);var e=this.widget;this._urls=e.urls?e.urls instanceof Array?e.urls:e.urls instanceof c.AjfFormula?e.urls.evaluate(t):[]:[],this._flags=e.flags?e.flags instanceof Array?e.flags:e.flags instanceof c.AjfFormula?e.flags.evaluate(t):[]:[],this._icons=e.icons?e.icons instanceof Array?e.icons.map(function(e){return e.evaluate(t)}):e.icons instanceof c.AjfFormula?e.icons.evaluate(t):[]:[]},e}(E),B=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return u(e,s),Object.defineProperty(e.prototype,"htmlText",{get:function(){return this._htmlText},enumerable:!0,configurable:!0}),e.prototype.initContext=function(n){s.prototype.initContext.call(this,n);for(var e,t=/\[\[(.+?)\]\]/g,r=this.widget.htmlText,o=[];e=t.exec(r);){var i=e.index,a=e[0].length,u=new c.AjfFormula({formula:e[1]});o.push({idx:i,len:a,formula:u})}o.reverse().forEach(function(e){var t;try{t=e.formula.evaluate(n)}catch(e){t=""}r=""+r.substr(0,e.idx)+t+r.substr(e.idx+e.len)}),this._htmlText=r},e}(E),S=function(f){function e(e,t,n){var r=f.call(this,e,t,n)||this;return r._recalcEvt=new o.Subject,r._recalc=r._recalcEvt.asObservable(),r}return u(e,f),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recalc",{get:function(){return this._recalc},enumerable:!0,configurable:!0}),e.prototype.initContext=function(e){f.prototype.initContext.call(this,e);var t=this.widget;this._data=[];for(var n=t.dataset||[],r=n.length,o=0;o<r;o++){var i=n[o],a=i.length;this._data.push([]);for(var u=0;u<a;u++){var s=i[u],c=s.formula.evaluate(e),l=p({},t.cellStyles,s.style);this._data[o].push({value:c,style:l,rowspan:s.rowspan,colspan:s.colspan})}}},e.prototype.calcValues=function(e){if(void 0!==e){for(var t=this.widget.dataset||[],n=t.length,r=0;r<n;r++)for(var o=t[r],i=o.length,a=0;a<i;a++){var u=o[a];this._data[r][a].value=u.formula.evaluate(e)}this._data=this._data.slice(0),this._recalcEvt.next(!0)}},e}(E),N=function(o){function e(e,t,n){return o.call(this,e,t,n)||this}return u(e,o),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chartType",{get:function(){return this._chartType},enumerable:!0,configurable:!0}),e.prototype._translate=function(e,t){var r=this,o=e.evaluate(t);try{return Array.isArray(o)&&o.forEach(function(e,n){Array.isArray(e)?e.forEach(function(e,t){o[n][t]=r.ts.instant(e)}):o[n]=r.ts.instant(e)}),o}catch(e){return o}},e.prototype.initContext=function(r){var t=this;o.prototype.initContext.call(this,r);var e=this.widget;this._chartType=g(e.chartType),e.labels instanceof Array?e.labels.map(function(e){t._labels.concat(t._translate(e,r))}):this._labels=this._translate(e.labels,r),this._datasets=e.dataset.map(function(e){var t=p({},e.options||{},{data:e.aggregation.evaluate(e.formula,r)});if(null!=e.chartType){var n=g(e.chartType);t=p({},t,{chartType:n,type:n})}return null!=e.options&&(t=p({},t,{options:e.options})),null!=e.label&&(t=p({},t,{label:e.label})),null!=e.datalabels&&(t.datalabels=i.deepCopy(e.datalabels)),t}),this._data={labels:this._labels,datasets:this._datasets}},e}(M),k=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return u(e,n),e.prototype.initContext=function(e){n.prototype.initContext.call(this,e);var t=this.widget;this.coordinate=t.coordinate.evaluate(e)},e}(M),H=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return u(e,n),Object.defineProperty(e.prototype,"formula",{get:function(){return this._formula},enumerable:!0,configurable:!0}),e.prototype.initContext=function(e){n.prototype.initContext.call(this,e);var t=this.widget;this._formula=t.formula.evaluate(e)},e}(E),D=function(){function e(e,t,n){this._ts=n,this._styles={},this._container=e,this._styles=null!=this._container?this._container.styles:{},this._context=t,this._populateContent()}return Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styles",{get:function(){return this._styles},enumerable:!0,configurable:!0}),e.prototype._populateContent=function(){var t=this,n=[];this._container.content.forEach(function(e){t._translate(e),n.push(E.create(e,t._context,t._ts))}),this._content=n},e.prototype._translate=function(e){var n=this;e.hasContent&&e.content.forEach(function(e){n._translate(e)}),e instanceof T&&e.htmlText&&(e.htmlText=this._ts.instant(e.htmlText)),e instanceof P&&e.dataset&&e.dataset.forEach(function(e){e.label=e.label?n._ts.instant(e.label):""}),e instanceof I&&e.dataset&&e.dataset.forEach(function(e){e.forEach(function(e){if(e.formula&&e.formula.formula)try{var t=e.formula.formula;'"'===t[0]?(t=t.slice(1,-1),e.formula.formula=0<t.length?'"'+n._ts.instant(t)+'"':e.formula.formula):e.formula.formula=n._ts.instant(t)}catch(e){}})})},e}(),G=function(){function e(e,t,n){this._ts=n,this._report=e,this._context=t,this._populateReport()}return Object.defineProperty(e.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"header",{get:function(){return this._header},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"footer",{get:function(){return this._footer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styles",{get:function(){return null!=this._report?this._report.styles:{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype._populateReport=function(){this._header=this._populateContainer(this._report.header),this._content=this._populateContainer(this._report.content),this._footer=this._populateContainer(this._report.footer)},e.prototype._populateContainer=function(e){return new D(e,this._context,this._ts)},e}(),z=function(n){function t(e){var t=n.call(this,e)||this;return t.jsonExportedMembers=t.jsonExportedMembers.concat(["content","styles"]),t._content=e&&e.content||[],t._styles=e&&e.styles||{},t}return u(t,n),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styles",{get:function(){return this._styles},enumerable:!0,configurable:!0}),t.fromJson=function(e){return e=i.deepCopy(e),-1<Object.keys(e).indexOf("content")&&e.content instanceof Array&&(e.content=e.content.map(function(e){return m.fromJson(e)})),new t(e)},t}(c.AjfJsonSerializable),q=function(r){function o(e,t){var n=r.call(this,t)||this;return n._forms=e.slice(0),n.jsonExportedMembers=n.jsonExportedMembers.concat(["header","footer","content","styles"]),n._header=t&&t.header||null,n._footer=t&&t.footer||null,n._content=t&&t.content||null,n._styles=t&&t.styles||null,n}return u(o,r),Object.defineProperty(o.prototype,"header",{get:function(){return this._header},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"footer",{get:function(){return this._footer},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"styles",{get:function(){return this._styles},set:function(e){this._styles=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"forms",{get:function(){return this._forms},set:function(e){this._forms=e},enumerable:!0,configurable:!0}),o.fromJson=function(t,e){t=i.deepCopy(t);var n=Object.keys(t);return["header","footer","content"].forEach(function(e){-1<n.indexOf(e)&&(t[e]=z.fromJson(t[e]))}),new o(e||[],t)},o}(c.AjfJsonSerializable),V=function(){function e(e){this._cdr=e,this.widgetTypes=d,this._imageTypes=r.AjfImageType}return Object.defineProperty(e.prototype,"widget",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageTypes",{get:function(){return this._imageTypes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"widgetInstance",{get:function(){return this._widgetInstance},set:function(e){this._widgetInstance!==e&&(this._widgetInstance=e,this._widget=null!=this._widgetInstance?this._widgetInstance.widget:null,this._cdr.markForCheck())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imgwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imgw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imgcwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imgcw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chartwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chartw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tablewInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapwInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapw",{get:function(){return this._widget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formulawInst",{get:function(){return this._widgetInstance},enumerable:!0,configurable:!0}),e}();e.AjfAggregationType=s,e.AjfAggregation=l,e.chartToChartJsType=g,e.AjfChartType=f,e.AjfDataset=h,e.AjfTableDataset=y,e.AjfChartDataset=b,e.AjfReportRenderer=t,e.AjfReportContainerInstance=D,e.AjfReportInstance=G,e.AjfReportContainer=z,e.AjfReport=q,e.AjfReportWidgetRenderer=V,e.AjfReportWidgetInstance=E,e.AjfReportDataWidgetInstance=M,e.AjfReportLayoutWidgetInstance=R,e.AjfReportColumnWidgetInstance=F,e.AjfReportPageBreakWidgetInstance=J,e.AjfReportImageWidgetInstance=W,e.AjfReportImageContainerWidgetInstance=L,e.AjfReportTextWidgetInstance=B,e.AjfReportTableWidgetInstance=S,e.AjfReportChartWidgetInstance=N,e.AjfReportMapWidgetInstance=k,e.AjfReportFormulaWidgetInstance=H,e.AjfReportWidgetType=d,e.AjfReportDataType=n,e.AjfReportWidget=m,e.AjfReportLayoutWidget=j,e.AjfReportColumnWidget=_,e.AjfReportPageBreakWidget=w,e.AjfReportImageWidget=v,e.AjfReportImageContainerWidget=A,e.AjfReportTextWidget=T,e.AjfReportFormulaWidget=O,e.AjfReportDataWidget=x,e.AjfReportChartWidget=P,e.AjfReportTableWidget=I,e.AjfReportMapWidget=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core-reports.umd.min.js.map
