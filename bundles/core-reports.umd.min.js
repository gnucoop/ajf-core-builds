!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@ajf/core/models"),require("@ajf/core/utils")):"function"==typeof define&&define.amd?define("@ajf/core/reports",["exports","@angular/core","@ajf/core/models","@ajf/core/utils"],t):t(((e=e||self).ajf=e.ajf||{},e.ajf.core=e.ajf.core||{},e.ajf.core.reports={}),e.ng.core,e.ng.core.models,e.ng.core.utils)}(this,(function(e,t,n,r){"use strict";
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var a,o=function(){function e(e,t){this._cdr=e,this.el=t}return Object.defineProperty(e.prototype,"instance",{get:function(){return this._instance},set:function(e){this._instance!==e&&(this._instance=e,this._cdr.detectChanges())},enumerable:!0,configurable:!0}),e}();
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function i(t){switch(t){case e.AjfChartType.Line:return"line";case e.AjfChartType.Bar:return"bar";case e.AjfChartType.HorizontalBar:return"horizontalBar";case e.AjfChartType.Radar:return"radar";case e.AjfChartType.Scatter:return"scatter";case e.AjfChartType.Doughnut:return"doughnut";case e.AjfChartType.Pie:return"pie";case e.AjfChartType.PolarArea:return"polarArea";case e.AjfChartType.Bubble:return"bubble";default:return"line"}}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */(a=e.AjfChartType||(e.AjfChartType={}))[a.Line=0]="Line",a[a.Bar=1]="Bar",a[a.HorizontalBar=2]="HorizontalBar",a[a.Radar=3]="Radar",a[a.Scatter=4]="Scatter",a[a.Doughnut=5]="Doughnut",a[a.Pie=6]="Pie",a[a.PolarArea=7]="PolarArea",a[a.Bubble=8]="Bubble",a[a.LENGTH=9]="LENGTH";var s,u,l=function(){function e(){}return e.prototype.transform=function(e,t){return t>=0&&t<e.content.length?e.content[t]:null},e.decorators=[{type:t.Pipe,args:[{name:"ajfGetColumnContent"}]}],e}();
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */(s=e.AjfAggregationType||(e.AjfAggregationType={}))[s.None=0]="None",s[s.Sum=1]="Sum",s[s.Average=2]="Average",s[s.WeightedAverage=3]="WeightedAverage",s[s.LENGTH=4]="LENGTH",(
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
u=e.AjfWidgetType||(e.AjfWidgetType={}))[u.Layout=0]="Layout",u[u.PageBreak=1]="PageBreak",u[u.Image=2]="Image",u[u.Text=3]="Text",u[u.Chart=4]="Chart",u[u.Table=5]="Table",u[u.Map=6]="Map",u[u.Column=7]="Column",u[u.Formula=8]="Formula",u[u.ImageContainer=9]="ImageContainer",u[u.LENGTH=10]="LENGTH";
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
var f=function(){function e(e){this._cdr=e}return Object.defineProperty(e.prototype,"instance",{get:function(){return this._instance},set:function(e){this._instance=e,this._report=null!=e?e.report:null,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),e.decorators=[{type:t.Directive}],e.ctorParameters=function(){return[{type:t.ChangeDetectorRef}]},e.propDecorators={instance:[{type:t.Input}]},e}(),c=function(){function e(e){this.viewContainerRef=e}return e.decorators=[{type:t.Directive,args:[{selector:"[ajf-widget-host]"}]}],e.ctorParameters=function(){return[{type:t.ViewContainerRef}]},e}(),p=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[l,c],exports:[l,c]}]}],e}(),g=function(){return(g=Object.assign||function e(t){for(var n,r=1,a=arguments.length;r<a;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function d(t){return g(g({},t),{aggregation:t.aggregation||e.AjfAggregationType.None})}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var y=function(){function e(){}return e.fromJson=function(e){if(null==e.aggregation)throw new Error("Malformed aggregation");return d(g(g({},e),{aggregation:e.aggregation}))},e}(),m=function(){function t(){}return t.fromJson=function(t){if(null==t.formula||null==t.aggregation||null==t.label)throw new Error("Malformed dataset");return t.formula=t.formula instanceof Array?t.formula=t.formula.map((function(e){return n.AjfFormulaSerializer.fromJson(e)})):n.AjfFormulaSerializer.fromJson(t.formula),t.aggregation=y.fromJson(t.aggregation),
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function r(t){return g(g({},t),{aggregation:t.aggregation||d({aggregation:e.AjfAggregationType.None})})}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */(t)},t}();
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function h(e){return g(g({},e),{styles:e.styles||{},visibility:e.visibility||n.alwaysCondition()})}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */var v=function(){function t(){}return t.fromJson=function(r){if(null==r.widgetType)throw new Error("Malformed widget");r.visibility=r.visibility?n.AjfConditionSerializer.fromJson(r.visibility):n.alwaysCondition(),r.styles=r.styles||{};var a=r;if(a.widgetType===e.AjfWidgetType.Layout||a.widgetType===e.AjfWidgetType.Column)return t._widgetWithContentFromJson(a);if(a.widgetType===e.AjfWidgetType.Chart||a.widgetType===e.AjfWidgetType.Table){var o=t._dataWidgetFromJson(a);if(a.widgetType===e.AjfWidgetType.Chart){var i=o;i.labels instanceof Array?i.labels.map((function(e){return n.AjfFormulaSerializer.fromJson(e)})):null!=i.labels&&(i.labels=n.AjfFormulaSerializer.fromJson(i.labels))}return o}return a.widgetType===e.AjfWidgetType.Map&&(a.coordinate=n.AjfFormulaSerializer.fromJson(a.coordinate)),a},t._dataWidgetFromJson=function(t){var n=t.dataset?t.dataset.map(t.widgetType===e.AjfWidgetType.Table?function(e){return e.map((function(e){return m.fromJson(e)}))}:function(e){return m.fromJson(e)}):[];return g(g({},h(t)),{dataset:n})},t._widgetWithContentFromJson=function(e){var n=(e.content||[]).map((function(e){return t.fromJson(e)}));return g(g({},h(e)),{content:n})},t}(),A=function(){function e(){}return e.fromJson=function(e){return e.content=(e.content||[]).map((function(e){return v.fromJson(e)})),g(g({},e),{content:e.content,styles:e.styles||{}})},e}(),T=function(){function e(){}return e.fromJson=function(e){return["header","footer","content"].forEach((function(t){e[t]&&(e[t]=A.fromJson(e[t]))})),
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function t(e){return g({},e)}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */(e)},e}(),j=function(){function e(e,t){this._cfr=e,this._renderer=t,this._init=!1}return Object.defineProperty(e.prototype,"instance",{get:function(){return this._instance},set:function(e){this._instance!==e&&(this._instance=e,this._init&&this._loadComponent())},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this._init=!0,this._loadComponent()},e.prototype._loadComponent=function(){var e=this;if(this._init&&null!=this._instance&&null!=this.widgetHost&&this.instance.visible){var t=this.widgetHost.viewContainerRef;t.clear();var n=this.widgetsMap[this._instance.widget.widgetType];if(null!=n){var r=n.component;try{var a=this._cfr.resolveComponentFactory(r),o=t.createComponent(a).instance;Object.keys(this._instance.widget.styles).forEach((function(t){try{e._renderer.setStyle(o.el.nativeElement,t,""+e._instance.widget.styles[t])}catch(e){}})),o.instance=this._instance,n.inputs&&Object.keys(n.inputs).forEach((function(e){e in o&&(o[e]=n.inputs[e])}))}catch(e){}}}},e.decorators=[{type:t.Directive}],e.ctorParameters=function(){return[{type:t.ComponentFactoryResolver},{type:t.Renderer2}]},e.propDecorators={widgetHost:[{type:t.ViewChild,args:[c,{static:!0}]}],instance:[{type:t.Input}]},e}();
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
function b(t,r,a){var o=r.map((function(e){return n.evaluateExpression(e.formula,a)}));switch(t.aggregation){case e.AjfAggregationType.None:if(1!==o.length)throw new Error("Invalid aggregation");return o[0];case e.AjfAggregationType.Sum:return o.map((function(e){return e.reduce((function(e,t){return e+t}),0)}));case e.AjfAggregationType.Average:case e.AjfAggregationType.WeightedAverage:return o.map((function(e){return e.reduce((function(e,t){return e+t}),0)/o.length}));default:return[]}}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function w(e,t,r){return{widget:e,widgetType:e.widgetType,visible:n.evaluateExpression(e.visibility.condition,t),styles:e.styles||{}}}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function C(t,a,o){var s=w(t,a);if(t.widgetType===e.AjfWidgetType.Column||t.widgetType===e.AjfWidgetType.Layout){var u=t,l=s,f=[];u.content.forEach((function(e){if(null!=u.repetitions){if(l.repetitions=n.evaluateExpression(u.repetitions.formula,a),"number"==typeof l.repetitions&&l.repetitions>0)for(var t=0;t<l.repetitions;t++)f.push(C(e,g(g({},a),{$repetition:t}),o))}else f.push(C(e,a,o));l.content=f}))}else if(t.widgetType===e.AjfWidgetType.Chart){var c=t,p=s,d=(c.labels instanceof Array?c.labels:[c.labels]).map((function(e){var t=n.evaluateExpression(e.formula,a);try{t=t instanceof Array?t.map((function(e){return null!=e&&"string"==typeof e&&e.trim().length>0?o.instant(e):e})):null!=t&&"string"==typeof t&&t.trim().length>0?o.instant(t):t}catch(e){}return t}));if(p.labels=c.labels instanceof Array?d:d[0],p.datasets=c.dataset.map((function(e){var t=g(g({},e.options||{}),{data:b(e.aggregation,e.formula,a)});if(null!=e.chartType){var n=i(e.chartType);t=g(g({},t),{chartType:n,type:n})}return null!=e.options&&(t=g(g({},t),{options:e.options})),null!=e.label&&(t=g(g({},t),{label:e.label})),null!=e.datalabels&&(t.datalabels=r.deepCopy(e.datalabels)),t})),p.data={labels:p.labels,datasets:p.datasets},p.chartType=i(c.type||c.chartType),null!=c.options&&null!=c.options.plugins){var y=c.options.plugins;Object.keys(y).forEach((function(e){var t=y[e];Object.keys(t).forEach((function(e){var r=t[e];"string"!=typeof r&&null!=r&&null!=r.formula&&(t[e]=n.evaluateExpression(r.formula,a))}))}))}}else if(t.widgetType===e.AjfWidgetType.Table){var m=t,h=s,v=function(e){var t=e.formula;if('"'===t.substr(0,1)){var r=t.slice(1,-1),i=null!=r&&"string"==typeof r&&r.trim().length>0?o.instant(r):r;r.length>0&&(t='"'+i+'"')}else t=null!=t&&"string"==typeof t&&t.trim().length>0?o.instant(t):t;return n.evaluateExpression(t,a)};h.dataset=m.dataset.map((function(e){return e.map((function(e){return e.formula instanceof Array?e.formula.map((function(e){return v(e)})):v(e.formula)}))})),h.data=(m.dataset||[]).map((function(e){return e.map((function(e){return{value:n.evaluateExpression(e.formula.formula,a),style:g(g({},m.cellStyles),e.style),rowspan:e.rowspan,colspan:e.colspan}}))}))}else if(t.widgetType===e.AjfWidgetType.Image){var A=t,T=s;A.flag&&(T.flag=n.evaluateExpression(A.flag.formula,a)),A.icon&&(T.icon=n.evaluateExpression(A.icon.formula,a)),A.url&&(T.url=n.evaluateExpression(A.url.formula,a))}else if(t.widgetType===e.AjfWidgetType.ImageContainer){var j=t,E=s;j.flags&&(E.flags=j.flags instanceof Array?j.flags.map((function(e){return n.evaluateExpression(e.formula,a)})):n.evaluateExpression(j.flags.formula,a)),j.icons&&(E.icons=j.icons instanceof Array?j.icons.map((function(e){return n.evaluateExpression(e.formula,a)})):n.evaluateExpression(j.icons.formula,a)),j.urls&&(E.urls=j.urls instanceof Array?j.urls.map((function(e){return n.evaluateExpression(e.formula,a)})):n.evaluateExpression(j.urls.formula,a))}else if(t.widgetType===e.AjfWidgetType.Text){for(var _=s,x=/\[{2}(.+?)\]{2}/g,W=[],J=void 0,P=t.htmlText;J=x.exec(P);){var S=J.index,F=J[0].length,R=n.createFormula({formula:J[1]});W.push({idx:S,len:F,formula:R})}W.reverse().forEach((function(e){var t;try{t=n.evaluateExpression(e.formula.formula,a)}catch(e){t=""}P=""+P.substr(0,e.idx)+t+P.substr(e.idx+e.len)})),_.htmlText=null!=P&&P.length>0?o.instant(P):P}else t.widgetType===e.AjfWidgetType.Formula?s.formula=n.evaluateExpression(t.formula.formula,a):t.widgetType===e.AjfWidgetType.Map&&(s.coordinate=n.evaluateExpression(t.coordinate.formula,a));return s}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */function E(e,t,n){var r=e.content.map((function(e){return C(e,t,n)}));return{container:e,content:r,styles:e.styles}}
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
/**
     * @license
     * Copyright (C) Gnucoop soc. coop.
     *
     * This file is part of the Advanced JSON forms (ajf).
     *
     * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
     * modify it under the terms of the GNU Affero General Public License as
     * published by the Free Software Foundation, either version 3 of the License,
     * or (at your option) any later version.
     *
     * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
     * General Public License for more details.
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with Advanced JSON forms (ajf).
     * If not, see http://www.gnu.org/licenses/.
     *
     */
e.AjfAggregationSerializer=y,e.AjfBaseWidgetComponent=o,e.AjfDatasetSerializer=m,e.AjfGetColumnContentPipe=l,e.AjfReportContainerSerializer=A,e.AjfReportRenderer=f,e.AjfReportSerializer=T,e.AjfReportWidget=j,e.AjfReportsModule=p,e.AjfWidgetHost=c,e.AjfWidgetSerializer=v,e.chartToChartJsType=i,e.createAggregation=d,e.createReportInstance=function _(e,t,r){return(e.variables||[]).forEach((function(e){t[e.name]=n.evaluateExpression(e.formula.formula,t)})),{report:e,header:e.header?E(e.header,t,r):void 0,content:e.content?E(e.content,t,r):void 0,footer:e.footer?E(e.footer,t,r):void 0,styles:e.styles||{}}},e.createWidget=h,e.createWidgetInstance=w,e.widgetToWidgetInstance=C,Object.defineProperty(e,"__esModule",{value:!0})}));