{"version":3,"file":"core-reports.umd.min.js","sources":["../../node_modules/tslib/tslib.es6.js","../../src/core/reports/base-widget.ts","../../src/core/reports/interface/charts/chart-type.ts","../../src/core/reports/chart-utils.ts","../../src/core/reports/interface/aggregation/aggregation-type.ts","../../src/core/reports/interface/widgets/widget-type.ts","../../src/core/reports/report.ts","../../src/core/reports/get-column-content.ts","../../src/core/reports/widget-host.ts","../../src/core/reports/reports-module.ts","../../src/core/reports/utils/aggregation/create-aggregation.ts","../../src/core/reports/serializers/aggregation-serializer.ts","../../src/core/reports/serializers/dataset-serializer.ts","../../src/core/reports/utils/dataset/create-dataset.ts","../../src/core/reports/utils/widgets/create-widget.ts","../../src/core/reports/serializers/widget-serializer.ts","../../src/core/reports/serializers/report-container-serializer.ts","../../src/core/reports/serializers/report-serializer.ts","../../src/core/reports/utils/reports/create-report.ts","../../src/core/reports/widget.ts","../../src/core/reports/utils/widgets-instances/create-widget-instance.ts","../../src/core/reports/utils/widgets-instances/widget-to-widget-instance.ts","../../src/core/reports/utils/aggregation/evaluate-aggregation.ts","../../src/core/reports/utils/reports-instances/create-report-container-instance.ts","../../src/core/reports/utils/reports-instances/create-report-instance.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef} from '@angular/core';\nimport {AjfWidgetInstance} from './interface/widgets-instances/widget-instance';\n\nexport abstract class AjfBaseWidgetComponent<T extends AjfWidgetInstance = AjfWidgetInstance> {\n  private _instance: T;\n  get instance(): T { return this._instance; }\n  set instance(instance: T) {\n    if (this._instance !== instance) {\n      this._instance = instance;\n      this._cdr.detectChanges();\n    }\n  }\n\n  constructor(private _cdr: ChangeDetectorRef) { }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfChartType {\n  Line,\n  Bar,\n  HorizontalBar,\n  Radar,\n  Scatter,\n  Doughnut,\n  Pie,\n  PolarArea,\n  Bubble,\n  LENGTH\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ExtendedChartType} from '@ajf/core/chart';\nimport {AjfChartType} from './interface/charts/chart-type';\n\nexport function chartToChartJsType(chartType?: AjfChartType): ExtendedChartType {\n    switch (chartType) {\n      case AjfChartType.Line:\n      return 'line';\n      case AjfChartType.Bar:\n      return 'bar';\n      case AjfChartType.HorizontalBar:\n      return 'horizontalBar';\n      case AjfChartType.Radar:\n      return 'radar';\n      case AjfChartType.Scatter:\n      return 'scatter';\n      case AjfChartType.Doughnut:\n      return 'doughnut';\n      case AjfChartType.Pie:\n      return 'pie';\n      case AjfChartType.PolarArea:\n      return 'polarArea';\n      case AjfChartType.Bubble:\n      return 'bubble';\n      default:\n      return 'line';\n    }\n  }\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfAggregationType {\n  None,\n  Sum,\n  Average,\n  WeightedAverage,\n  LENGTH\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport enum AjfWidgetType {\n  Layout,\n  PageBreak,\n  Image,\n  Text,\n  Chart,\n  Table,\n  Map,\n  Column,\n  Formula,\n  ImageContainer,\n  LENGTH\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef} from '@angular/core';\n\nimport {AjfReportInstance} from './interface/reports-instances/report-instance';\nimport {AjfReport} from './interface/reports/report';\n\nexport abstract class AjfReportRenderer {\n  private _instance: AjfReportInstance;\n  get instance(): AjfReportInstance { return this._instance; }\n  set instance(instance: AjfReportInstance) {\n    this._instance = instance;\n    this._report = instance != null ? instance.report : null;\n    this._cdr.markForCheck();\n  }\n\n  private _report: AjfReport | null;\n  get report(): AjfReport | null {\n    return this._report;\n  }\n\n  constructor(private _cdr: ChangeDetectorRef) { }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe} from '@angular/core';\nimport {AjfLayoutWidgetInstance} from './interface/widgets-instances/layout-widget-instance';\nimport {AjfWidgetInstance} from './interface/widgets-instances/widget-instance';\n\n@Pipe({name: 'ajfGetColumnContent'})\nexport class AjfGetColumnContentPipe {\n  transform(instance: AjfLayoutWidgetInstance, column: number): AjfWidgetInstance|null {\n    return column >= 0 && column < instance.content.length ? instance.content[column] : null;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Directive, ViewContainerRef} from '@angular/core';\n\n@Directive({selector: '[ajf-widget-host]'})\nexport class AjfWidgetHost {\n  constructor(readonly viewContainerRef: ViewContainerRef) { }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {AjfGetColumnContentPipe} from './get-column-content';\nimport {AjfWidgetHost} from './widget-host';\n\n@NgModule({\n  declarations: [\n    AjfGetColumnContentPipe,\n    AjfWidgetHost,\n  ],\n  exports: [\n    AjfGetColumnContentPipe,\n    AjfWidgetHost,\n  ],\n})\nexport class AjfReportsModule {\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfAggregation} from '../../interface/aggregation/aggregation';\nimport {AjfAggregationType} from '../../interface/aggregation/aggregation-type';\n\nexport type AjfAggregationCreate = Partial<AjfAggregation>;\n\nexport function createAggregation(aggregation: AjfAggregationCreate): AjfAggregation {\n  return {\n    ...aggregation,\n    aggregation: aggregation.aggregation || AjfAggregationType.None,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfAggregation} from '../interface/aggregation/aggregation';\nimport {createAggregation} from '../utils/aggregation/create-aggregation';\n\nexport class AjfAggregationSerializer {\n  static fromJson(json: Partial<AjfAggregation>): AjfAggregation {\n    if (json.aggregation == null) {\n      throw new Error('Malformed aggregation');\n    }\n    return createAggregation({...json, aggregation: json.aggregation});\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfFormulaSerializer} from '@ajf/core/models';\n\nimport {AjfDataset} from '../interface/dataset/dataset';\nimport {createDataset} from '../utils/dataset/create-dataset';\n\nimport {AjfAggregationSerializer} from './aggregation-serializer';\n\nexport class AjfDatasetSerializer {\n  static fromJson(json: Partial<AjfDataset>): AjfDataset {\n    if (json.formula == null || json.aggregation == null || json.label == null) {\n      throw new Error('Malformed dataset');\n    }\n    json.formula = json.formula instanceof Array ?\n        json.formula = json.formula.map(f => AjfFormulaSerializer.fromJson(f)) :\n        AjfFormulaSerializer.fromJson(json.formula);\n    json.aggregation = AjfAggregationSerializer.fromJson(json.aggregation);\n    return createDataset(json);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfAggregationType} from '../../interface/aggregation/aggregation-type';\nimport {AjfDataset} from '../../interface/dataset/dataset';\nimport {createAggregation} from '../aggregation/create-aggregation';\n\nexport function createDataset(dataset: Partial<AjfDataset>): AjfDataset {\n  return {\n    ...dataset,\n    aggregation: dataset.aggregation || createAggregation({aggregation: AjfAggregationType.None}),\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {alwaysCondition} from '@ajf/core/models';\nimport {AjfWidget} from '../../interface/widgets/widget';\n\nexport type AjfWidgetCreate = Pick<AjfWidget, 'widgetType'>&Partial<AjfWidget>;\n\nexport function createWidget(widget: AjfWidgetCreate): AjfWidget {\n  return {\n    ...widget,\n    styles: widget.styles || {},\n    visibility: widget.visibility || alwaysCondition(),\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfConditionSerializer, AjfFormulaSerializer, alwaysCondition} from '@ajf/core/models';\n\nimport {AjfChartDataset} from '../interface/dataset/chart-dataset';\nimport {AjfTableDataset} from '../interface/dataset/table-dataset';\nimport {AjfChartWidget} from '../interface/widgets/chart-widget';\nimport {AjfDataWidget} from '../interface/widgets/data-widget';\nimport {AjfMapWidget} from '../interface/widgets/map-widget';\nimport {AjfWidget} from '../interface/widgets/widget';\nimport {AjfWidgetType} from '../interface/widgets/widget-type';\nimport {AjfWidgetWithContent} from '../interface/widgets/widget-with-content';\nimport {createWidget} from '../utils/widgets/create-widget';\n\nimport {AjfDatasetSerializer} from './dataset-serializer';\n\nexport class AjfWidgetSerializer {\n  static fromJson(json: Partial<AjfWidget>): AjfWidget {\n    if (json.widgetType == null) {\n      throw new Error('Malformed widget');\n    }\n    json.visibility =\n        json.visibility ? AjfConditionSerializer.fromJson(json.visibility) : alwaysCondition();\n    json.styles = json.styles || {};\n    const obj = json as AjfWidget;\n    if (obj.widgetType === AjfWidgetType.Layout || obj.widgetType === AjfWidgetType.Column) {\n      return AjfWidgetSerializer._widgetWithContentFromJson(obj);\n    }\n    if (obj.widgetType === AjfWidgetType.Chart || obj.widgetType === AjfWidgetType.Table) {\n      const w = AjfWidgetSerializer._dataWidgetFromJson(obj);\n      if (obj.widgetType === AjfWidgetType.Chart) {\n        const cw = w as AjfChartWidget;\n        if (cw.labels instanceof Array) {\n          cw.labels.map(l => AjfFormulaSerializer.fromJson(l));\n        } else if (cw.labels != null) {\n          cw.labels = AjfFormulaSerializer.fromJson(cw.labels);\n        }\n      }\n      return w;\n    }\n    if (obj.widgetType === AjfWidgetType.Map) {\n      const mw = obj as AjfMapWidget;\n      mw.coordinate = AjfFormulaSerializer.fromJson(mw.coordinate);\n    }\n    return obj;\n  }\n\n  private static _dataWidgetFromJson(json: AjfWidget&Partial<AjfDataWidget>): AjfDataWidget {\n    const dataset = json.dataset ?\n        (json.widgetType === AjfWidgetType.Table ?\n             (json.dataset as AjfTableDataset[][])\n                 .map(row => row.map(cell => AjfDatasetSerializer.fromJson(cell))) :\n             (json.dataset as AjfChartDataset[]).map(d => AjfDatasetSerializer.fromJson(d))) :\n        [];\n    return {...createWidget(json), dataset};\n  }\n\n  private static _widgetWithContentFromJson(json: AjfWidget&\n                                           Partial<AjfWidgetWithContent>): AjfWidgetWithContent {\n    const content = (json.content || []).map(c => AjfWidgetSerializer.fromJson(c));\n    return {...createWidget(json), content};\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfReportContainer} from '../interface/reports/report-container';\nimport {AjfWidgetSerializer} from './widget-serializer';\n\nexport class AjfReportContainerSerializer {\n  static fromJson(json: Partial<AjfReportContainer>): AjfReportContainer {\n    json.content = (json.content || []).map(c => AjfWidgetSerializer.fromJson(c));\n    return {...json, content: json.content!, styles: json.styles || {}};\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfReport} from '../interface/reports/report';\nimport {AjfReportContainer} from '../interface/reports/report-container';\nimport {createReport} from '../utils/reports/create-report';\nimport {AjfReportContainerSerializer} from './report-container-serializer';\n\nexport class AjfReportSerializer {\n  static fromJson(json: Partial<AjfReport>): AjfReport {\n    const containers: (keyof AjfReport)[] = ['header', 'footer', 'content'];\n    containers.forEach(c => {\n      if (json[c]) {\n        (json[c] as AjfReportContainer) =\n            AjfReportContainerSerializer.fromJson(json[c] as Partial<AjfReportContainer>);\n      }\n    });\n    return createReport(json);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfReport} from '../../interface/reports/report';\n\nexport type AjfReportCreate = Partial<AjfReport>;\n\nexport function createReport(report: AjfReportCreate): AjfReport {\n  return {...report};\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AfterViewInit, ComponentFactoryResolver} from '@angular/core';\n\nimport {AjfWidgetInstance} from './interface/widgets-instances/widget-instance';\nimport {AjfWidgetComponentsMap} from './widget-components-map';\nimport {AjfWidgetHost} from './widget-host';\n\nexport abstract class AjfReportWidget implements AfterViewInit {\n  widgetHost: AjfWidgetHost;\n\n  private _instance: AjfWidgetInstance;\n  get instance(): AjfWidgetInstance { return this._instance; }\n  set instance(instance: AjfWidgetInstance) {\n    if (this._instance !== instance) {\n      this._instance = instance;\n      this._loadComponent();\n    }\n  }\n\n  protected abstract widgetsMap: AjfWidgetComponentsMap;\n\n  constructor(private _cfr: ComponentFactoryResolver) { }\n\n  ngAfterViewInit(): void {\n    this._loadComponent();\n  }\n\n  private _loadComponent(): void {\n    if (this._instance == null || this.widgetHost == null) { return; }\n\n    const vcr = this.widgetHost.viewContainerRef;\n    vcr.clear();\n    const componentDef = this.widgetsMap[this._instance.widget.widgetType];\n    if (componentDef == null) { return; }\n    const component = componentDef.component;\n    try {\n      const componentFactory = this._cfr.resolveComponentFactory(component);\n      const componentRef = vcr.createComponent(componentFactory);\n      const componentInstance = componentRef.instance;\n      componentInstance.instance = this._instance;\n      if (componentDef.inputs) {\n        Object.keys(componentDef.inputs).forEach(key => {\n          if (key in componentInstance) {\n            (componentInstance as any)[key] = componentDef.inputs![key];\n          }\n        });\n      }\n    } catch (e) { }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\nimport {TranslateService} from '@ngx-translate/core';\n\nimport {AjfWidgetInstance} from '../../interface/widgets-instances/widget-instance';\nimport {AjfWidget} from '../../interface/widgets/widget';\n\nexport function createWidgetInstance(\n    widget: AjfWidget, context: AjfContext, ts: TranslateService): AjfWidgetInstance {\n  return {\n    widget,\n    widgetType: widget.widgetType,\n    visible: evaluateExpression(widget.visibility.condition, context),\n    styles: widget.styles || {},\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, AjfFormula, createFormula, evaluateExpression} from '@ajf/core/models';\nimport {deepCopy} from '@ajf/core/utils';\nimport {TranslateService} from '@ngx-translate/core';\n\nimport {chartToChartJsType} from '../../chart-utils';\nimport {AjfChartWidgetInstance} from '../../interface/widgets-instances/chart-widget-instance';\nimport {AjfFormulaWidgetInstance} from '../../interface/widgets-instances/formula-widget-instance';\nimport {\n  AjfImageContainerWidgetInstance\n} from '../../interface/widgets-instances/image-container-widget-instance';\nimport {AjfImageWidgetInstance} from '../../interface/widgets-instances/image-widget-instance';\nimport {AjfMapWidgetInstance} from '../../interface/widgets-instances/map-widget-instance';\nimport {AjfTableWidgetInstance} from '../../interface/widgets-instances/table-widget-instance';\nimport {AjfTextWidgetInstance} from '../../interface/widgets-instances/text-widget-instance';\nimport {AjfWidgetInstance} from '../../interface/widgets-instances/widget-instance';\nimport {\n  AjfWidgetWithContentInstance\n} from '../../interface/widgets-instances/widget-with-content-instance';\nimport {AjfChartWidget} from '../../interface/widgets/chart-widget';\nimport {AjfFormulaWidget} from '../../interface/widgets/formula-widget';\nimport {AjfImageContainerWidget} from '../../interface/widgets/image-container-widget';\nimport {AjfImageWidget} from '../../interface/widgets/image-widget';\nimport {AjfMapWidget} from '../../interface/widgets/map-widget';\nimport {AjfTableWidget} from '../../interface/widgets/table-widget';\nimport {AjfTextWidget} from '../../interface/widgets/text-widget';\nimport {AjfWidget} from '../../interface/widgets/widget';\nimport {AjfWidgetType} from '../../interface/widgets/widget-type';\nimport {AjfWidgetWithContent} from '../../interface/widgets/widget-with-content';\nimport {evaluateAggregation} from '../aggregation/evaluate-aggregation';\n\nimport {createWidgetInstance} from './create-widget-instance';\n\nexport function widgetToWidgetInstance(\n    widget: AjfWidget, context: AjfContext, ts: TranslateService): AjfWidgetInstance {\n  const wi = createWidgetInstance(widget, context, ts);\n  if (widget.widgetType === AjfWidgetType.Column || widget.widgetType === AjfWidgetType.Layout) {\n    const wwc = widget as AjfWidgetWithContent;\n    const wwci = wi as AjfWidgetWithContentInstance;\n    wwci.content = wwc.content.map(c => widgetToWidgetInstance(c, context, ts));\n  } else if (widget.widgetType === AjfWidgetType.Chart) {\n    const cw = widget as AjfChartWidget;\n    const cwi = wi as AjfChartWidgetInstance;\n    const labels = cw.labels instanceof Array ? cw.labels : [cw.labels];\n    cwi.labels = labels.map(l => {\n      let evf = evaluateExpression(l.formula, context);\n      try {\n        if (evf instanceof Array) {\n          evf = evf.map(v => ts.instant(v));\n        } else {\n          evf = ts.instant(evf);\n        }\n      } catch (_e) {\n      }\n      return evf;\n    });\n    cwi.dataset = cw.dataset.map(d => {\n      let ds: any = {\n        ...d.options || {},\n        data: evaluateAggregation(d.aggregation, d.formula, context),\n      };\n      if (d.chartType != null) {\n        const ct = chartToChartJsType(d.chartType);\n        ds = {...ds, chartType: ct, type: ct };\n      }\n      if (d.options != null) {\n        ds = {...ds, options: d.options};\n      }\n      if (d.label != null) {\n        ds = {...ds, label: d.label};\n      }\n      if (d.datalabels != null) {\n        ds.datalabels = deepCopy(d.datalabels);\n      }\n      return ds;\n    });\n    cwi.data = {labels: cwi.labels, datasets: cwi.datasets};\n  } else if (widget.widgetType === AjfWidgetType.Table) {\n    const tw = widget as AjfTableWidget;\n    const twi = wi as AjfTableWidgetInstance;\n    const trFormula = (f: AjfFormula) => {\n      let formula = f.formula;\n      if (formula.substr(0, 1) === '\"') {\n        const ft = formula.slice(1, -1);\n        if (ft.length > 0) {\n          formula = `\"${ts.instant(ft)}\"`;\n        }\n      } else {\n        formula = ts.instant(formula);\n      }\n      return evaluateExpression(formula, context);\n    };\n    twi.dataset = tw.dataset.map(row => row.map(cell => {\n      return cell.formula instanceof Array ? cell.formula.map(f => trFormula(f as AjfFormula)) :\n                                             trFormula(cell.formula!);\n    }));\n    twi.data = (tw.dataset ||\n                []).map(row => row.map(cell => ({\n                                         value: evaluateExpression(cell.formula.formula, context),\n                                         style: {...tw.cellStyles, ...cell.style},\n                                         rowspan: cell.rowspan,\n                                         colspan: cell.colspan,\n                                       })));\n  } else if (widget.widgetType === AjfWidgetType.Image) {\n    const iw = widget as AjfImageWidget;\n    const iwi = wi as AjfImageWidgetInstance;\n    if (iw.flag) {\n      iwi.flag = evaluateExpression(iw.flag.formula, context);\n    }\n    if (iw.icon) {\n      iwi.icon = evaluateExpression(iw.icon.formula, context);\n    }\n    if (iw.url) {\n      iwi.url = evaluateExpression(iw.url.formula, context);\n    }\n  } else if (widget.widgetType === AjfWidgetType.ImageContainer) {\n    const icw = widget as AjfImageContainerWidget;\n    const icwi = wi as AjfImageContainerWidgetInstance;\n    if (icw.flags) {\n      const flags = icw.flags instanceof Array ? icw.flags : [icw.flags];\n      icwi.flags = flags.map(f => evaluateExpression(f.formula, context));\n    }\n    if (icw.icons) {\n      const icons = icw.icons instanceof Array ? icw.icons : [icw.icons];\n      icwi.icons = icons.map(f => evaluateExpression(f.formula, context));\n    }\n    if (icw.urls) {\n      const urls = icw.urls instanceof Array ? icw.urls : [icw.urls];\n      icwi.urls = urls.map(f => evaluateExpression(f.formula, context));\n    }\n  } else if (widget.widgetType === AjfWidgetType.Text) {\n    const tew = widget as AjfTextWidget;\n    const tewi = wi as AjfTextWidgetInstance;\n    const formulaRegEx: RegExp = /\\[\\[(.+?)\\]\\]/g;\n    const matches: {idx: number, len: number, formula: AjfFormula}[] = [];\n    let match: RegExpExecArray|null;\n    let htmlText = tew.htmlText;\n    while (match = formulaRegEx.exec(htmlText)) {\n      const idx = match.index;\n      const len = match[0].length;\n      const formula = createFormula({formula: match[1]});\n      matches.push({idx, len, formula});\n      matches.reverse().forEach((m) => {\n        let calcValue;\n        try {\n          calcValue = evaluateExpression(m.formula.formula, context);\n        } catch (e) {\n          calcValue = '';\n        }\n        htmlText = `${htmlText.substr(0, m.idx)}${calcValue}${htmlText.substr(m.idx + m.len)}`;\n      });\n    }\n    tewi.htmlText = ts.instant(htmlText);\n  } else if (widget.widgetType === AjfWidgetType.Formula) {\n    const fw = widget as AjfFormulaWidget;\n    const fwi = wi as AjfFormulaWidgetInstance;\n    fwi.formula = evaluateExpression(fw.formula.formula, context);\n  } else if (widget.widgetType === AjfWidgetType.Map) {\n    const mw = widget as AjfMapWidget;\n    const mwi = wi as AjfMapWidgetInstance;\n    mwi.coordinate = evaluateExpression(mw.coordinate.formula, context);\n  }\n  return wi;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, AjfFormula, evaluateExpression} from '@ajf/core/models';\nimport {AjfAggregation} from '../../interface/aggregation/aggregation';\nimport {AjfAggregationType} from '../../interface/aggregation/aggregation-type';\n\nexport function evaluateAggregation(\n    aggregation: AjfAggregation, formulas: AjfFormula[], context: AjfContext): number[] {\n  const data: any[] = formulas.map(f => evaluateExpression(f.formula, context));\n  switch (aggregation.aggregation) {\n    case AjfAggregationType.None:\n      if (data.length !== 1) {\n        throw new Error('Invalid aggregation');\n      }\n      return data[0];\n    case AjfAggregationType.Sum:\n      return data.map((r: any) => r.reduce((s: any, d: any) => s + d, 0));\n    case AjfAggregationType.Average:\n    case AjfAggregationType.WeightedAverage:\n      return data.map((r: any) => {\n        const sum = r.reduce((s: any, d: any) => s + d, 0);\n        return sum / data.length;\n      });\n    default:\n      return [];\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\nimport {TranslateService} from '@ngx-translate/core';\n\nimport {\n  AjfReportContainerInstance\n} from '../../interface/reports-instances/report-container-instance';\nimport {AjfReportContainer} from '../../interface/reports/report-container';\nimport {widgetToWidgetInstance} from '../widgets-instances/widget-to-widget-instance';\n\nexport function createReportContainerInstance(\n    container: AjfReportContainer, context: AjfContext,\n    ts: TranslateService): AjfReportContainerInstance {\n  const content = container.content.map(c => widgetToWidgetInstance(c, context, ts));\n  return {\n    container,\n    content,\n    styles: container.styles,\n  };\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\nimport {TranslateService} from '@ngx-translate/core';\n\nimport {AjfReportInstance} from '../../interface/reports-instances/report-instance';\nimport {AjfReport} from '../../interface/reports/report';\n\nimport {createReportContainerInstance} from './create-report-container-instance';\n\nexport function createReportInstance(\n    report: AjfReport, context: AjfContext, ts: TranslateService): AjfReportInstance {\n  return {\n    report,\n    header: report.header ? createReportContainerInstance(report.header, context, ts) : undefined,\n    content: report.content ? createReportContainerInstance(report.content, context, ts) :\n                              undefined,\n    footer: report.footer ? createReportContainerInstance(report.footer, context, ts) : undefined,\n    styles: report.styles || {},\n  };\n}\n"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","defineProperty","AjfBaseWidgetComponent","_instance","instance","_cdr","detectChanges","Line","Bar","HorizontalBar","Radar","Scatter","Doughnut","Pie","PolarArea","Bubble","LENGTH","chartToChartJsType","chartType","AjfChartType","None","Sum","Average","WeightedAverage","Layout","PageBreak","Image","Text","Chart","Table","Map","Column","Formula","ImageContainer","AjfReportRenderer","_report","report","markForCheck","AjfGetColumnContentPipe","transform","column","content","type","Pipe","args","name","AjfWidgetHost","Directive","selector","ViewContainerRef","viewContainerRef","AjfReportsModule","NgModule","declarations","exports","createAggregation","aggregation","tslib_1.__assign","AjfAggregationType","AjfAggregationSerializer","fromJson","json","Error","AjfDatasetSerializer","formula","label","Array","map","f","AjfFormulaSerializer","dataset","createDataset","createWidget","widget","styles","visibility","alwaysCondition","AjfWidgetSerializer","widgetType","AjfConditionSerializer","obj","AjfWidgetType","_widgetWithContentFromJson","w","_dataWidgetFromJson","cw","labels","l","mw","coordinate","row","cell","d","c","AjfReportContainerSerializer","AjfReportSerializer","forEach","createReport","AjfReportWidget","_loadComponent","ngAfterViewInit","widgetHost","vcr","clear","componentDef","widgetsMap","component","componentFactory","_cfr","resolveComponentFactory","componentInstance_1","createComponent","inputs","keys","key","e","createWidgetInstance","context","ts","visible","evaluateExpression","condition","widgetToWidgetInstance","wi","wwc","cwi","evf","v","instant","_e","ds","options","data","formulas","r","reduce","evaluateAggregation","ct","datalabels","deepCopy","datasets","tw_1","twi","trFormula_1","substr","ft","slice","value","style","cellStyles","rowspan","colspan","iw","iwi","flag","icon","url","icw","icwi","flags","icons","urls","tewi","formulaRegEx","matches","match","htmlText_1","htmlText","exec","idx","index","len","createFormula","push","reverse","m","calcValue","fw","createReportContainerInstance","container","header","undefined","footer"],"mappings":"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"}