/**
 * @license
 * Copyright (C) Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
import { deepCopy } from '@ajf/core/utils';
import { AjfFieldType } from './interface/fields/field-type';
import { AjfFormSerializer } from './serializers/form-serializer';
import { isField } from './utils/nodes/is-field';
import { isRepeatingSlide } from './utils/nodes/is-repeating-slide';
function generateRandomInstanceFields(fields) {
    const fieldReps = [];
    fields.forEach(f => {
        for (let i = 0; i < 5; i++) {
            const newReps = deepCopy(f);
            newReps.name = `${newReps.name}__${i}`;
            fieldReps.push(newReps);
        }
    });
    return fieldReps;
}
function flattenFields(slides) {
    let flatFields = [];
    slides.forEach(slide => {
        if (isField(slide)) {
            flatFields.push(slide);
        }
        else if (isRepeatingSlide(slide)) {
            const childs = generateRandomInstanceFields(slide.nodes);
            flatFields = flatFields.concat(flattenFields(childs));
        }
        else {
            flatFields = flatFields.concat([...slide.nodes]);
        }
    });
    return flatFields;
}
export function generateRandomCtx(formSchema) {
    const ctxMap = [];
    const allFields = flattenFields(formSchema.nodes);
    const generateRandomNumberOfContext = Math.floor(Math.random() * 100) + 1;
    for (let i = 0; i < generateRandomNumberOfContext; i++) {
        const ctx = {};
        allFields.forEach(field => {
            switch (field.fieldType) {
                default:
                    ctx[field.name] = 0;
                    break;
                case AjfFieldType.Number:
                    ctx[field.name] = Math.floor(Math.random() * 1000) + 1;
                    break;
                case AjfFieldType.Boolean:
                    ctx[field.name] = Math.random() < 0.5;
                    break;
                case AjfFieldType.SingleChoice:
                    const singleChoices = field.choicesOrigin.choices.map(c => c.value);
                    ctx[field.name] = singleChoices[Math.floor(Math.random() * singleChoices.length)];
                    break;
                case AjfFieldType.MultipleChoice:
                    const multipleChoices = field.choicesOrigin.choices.map(c => c.value);
                    ctx[field.name] = [
                        multipleChoices[Math.floor(Math.random() * multipleChoices.length)],
                        multipleChoices[Math.floor(Math.random() * multipleChoices.length)],
                    ];
                    break;
                case AjfFieldType.Range:
                    const end = field.end ?? 10;
                    const start = field.start ?? 1;
                    const value = Math.floor(start + Math.random() * (end + 1 - start));
                    ctx[field.name] = value;
            }
        });
        ctxMap.push(ctx);
    }
    return ctxMap;
}
export function buildformDatas(formSchemas) {
    const forms = {};
    Object.keys(formSchemas).forEach(nameSchema => {
        forms[nameSchema] = generateRandomCtx(AjfFormSerializer.fromJson(formSchemas[nameSchema]));
    });
    return forms;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZG9tLWFqZi1jb250ZXh0LWdlbmVyYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2NvcmUvZm9ybXMvc3JjL3JhbmRvbS1hamYtY29udGV4dC1nZW5lcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBb0JHO0FBR0gsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBRXpDLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQztBQUczRCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQztBQUVoRSxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDL0MsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFFbEUsU0FBUyw0QkFBNEIsQ0FBQyxNQUFrQjtJQUN0RCxNQUFNLFNBQVMsR0FBZSxFQUFFLENBQUM7SUFDakMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtRQUNqQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzFCLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QixPQUFPLENBQUMsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUN2QyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsTUFBaUI7SUFDdEMsSUFBSSxVQUFVLEdBQWUsRUFBRSxDQUFDO0lBQ2hDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVB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R0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDO29CQUM1QixNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztvQkFDL0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUNwRSxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQzthQUMzQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNsQjtJQUNELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYyxDQUFDLFdBQTRDO0lBR3pFLE1BQU0sS0FBSyxHQUFtQyxFQUFFLENBQUM7SUFDakQsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7UUFDNUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdGLENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IChDKSBHbnVjb29wIHNvYy4gY29vcC5cbiAqXG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiB0aGUgQWR2YW5jZWQgSlNPTiBmb3JtcyAoYWpmKS5cbiAqXG4gKiBBZHZhbmNlZCBKU09OIGZvcm1zIChhamYpIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vclxuICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzXG4gKiBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSxcbiAqIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogQWR2YW5jZWQgSlNPTiBmb3JtcyAoYWpmKSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlUgQWZmZXJvXG4gKiBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIEFkdmFuY2VkIEpTT04gZm9ybXMgKGFqZikuXG4gKiBJZiBub3QsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvLlxuICpcbiAqL1xuXG5pbXBvcnQge0FqZkNvbnRleHR9IGZyb20gJ0BhamYvY29yZS9jb21tb24nO1xuaW1wb3J0IHtkZWVwQ29weX0gZnJvbSAnQGFqZi9jb3JlL3V0aWxzJztcbmltcG9ydCB7QWpmRmllbGR9IGZyb20gJy4vaW50ZXJmYWNlL2ZpZWxkcy9maWVsZCc7XG5pbXBvcnQge0FqZkZpZWxkVHlwZX0gZnJvbSAnLi9pbnRlcmZhY2UvZmllbGRzL2ZpZWxkLXR5cGUnO1xuaW1wb3J0IHtBamZDb250YWluZXJOb2RlfSBmcm9tICcuL2ludGVyZmFjZS9ub2Rlcy9jb250YWluZXItbm9kZSc7XG5pbXBvcnQge0FqZk5vZGV9IGZyb20gJy4vaW50ZXJmYWNlL25vZGVzL25vZGUnO1xuaW1wb3J0IHtBamZGb3JtU2VyaWFsaXplcn0gZnJvbSAnLi9zZXJpYWxpemVycy9mb3JtLXNlcmlhbGl6ZXInO1xuaW1wb3J0IHtBamZGb3JtQ3JlYXRlfSBmcm9tICcuL3V0aWxzL2Zvcm1zL2NyZWF0ZS1mb3JtJztcbmltcG9ydCB7aXNGaWVsZH0gZnJvbSAnLi91dGlscy9ub2Rlcy9pcy1maWVsZCc7XG5pbXBvcnQge2lzUmVwZWF0aW5nU2xpZGV9IGZyb20gJy4vdXRpbHMvbm9kZXMvaXMtcmVwZWF0aW5nLXNsaWRlJztcblxuZnVuY3Rpb24gZ2VuZXJhdGVSYW5kb21JbnN0YW5jZUZpZWxkcyhmaWVsZHM6IEFqZkZpZWxkW10pOiBBamZGaWVsZFtdIHtcbiAgY29uc3QgZmllbGRSZXBzOiBBamZGaWVsZFtdID0gW107XG4gIGZpZWxkcy5mb3JFYWNoKGYgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICBjb25zdCBuZXdSZXBzID0gZGVlcENvcHkoZik7XG4gICAgICBuZXdSZXBzLm5hbWUgPSBgJHtuZXdSZXBzLm5hbWV9X18ke2l9YDtcbiAgICAgIGZpZWxkUmVwcy5wdXNoKG5ld1JlcHMpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmaWVsZFJlcHM7XG59XG5cbmZ1bmN0aW9uIGZsYXR0ZW5GaWVsZHMoc2xpZGVzOiBBamZOb2RlW10pOiBBamZGaWVsZFtdIHtcbiAgbGV0IGZsYXRGaWVsZHM6IEFqZkZpZWxkW10gPSBbXTtcbiAgc2xpZGVzLmZvckVhY2goc2xpZGUgPT4ge1xuICAgIGlmIChpc0ZpZWxkKHNsaWRlKSkge1xuICAgICAgZmxhdEZpZWxkcy5wdXNoKHNsaWRlKTtcbiAgICB9IGVsc2UgaWYgKGlzUmVwZWF0aW5nU2xpZGUoc2xpZGUpKSB7XG4gICAgICBjb25zdCBjaGlsZHMgPSBnZW5lcmF0ZVJhbmRvbUluc3RhbmNlRmllbGRzKHNsaWRlLm5vZGVzIGFzIEFqZkZpZWxkW10pO1xuICAgICAgZmxhdEZpZWxkcyA9IGZsYXRGaWVsZHMuY29uY2F0KGZsYXR0ZW5GaWVsZHMoY2hpbGRzKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZsYXRGaWVsZHMgPSBmbGF0RmllbGRzLmNvbmNhdChbLi4uKChzbGlkZSBhcyBBamZDb250YWluZXJOb2RlKS5ub2RlcyBhcyBBamZGaWVsZFtdKV0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmbGF0RmllbGRzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVSYW5kb21DdHgoZm9ybVNjaGVtYTogQWpmRm9ybUNyZWF0ZSk6IEFqZkNvbnRleHRbXSB7XG4gIGNvbnN0IGN0eE1hcDogQWpmQ29udGV4dFtdID0gW107XG4gIGNvbnN0IGFsbEZpZWxkczogQWpmRmllbGRbXSA9IGZsYXR0ZW5GaWVsZHMoZm9ybVNjaGVtYS5ub2RlcyEpO1xuICBjb25zdCBnZW5lcmF0ZVJhbmRvbU51bWJlck9mQ29udGV4dCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCkgKyAxO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGdlbmVyYXRlUmFuZG9tTnVtYmVyT2ZDb250ZXh0OyBpKyspIHtcbiAgICBjb25zdCBjdHg6IEFqZkNvbnRleHQgPSB7fTtcbiAgICBhbGxGaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICBzd2l0Y2ggKGZpZWxkLmZpZWxkVHlwZSkge1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGN0eFtmaWVsZC5uYW1lXSA9IDA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWpmRmllbGRUeXBlLk51bWJlcjpcbiAgICAgICAgICBjdHhbZmllbGQubmFtZV0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwKSArIDE7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWpmRmllbGRUeXBlLkJvb2xlYW46XG4gICAgICAgICAgY3R4W2ZpZWxkLm5hbWVdID0gTWF0aC5yYW5kb20oKSA8IDAuNTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBamZGaWVsZFR5cGUuU2luZ2xlQ2hvaWNlOlxuICAgICAgICAgIGNvbnN0IHNpbmdsZUNob2ljZXMgPSBmaWVsZC5jaG9pY2VzT3JpZ2luLmNob2ljZXMubWFwKGMgPT4gYy52YWx1ZSk7XG4gICAgICAgICAgY3R4W2ZpZWxkLm5hbWVdID0gc2luZ2xlQ2hvaWNlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzaW5nbGVDaG9pY2VzLmxlbmd0aCldO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFqZkZpZWxkVHlwZS5NdWx0aXBsZUNob2ljZTpcbiAgICAgICAgICBjb25zdCBtdWx0aXBsZUNob2ljZXMgPSBmaWVsZC5jaG9pY2VzT3JpZ2luLmNob2ljZXMubWFwKGMgPT4gYy52YWx1ZSk7XG4gICAgICAgICAgY3R4W2ZpZWxkLm5hbWVdID0gW1xuICAgICAgICAgICAgbXVsdGlwbGVDaG9pY2VzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG11bHRpcGxlQ2hvaWNlcy5sZW5ndGgpXSxcbiAgICAgICAgICAgIG11bHRpcGxlQ2hvaWNlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtdWx0aXBsZUNob2ljZXMubGVuZ3RoKV0sXG4gICAgICAgICAgXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBamZGaWVsZFR5cGUuUmFuZ2U6XG4gICAgICAgICAgY29uc3QgZW5kID0gZmllbGQuZW5kID8/IDEwO1xuICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gZmllbGQuc3RhcnQgPz8gMTtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGguZmxvb3Ioc3RhcnQgKyBNYXRoLnJhbmRvbSgpICogKGVuZCArIDEgLSBzdGFydCkpO1xuICAgICAgICAgIGN0eFtmaWVsZC5uYW1lXSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGN0eE1hcC5wdXNoKGN0eCk7XG4gIH1cbiAgcmV0dXJuIGN0eE1hcDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkZm9ybURhdGFzKGZvcm1TY2hlbWFzOiB7W25hbWU6IHN0cmluZ106IEFqZkZvcm1DcmVhdGV9KToge1xuICBbbmFtZTogc3RyaW5nXTogQWpmQ29udGV4dFtdO1xufSB7XG4gIGNvbnN0IGZvcm1zOiB7W25hbWU6IHN0cmluZ106IEFqZkNvbnRleHRbXX0gPSB7fTtcbiAgT2JqZWN0LmtleXMoZm9ybVNjaGVtYXMpLmZvckVhY2gobmFtZVNjaGVtYSA9PiB7XG4gICAgZm9ybXNbbmFtZVNjaGVtYV0gPSBnZW5lcmF0ZVJhbmRvbUN0eChBamZGb3JtU2VyaWFsaXplci5mcm9tSnNvbihmb3JtU2NoZW1hc1tuYW1lU2NoZW1hXSkpO1xuICB9KTtcbiAgcmV0dXJuIGZvcm1zO1xufVxuIl19