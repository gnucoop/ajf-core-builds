/**
 * @license
 * Copyright (C) Gnucoop soc. coop.
 *
 * This file is part of the Advanced JSON forms (ajf).
 *
 * Advanced JSON forms (ajf) is free software: you can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the License,
 * or (at your option) any later version.
 *
 * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
 * General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Advanced JSON forms (ajf).
 * If not, see http://www.gnu.org/licenses/.
 *
 */
import { deepCopy } from '@ajf/core/utils';
import { AjfFieldType } from './interface/fields/field-type';
import { AjfFormSerializer } from './serializers/form-serializer';
import { isField } from './utils/nodes/is-field';
import { isRepeatingSlide } from './utils/nodes/is-repeating-slide';
function generateRandomInstanceFields(fields) {
    const fieldReps = [];
    fields.forEach(f => {
        for (let i = 0; i < 5; i++) {
            const newReps = deepCopy(f);
            newReps.name = `${newReps.name}__${i}`;
            fieldReps.push(newReps);
        }
    });
    return fieldReps;
}
function flattenFields(slides) {
    let flatFields = [];
    slides.forEach((slide) => {
        if (isField(slide)) {
            flatFields.push(slide);
        }
        else if (isRepeatingSlide(slide)) {
            const childs = generateRandomInstanceFields(slide.nodes);
            flatFields = flatFields.concat(flattenFields(childs));
        }
        else {
            flatFields = flatFields.concat([...slide.nodes]);
        }
    });
    return flatFields;
}
export function generateRandomCtx(formSchema) {
    const ctxMap = [];
    const allFields = flattenFields(formSchema.nodes);
    const generateRandomNumberOfContext = Math.floor(Math.random() * 100) + 1;
    for (let i = 0; i < generateRandomNumberOfContext; i++) {
        const ctx = {};
        allFields.forEach(field => {
            switch (field.fieldType) {
                default:
                    ctx[field.name] = 0;
                    break;
                case AjfFieldType.Number:
                    ctx[field.name] = Math.floor(Math.random() * 1000) + 1;
                    break;
                case AjfFieldType.Boolean:
                    ctx[field.name] = Math.random() < 0.5;
                    break;
                case AjfFieldType.SingleChoice:
                    const singleChoices = field.choicesOrigin.choices.map(c => c.value);
                    ctx[field.name] = singleChoices[Math.floor(Math.random() * singleChoices.length)];
                    break;
                case AjfFieldType.MultipleChoice:
                    const multipleChoices = field.choicesOrigin.choices.map(c => c.value);
                    ctx[field.name] = [
                        multipleChoices[Math.floor(Math.random() * multipleChoices.length)],
                        multipleChoices[Math.floor(Math.random() * multipleChoices.length)],
                    ];
                    break;
                case AjfFieldType.Range:
                    const rangeField = field;
                    const end = rangeField.end ?? 10;
                    const start = rangeField.start ?? 1;
                    const value = Math.floor(start + Math.random() * (end + 1 - start));
                    ctx[field.name] = value;
            }
        });
        ctxMap.push(ctx);
    }
    return ctxMap;
}
export function buildformDatas(formSchemas) {
    const forms = {};
    Object.keys(formSchemas).forEach(nameSchema => {
        forms[nameSchema] = generateRandomCtx(AjfFormSerializer.fromJson(formSchemas[nameSchema]));
    });
    return forms;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZG9tLWFqZi1jb250ZXh0LWdlbmVyYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb3JlL2Zvcm1zL3JhbmRvbS1hamYtY29udGV4dC1nZW5lcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBb0JHO0FBR0gsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBRXpDLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQztBQUszRCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQztBQUVoRSxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDL0MsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFFbEUsU0FBUyw0QkFBNEIsQ0FBQyxNQUFrQjtJQUN0RCxNQUFNLFNBQVMsR0FBZSxFQUFFLENBQUM7SUFDakMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtRQUNqQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzFCLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QixPQUFPLENBQUMsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUN2QyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsTUFBaUI7SUFDdEMsSUFBSSxVQUFVLEdBQWUsRUFBRSxDQUFDO0lBQ2hDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFjLEVBQUUs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LE1BQU0sVUFBVSxHQUFHLEtBQXNCLENBQUM7b0JBQzFDLE1BQU0sR0FBRyxHQUFHLFVBQVUsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDO29CQUNqQyxNQUFNLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztvQkFDcEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUNwRSxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQzthQUMzQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNsQjtJQUNELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYyxDQUFDLFdBQTRDO0lBR3pFLE1BQU0sS0FBSyxHQUFtQyxFQUFFLENBQUM7SUFDakQsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7UUFDNUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdGLENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IChDKSBHbnVjb29wIHNvYy4gY29vcC5cbiAqXG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiB0aGUgQWR2YW5jZWQgSlNPTiBmb3JtcyAoYWpmKS5cbiAqXG4gKiBBZHZhbmNlZCBKU09OIGZvcm1zIChhamYpIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vclxuICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzXG4gKiBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSxcbiAqIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogQWR2YW5jZWQgSlNPTiBmb3JtcyAoYWpmKSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlUgQWZmZXJvXG4gKiBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIEFkdmFuY2VkIEpTT04gZm9ybXMgKGFqZikuXG4gKiBJZiBub3QsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvLlxuICpcbiAqL1xuXG5pbXBvcnQge0FqZkNvbnRleHR9IGZyb20gJ0BhamYvY29yZS9jb21tb24nO1xuaW1wb3J0IHtkZWVwQ29weX0gZnJvbSAnQGFqZi9jb3JlL3V0aWxzJztcbmltcG9ydCB7QWpmRmllbGR9IGZyb20gJy4vaW50ZXJmYWNlL2ZpZWxkcy9maWVsZCc7XG5pbXBvcnQge0FqZkZpZWxkVHlwZX0gZnJvbSAnLi9pbnRlcmZhY2UvZmllbGRzL2ZpZWxkLXR5cGUnO1xuaW1wb3J0IHtBamZGaWVsZFdpdGhDaG9pY2VzfSBmcm9tICcuL2ludGVyZmFjZS9maWVsZHMvZmllbGQtd2l0aC1jaG9pY2VzJztcbmltcG9ydCB7QWpmUmFuZ2VGaWVsZH0gZnJvbSAnLi9pbnRlcmZhY2UvZmllbGRzL3JhbmdlLWZpZWxkJztcbmltcG9ydCB7QWpmQ29udGFpbmVyTm9kZX0gZnJvbSAnLi9pbnRlcmZhY2Uvbm9kZXMvY29udGFpbmVyLW5vZGUnO1xuaW1wb3J0IHtBamZOb2RlfSBmcm9tICcuL2ludGVyZmFjZS9ub2Rlcy9ub2RlJztcbmltcG9ydCB7QWpmRm9ybVNlcmlhbGl6ZXJ9IGZyb20gJy4vc2VyaWFsaXplcnMvZm9ybS1zZXJpYWxpemVyJztcbmltcG9ydCB7QWpmRm9ybUNyZWF0ZX0gZnJvbSAnLi91dGlscy9mb3Jtcy9jcmVhdGUtZm9ybSc7XG5pbXBvcnQge2lzRmllbGR9IGZyb20gJy4vdXRpbHMvbm9kZXMvaXMtZmllbGQnO1xuaW1wb3J0IHtpc1JlcGVhdGluZ1NsaWRlfSBmcm9tICcuL3V0aWxzL25vZGVzL2lzLXJlcGVhdGluZy1zbGlkZSc7XG5cbmZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tSW5zdGFuY2VGaWVsZHMoZmllbGRzOiBBamZGaWVsZFtdKTogQWpmRmllbGRbXSB7XG4gIGNvbnN0IGZpZWxkUmVwczogQWpmRmllbGRbXSA9IFtdO1xuICBmaWVsZHMuZm9yRWFjaChmID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgY29uc3QgbmV3UmVwcyA9IGRlZXBDb3B5KGYpO1xuICAgICAgbmV3UmVwcy5uYW1lID0gYCR7bmV3UmVwcy5uYW1lfV9fJHtpfWA7XG4gICAgICBmaWVsZFJlcHMucHVzaChuZXdSZXBzKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZmllbGRSZXBzO1xufVxuXG5mdW5jdGlvbiBmbGF0dGVuRmllbGRzKHNsaWRlczogQWpmTm9kZVtdKTogQWpmRmllbGRbXSB7XG4gIGxldCBmbGF0RmllbGRzOiBBamZGaWVsZFtdID0gW107XG4gIHNsaWRlcy5mb3JFYWNoKChzbGlkZTogQWpmTm9kZSkgPT4ge1xuICAgIGlmIChpc0ZpZWxkKHNsaWRlKSkge1xuICAgICAgZmxhdEZpZWxkcy5wdXNoKHNsaWRlIGFzIEFqZkZpZWxkKTtcbiAgICB9IGVsc2UgaWYgKGlzUmVwZWF0aW5nU2xpZGUoc2xpZGUpKSB7XG4gICAgICBjb25zdCBjaGlsZHMgPSBnZW5lcmF0ZVJhbmRvbUluc3RhbmNlRmllbGRzKChzbGlkZSBhcyBBamZDb250YWluZXJOb2RlKS5ub2RlcyBhcyBBamZGaWVsZFtdKTtcbiAgICAgIGZsYXRGaWVsZHMgPSBmbGF0RmllbGRzLmNvbmNhdChmbGF0dGVuRmllbGRzKGNoaWxkcykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmbGF0RmllbGRzID0gZmxhdEZpZWxkcy5jb25jYXQoWy4uLigoc2xpZGUgYXMgQWpmQ29udGFpbmVyTm9kZSkubm9kZXMgYXMgQWpmRmllbGRbXSldKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZmxhdEZpZWxkcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tQ3R4KGZvcm1TY2hlbWE6IEFqZkZvcm1DcmVhdGUpOiBBamZDb250ZXh0W10ge1xuICBjb25zdCBjdHhNYXA6IEFqZkNvbnRleHRbXSA9IFtdO1xuICBjb25zdCBhbGxGaWVsZHM6IEFqZkZpZWxkW10gPSBmbGF0dGVuRmllbGRzKGZvcm1TY2hlbWEubm9kZXMhKTtcbiAgY29uc3QgZ2VuZXJhdGVSYW5kb21OdW1iZXJPZkNvbnRleHQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApICsgMTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBnZW5lcmF0ZVJhbmRvbU51bWJlck9mQ29udGV4dDsgaSsrKSB7XG4gICAgY29uc3QgY3R4OiBBamZDb250ZXh0ID0ge307XG4gICAgYWxsRmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgc3dpdGNoIChmaWVsZC5maWVsZFR5cGUpIHtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBjdHhbZmllbGQubmFtZV0gPSAwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFqZkZpZWxkVHlwZS5OdW1iZXI6XG4gICAgICAgICAgY3R4W2ZpZWxkLm5hbWVdID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCkgKyAxO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFqZkZpZWxkVHlwZS5Cb29sZWFuOlxuICAgICAgICAgIGN0eFtmaWVsZC5uYW1lXSA9IE1hdGgucmFuZG9tKCkgPCAwLjU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWpmRmllbGRUeXBlLlNpbmdsZUNob2ljZTpcbiAgICAgICAgICBjb25zdCBzaW5nbGVDaG9pY2VzID0gKGZpZWxkIGFzIEFqZkZpZWxkV2l0aENob2ljZXM8YW55PikuY2hvaWNlc09yaWdpbi5jaG9pY2VzLm1hcChcbiAgICAgICAgICAgIGMgPT4gYy52YWx1ZSxcbiAgICAgICAgICApO1xuICAgICAgICAgIGN0eFtmaWVsZC5uYW1lXSA9IHNpbmdsZUNob2ljZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc2luZ2xlQ2hvaWNlcy5sZW5ndGgpXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBamZGaWVsZFR5cGUuTXVsdGlwbGVDaG9pY2U6XG4gICAgICAgICAgY29uc3QgbXVsdGlwbGVDaG9pY2VzID0gKGZpZWxkIGFzIEFqZkZpZWxkV2l0aENob2ljZXM8YW55PikuY2hvaWNlc09yaWdpbi5jaG9pY2VzLm1hcChcbiAgICAgICAgICAgIGMgPT4gYy52YWx1ZSxcbiAgICAgICAgICApO1xuICAgICAgICAgIGN0eFtmaWVsZC5uYW1lXSA9IFtcbiAgICAgICAgICAgIG11bHRpcGxlQ2hvaWNlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtdWx0aXBsZUNob2ljZXMubGVuZ3RoKV0sXG4gICAgICAgICAgICBtdWx0aXBsZUNob2ljZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbXVsdGlwbGVDaG9pY2VzLmxlbmd0aCldLFxuICAgICAgICAgIF07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQWpmRmllbGRUeXBlLlJhbmdlOlxuICAgICAgICAgIGNvbnN0IHJhbmdlRmllbGQgPSBmaWVsZCBhcyBBamZSYW5nZUZpZWxkO1xuICAgICAgICAgIGNvbnN0IGVuZCA9IHJhbmdlRmllbGQuZW5kID8/IDEwO1xuICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gcmFuZ2VGaWVsZC5zdGFydCA/PyAxO1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5mbG9vcihzdGFydCArIE1hdGgucmFuZG9tKCkgKiAoZW5kICsgMSAtIHN0YXJ0KSk7XG4gICAgICAgICAgY3R4W2ZpZWxkLm5hbWVdID0gdmFsdWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgY3R4TWFwLnB1c2goY3R4KTtcbiAgfVxuICByZXR1cm4gY3R4TWFwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRmb3JtRGF0YXMoZm9ybVNjaGVtYXM6IHtbbmFtZTogc3RyaW5nXTogQWpmRm9ybUNyZWF0ZX0pOiB7XG4gIFtuYW1lOiBzdHJpbmddOiBBamZDb250ZXh0W107XG59IHtcbiAgY29uc3QgZm9ybXM6IHtbbmFtZTogc3RyaW5nXTogQWpmQ29udGV4dFtdfSA9IHt9O1xuICBPYmplY3Qua2V5cyhmb3JtU2NoZW1hcykuZm9yRWFjaChuYW1lU2NoZW1hID0+IHtcbiAgICBmb3Jtc1tuYW1lU2NoZW1hXSA9IGdlbmVyYXRlUmFuZG9tQ3R4KEFqZkZvcm1TZXJpYWxpemVyLmZyb21Kc29uKGZvcm1TY2hlbWFzW25hbWVTY2hlbWFdKSk7XG4gIH0pO1xuICByZXR1cm4gZm9ybXM7XG59XG4iXX0=