{"version":3,"file":"ajf-core-echarts.mjs","sources":["../../../projects/core/echarts/src/echarts-config.ts","../../../projects/core/echarts/src/echarts-directive.ts","../../../projects/core/echarts/src/echarts-module.ts","../../../projects/core/echarts/src/public_api.ts","../../../projects/core/echarts/src/ajf-core-echarts.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nexport type EchartsModule = any;\n\nexport type AjfEchartsProvider = () => Promise<EchartsModule>;\n\nexport interface AjfEchartsConfig {\n  echarts: EchartsModule | AjfEchartsProvider;\n}\n\nexport const AJF_ECHARTS_PROVIDER = new InjectionToken<AjfEchartsProvider>('AJF_ECHARTS_PROVIDER');\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\n/// <reference types=\"resize-observer-browser\" />\n\nimport {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  Inject,\n  Input,\n  NgZone,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  SimpleChanges,\n} from '@angular/core';\nimport {Subscription} from 'rxjs';\nimport {debounceTime} from 'rxjs/operators';\n\nimport {AjfEchartsProvider, AJF_ECHARTS_PROVIDER} from './echarts-config';\n\nexport type EChartsRenderer = 'canvas' | 'svg';\n\nexport interface AjfEchartsInitEvent {\n  echarts: any;\n  chart: echarts.ECharts;\n}\n\n@Directive({selector: '[ajfEcharts]', exportAs: 'ajfEcharts'})\nexport class AjfEchartsDirective implements OnChanges, OnDestroy, OnInit {\n  @Input()\n  set theme(theme: string | object | undefined) {\n    this._theme = theme;\n  }\n  private _theme?: string | object;\n\n  @Input()\n  set renderer(renderer: EChartsRenderer) {\n    this._renderer = renderer;\n  }\n  private _renderer: EChartsRenderer = 'canvas';\n\n  @Input()\n  set options(options: echarts.EChartsOption | undefined) {\n    this._options = options;\n  }\n  private _options?: echarts.EChartsOption;\n\n  @Output()\n  readonly chartInit = new EventEmitter<AjfEchartsInitEvent>();\n\n  private _echarts?: any;\n  private _container: HTMLElement;\n  private _chart?: echarts.ECharts;\n  private _resizeObserver?: ResizeObserver;\n  private _resizeEvent = new EventEmitter<void>();\n  private _resizeSub = Subscription.EMPTY;\n\n  constructor(\n    @Inject(AJF_ECHARTS_PROVIDER) private _echartsProvider: AjfEchartsProvider,\n    el: ElementRef<HTMLElement>,\n    private _ngZone: NgZone,\n  ) {\n    this._container = el.nativeElement;\n    if (typeof ResizeObserver !== 'undefined') {\n      this._resizeObserver = new ResizeObserver(() => this._onResize());\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['theme'] != null || changes['renderer'] != null) {\n      this._destroyChart();\n      this._initChart();\n    } else if (changes['options'] != null) {\n      if (this._options) {\n        if (this._chart != null) {\n          this._chart.setOption(this._options);\n        } else {\n          this._initChart();\n        }\n      } else {\n        this._destroyChart();\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this._resizeObserver != null) {\n      this._resizeObserver.unobserve(this._container);\n      this._resizeObserver.disconnect();\n    }\n    this._resizeEvent.complete();\n    this._resizeSub.unsubscribe();\n    this._destroyChart();\n  }\n\n  ngOnInit(): void {\n    if (this._resizeObserver != null) {\n      this._resizeObserver.observe(this._container);\n      this._resizeSub = this._resizeEvent\n        .pipe(debounceTime(200))\n        .subscribe(() => this._resizeChart());\n    }\n    this._ngZone.runOutsideAngular(() => {\n      this._echartsProvider().then(echarts => {\n        this._echarts = echarts;\n        this._initChart();\n      });\n    });\n  }\n\n  private _destroyChart(): void {\n    if (this._chart != null && !this._chart.isDisposed()) {\n      this._chart.dispose();\n      this._chart = undefined;\n    }\n  }\n\n  private _initChart(): void {\n    if (this._echarts == null) {\n      return;\n    }\n    this._chart = this._echarts.init(this._container, this._theme, {renderer: this._renderer});\n    if (this._chart == null) {\n      return;\n    }\n    if (this._options) {\n      this._chart.setOption(this._options);\n    }\n    this.chartInit.emit({echarts: this._echarts, chart: this._chart});\n  }\n\n  private _onResize(): void {\n    this._resizeEvent.emit();\n  }\n\n  private _resizeChart(): void {\n    if (this._chart != null) {\n      this._chart.resize();\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ModuleWithProviders, NgModule} from '@angular/core';\n\nimport {AjfEchartsConfig, AjfEchartsProvider, AJF_ECHARTS_PROVIDER} from './echarts-config';\nimport {AjfEchartsDirective} from './echarts-directive';\n\n@NgModule({\n  declarations: [AjfEchartsDirective],\n  exports: [AjfEchartsDirective],\n})\nexport class AjfEchartsModule {\n  static forRoot(config: AjfEchartsConfig): ModuleWithProviders<AjfEchartsModule> {\n    let echarts: any | AjfEchartsProvider = config.echarts;\n    if (typeof echarts !== 'function') {\n      echarts = (async () => echarts) as AjfEchartsProvider;\n    }\n    return {\n      ngModule: AjfEchartsModule,\n      providers: [{provide: AJF_ECHARTS_PROVIDER, useValue: echarts}],\n    };\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport * from './echarts-config';\nexport * from './echarts-directive';\nexport * from './echarts-module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}