{"version":3,"file":"ajf-core-image.mjs","sources":["../../../projects/core/image/src/image-type.ts","../../../projects/core/image/src/image.ts","../../../projects/core/image/src/public_api.ts","../../../projects/core/image/src/ajf-core-image.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\n// tslint:disable-next-line:prefer-const-enum\nexport enum AjfImageType {\n  Image,\n  Flag,\n  Icon,\n  LENGTH,\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  Directive,\n  ElementRef,\n  Input,\n  OnDestroy,\n  OnInit,\n  Renderer2,\n  RendererStyleFlags2,\n} from '@angular/core';\nimport {DomSanitizer, SafeResourceUrl} from '@angular/platform-browser';\nimport {BehaviorSubject, Observable, Subscription} from 'rxjs';\n\nimport {AjfImageIcon} from './image-icon';\nimport {AjfImageType} from './image-type';\n\n@Directive()\nexport abstract class AjfImage implements OnDestroy, OnInit {\n  iconComponent: ElementRef | undefined;\n\n  /**\n   * if 0 take image by url\n   * if 1 take image by icon\n   * if 2 take image by class\n   *\n   */\n  @Input()\n  set type(type: AjfImageType | null) {\n    this._imageType.next(type);\n  }\n\n  @Input()\n  set imageUrl(imageUrl: string | null) {\n    imageUrl = typeof imageUrl === 'string' ? imageUrl : '';\n    this._url.next(\n      imageUrl.startsWith('data:image/svg+xml;base64,')\n        ? this._domSanitizer.bypassSecurityTrustResourceUrl(imageUrl)\n        : imageUrl,\n    );\n  }\n\n  @Input()\n  set icon(icon: AjfImageIcon | null) {\n    this._iconObj.next(icon);\n  }\n\n  @Input()\n  set flag(flag: string | null) {\n    this._flagName.next(flag);\n  }\n\n  readonly imageTypes = AjfImageType;\n\n  private _imageType = new BehaviorSubject<AjfImageType | null>(null);\n  readonly imageType: Observable<AjfImageType | null> = this\n    ._imageType as Observable<AjfImageType | null>;\n\n  private _url = new BehaviorSubject<string | SafeResourceUrl | null>(null);\n  readonly url: Observable<string | SafeResourceUrl | null> = this._url as Observable<\n    string | SafeResourceUrl | null\n  >;\n\n  private _iconObj = new BehaviorSubject<AjfImageIcon | null>(null);\n  readonly iconObj: Observable<AjfImageIcon | null> = this\n    ._iconObj as Observable<AjfImageIcon | null>;\n\n  private _flagName = new BehaviorSubject<string | null>(null);\n  readonly flagName: Observable<string | null> = this._flagName as Observable<string | null>;\n\n  private _iconSub = Subscription.EMPTY;\n\n  constructor(\n    private _el: ElementRef,\n    private _renderer: Renderer2,\n    private _domSanitizer: DomSanitizer,\n  ) {\n    this._iconSub = this.iconObj.subscribe(() => this._updateIconSize());\n  }\n\n  ngOnDestroy(): void {\n    if (this._iconSub && !this._iconSub.closed) {\n      this._iconSub.unsubscribe();\n    }\n  }\n\n  ngOnInit(): void {\n    this._updateIconSize();\n  }\n\n  private _updateIconSize(): void {\n    const icon = this._iconObj.getValue();\n    if (icon == null) {\n      return;\n    }\n    const styles = this._el.nativeElement.style;\n    if (this.iconComponent == null || styles == null || styles.fontSize == null) {\n      return;\n    }\n    const fontSize: string = styles.fontSize;\n    if (fontSize.match(/^[0-9]+px$/) != null) {\n      const el = this.iconComponent.nativeElement;\n      this._renderer.setStyle(el, 'width', fontSize, RendererStyleFlags2.Important);\n      this._renderer.setStyle(el, 'height', fontSize, RendererStyleFlags2.Important);\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport * from './image-icon';\nexport * from './image-type';\nexport * from './image';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}