{"version":3,"file":"chart.js","sources":["../../../../../../src/core/chart/register-chart-plugins.ts","../../../../../../src/core/chart/chart.ts","../../../../../../src/core/chart/chart-module.ts","../../../../../../src/core/chart/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport * as Chart from 'chart.js';\nconst chartClass = (<any>Chart).default || Chart;\n\nexport function registerChartPlugins(plugins: any[]) {\n  if (plugins != null && plugins.length > 0) {\n    plugins.forEach(plugin => chartClass.plugins.register(plugin));\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AfterViewInit, ChangeDetectionStrategy, Component, ElementRef, Input, OnChanges,\n  Renderer2, SimpleChanges, ViewEncapsulation\n} from '@angular/core';\n\nimport * as Chart from 'chart.js';\nconst chartClass = (<any>Chart).default || Chart;\n// tslint:disable-next-line\nimport {ChartData, ChartOptions, ChartPoint} from 'chart.js';\nimport 'chart.piecelabel.js';\n\nimport {deepCopy} from '@ajf/core/utils';\nimport {ExtendedChartType} from './extended-chart-type';\n\n\n@Component({\n  selector: 'ajf-chart',\n  templateUrl: 'chart.html',\n  styleUrls: ['chart.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class AjfChartComponent implements AfterViewInit, OnChanges {\n  @Input() data: ChartData;\n  @Input() options: ChartOptions;\n  @Input() chartType: ExtendedChartType;\n\n  private _chart: Chart | null;\n  private _chartCanvasElement: any;\n  private _chartTypesNeedPoints: ExtendedChartType[] = ['scatter', 'bubble'];\n\n  constructor(private _el: ElementRef, private _renderer: Renderer2) { }\n\n  ngAfterViewInit(): void {\n    this._rebuildChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if ('chartType' in changes) {\n      this._rebuildChart();\n    } else if ('options' in changes || 'data' in changes) {\n      this._updateChart();\n    }\n  }\n\n  private _fixData(chartType: ExtendedChartType, data: ChartData): ChartData {\n    const newData: ChartData = deepCopy(data);\n    let maxPointsNum = 0;\n    (newData.datasets || []).forEach((dataset) => {\n      if (dataset.label == null) {\n        dataset.label = '';\n      }\n      maxPointsNum = Math.max(maxPointsNum, (dataset.data || []).length);\n      const datasetType = dataset.type != null ? <ExtendedChartType>dataset.type : chartType;\n      if (this._chartTypesNeedPoints.indexOf(datasetType) > -1) {\n        dataset.data = (<any[]>(dataset.data || [])).map((d, idx) => {\n          if (typeof d === 'number') {\n            return <any>{ x: idx, y: d, r: d };\n          }\n          return <ChartPoint>d;\n        });\n      }\n    });\n    const labels = newData.labels || [];\n    if (maxPointsNum > 0 && labels.length < maxPointsNum) {\n      for (let i = labels.length; i < maxPointsNum; i++) {\n        labels.push('');\n      }\n      newData.labels = labels;\n    }\n    return newData;\n  }\n\n  private _updateChart(): void {\n    if (this._chart == null) {\n      this._rebuildChart();\n    } else {\n      (<any>this._chart).options = {\n        ...deepCopy((<any>this._chart).options),\n        ...deepCopy(this.options || {})\n      };\n      this._chart.data = {\n        ...deepCopy(this._chart.data),\n        ...deepCopy(this.data)\n      };\n      this._chart.update();\n    }\n  }\n\n  private _rebuildChart(): void {\n    if (this._chart != null) {\n      this._chart.destroy();\n      this._chart = null;\n    }\n    if (this._chartCanvasElement != null) {\n      this._renderer.removeChild(this._el.nativeElement, this._chartCanvasElement);\n      this._chartCanvasElement = null;\n    }\n    if (this.data != null) {\n      this._chartCanvasElement = this._renderer.createElement('canvas');\n      this._renderer.setStyle(this._chartCanvasElement, 'width', 'inherit');\n      this._renderer.setStyle(this._chartCanvasElement, 'height', 'inherit');\n      this._renderer.appendChild(this._el.nativeElement, this._chartCanvasElement);\n      const ctx = this._chartCanvasElement.getContext('2d');\n      this._chart = new chartClass(ctx, {\n        type: this.chartType,\n        data: this._fixData(this.chartType, this.data),\n        options: this._fixChartOptions(this.options)\n      });\n    }\n  }\n\n  private _fixChartOptions(options: ChartOptions): ChartOptions {\n    options = options || {};\n    if (options.scales == null) {\n      options.scales = { xAxes: [], yAxes: [] };\n    }\n    if (options.scales.xAxes == null) {\n      options.scales.xAxes = [];\n    }\n    if (options.scales.yAxes == null) {\n      options.scales.yAxes = [];\n    }\n    if (this.chartType == 'pie') {\n      let newOptions = <any>options;\n      newOptions.pieceLabel = {\n        render: function (args: any) {\n          if (args.label) {\n            return args.label + ':' + args.value;\n          } else {\n            return args.value;\n          }\n        },\n        position: 'outside'\n      };\n      return newOptions;\n    }\n    return options;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {AjfChartComponent} from './chart';\n\n@NgModule({\n  declarations: [\n    AjfChartComponent\n  ],\n  exports: [\n    AjfChartComponent\n  ]\n})\nexport class AjfChartModule { }\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["((/** @type {?} */ (Chart))).default","chartClass"],"mappings":"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"}