{"version":3,"file":"map.js","sources":["../../../../../../src/core/map/map-container-directive.ts","../../../../../../src/core/map/map.ts","../../../../../../src/core/map/map-module.ts","../../../../../../src/core/map/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ElementRef, Directive} from '@angular/core';\n\n@Directive({\n  selector: '[mapContainer]'\n})\nexport class AjfMapContainerDirective {\n  get htmlElement(): HTMLElement { return this._el.nativeElement; }\n\n  constructor(private _el: ElementRef) { }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AfterViewInit, ChangeDetectionStrategy, Component, Input,\n  OnDestroy, ViewChild, ViewEncapsulation\n} from '@angular/core';\n\nimport {Subscription} from 'rxjs';\n\nimport * as L from 'leaflet';\nconst leafletLib = (L as any).default || L;\n\nimport {AjfMapContainerDirective} from './map-container-directive';\n\n@Component({\n  selector: 'ajf-map',\n  templateUrl: 'map.html',\n  styleUrls: ['map.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class AjfMapComponent implements AfterViewInit, OnDestroy {\n  @ViewChild(AjfMapContainerDirective, {static: true}) mapContainer: AjfMapContainerDirective;\n\n  private _coordinate: number[];\n  @Input() set coordinate(coordinate: number[]) {\n    this._coordinate = coordinate.slice(0);\n    this._setMapView();\n  }\n\n  private _tileLayer: string;\n  @Input() set tileLayer(tileLayer: string) {\n    this._tileLayer = tileLayer;\n    this._addTileLayerToMap();\n  }\n\n  private _attribution: string;\n  @Input() set attribution(attribution: string) {\n    this._attribution = attribution;\n    this._addTileLayerToMap();\n  }\n\n  private _disabled: boolean;\n  @Input() set disabled(disabled: boolean) {\n    this._disabled = disabled;\n    this._disableMap();\n  }\n\n\n  private _map: L.Map;\n  get map(): L.Map { return this._map; }\n\n  private _columnWidthChanged: Subscription = Subscription.EMPTY;\n\n  ngAfterViewInit(): void {\n    if (this.mapContainer) {\n      this._initMap();\n      this._setMapView();\n      this._addTileLayerToMap();\n      this._disableMap();\n    }\n  }\n\n  redraw() {\n    if (this.mapContainer && this._map) {\n      this._map.invalidateSize();\n    }\n  }\n\n  ngOnDestroy() {\n    this._columnWidthChanged.unsubscribe();\n  }\n\n  private _initMap(): void {\n    const options = {\n      zoomControl: false,\n      attributionControl: false\n    };\n\n    this._map = leafletLib.map(this.mapContainer.htmlElement, options);\n  }\n\n  private _setMapView(): void {\n    if (this._map == null) { return; }\n\n    let x, y, z;\n    if (this._coordinate != null && this._coordinate.length === 3) {\n      x = this._coordinate[0];\n      y = this._coordinate[1];\n      z = this._coordinate[2];\n    } else {\n      x = 0;\n      y = 0;\n      z = 14;\n    }\n    this._map.setView([x, y], z);\n  }\n\n  private _addTileLayerToMap(): void {\n    if (this._map == null || this._tileLayer == null) { return; }\n    this._map.eachLayer((l) => this._map.removeLayer(l));\n    leafletLib.tileLayer(this._tileLayer, {\n      attribution: this._attribution\n    }).addTo(this._map);\n  }\n\n  private _disableMap(): void {\n    if (this._map == null) { return; }\n\n    if (this._disabled) {\n      this._map.dragging.disable();\n      this._map.touchZoom.disable();\n      this._map.doubleClickZoom.disable();\n      this._map.scrollWheelZoom.disable();\n      this._map.boxZoom.disable();\n      this._map.keyboard.disable();\n      if (this._map.tap) {\n        this._map.tap.disable();\n      }\n    }\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {AjfMapContainerDirective} from './map-container-directive';\nimport {AjfMapComponent} from './map';\n\n@NgModule({\n  declarations: [\n    AjfMapComponent,\n    AjfMapContainerDirective\n  ],\n  exports: [\n    AjfMapComponent\n  ]\n})\nexport class AjfMapModule { }\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {AjfMapContainerDirective as Éµajf_src_core_map_map_a} from './map-container-directive';"],"names":["((/** @type {?} */ (L))).default"],"mappings":"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"}