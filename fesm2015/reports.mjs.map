{"version":3,"file":"reports.mjs","sources":["../../../../../../src/core/reports/base-widget.ts","../../../../../../src/core/reports/interface/charts/chart-type.ts","../../../../../../src/core/reports/chart-utils.ts","../../../../../../src/core/reports/get-column-content.ts","../../../../../../src/core/reports/interface/aggregation/aggregation-type.ts","../../../../../../src/core/reports/interface/widgets/widget-type.ts","../../../../../../src/core/reports/report.ts","../../../../../../src/core/reports/utils/reports/build-report-string-identifier.ts","../../../../../../src/core/reports/report-string-identifier.ts","../../../../../../src/core/reports/widget-export.ts","../../../../../../src/core/reports/widget-export.html","../../../../../../src/core/reports/widget-host.ts","../../../../../../src/core/reports/reports-module.ts","../../../../../../src/core/reports/utils/aggregation/create-aggregation.ts","../../../../../../src/core/reports/serializers/aggregation-serializer.ts","../../../../../../src/core/reports/utils/dataset/create-dataset.ts","../../../../../../src/core/reports/serializers/dataset-serializer.ts","../../../../../../src/core/reports/utils/widgets/create-widget.ts","../../../../../../src/core/reports/serializers/widget-serializer.ts","../../../../../../src/core/reports/serializers/report-container-serializer.ts","../../../../../../src/core/reports/utils/reports/create-report.ts","../../../../../../src/core/reports/serializers/report-serializer.ts","../../../../../../src/core/reports/widget.ts","../../../../../../src/core/reports/utils/widgets/widgets-map.ts","../../../../../../src/core/reports/widget-service.ts","../../../../../../src/core/reports/utils/aggregation/evaluate-aggregation.ts","../../../../../../src/core/reports/utils/widgets-instances/create-widget-instance.ts","../../../../../../src/core/reports/utils/widgets-instances/widget-instance-utils.ts","../../../../../../src/core/reports/utils/widgets-instances/widget-to-widget-instance.ts","../../../../../../src/core/reports/utils/reports-instances/create-report-container-instance.ts","../../../../../../src/core/reports/utils/reports-instances/create-report-instance.ts","../../../../../../src/core/reports/utils/reports/create-report-container.ts","../../../../../../src/core/reports/report-from-form/styles.ts","../../../../../../src/core/reports/report-from-form/report-from-form.ts","../../../../../../src/core/reports/report-to-pdf/load-report-images.ts","../../../../../../src/core/reports/report-to-pdf/report-to-pdf.ts","../../../../../../src/core/reports/public-api.ts","../../../../../../src/core/reports/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef, ElementRef} from '@angular/core';\nimport {AjfWidgetInstance} from './interface/widgets-instances/widget-instance';\n\nexport abstract class AjfBaseWidgetComponent<T extends AjfWidgetInstance = AjfWidgetInstance> {\n  private _instance: T;\n  get instance(): T {\n    return this._instance;\n  }\n  set instance(instance: T) {\n    if (this._instance !== instance) {\n      this._instance = instance;\n      this._cdr.detectChanges();\n    }\n  }\n\n  constructor(private _cdr: ChangeDetectorRef, readonly el: ElementRef) {}\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\n// tslint:disable-next-line:prefer-const-enum\nexport enum AjfChartType {\n  Line,\n  Bar,\n  HorizontalBar,\n  Radar,\n  Scatter,\n  Doughnut,\n  Pie,\n  PolarArea,\n  Bubble,\n  LENGTH,\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ExtendedChartType} from '@ajf/core/chart';\nimport {AjfChartType} from './interface/charts/chart-type';\n\nexport function chartToChartJsType(chartType?: AjfChartType): ExtendedChartType {\n  switch (chartType) {\n    case AjfChartType.Line:\n      return 'line';\n    case AjfChartType.Bar:\n      return 'bar';\n    case AjfChartType.HorizontalBar:\n      return 'horizontalBar';\n    case AjfChartType.Radar:\n      return 'radar';\n    case AjfChartType.Scatter:\n      return 'scatter';\n    case AjfChartType.Doughnut:\n      return 'doughnut';\n    case AjfChartType.Pie:\n      return 'pie';\n    case AjfChartType.PolarArea:\n      return 'polarArea';\n    case AjfChartType.Bubble:\n      return 'bubble';\n    default:\n      return 'line';\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Pipe} from '@angular/core';\nimport {AjfLayoutWidgetInstance} from './interface/widgets-instances/layout-widget-instance';\nimport {AjfWidgetInstance} from './interface/widgets-instances/widget-instance';\n\n@Pipe({name: 'ajfGetColumnContent'})\nexport class AjfGetColumnContentPipe {\n  transform(instance: AjfLayoutWidgetInstance, column: number): AjfWidgetInstance | null {\n    return column >= 0 && column < instance.content.length ? instance.content[column] : null;\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\n// tslint:disable-next-line:prefer-const-enum\nexport enum AjfAggregationType {\n  None,\n  Sum,\n  Average,\n  WeightedAverage,\n  LENGTH,\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\n// tslint:disable-next-line:prefer-const-enum\nexport enum AjfWidgetType {\n  Layout,\n  PageBreak,\n  Image,\n  Text,\n  Chart,\n  Table,\n  Map,\n  Column,\n  Formula,\n  ImageContainer,\n  DynamicTable,\n  LENGTH,\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef, Directive, Input} from '@angular/core';\n\nimport {AjfReportInstance} from './interface/reports-instances/report-instance';\nimport {AjfReport} from './interface/reports/report';\n\n@Directive()\nexport abstract class AjfReportRenderer {\n  private _instance: AjfReportInstance;\n  get instance(): AjfReportInstance {\n    return this._instance;\n  }\n  @Input()\n  set instance(instance: AjfReportInstance) {\n    this._instance = instance;\n    this._report = instance != null ? instance.report : null;\n    this._cdr.markForCheck();\n  }\n\n  private _report: AjfReport | null;\n  get report(): AjfReport | null {\n    return this._report;\n  }\n\n  constructor(private _cdr: ChangeDetectorRef) {}\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, buildStringIdentifier, BuildStringIdentifierOpts} from '@ajf/core/common';\n\nimport {AjfReport} from '../../interface/reports/report';\n\nexport const buildReportStringIdentifier = (\n  report: AjfReport,\n  context: AjfContext,\n  opts?: BuildStringIdentifierOpts,\n): string => {\n  if (report == null) {\n    return '';\n  }\n  const stringIdentifier = report.stringIdentifier || [];\n  if (stringIdentifier.length === 0) {\n    return '';\n  }\n  return buildStringIdentifier(stringIdentifier, context, opts);\n};\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, BuildStringIdentifierOpts} from '@ajf/core/common';\nimport {Pipe, PipeTransform} from '@angular/core';\n\nimport {AjfReport} from './interface/reports/report';\nimport {buildReportStringIdentifier} from './utils/reports/build-report-string-identifier';\n\n@Pipe({name: 'ajfReportStringIdentifier'})\nexport class AjfReportStringIdentifierPipe implements PipeTransform {\n  transform(report: AjfReport, context: AjfContext, opts?: BuildStringIdentifierOpts): string {\n    return buildReportStringIdentifier(report, context, opts);\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfTableCell} from '@ajf/core/table';\nimport {ChangeDetectionStrategy, Component, Input, ViewEncapsulation} from '@angular/core';\nimport {ChartData} from 'chart.js';\nimport {format} from 'date-fns';\nimport * as XLSX from 'xlsx';\n\nconst xlsxMod = ((XLSX as any).default || XLSX) as typeof XLSX;\n\nimport {AjfWidgetType} from '../reports/interface/widgets/widget-type';\n\n@Component({\n  selector: 'ajf-widget-export',\n  templateUrl: 'widget-export.html',\n  styleUrls: ['widget-export.css'],\n  encapsulation: ViewEncapsulation.None,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class AjfWidgetExport {\n  @Input() widgetType: AjfWidgetType;\n  @Input() data: ChartData | AjfTableCell[][];\n  @Input() overlay = true;\n  @Input() enable = false;\n\n  constructor() {}\n\n  /**\n   * Export widget data in CSV format\n   * @deprecated Use `AjfWidgetExport.export` with 'csv' parameter.\n   * @breaking-change 13.0.0\n   */\n  exportCsv(): void {\n    this.export('csv');\n  }\n\n  /**\n   * Export widget data in Xlsx format\n   * @deprecated Use `AjfWidgetExport.export` with 'xlsx' parameter.\n   * @breaking-change 13.0.0\n   */\n  exportXlsx(): void {\n    this.export('xlsx');\n  }\n\n  /**\n   * Export widget data in CSV or Xlsx format\n   */\n  export(bookType: 'csv' | 'xlsx'): void {\n    const sheetName = this._buildTitle(this.widgetType);\n    const sheets: {[sheet: string]: XLSX.WorkSheet} = {};\n    sheets[sheetName] = xlsxMod.utils.aoa_to_sheet(this._buildXlsxData());\n    const workBook: XLSX.WorkBook = {Sheets: sheets, SheetNames: [sheetName]};\n    xlsxMod.writeFile(workBook, `${sheetName}.${bookType}`, {\n      bookType,\n      type: 'array',\n    });\n  }\n\n  private _buildXlsxData(): unknown[][] {\n    let xlsxData: unknown[][] = [];\n    let labels: string[] = [];\n    switch (this.widgetType) {\n      default:\n      case AjfWidgetType.Chart:\n        this.data = this.data as ChartData;\n        const datasets = this.data.datasets || [];\n        labels = ['name'].concat(this.data.labels as string[]);\n        xlsxData.push(labels);\n        for (let i = 0; i < datasets.length; i++) {\n          const row: unknown[] = [];\n          const data = datasets[i].data || [];\n          row.push(datasets[i].label);\n          for (let j = 0; j < data.length; j++) {\n            row.push(data[j]);\n          }\n          xlsxData.push(row);\n        }\n        break;\n      case AjfWidgetType.Table:\n        this.data = this.data as AjfTableCell[][];\n        this.data.forEach((row: AjfTableCell[], idxRow: number) => {\n          const res: unknown[] = [];\n          if (idxRow === 0) {\n            row.forEach((elem: AjfTableCell) => {\n              labels.push(elem.value.changingThisBreaksApplicationSecurity);\n              if (elem.colspan && elem.colspan > 1) {\n                for (let i = 1; i < elem.colspan; i++) {\n                  labels.push(' ');\n                }\n              }\n            });\n            xlsxData.push(labels);\n          } else {\n            row.forEach((elem: AjfTableCell) => {\n              res.push(elem.value.changingThisBreaksApplicationSecurity);\n            });\n            xlsxData.push(res);\n          }\n        });\n        break;\n    }\n\n    return xlsxData;\n  }\n\n  private _buildTitle(widgetType: AjfWidgetType): string {\n    return `${AjfWidgetType[widgetType]} ${format(new Date(), `yyyy-MM-dd`)}`;\n  }\n}\n","<div class=\"ajf-widget-wrapper\">\n  <ng-content></ng-content>\n  <div *ngIf=\"enable\" class=\"ajf-export-menu\" [class.ajf-export-menu-overlay]=\"overlay\">\n      <button (click)=\"export('csv')\">CSV</button>\n      <button (click)=\"export('xlsx')\">XLSX</button>\n  </div>\n</div>\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Directive, ViewContainerRef} from '@angular/core';\n\n@Directive({selector: '[ajf-widget-host]'})\nexport class AjfWidgetHost {\n  constructor(readonly viewContainerRef: ViewContainerRef) {}\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\n\nimport {AjfGetColumnContentPipe} from './get-column-content';\nimport {AjfReportStringIdentifierPipe} from './report-string-identifier';\nimport {AjfWidgetExport} from './widget-export';\nimport {AjfWidgetHost} from './widget-host';\n\n@NgModule({\n  declarations: [\n    AjfGetColumnContentPipe,\n    AjfReportStringIdentifierPipe,\n    AjfWidgetHost,\n    AjfWidgetExport,\n  ],\n  imports: [CommonModule],\n  exports: [AjfGetColumnContentPipe, AjfReportStringIdentifierPipe, AjfWidgetHost, AjfWidgetExport],\n})\nexport class AjfReportsModule {}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfAggregation} from '../../interface/aggregation/aggregation';\nimport {AjfAggregationType} from '../../interface/aggregation/aggregation-type';\n\nexport type AjfAggregationCreate = Partial<AjfAggregation>;\n\nexport function createAggregation(aggregation: AjfAggregationCreate): AjfAggregation {\n  return {\n    ...aggregation,\n    aggregation: aggregation.aggregation || AjfAggregationType.None,\n  };\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfAggregation} from '../interface/aggregation/aggregation';\nimport {createAggregation} from '../utils/aggregation/create-aggregation';\n\nexport class AjfAggregationSerializer {\n  static fromJson(json: Partial<AjfAggregation>): AjfAggregation {\n    if (json.aggregation == null) {\n      throw new Error('Malformed aggregation');\n    }\n    return createAggregation({...json, aggregation: json.aggregation});\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfAggregationType} from '../../interface/aggregation/aggregation-type';\nimport {AjfDataset} from '../../interface/dataset/dataset';\nimport {createAggregation} from '../aggregation/create-aggregation';\n\nexport function createDataset(dataset: Partial<AjfDataset>): AjfDataset {\n  return {\n    ...dataset,\n    aggregation: dataset.aggregation || createAggregation({aggregation: AjfAggregationType.None}),\n  };\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfFormulaSerializer} from '@ajf/core/models';\n\nimport {AjfDataset} from '../interface/dataset/dataset';\nimport {createDataset} from '../utils/dataset/create-dataset';\n\nimport {AjfAggregationSerializer} from './aggregation-serializer';\n\nexport class AjfDatasetSerializer {\n  static fromJson(json: Partial<AjfDataset>): AjfDataset {\n    if (json.formula == null || json.aggregation == null || json.label == null) {\n      throw new Error('Malformed dataset');\n    }\n    json.formula =\n      json.formula instanceof Array\n        ? (json.formula = json.formula.map(f => AjfFormulaSerializer.fromJson(f)))\n        : AjfFormulaSerializer.fromJson(json.formula);\n    json.aggregation = AjfAggregationSerializer.fromJson(json.aggregation);\n    return createDataset(json);\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {alwaysCondition} from '@ajf/core/models';\nimport {AjfWidget} from '../../interface/widgets/widget';\n\nexport type AjfWidgetCreate = Pick<AjfWidget, 'widgetType'> & Partial<AjfWidget>;\n\nexport function createWidget(widget: AjfWidgetCreate): AjfWidget {\n  return {\n    ...widget,\n    styles: widget.styles || {},\n    visibility: widget.visibility || alwaysCondition(),\n  };\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfConditionSerializer, AjfFormulaSerializer, alwaysCondition} from '@ajf/core/models';\n\nimport {AjfChartDataset} from '../interface/dataset/chart-dataset';\nimport {AjfDataset} from '../interface/dataset/dataset';\nimport {AjfTableDataset} from '../interface/dataset/table-dataset';\nimport {AjfChartWidget} from '../interface/widgets/chart-widget';\nimport {AjfDataWidget} from '../interface/widgets/data-widget';\nimport {AjfMapWidget} from '../interface/widgets/map-widget';\nimport {AjfWidget} from '../interface/widgets/widget';\nimport {AjfWidgetType} from '../interface/widgets/widget-type';\nimport {AjfWidgetWithContent} from '../interface/widgets/widget-with-content';\nimport {createWidget} from '../utils/widgets/create-widget';\n\nimport {AjfDatasetSerializer} from './dataset-serializer';\n\nexport class AjfWidgetSerializer {\n  static fromJson(json: Partial<AjfWidget>): AjfWidget {\n    if (json.widgetType == null) {\n      throw new Error('Malformed widget');\n    }\n    json.visibility = json.visibility\n      ? AjfConditionSerializer.fromJson(json.visibility)\n      : alwaysCondition();\n    json.styles = json.styles || {};\n    const obj = json as AjfWidget;\n    if (obj.widgetType === AjfWidgetType.Layout || obj.widgetType === AjfWidgetType.Column) {\n      return AjfWidgetSerializer._widgetWithContentFromJson(obj);\n    }\n    if (obj.widgetType === AjfWidgetType.Chart || obj.widgetType === AjfWidgetType.Table) {\n      const w = AjfWidgetSerializer._dataWidgetFromJson(obj);\n      if (obj.widgetType === AjfWidgetType.Chart) {\n        const cw = w as AjfChartWidget;\n        if (cw.labels instanceof Array) {\n          cw.labels.map(l => AjfFormulaSerializer.fromJson(l));\n        } else if (cw.labels != null) {\n          cw.labels = AjfFormulaSerializer.fromJson(cw.labels);\n        }\n      }\n      return w;\n    }\n    if (obj.widgetType === AjfWidgetType.Map) {\n      const mw = obj as AjfMapWidget;\n      mw.coordinate = AjfFormulaSerializer.fromJson(mw.coordinate);\n    }\n    return obj;\n  }\n\n  private static _dataWidgetFromJson(json: AjfWidget & Partial<AjfDataWidget>): AjfDataWidget {\n    let dataset: AjfDataset[] | AjfDataset[][];\n    if (json.dataset == null) {\n      dataset = [];\n    } else {\n      if (json.widgetType === AjfWidgetType.Table) {\n        dataset = (json.dataset as AjfTableDataset[][]).map(row =>\n          row.map(cell => AjfDatasetSerializer.fromJson(cell)),\n        );\n      } else {\n        dataset = (json.dataset as AjfChartDataset[]).map(d => AjfDatasetSerializer.fromJson(d));\n      }\n    }\n    return {...createWidget(json), dataset};\n  }\n\n  private static _widgetWithContentFromJson(\n    json: AjfWidget & Partial<AjfWidgetWithContent>,\n  ): AjfWidgetWithContent {\n    const content = (json.content || []).map(c => AjfWidgetSerializer.fromJson(c));\n    return {...createWidget(json), content};\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfReportContainer} from '../interface/reports/report-container';\nimport {AjfWidgetSerializer} from './widget-serializer';\n\nexport class AjfReportContainerSerializer {\n  static fromJson(json: Partial<AjfReportContainer>): AjfReportContainer {\n    json.content = (json.content || []).map(c => AjfWidgetSerializer.fromJson(c));\n    return {...json, content: json.content!, styles: json.styles || {}};\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfReport} from '../../interface/reports/report';\n\nexport type AjfReportCreate = Partial<AjfReport>;\n\nexport function createReport(report: AjfReportCreate): AjfReport {\n  return {...report};\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfReport} from '../interface/reports/report';\nimport {AjfReportContainer} from '../interface/reports/report-container';\nimport {createReport} from '../utils/reports/create-report';\nimport {AjfReportContainerSerializer} from './report-container-serializer';\n\nexport class AjfReportSerializer {\n  static fromJson(json: Partial<AjfReport>): AjfReport {\n    const containers: (keyof AjfReport)[] = ['header', 'footer', 'content'];\n    containers.forEach(c => {\n      if (json[c]) {\n        (json[c] as AjfReportContainer) = AjfReportContainerSerializer.fromJson(\n          json[c] as Partial<AjfReportContainer>,\n        );\n      }\n    });\n    return createReport(json);\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  ComponentFactoryResolver,\n  Directive,\n  Input,\n  OnInit,\n  Renderer2,\n  ViewChild,\n} from '@angular/core';\n\nimport {AjfWidgetInstance} from './interface/widgets-instances/widget-instance';\nimport {AjfWidgetComponentsMap} from './interface/widgets/widget-components-map';\nimport {AjfWidgetHost} from './widget-host';\n\n@Directive()\nexport abstract class AjfReportWidget implements OnInit {\n  @ViewChild(AjfWidgetHost, {static: true}) widgetHost: AjfWidgetHost;\n\n  private _instance: AjfWidgetInstance;\n  get instance(): AjfWidgetInstance {\n    return this._instance;\n  }\n  @Input()\n  set instance(instance: AjfWidgetInstance) {\n    if (this._instance !== instance) {\n      this._instance = instance;\n      if (this._init) {\n        this._loadComponent();\n      }\n    }\n  }\n\n  protected abstract widgetsMap: AjfWidgetComponentsMap;\n\n  private _init = false;\n\n  constructor(private _cfr: ComponentFactoryResolver, private _renderer: Renderer2) {}\n\n  ngOnInit(): void {\n    this._init = true;\n    this._loadComponent();\n  }\n\n  private _loadComponent(): void {\n    if (\n      !this._init ||\n      this._instance == null ||\n      this.widgetHost == null ||\n      !this.instance.visible\n    ) {\n      return;\n    }\n\n    const vcr = this.widgetHost.viewContainerRef;\n    vcr.clear();\n    const componentDef = this.widgetsMap[this._instance.widget.widgetType];\n    if (componentDef == null) {\n      return;\n    }\n    const component = componentDef.component;\n    try {\n      const componentFactory = this._cfr.resolveComponentFactory(component);\n      const componentRef = vcr.createComponent(componentFactory);\n      const componentInstance = componentRef.instance;\n\n      Object.keys(this._instance.widget.styles).forEach((style: string) => {\n        try {\n          this._renderer.setStyle(\n            componentInstance.el.nativeElement,\n            style,\n            `${this._instance.widget.styles[style]}`,\n          );\n        } catch (e) {}\n      });\n\n      componentInstance.instance = this._instance;\n      if (componentDef.inputs) {\n        Object.keys(componentDef.inputs).forEach(key => {\n          if (key in componentInstance) {\n            (componentInstance as any)[key] = componentDef.inputs![key];\n          }\n        });\n      }\n    } catch (e) {}\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfWidgetComponentsMap} from '../../interface/widgets/widget-components-map';\n\nexport const componentsMap: AjfWidgetComponentsMap = {};\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Type} from '@angular/core';\n\nimport {AjfBaseWidgetComponent} from './base-widget';\nimport {AjfWidgetComponentsMap} from './interface/widgets/widget-components-map';\nimport {componentsMap} from './utils/widgets/widgets-map';\n\nexport abstract class AjfWidgetService {\n  readonly componentsMap: AjfWidgetComponentsMap = componentsMap;\n\n  constructor(defaultWidgets: AjfWidgetComponentsMap) {\n    if (defaultWidgets != null) {\n      for (const key in defaultWidgets) {\n        const nKey = parseInt(key, 10);\n        this.componentsMap[nKey] = defaultWidgets[key];\n      }\n    }\n  }\n\n  registerCustomWidget(widget: {\n    widgetType: number;\n    component: Type<AjfBaseWidgetComponent>;\n    inputs?: {[key: string]: any};\n  }): void {\n    const {widgetType, component} = widget;\n    if (widgetType < 100) {\n      throw new Error('Invalid custom widget type, it must be greater than 100');\n    }\n    if (component == null) {\n      throw new Error('Invalid custom widget component');\n    }\n    this.componentsMap[widgetType] = widget;\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, AjfFormula, evaluateExpression} from '@ajf/core/models';\nimport {AjfAggregation} from '../../interface/aggregation/aggregation';\nimport {AjfAggregationType} from '../../interface/aggregation/aggregation-type';\n\nexport function evaluateAggregation(\n  aggregation: AjfAggregation,\n  formulas: AjfFormula[],\n  context: AjfContext,\n): number[] {\n  const data: any[] = formulas.map(f => evaluateExpression(f.formula, context));\n  switch (aggregation.aggregation) {\n    case AjfAggregationType.None:\n      if (data.length !== 1) {\n        throw new Error('Invalid aggregation');\n      }\n      return data[0];\n    case AjfAggregationType.Sum:\n      return data.map((r: any) => r.reduce((s: any, d: any) => s + d, 0));\n    case AjfAggregationType.Average:\n    case AjfAggregationType.WeightedAverage:\n      return data.map((r: any) => {\n        const sum = r.reduce((s: any, d: any) => s + d, 0);\n        return sum / data.length;\n      });\n    default:\n      return [];\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\nimport {TranslocoService} from '@ajf/core/transloco';\n\nimport {AjfWidgetInstance} from '../../interface/widgets-instances/widget-instance';\nimport {AjfWidget} from '../../interface/widgets/widget';\n\nexport function createWidgetInstance(\n  widget: AjfWidget,\n  context: AjfContext,\n  _ts: TranslocoService,\n): AjfWidgetInstance {\n  return {\n    widget,\n    widgetType: widget.widgetType,\n    visible: evaluateExpression(widget.visibility.condition, context),\n    styles: widget.styles || {},\n  };\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, AjfFormula, evaluateExpression} from '@ajf/core/models';\nimport {TranslocoService} from '@ajf/core/transloco';\n\nexport function trFormula(f: AjfFormula, context: AjfContext, ts: TranslocoService): any {\n  let formula = f.formula;\n  if (formula.substr(0, 1) === '\"' || formula.substr(0, 1) === \"'\") {\n    const ft = formula.slice(1, -1);\n    const transFt =\n      ft != null && typeof ft === 'string' && ft.trim().length > 0 ? ts.translate(ft) : ft;\n    if (ft.length > 0) {\n      formula = `\"${transFt}\"`;\n    }\n  } else {\n    formula =\n      formula != null && typeof formula === 'string' && formula.trim().length > 0\n        ? ts.translate(formula)\n        : formula;\n  }\n  return evaluateExpression(formula, context);\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, AjfFormula, createFormula, evaluateExpression} from '@ajf/core/models';\nimport {AjfTableCell} from '@ajf/core/table';\nimport {TranslocoService} from '@ajf/core/transloco';\nimport {deepCopy} from '@ajf/core/utils';\n\nimport {chartToChartJsType} from '../../chart-utils';\nimport {AjfTableDataset} from '../../interface/dataset/table-dataset';\nimport {AjfChartWidgetInstance} from '../../interface/widgets-instances/chart-widget-instance';\nimport {AjfFormulaWidgetInstance} from '../../interface/widgets-instances/formula-widget-instance';\nimport {AjfImageContainerWidgetInstance} from '../../interface/widgets-instances/image-container-widget-instance';\nimport {AjfImageWidgetInstance} from '../../interface/widgets-instances/image-widget-instance';\nimport {AjfMapWidgetInstance} from '../../interface/widgets-instances/map-widget-instance';\nimport {AjfTableWidgetInstance} from '../../interface/widgets-instances/table-widget-instance';\nimport {AjfTextWidgetInstance} from '../../interface/widgets-instances/text-widget-instance';\nimport {AjfWidgetInstance} from '../../interface/widgets-instances/widget-instance';\nimport {AjfWidgetWithContentInstance} from '../../interface/widgets-instances/widget-with-content-instance';\nimport {AjfChartWidget} from '../../interface/widgets/chart-widget';\nimport {AjfDynamicTableWidget} from '../../interface/widgets/dynamic-table-widget';\nimport {AjfFormulaWidget} from '../../interface/widgets/formula-widget';\nimport {AjfImageContainerWidget} from '../../interface/widgets/image-container-widget';\nimport {AjfImageWidget} from '../../interface/widgets/image-widget';\nimport {AjfMapWidget} from '../../interface/widgets/map-widget';\nimport {AjfTableWidget} from '../../interface/widgets/table-widget';\nimport {AjfTextWidget} from '../../interface/widgets/text-widget';\nimport {AjfWidget} from '../../interface/widgets/widget';\nimport {AjfWidgetType} from '../../interface/widgets/widget-type';\nimport {AjfWidgetWithContent} from '../../interface/widgets/widget-with-content';\nimport {evaluateAggregation} from '../aggregation/evaluate-aggregation';\nimport {componentsMap} from '../widgets/widgets-map';\n\nimport {createWidgetInstance} from './create-widget-instance';\nimport {trFormula} from './widget-instance-utils';\n\nexport function widgetToWidgetInstance(\n  widget: AjfWidget,\n  context: AjfContext,\n  ts: TranslocoService,\n): AjfWidgetInstance {\n  const wi = createWidgetInstance(widget, context, ts);\n\n  if (widget.widgetType === AjfWidgetType.Column || widget.widgetType === AjfWidgetType.Layout) {\n    const wwc = widget as AjfWidgetWithContent;\n    const wwci = wi as AjfWidgetWithContentInstance;\n    let content = [] as AjfWidgetInstance[];\n    wwc.content.forEach(c => {\n      if (wwc.repetitions != null) {\n        wwci.repetitions = evaluateExpression(wwc.repetitions.formula, context);\n        if (typeof wwci.repetitions === 'number' && wwci.repetitions > 0) {\n          for (let i = 0; i < wwci.repetitions; i++) {\n            content.push(widgetToWidgetInstance(c, {...context, '$repetition': i}, ts));\n          }\n        }\n      } else {\n        content.push(widgetToWidgetInstance(c, context, ts));\n      }\n      wwci.content = content;\n    });\n  } else if (widget.widgetType === AjfWidgetType.Chart) {\n    const cw = widget as AjfChartWidget;\n    const cwi = wi as AjfChartWidgetInstance;\n    const labels = cw.labels instanceof Array ? cw.labels : [cw.labels];\n    const evLabels = labels.map(l => {\n      let evf = evaluateExpression(l.formula, context);\n      try {\n        if (evf instanceof Array) {\n          evf = evf.map(v =>\n            v != null && typeof v === 'string' && v.trim().length > 0 ? ts.translate(v) : v,\n          );\n        } else {\n          evf =\n            evf != null && typeof evf === 'string' && evf.trim().length > 0\n              ? ts.translate(evf)\n              : evf;\n        }\n      } catch (_e) {}\n      return evf;\n    });\n    cwi.labels = cw.labels instanceof Array ? evLabels : evLabels[0];\n    cwi.datasets = cw.dataset.map(d => {\n      let ds: any = {\n        ...(d.options || {}),\n        data: evaluateAggregation(d.aggregation, d.formula, context),\n      };\n      if (d.chartType != null) {\n        const ct = chartToChartJsType(d.chartType);\n        ds = {...ds, chartType: ct, type: ct};\n      }\n      if (d.options != null) {\n        ds = {...ds, options: d.options};\n      }\n      if (d.label != null) {\n        ds = {...ds, label: d.label.trim().length > 0 ? ts.translate(d.label) : d.label};\n      }\n      if (d.datalabels != null) {\n        ds.datalabels = deepCopy(d.datalabels);\n      }\n      return ds;\n    });\n    cwi.data = {labels: cwi.labels, datasets: cwi.datasets};\n    cwi.chartType = chartToChartJsType(cw.type || cw.chartType);\n    cwi.exportable =\n      cw.exportable && (cw.exportable === true || cw.exportable === 'true') ? true : false;\n    if (cw.options != null && cw.options.plugins != null) {\n      const plugins = cw.options.plugins;\n      const pluginNames = Object.keys(plugins);\n      pluginNames.forEach(pluginName => {\n        const plugin = plugins[pluginName];\n        const pluginOptions = Object.keys(plugin);\n        pluginOptions.forEach((pluginOptionName: string) => {\n          const pluginOption = plugin[pluginOptionName];\n          if (\n            typeof pluginOption !== 'string' &&\n            pluginOption != null &&\n            pluginOption.formula != null\n          ) {\n            plugin[pluginOptionName] = evaluateExpression(pluginOption.formula, context);\n          }\n        });\n      });\n    }\n  } else if (widget.widgetType === AjfWidgetType.Table) {\n    const tw = widget as AjfTableWidget;\n    const twi = wi as AjfTableWidgetInstance;\n\n    twi.dataset = tw.dataset.map(row =>\n      row.map(cell => {\n        return cell.formula instanceof Array\n          ? cell.formula.map(f => trFormula(f as AjfFormula, context as AjfContext, ts))\n          : trFormula(cell.formula!, context as AjfContext, ts);\n      }),\n    );\n    twi.exportable =\n      tw.exportable && (tw.exportable === true || tw.exportable === 'true') ? true : false;\n    twi.data = (tw.dataset || []).map(row =>\n      row.map(cell => {\n        let evf = '';\n        try {\n          evf =\n            cell.formula instanceof Array\n              ? cell.formula.map(f => trFormula(f as AjfFormula, context as AjfContext, ts))\n              : trFormula(cell.formula!, context as AjfContext, ts);\n        } catch (_e) {}\n        return {\n          value: evf,\n          style: {...tw.cellStyles, ...cell.style},\n          rowspan: cell.rowspan,\n          colspan: cell.colspan,\n        };\n      }),\n    );\n  } else if (widget.widgetType === AjfWidgetType.DynamicTable) {\n    const tdw = widget as AjfDynamicTableWidget;\n    const tdwi = wi as AjfTableWidgetInstance;\n\n    tdwi.dataset = tdw.dataset.map((cell: AjfTableDataset) => {\n      return cell.formula instanceof Array\n        ? cell.formula.map(f => trFormula(f as AjfFormula, context, ts))\n        : trFormula(cell.formula!, context, ts);\n    });\n    tdwi.exportable =\n      tdw.exportable && (tdw.exportable === true || tdw.exportable === 'true') ? true : false;\n\n    let dataset: AjfTableCell[][] = evaluateExpression(tdw.rowDefinition.formula, context) || [];\n    dataset = (dataset || []).map((row: AjfTableCell[]) =>\n      row.map(cell => {\n        let trf = cell.value;\n        try {\n          if (trf instanceof Array) {\n            trf = trf.map(v =>\n              v != null && typeof v === 'string' && v.trim().length > 0 ? ts.translate(v) : v,\n            );\n          } else {\n            trf =\n              trf != null && typeof trf === 'string' && trf.trim().length > 0\n                ? ts.translate(trf)\n                : trf;\n          }\n        } catch (_e) {}\n        return {...cell, value: trf};\n      }),\n    );\n\n    const header = (tdw.dataset || []).map(cell => {\n      let evf = '';\n      try {\n        evf =\n          cell.formula instanceof Array\n            ? cell.formula.map(f => trFormula(f as AjfFormula, context as AjfContext, ts))\n            : trFormula(cell.formula!, context as AjfContext, ts);\n      } catch (_e) {}\n      return {\n        value: evf,\n        style: {...tdw.cellStyles, ...cell.style},\n        rowspan: cell.rowspan,\n        colspan: cell.colspan,\n      };\n    });\n    tdwi.data = header.length === 0 ? [...dataset] : [[...header], ...dataset];\n  } else if (widget.widgetType === AjfWidgetType.Image) {\n    const iw = widget as AjfImageWidget;\n    const iwi = wi as AjfImageWidgetInstance;\n    if (iw.flag) {\n      iwi.flag = evaluateExpression(iw.flag.formula, context);\n    }\n    if (iw.icon) {\n      iwi.icon = evaluateExpression(iw.icon.formula, context);\n    }\n    if (iw.url) {\n      iwi.url = evaluateExpression(iw.url.formula, context);\n    }\n  } else if (widget.widgetType === AjfWidgetType.ImageContainer) {\n    const icw = widget as AjfImageContainerWidget;\n    const icwi = wi as AjfImageContainerWidgetInstance;\n    if (icw.flags) {\n      icwi.flags =\n        icw.flags instanceof Array\n          ? icw.flags.map(f => evaluateExpression(f.formula, context))\n          : evaluateExpression(icw.flags.formula, context);\n    }\n    if (icw.icons) {\n      icwi.icons =\n        icw.icons instanceof Array\n          ? icw.icons.map(f => evaluateExpression(f.formula, context))\n          : evaluateExpression(icw.icons.formula, context);\n    }\n    if (icw.urls) {\n      icwi.urls =\n        icw.urls instanceof Array\n          ? icw.urls.map(f => evaluateExpression(f.formula, context))\n          : evaluateExpression(icw.urls.formula, context);\n    }\n  } else if (widget.widgetType === AjfWidgetType.Text) {\n    const tew = widget as AjfTextWidget;\n    const tewi = wi as AjfTextWidgetInstance;\n    const formulaRegEx: RegExp = /\\[{2}(.+?)\\]{2}/g;\n    const matches: {idx: number; len: number; formula: AjfFormula}[] = [];\n    let match: RegExpExecArray | null;\n    let htmlText = tew.htmlText;\n    while ((match = formulaRegEx.exec(htmlText))) {\n      const idx = match.index;\n      const len = match[0].length;\n      const formula = createFormula({formula: match[1]});\n      matches.push({idx, len, formula});\n    }\n    matches.reverse().forEach(m => {\n      let calcValue;\n      try {\n        calcValue = evaluateExpression(m.formula.formula, context);\n      } catch (e) {\n        calcValue = '';\n      }\n      htmlText = `${htmlText.substr(0, m.idx)}${calcValue}${htmlText.substr(m.idx + m.len)}`;\n    });\n    tewi.htmlText = htmlText != null && htmlText.length > 0 ? ts.translate(htmlText) : htmlText;\n  } else if (widget.widgetType === AjfWidgetType.Formula) {\n    const fw = widget as AjfFormulaWidget;\n    const fwi = wi as AjfFormulaWidgetInstance;\n    fwi.formula = evaluateExpression(fw.formula.formula, context);\n  } else if (widget.widgetType === AjfWidgetType.Map) {\n    const mw = widget as AjfMapWidget;\n    const mwi = wi as AjfMapWidgetInstance;\n    mwi.coordinate = evaluateExpression(mw.coordinate.formula, context);\n  } else if (widget.widgetType > 100) {\n    const iiFn =\n      componentsMap[widget.widgetType] != null\n        ? componentsMap[widget.widgetType].initInstance\n        : null;\n    if (iiFn != null) {\n      return iiFn(wi, context, ts);\n    }\n  }\n  return wi;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext} from '@ajf/core/models';\nimport {TranslocoService} from '@ajf/core/transloco';\n\nimport {AjfReportContainerInstance} from '../../interface/reports-instances/report-container-instance';\nimport {AjfReportContainer} from '../../interface/reports/report-container';\nimport {widgetToWidgetInstance} from '../widgets-instances/widget-to-widget-instance';\n\nexport function createReportContainerInstance(\n  container: AjfReportContainer,\n  context: AjfContext,\n  ts: TranslocoService,\n): AjfReportContainerInstance {\n  const content = container.content.map(c => widgetToWidgetInstance(c, context, ts));\n  return {\n    container,\n    content,\n    styles: container.styles,\n  };\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfContext, evaluateExpression} from '@ajf/core/models';\nimport {TranslocoService} from '@ajf/core/transloco';\n\nimport {AjfReportInstance} from '../../interface/reports-instances/report-instance';\nimport {AjfReport} from '../../interface/reports/report';\n\nimport {createReportContainerInstance} from './create-report-container-instance';\n\nexport function createReportInstance(\n  report: AjfReport,\n  context: AjfContext,\n  ts: TranslocoService,\n): AjfReportInstance {\n  (report.variables || []).forEach(variable => {\n    context[variable.name] = evaluateExpression(variable.formula.formula, context);\n  });\n  return {\n    report,\n    header: report.header ? createReportContainerInstance(report.header, context, ts) : undefined,\n    content: report.content\n      ? createReportContainerInstance(report.content, context, ts)\n      : undefined,\n    footer: report.footer ? createReportContainerInstance(report.footer, context, ts) : undefined,\n    styles: report.styles || {},\n  };\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfReportContainer} from '../../interface/reports/report-container';\n\nexport type AjfReportContainerCreate = Partial<AjfReportContainer>;\n\nexport function createReportContainer(container: AjfReportContainer): AjfReportContainer {\n  return {...container};\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfStyles} from '../interface/styles';\n\nexport const slideTitleStyle: AjfStyles = {\n  width: '100%',\n  dislay: 'block',\n  border: '1px solid gray',\n  margin: '10px 10px 0px 10px',\n  padding: '10px',\n  backgroundColor: 'white',\n};\nexport const slideContentStyle: AjfStyles = {\n  with: '100%',\n  dislay: 'block',\n  border: '1px solid gray',\n  margin: '0px 10px 10px 50px',\n  padding: '10px',\n  backgroundColor: 'white',\n};\nexport const widgetTitleStyle: AjfStyles = {\n  width: '100%',\n  dislay: 'block',\n  border: '1px solid gray',\n  padding: '10px',\n  maxHeight: '600px',\n  backgroundColor: 'white',\n};\nexport const boxStyle: AjfStyles = {\n  dislay: 'block',\n  padding: '10px',\n  width: '100%',\n  height: '100%',\n};\nexport const widgetStyle: AjfStyles = {\n  backgroundColor: 'white',\n  dislay: 'block',\n  border: '1px solid gray',\n  padding: '10px',\n  maxHeight: '500px',\n  marginBottom: '10px',\n};\nexport const backgroundColor: string[] = [\n  '#FF6633',\n  '#FFB399',\n  '#FF33FF',\n  '#FFFF99',\n  '#00B3E6',\n  '#E6B333',\n  '#3366E6',\n  '#999966',\n  '#99FF99',\n  '#B34D4D',\n  '#80B300',\n  '#809900',\n  '#E6B3B3',\n  '#6680B3',\n  '#66991A',\n  '#FF99E6',\n  '#CCFF1A',\n  '#FF1A66',\n  '#E6331A',\n  '#33FFCC',\n  '#66994D',\n  '#B366CC',\n  '#4D8000',\n  '#B33300',\n  '#CC80CC',\n  '#66664D',\n  '#991AFF',\n  '#E666FF',\n  '#4DB3FF',\n  '#1AB399',\n  '#E666B3',\n  '#33991A',\n  '#CC9999',\n  '#B3B31A',\n  '#00E680',\n  '#4D8066',\n  '#809980',\n  '#E6FF80',\n  '#1AFF33',\n  '#999933',\n  '#FF3380',\n  '#CCCC00',\n  '#66E64D',\n  '#4D80CC',\n  '#9900B3',\n  '#E64D66',\n  '#4DB380',\n  '#FF4D4D',\n  '#99E6E6',\n  '#6666FF',\n  '#F44336',\n  '#FFEBEE',\n  '#FFCDD2',\n  '#EF9A9A',\n  '#E57373',\n  '#EF5350',\n  '#E53935',\n  '#D32F2F',\n  '#C62828',\n  '#B71C1C',\n  '#FF8A80',\n  '#FF5252',\n  '#FF1744',\n  '#D50000',\n  '#FCE4EC',\n  '#F8BBD0',\n  '#F48FB1',\n  '#F06292',\n  '#EC407A',\n  '#E91E63',\n  '#D81B60',\n  '#C2185B',\n  '#AD1457',\n  '#880E4F',\n  '#FF80AB',\n  '#FF4081',\n  '#F50057',\n  '#C51162',\n  '#F3E5F5',\n  '#E1BEE7',\n  '#CE93D8',\n  '#BA68C8',\n  '#AB47BC',\n  '#9C27B0',\n  '#8E24AA',\n  '#7B1FA2',\n  '#6A1B9A',\n  '#4A148C',\n  '#EA80FC',\n  '#E040FB',\n  '#D500F9',\n  '#AA00FF',\n  '#EDE7F6',\n  '#D1C4E9',\n  '#B39DDB',\n  '#9575CD',\n  '#7E57C2',\n  '#673AB7',\n  '#5E35B1',\n  '#512DA8',\n  '#4527A0',\n  '#311B92',\n  '#B388FF',\n  '#7C4DFF',\n  '#651FFF',\n  '#6200EA',\n  '#E8EAF6',\n  '#C5CAE9',\n  '#9FA8DA',\n  '#7986CB',\n  '#5C6BC0',\n  '#3F51B5',\n  '#3949AB',\n  '#303F9F',\n  '#283593',\n  '#1A237E',\n  '#8C9EFF',\n  '#536DFE',\n  '#3D5AFE',\n  '#304FFE',\n  '#E3F2FD',\n  '#BBDEFB',\n  '#90CAF9',\n  '#64B5F6',\n  '#42A5F5',\n  '#2196F3',\n  '#1E88E5',\n  '#1976D2',\n  '#1565C0',\n  '#0D47A1',\n  '#82B1FF',\n  '#448AFF',\n  '#2979FF',\n  '#2962FF',\n  '#E1F5FE',\n  '#B3E5FC',\n  '#81D4FA',\n  '#4FC3F7',\n  '#29B6F6',\n  '#03A9F4',\n  '#039BE5',\n  '#0288D1',\n  '#0277BD',\n  '#01579B',\n  '#80D8FF',\n  '#40C4FF',\n  '#00B0FF',\n  '#0091EA',\n  '#E0F7FA',\n  '#B2EBF2',\n  '#80DEEA',\n  '#4DD0E1',\n  '#26C6DA',\n  '#00BCD4',\n  '#00ACC1',\n  '#0097A7',\n  '#00838F',\n  '#6064',\n  '#84FFFF',\n  '#18FFFF',\n  '#00E5FF',\n  '#00B8D4',\n  '#E0F2F1',\n  '#B2DFDB',\n  '#80CBC4',\n  '#4DB6AC',\n  '#26A69A',\n  '#9688',\n  '#00897B',\n  '#00796B',\n  '#00695C',\n  '#004D40',\n  '#A7FFEB',\n  '#64FFDA',\n  '#1DE9B6',\n  '#00BFA5',\n  '#E8F5E9',\n  '#C8E6C9',\n  '#A5D6A7',\n  '#81C784',\n  '#66BB6A',\n  '#4CAF50',\n  '#43A047',\n  '#388E3C',\n  '#2E7D32',\n  '#1B5E20',\n  '#B9F6CA',\n  '#69F0AE',\n  '#00E676',\n  '#00C853',\n  '#F1F8E9',\n  '#DCEDC8',\n  '#C5E1A5',\n  '#AED581',\n  '#9CCC65',\n  '#8BC34A',\n  '#7CB342',\n  '#689F38',\n  '#558B2F',\n  '#33691E',\n  '#CCFF90',\n  '#B2FF59',\n  '#76FF03',\n  '#64DD17',\n  '#F9FBE7',\n  '#F0F4C3',\n  '#E6EE9C',\n  '#DCE775',\n  '#D4E157',\n  '#CDDC39',\n  '#C0CA33',\n  '#AFB42B',\n  '#9E9D24',\n  '#827717',\n  '#F4FF81',\n  '#EEFF41',\n  '#C6FF00',\n  '#AEEA00',\n  '#FFFDE7',\n  '#FFF9C4',\n  '#FFF59D',\n  '#FFF176',\n  '#FFEE58',\n  '#FFEB3B',\n  '#FDD835',\n  '#FBC02D',\n  '#F9A825',\n  '#F57F17',\n  '#FFFF8D',\n  '#FFFF00',\n  '#FFEA00',\n  '#FFD600',\n  '#FFF8E1',\n  '#FFECB3',\n  '#FFE082',\n  '#FFD54F',\n  '#FFCA28',\n  '#FFC107',\n  '#FFB300',\n  '#FFA000',\n  '#FF8F00',\n  '#FF6F00',\n  '#FFE57F',\n  '#FFD740',\n  '#FFC400',\n  '#FFAB00',\n  '#FFF3E0',\n  '#FFE0B2',\n  '#FFCC80',\n  '#FFB74D',\n  '#FFA726',\n  '#FF9800',\n  '#FB8C00',\n  '#F57C00',\n  '#EF6C00',\n  '#E65100',\n  '#FFD180',\n  '#FFAB40',\n  '#FF9100',\n  '#FF6D00',\n  '#FBE9E7',\n  '#FFCCBC',\n  '#FFAB91',\n  '#FF8A65',\n  '#FF7043',\n  '#FF5722',\n  '#F4511E',\n  '#E64A19',\n  '#D84315',\n  '#BF360C',\n  '#FF9E80',\n  '#FF6E40',\n  '#FF3D00',\n  '#DD2C00',\n  '#EFEBE9',\n  '#D7CCC8',\n  '#BCAAA4',\n  '#A1887F',\n  '#8D6E63',\n  '#795548',\n  '#6D4C41',\n  '#5D4037',\n  '#4E342E',\n  '#3E2723',\n  '#FAFAFA',\n  '#F5F5F5',\n  '#EEEEEE',\n  '#E0E0E0',\n  '#BDBDBD',\n  '#9E9E9E',\n  '#757575',\n  '#616161',\n  '#424242',\n  '#212121',\n  '#ECEFF1',\n  '#CFD8DC',\n  '#B0BEC5',\n  '#90A4AE',\n  '#78909C',\n  '#607D8B',\n  '#546E7A',\n  '#455A64',\n  '#37474F',\n  '#263238',\n];\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfField, AjfFieldType, AjfFieldWithChoices, AjfForm, AjfRangeField} from '@ajf/core/forms';\nimport {createFormula} from '@ajf/core/models';\n\nimport {AjfChartType} from '../interface/charts/chart-type';\nimport {AjfDataset} from '../interface/dataset/dataset';\nimport {AjfReport} from '../interface/reports/report';\nimport {AjfReportContainer} from '../interface/reports/report-container';\nimport {AjfReportVariable} from '../interface/reports/report-variable';\nimport {AjfWidget} from '../interface/widgets/widget';\nimport {AjfWidgetType} from '../interface/widgets/widget-type';\nimport {createDataset} from '../utils/dataset/create-dataset';\nimport {createReportContainer} from '../utils/reports/create-report-container';\nimport {AjfWidgetCreate, createWidget} from '../utils/widgets/create-widget';\nimport {\n  backgroundColor,\n  boxStyle,\n  slideContentStyle,\n  slideTitleStyle,\n  widgetStyle,\n  widgetTitleStyle,\n} from './styles';\n\nfunction createBooleanWidget(field: AjfField): AjfWidget {\n  return createWidget({\n    widgetType: AjfWidgetType.Column,\n    content: [\n      createWidget({\n        widgetType: AjfWidgetType.Chart,\n        type: AjfChartType.Pie,\n        labels: {formula: \"['True', 'False']\"},\n        dataset: [\n          createDataset({\n            label: 'true',\n            formula: [\n              createFormula({\n                formula: `[COUNTFORMS(forms,\"${field.name}===true\"),COUNTFORMS(forms,\"${field.name}===false\")]`,\n              }),\n            ],\n            options: {backgroundColor: ['green', 'red']},\n          } as Partial<AjfDataset>) as AjfDataset,\n        ],\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          legend: {display: true, position: 'bottom'},\n        },\n        styles: {width: '100%', height: '400px'},\n        exportable: true,\n      } as AjfWidgetCreate),\n    ],\n  } as AjfWidgetCreate);\n}\nfunction createMultipleChoiceWidget(field: AjfFieldWithChoices<any>): AjfWidget {\n  const choices = field.choicesOrigin.choices;\n  let dataset: AjfDataset[] = choices.map(\n    (c, index) =>\n      createDataset({\n        label: `${c.label}`,\n        formula: [\n          createFormula({\n            formula: `[COUNTFORMS(forms,\"${field.name}.indexOf('${c.value}') > -1\")]`,\n          }),\n        ],\n        options: {\n          backgroundColor: backgroundColor[index],\n          stack: `Stack ${index}`,\n        },\n      } as Partial<AjfDataset>) as AjfDataset,\n  );\n  let chartType = AjfChartType.Bar;\n  let labels = {formula: `[]`};\n\n  return createWidget({\n    widgetType: AjfWidgetType.Column,\n    content: [\n      createWidget({\n        widgetType: AjfWidgetType.Chart,\n        type: chartType,\n        labels,\n        dataset,\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          legend: {display: true, position: 'bottom'},\n        },\n        styles: {width: '100%', height: '400px'},\n        exportable: true,\n      } as AjfWidgetCreate),\n    ],\n  } as AjfWidgetCreate);\n}\nfunction createNumberWidget(field: AjfField): AjfWidget {\n  return createWidget({\n    widgetType: AjfWidgetType.Column,\n    styles: widgetStyle,\n    content: [\n      createWidget({\n        widgetType: AjfWidgetType.Layout,\n        columns: [0.33, 0.33, 0.33],\n        content: [\n          createWidget({\n            widgetType: AjfWidgetType.Column,\n            styles: boxStyle,\n            content: [\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                htmlText: `<div color=\"primary\"><h5>Mean</h5></div>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                'htmlText': `<p>[[MEAN(forms,\"${field.name}\")]] / [[MAX(forms,\"${field.name}\")]]</p>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n            ],\n          } as AjfWidgetCreate),\n          createWidget({\n            widgetType: AjfWidgetType.Column,\n            styles: boxStyle,\n            content: [\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                htmlText: `<div color=\"primary\"><h5>Median</h5></div>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                'htmlText': `<p>[[MEDIAN(forms,\"${field.name}\")]] / [[MAX(forms,\"${field.name}\")]]</p>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n            ],\n          } as AjfWidgetCreate),\n          createWidget({\n            widgetType: AjfWidgetType.Column,\n            styles: boxStyle,\n            content: [\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                htmlText: `<div color=\"primary\"><h5>Mode</h5></div>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                htmlText: `<p>[[MODE(forms,\"${field.name}\")]]</p>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n            ],\n          } as AjfWidgetCreate),\n        ],\n      } as AjfWidgetCreate),\n    ],\n  } as AjfWidgetCreate);\n}\nfunction createSingleChoiceWidget(field: AjfFieldWithChoices<any>): AjfWidget {\n  const choices = field.choicesOrigin.choices;\n  let dataset: AjfDataset[] = [];\n  let chartType = AjfChartType.Bar;\n  let labels = {formula: `[]`};\n\n  if (choices.length > 5) {\n    labels = {formula: `[${choices.map(c => `${JSON.stringify(c.label)}`)}]`};\n    chartType = AjfChartType.Pie;\n    dataset = [\n      createDataset({\n        label: field.label,\n        formula: [\n          createFormula({\n            formula: `[${choices\n              .map(choice => `COUNTFORMS(forms,\"${field.name}==='${choice.value}'\")`)\n              .toString()}]`,\n          }),\n        ],\n        options: {backgroundColor},\n      } as any) as AjfDataset,\n    ];\n  } else {\n    dataset = choices.map(\n      (c, index) =>\n        createDataset({\n          label: `${c.label}`,\n          formula: [createFormula({formula: `[COUNTFORMS(forms,\"${field.name}==='${c.value}'\")]`})],\n          options: {\n            backgroundColor: backgroundColor[index],\n            stack: `Stack ${index}`,\n          },\n        } as Partial<AjfDataset>) as AjfDataset,\n    );\n  }\n\n  return createWidget({\n    widgetType: AjfWidgetType.Column,\n    content: [\n      createWidget({\n        widgetType: AjfWidgetType.Chart,\n        type: chartType,\n        labels,\n        dataset,\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          legend: {display: true, position: 'bottom'},\n        },\n        styles: {width: '100%', height: '400px'},\n        exportable: true,\n      } as AjfWidgetCreate),\n    ],\n  } as AjfWidgetCreate);\n}\n\nfunction createRangeWidget(field: AjfRangeField): AjfWidget {\n  const end = field.end ?? 11;\n  const start = field.start ?? 1;\n  let choices = [];\n  for (let i = start; i <= end; i++) {\n    choices.push(i);\n  }\n\n  let labels = {formula: `[${JSON.stringify(field.label)}]`};\n  let dataset: AjfDataset[] = choices.map(\n    (_, index) =>\n      createDataset({\n        label: `${index + start}`,\n        formula: [\n          createFormula({formula: `[COUNTFORMS(forms,\"${field.name}===${index + 1 + start}\")]`}),\n        ],\n        options: {\n          backgroundColor: backgroundColor[index],\n          stack: `Stack ${index}`,\n        },\n      } as Partial<AjfDataset>) as AjfDataset,\n  );\n  return createWidget({\n    widgetType: AjfWidgetType.Column,\n    styles: widgetStyle,\n    content: [\n      createWidget({\n        widgetType: AjfWidgetType.Layout,\n        columns: [0.33, 0.33, 0.33],\n        content: [\n          createWidget({\n            widgetType: AjfWidgetType.Column,\n            styles: boxStyle,\n            content: [\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                htmlText: `<div color=\"primary\"><h5>Mean</h5></div>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                'htmlText': `<p>[[MEAN(forms,\"${field.name}\")]] / [[MAX(forms,\"${field.name}\")]]</p>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n            ],\n          } as AjfWidgetCreate),\n          createWidget({\n            widgetType: AjfWidgetType.Column,\n            styles: boxStyle,\n            content: [\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                htmlText: `<div color=\"primary\"><h5>Median</h5></div>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                'htmlText': `<p>[[MEDIAN(forms,\"${field.name}\")]] / [[MAX(forms,\"${field.name}\")]]</p>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n            ],\n          } as AjfWidgetCreate),\n          createWidget({\n            widgetType: AjfWidgetType.Column,\n            styles: boxStyle,\n            content: [\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                htmlText: `<div color=\"primary\"><h5>Mode</h5></div>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n              createWidget({\n                widgetType: AjfWidgetType.Text,\n                htmlText: `<p>[[MODE(forms,\"${field.name}\")]]</p>`,\n                styles: widgetTitleStyle,\n              } as AjfWidgetCreate),\n            ],\n          } as AjfWidgetCreate),\n        ],\n      } as AjfWidgetCreate),\n      createWidget({\n        widgetType: AjfWidgetType.Chart,\n        type: AjfChartType.Bar,\n        labels,\n        dataset,\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          legend: {display: true, position: 'bottom'},\n        },\n        styles: {width: '100%', height: '400px'},\n        exportable: true,\n      } as AjfWidgetCreate),\n    ],\n  } as AjfWidgetCreate);\n}\n\n/**\n * This function returns a basic report for any form passed in input.\n *\n * @param form the form schema\n * @param [id] the id of the form inside the plathform.\n */\nexport function reportFromForm(form: Partial<AjfForm>, id?: number): AjfReport {\n  const report: AjfReport = {};\n  const reportWidgets: AjfWidget[] = [];\n  // we assume that the array of forms passed to the report is called 'forms'.\n  if (id != null) {\n    report.variables = [{name: 'forms', formula: {'formula': `forms[${id}]`}} as AjfReportVariable];\n  }\n  form.nodes?.forEach(slide => {\n    const slideWidgets: AjfWidget[] = [];\n\n    (slide.nodes as AjfField[]).forEach((field: AjfField) => {\n      // create the title of the widget.\n      const fieldTitleWidget: AjfWidget = createWidget({\n        widgetType: AjfWidgetType.Text,\n        htmlText: `<div color=\"primary\"><h5>${field.label} - [[COUNTFORMS(forms,\"${field.name} != null\")]] answers</h5></div>`,\n        styles: widgetTitleStyle,\n      } as AjfWidgetCreate);\n      slideWidgets.push(fieldTitleWidget);\n\n      switch (field.fieldType) {\n        default:\n          slideWidgets.pop(); // remove the title of empty widget\n          break;\n        case AjfFieldType.Number:\n          slideWidgets.push(createNumberWidget(field));\n          break;\n        case AjfFieldType.Boolean:\n          slideWidgets.push(createBooleanWidget(field));\n          break;\n        case AjfFieldType.SingleChoice:\n          slideWidgets.push(createSingleChoiceWidget(field as AjfFieldWithChoices<any>));\n          break;\n        case AjfFieldType.MultipleChoice:\n          slideWidgets.push(createMultipleChoiceWidget(field as AjfFieldWithChoices<any>));\n          break;\n        case AjfFieldType.Range:\n          slideWidgets.push(createRangeWidget(field as AjfRangeField));\n          break;\n      }\n    });\n    // if the slide have a widgets add him to the reports with the relative title\n    if (slideWidgets.length > 0) {\n      // create the title of the slide.\n      const slideTitleWidget: AjfWidget = createWidget({\n        widgetType: AjfWidgetType.Text,\n        htmlText: `<div color=\"primary\"><h1>${slide.label}</h1></div>`,\n        styles: slideTitleStyle,\n      } as AjfWidgetCreate);\n      reportWidgets.push(slideTitleWidget);\n      // create the column with the slide widgets.\n      const columnWidget: AjfWidget = createWidget({\n        widgetType: AjfWidgetType.Column,\n        content: slideWidgets,\n        styles: slideContentStyle,\n      } as AjfWidgetCreate);\n      reportWidgets.push(columnWidget);\n    }\n  });\n\n  report.content = createReportContainer({content: [...reportWidgets]} as AjfReportContainer);\n\n  return report;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfImageWidgetInstance} from '../interface/widgets-instances/image-widget-instance';\nimport {AjfReportContainerInstance} from '../interface/reports-instances/report-container-instance';\nimport {AjfReportInstance} from '../interface/reports-instances/report-instance';\nimport {AjfWidgetInstance} from '../interface/widgets-instances/widget-instance';\nimport {AjfWidgetType} from '../interface/widgets/widget-type';\nimport {AjfWidgetWithContentInstance} from '../interface/widgets-instances/widget-with-content-instance';\n\nimport {AjfImageType} from '@ajf/core/image';\n\n// ImageMap maps image urls to dataurls, like:\n// 'http://whatever.com/image.png': 'data:image/png;base64,...'\n// It can also be used for icons, like:\n// '<span class=\"material-icons\">radio_button_checked</span>': 'X'\nexport interface ImageMap {\n  [url: string]: string;\n}\n\nexport function loadReportImages(report: AjfReportInstance): Promise<ImageMap> {\n  const promises: Promise<ImageMap>[] = [];\n  if (report.header != null) {\n    promises.push(loadContainerImages(report.header));\n  }\n  if (report.content != null) {\n    promises.push(loadContainerImages(report.content));\n  }\n  if (report.footer != null) {\n    promises.push(loadContainerImages(report.footer));\n  }\n  return new Promise<ImageMap>(resolve => {\n    Promise.all(promises).then(maps => {\n      let map: ImageMap = {};\n      for (const m of maps) {\n        map = {...map, ...m};\n      }\n      resolve(map);\n    });\n  });\n}\n\nfunction loadContainerImages(\n  container: AjfReportContainerInstance | AjfWidgetWithContentInstance,\n): Promise<ImageMap> {\n  const promises: Promise<ImageMap>[] = [];\n  for (let widget of container.content) {\n    promises.push(loadWidgetImages(widget));\n  }\n  return new Promise<ImageMap>(resolve => {\n    Promise.all(promises).then(maps => {\n      let map: ImageMap = {};\n      for (const m of maps) {\n        map = {...map, ...m};\n      }\n      resolve(map);\n    });\n  });\n}\n\nfunction loadWidgetImages(widget: AjfWidgetInstance): Promise<ImageMap> {\n  switch (widget.widgetType) {\n    case AjfWidgetType.Layout:\n    case AjfWidgetType.Column:\n      return loadContainerImages(widget as AjfWidgetWithContentInstance);\n    case AjfWidgetType.Image:\n      const image = widget as AjfImageWidgetInstance;\n      if (image.widget.imageType !== AjfImageType.Image) {\n        break;\n      }\n      return new Promise<ImageMap>(resolve => {\n        const req = new XMLHttpRequest();\n        req.onerror = () => resolve({}); // ignore 404's\n        req.onload = () => {\n          const r = new FileReader();\n          r.onerror = () => resolve({});\n          r.onloadend = () => {\n            const result = r.result as string;\n            if (result.startsWith('data:image')) {\n              const map: ImageMap = {};\n              map[image.url] = result;\n              resolve(map);\n            } else {\n              resolve({});\n            }\n          };\n          r.readAsDataURL(req.response);\n        };\n        req.open('GET', image.url);\n        req.responseType = 'blob';\n        req.send();\n      });\n  }\n  return new Promise<ImageMap>(resolve => resolve({}));\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AjfImageType} from '@ajf/core/image';\nimport {\n  Column,\n  Content,\n  ContentStack,\n  createPdf,\n  PageOrientation,\n  TableCell,\n  TCreatedPdf,\n  TDocumentDefinitions,\n} from '@ajf/core/pdfmake';\nimport {AjfTableCell} from '@ajf/core/table';\nimport {deepCopy} from '@ajf/core/utils';\n\nimport {AjfReportContainerInstance} from '../interface/reports-instances/report-container-instance';\nimport {AjfReportInstance} from '../interface/reports-instances/report-instance';\nimport {AjfChartWidgetInstance} from '../interface/widgets-instances/chart-widget-instance';\nimport {AjfColumnWidgetInstance} from '../interface/widgets-instances/column-widget-instance';\nimport {AjfFormulaWidgetInstance} from '../interface/widgets-instances/formula-widget-instance';\nimport {AjfImageWidgetInstance} from '../interface/widgets-instances/image-widget-instance';\nimport {AjfLayoutWidgetInstance} from '../interface/widgets-instances/layout-widget-instance';\nimport {AjfTableWidgetInstance} from '../interface/widgets-instances/table-widget-instance';\nimport {AjfTextWidgetInstance} from '../interface/widgets-instances/text-widget-instance';\nimport {AjfWidgetInstance} from '../interface/widgets-instances/widget-instance';\nimport {AjfWidgetType} from '../interface/widgets/widget-type';\n\nimport {ImageMap, loadReportImages} from './load-report-images';\n\nconst pageWidth = 800;\nconst pageHeight = pageWidth * 1.4142; // A4 proportions\nconst pageMargins: [number, number] = [40, 60];\n\nexport function openReportPdf(\n  report: AjfReportInstance,\n  orientation: PageOrientation = 'portrait',\n  icons: ImageMap = {},\n) {\n  createReportPdf(report, orientation, icons).then(pdf => {\n    pdf.open();\n  });\n}\n\nexport function createReportPdf(\n  report: AjfReportInstance,\n  orientation: PageOrientation = 'portrait',\n  icons: ImageMap = {},\n): Promise<TCreatedPdf> {\n  return new Promise<TCreatedPdf>(resolve => {\n    loadReportImages(report).then(images => {\n      let width = pageWidth - pageMargins[0] * 2;\n      if (orientation === 'landscape') {\n        width = pageHeight - pageMargins[1] * 2;\n      }\n      const pdfDef = reportToPdf(report, {...images, ...icons}, width);\n      pdfDef.pageSize = {width: pageWidth, height: pageHeight};\n      pdfDef.pageMargins = pageMargins;\n      pdfDef.pageOrientation = orientation;\n      resolve(createPdf(pdfDef));\n    });\n  });\n}\n\nfunction reportToPdf(\n  report: AjfReportInstance,\n  images: ImageMap,\n  width: number,\n): TDocumentDefinitions {\n  const stack: Content[] = [];\n  if (report.header != null) {\n    stack.push(containerToPdf(report.header, images, width));\n  }\n  if (report.content != null) {\n    stack.push(containerToPdf(report.content, images, width));\n  }\n  if (report.footer != null) {\n    stack.push(containerToPdf(report.footer, images, width));\n  }\n  return {content: {stack}};\n}\n\nfunction containerToPdf(\n  container: AjfReportContainerInstance,\n  images: ImageMap,\n  width: number,\n): Content {\n  return {stack: container.content.map(w => widgetToPdf(w, images, width))};\n}\n\nconst marginBetweenWidgets = 10;\n\nfunction widgetToPdf(widget: AjfWidgetInstance, images: ImageMap, width: number): Content {\n  switch (widget.widget.widgetType) {\n    case AjfWidgetType.Layout:\n      return layoutToPdf(widget as AjfLayoutWidgetInstance, images, width);\n    case AjfWidgetType.PageBreak:\n      return {text: '', pageBreak: 'after'};\n    case AjfWidgetType.Image:\n      return imageToPdf(widget as AjfImageWidgetInstance, images, width);\n    case AjfWidgetType.Text:\n      return textToPdf(widget as AjfTextWidgetInstance, images);\n    case AjfWidgetType.Chart:\n      const chart = widget as AjfChartWidgetInstance;\n      const dataUrl = chart.canvasDataUrl == null ? '' : chart.canvasDataUrl();\n      if (dataUrl === '') {\n        return {text: '[chart with no attached canvas]'};\n      }\n      return {image: dataUrl, width, margin: [0, 0, 0, marginBetweenWidgets]};\n    case AjfWidgetType.Table:\n    case AjfWidgetType.DynamicTable:\n      return tableToPdf(widget as AjfTableWidgetInstance, images);\n    case AjfWidgetType.Column:\n      const cw = widget as AjfColumnWidgetInstance;\n      return {stack: cw.content.map(w => widgetToPdf(w, images, width))};\n    case AjfWidgetType.Formula:\n      const fw = widget as AjfFormulaWidgetInstance;\n      return {text: fw.formula, margin: [0, 0, 0, marginBetweenWidgets]};\n    default:\n      return {text: ''};\n  }\n}\n\nfunction layoutToPdf(lw: AjfLayoutWidgetInstance, images: ImageMap, width: number): Content {\n  const columns = [...lw.widget.columns];\n  while (columns.length < lw.content.length) {\n    columns.push(1);\n  }\n  const childWidth = width / (columns.length || 1);\n  const children = [];\n  for (let i = 0; i < lw.content.length; i++) {\n    let child = widgetToPdf(lw.content[i], images, childWidth) as ContentStack;\n    // Children of Layout widgets are supposed to be Columns. If they aren't,\n    // we must wrap them to avoid problems like images having an 'auto' width.\n    if (child.stack == null) {\n      child = {stack: [child]};\n    }\n    (child as Column).width = columns[i] === -1 ? 'auto' : '*';\n    children.push(child);\n  }\n  return {columns: children};\n}\n\nfunction imageToPdf(image: AjfImageWidgetInstance, images: ImageMap, width: number): Content {\n  if (image.widget.imageType !== AjfImageType.Image) {\n    // Can't get icons to work, pdfs with multiple fonts don't seem to be working\n    return {text: ''};\n  }\n  const dataUrl = images[image.url];\n  if (dataUrl == null) {\n    return {text: ''};\n  }\n  const w = image.styles.width;\n  if (typeof w === 'string' && w.endsWith('px')) {\n    width = Number(w.slice(0, -2));\n  }\n  return {image: dataUrl, width, margin: [0, 0, 0, marginBetweenWidgets]};\n}\n\nfunction htmlTextToPdfText(htmlText: string, images: ImageMap): string {\n  const iconText = images[htmlText];\n  if (typeof iconText === 'string') {\n    return iconText;\n  }\n  return stripHTML(htmlText);\n}\n\nfunction textToPdf(tw: AjfTextWidgetInstance, images: ImageMap): Content {\n  const text: Content = {\n    text: htmlTextToPdfText(tw.htmlText, images),\n    margin: [0, 0, 0, marginBetweenWidgets],\n  };\n  if (tw.htmlText.startsWith('<h1>')) {\n    text.fontSize = 20;\n    text.margin = [0, 10, 0, marginBetweenWidgets];\n  } else if (tw.htmlText.startsWith('<h2>')) {\n    text.fontSize = 15;\n    text.margin = [0, 5, 0, marginBetweenWidgets];\n  }\n  return text;\n}\n\nfunction tableToPdf(table: AjfTableWidgetInstance, images: ImageMap): Content {\n  if (table.data == null || table.data.length === 0) {\n    return {text: ''};\n  }\n  const body: TableCell[][] = [];\n  for (const dataRow of expandColAndRowSpan(table.data)) {\n    const bodyRow: TableCell[] = [];\n    for (const cell of dataRow) {\n      let text = '';\n      switch (typeof cell.value) {\n        case 'number':\n          text = String(cell.value);\n          break;\n        case 'string':\n          text = htmlTextToPdfText(cell.value, images);\n          break;\n        case 'object':\n          let val = cell.value.changingThisBreaksApplicationSecurity;\n          if (typeof val === 'number') {\n            val = String(val);\n          }\n          text = htmlTextToPdfText(val || '', images);\n          break;\n      }\n      bodyRow.push({text, colSpan: cell.colspan, rowSpan: cell.rowspan});\n    }\n    body.push(bodyRow);\n  }\n  return {table: {headerRows: 0, body}, margin: [0, 0, 0, marginBetweenWidgets]};\n}\n\n// pdfmake wants placeholder cells after cells with col/rowspan > 1\nfunction expandColAndRowSpan(data: AjfTableCell[][]): AjfTableCell[][] {\n  data = deepCopy(data);\n  // expand colspan:\n  for (const row of data) {\n    for (let j = 0; j < row.length; j++) {\n      const cell = row[j];\n      for (let k = 1; k < (cell.colspan || 1); k++) {\n        row.splice(j + k, 0, {rowspan: cell.rowspan, value: '', style: {}});\n      }\n    }\n  }\n  // expand rowspan:\n  for (let i = 0; i < data.length; i++) {\n    const row = data[i];\n    for (let j = 0; j < row.length; j++) {\n      const cell = row[j];\n      for (let k = 1; k < (cell.rowspan || 1); k++) {\n        data[i + k].splice(j, 0, {value: '', style: {}});\n      }\n    }\n  }\n  return data;\n}\n\nfunction stripHTML(s: string): string {\n  return s.replace(/<\\/?[^>]+(>|$)/g, '');\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport * from './base-widget';\nexport * from './chart-utils';\nexport * from './get-column-content';\nexport * from './interface/aggregation/aggregation';\nexport * from './interface/aggregation/aggregation-type';\nexport * from './interface/charts/chart-type';\nexport * from './interface/dataset/chart-dataset';\nexport * from './interface/dataset/chart-dataset-options';\nexport * from './interface/dataset/dataset';\nexport * from './interface/dataset/table-dataset';\nexport * from './interface/reports/report';\nexport * from './interface/reports/report-container';\nexport * from './interface/reports/report-string-identifier';\nexport * from './interface/reports/report-variable';\nexport * from './interface/reports-instances/report-container-instance';\nexport * from './interface/reports-instances/report-instance';\nexport * from './interface/styles';\nexport * from './interface/widgets/chart-widget';\nexport * from './interface/widgets/column-widget';\nexport * from './interface/widgets/custom-widget';\nexport * from './interface/widgets/data-widget';\nexport * from './interface/widgets/formula-widget';\nexport * from './interface/widgets/image-container-widget';\nexport * from './interface/widgets/image-widget';\nexport * from './interface/widgets/layout-widget';\nexport * from './interface/widgets/map-widget';\nexport * from './interface/widgets/page-break-widget';\nexport * from './interface/widgets/table-widget';\nexport * from './interface/widgets/text-widget';\nexport * from './interface/widgets/widget';\nexport * from './interface/widgets/widget-type';\nexport * from './interface/widgets/widget-with-content';\nexport * from './interface/widgets-instances/chart-widget-instance';\nexport * from './interface/widgets-instances/column-widget-instance';\nexport * from './interface/widgets-instances/data-widget-instance';\nexport * from './interface/widgets-instances/formula-widget-instance';\nexport * from './interface/widgets-instances/image-container-widget-instance';\nexport * from './interface/widgets-instances/image-widget-instance';\nexport * from './interface/widgets-instances/layout-widget-instance';\nexport * from './interface/widgets-instances/map-widget-instance';\nexport * from './interface/widgets-instances/page-break-widget-instance';\nexport * from './interface/widgets-instances/table-widget-instance';\nexport * from './interface/widgets-instances/text-widget-instance';\nexport * from './interface/widgets-instances/widget-instance';\nexport * from './interface/widgets-instances/widget-with-content-instance';\nexport * from './report';\nexport * from './report-string-identifier';\nexport * from './reports-module';\nexport * from './serializers/aggregation-serializer';\nexport * from './serializers/dataset-serializer';\nexport * from './serializers/report-container-serializer';\nexport * from './serializers/report-serializer';\nexport * from './serializers/widget-serializer';\nexport * from './widget';\nexport * from './interface/widgets/widget-components-map';\nexport * from './widget-export';\nexport * from './widget-host';\nexport * from './widget-service';\n\nexport * from './utils/aggregation/create-aggregation';\nexport * from './utils/reports-instances/create-report-instance';\nexport * from './utils/widgets/create-widget';\nexport * from './utils/widgets-instances/create-widget-instance';\nexport * from './utils/widgets-instances/widget-to-widget-instance';\n\nexport * from './report-from-form/report-from-form';\nexport * from './report-to-pdf/report-to-pdf';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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AS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,OAAO;IACP,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,OAAO;IACP,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SAAS;IACT,SA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"}