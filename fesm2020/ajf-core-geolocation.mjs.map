{"version":3,"file":"ajf-core-geolocation.mjs","sources":["../../../projects/core/geolocation/src/geolocation-model.ts","../../../projects/core/geolocation/src/geolocation.ts","../../../projects/core/geolocation/src/public_api.ts","../../../projects/core/geolocation/src/ajf-core-geolocation.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {EventEmitter} from '@angular/core';\nimport {Observable} from 'rxjs';\n\nexport class AjfGeolocationModel {\n  private _changed: EventEmitter<string> = new EventEmitter<string>();\n  readonly changed: Observable<string> = this._changed as Observable<string>;\n\n  private _latitude = '';\n  private _longitude = '';\n\n  get longitude() {\n    return this._longitude;\n  }\n  set longitude(value: string) {\n    if (value) {\n      this._longitude = value.toString().replace(',', '.');\n      this._changed.emit(this.toString());\n    }\n  }\n\n  get latitude() {\n    return this._latitude;\n  }\n  set latitude(value: string) {\n    if (value) {\n      this._latitude = value.toString().replace(',', '.');\n      this._changed.emit(this.toString());\n    }\n  }\n\n  toString() {\n    return `${this.latitude},${this.longitude}`;\n  }\n\n  fromString(value: string) {\n    try {\n      let splitted = value.toString().split(',');\n      if (splitted.length == 2) {\n        this.latitude = splitted[0];\n        this.longitude = splitted[1];\n      }\n    } catch (e) {}\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef, Directive, Input, OnDestroy} from '@angular/core';\nimport {ControlValueAccessor} from '@angular/forms';\nimport {Subscription} from 'rxjs';\n\nimport {AjfGeolocationModel} from './geolocation-model';\n\n@Directive()\nexport abstract class AjfGeolocation implements ControlValueAccessor, OnDestroy {\n  @Input() readonly: boolean = false;\n\n  get geolocation(): AjfGeolocationModel {\n    return this._value;\n  }\n\n  private _value: AjfGeolocationModel = new AjfGeolocationModel();\n  get value(): string {\n    return this._value.toString();\n  }\n\n  set value(value: string) {\n    if (value !== this._value.toString()) {\n      this._value.fromString(value);\n      this._onChangeCallback(value);\n    }\n  }\n\n  get latitude(): string {\n    return this._value.latitude;\n  }\n  set latitude(latitude: string) {\n    this._value.latitude = latitude;\n    this._cdr.detectChanges();\n    this._onChangeCallback(this._value.toString());\n  }\n\n  get longitude(): string {\n    return this._value.longitude;\n  }\n  set longitude(longitude: string) {\n    this._value.longitude = longitude;\n    this._cdr.detectChanges();\n    this._onChangeCallback(this._value.toString());\n  }\n\n  private _onChangeCallback: (_: any) => void = (_: any) => {};\n  private _onTouchedCallback: () => void = () => {};\n  private _valueChangeSub: Subscription = Subscription.EMPTY;\n\n  constructor(protected _cdr: ChangeDetectorRef) {\n    this._valueChangeSub = this._value.changed.subscribe((x: string) => {\n      this._onChangeCallback(x);\n    });\n  }\n\n  getLocation(): void {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (position: any) => {\n          if (position) {\n            this.latitude = position.coords.latitude;\n            this.longitude = position.coords.longitude;\n          }\n        },\n        error => console.log(error),\n      );\n    } else {\n      console.log('Geolocation is not supported by this device or browser.');\n    }\n  }\n\n  ngOnDestroy(): void {\n    this._valueChangeSub.unsubscribe();\n  }\n\n  writeValue(value: string) {\n    this._value.fromString(value);\n  }\n\n  registerOnChange(fn: (value: any) => void) {\n    this._onChangeCallback = fn;\n  }\n\n  registerOnTouched(fn: any) {\n    this._onTouchedCallback = fn;\n  }\n\n  focusHandler(): void {\n    this._onTouchedCallback();\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Advanced JSON forms (ajf).\n *\n * Advanced JSON forms (ajf) is free software: you can redistribute it and/or\n * modify it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * Advanced JSON forms (ajf) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero\n * General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with Advanced JSON forms (ajf).\n * If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport * from './geolocation';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}